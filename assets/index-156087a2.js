var yee=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var S9e=yee((H9e,ZZ)=>{function Gz(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Ii=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function m0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function bee(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Hz={exports:{}},LS={},qz={exports:{}},Nt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g0=Symbol.for("react.element"),xee=Symbol.for("react.portal"),wee=Symbol.for("react.fragment"),See=Symbol.for("react.strict_mode"),Cee=Symbol.for("react.profiler"),kee=Symbol.for("react.provider"),Tee=Symbol.for("react.context"),Eee=Symbol.for("react.forward_ref"),_ee=Symbol.for("react.suspense"),Iee=Symbol.for("react.memo"),Ree=Symbol.for("react.lazy"),T3=Symbol.iterator;function Nee(t){return t===null||typeof t!="object"?null:(t=T3&&t[T3]||t["@@iterator"],typeof t=="function"?t:null)}var Kz={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xz=Object.assign,Jz={};function zm(t,e,n){this.props=t,this.context=e,this.refs=Jz,this.updater=n||Kz}zm.prototype.isReactComponent={};zm.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zm.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Yz(){}Yz.prototype=zm.prototype;function NR(t,e,n){this.props=t,this.context=e,this.refs=Jz,this.updater=n||Kz}var PR=NR.prototype=new Yz;PR.constructor=NR;Xz(PR,zm.prototype);PR.isPureReactComponent=!0;var E3=Array.isArray,Qz=Object.prototype.hasOwnProperty,AR={current:null},Zz={key:!0,ref:!0,__self:!0,__source:!0};function eW(t,e,n){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)Qz.call(e,r)&&!Zz.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var u=Array(a),c=0;c<a;c++)u[c]=arguments[c+2];i.children=u}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:g0,type:t,key:o,ref:s,props:i,_owner:AR.current}}function Pee(t,e){return{$$typeof:g0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function $R(t){return typeof t=="object"&&t!==null&&t.$$typeof===g0}function Aee(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _3=/\/+/g;function Y2(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Aee(""+t.key):e.toString(36)}function ex(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case g0:case xee:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+Y2(s,0):r,E3(i)?(n="",t!=null&&(n=t.replace(_3,"$&/")+"/"),ex(i,e,n,"",function(c){return c})):i!=null&&($R(i)&&(i=Pee(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(_3,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",E3(t))for(var a=0;a<t.length;a++){o=t[a];var u=r+Y2(o,a);s+=ex(o,e,n,u,i)}else if(u=Nee(t),typeof u=="function")for(t=u.call(t),a=0;!(o=t.next()).done;)o=o.value,u=r+Y2(o,a++),s+=ex(o,e,n,u,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function Mb(t,e,n){if(t==null)return t;var r=[],i=0;return ex(t,r,"","",function(o){return e.call(n,o,i++)}),r}function $ee(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Fi={current:null},tx={transition:null},Dee={ReactCurrentDispatcher:Fi,ReactCurrentBatchConfig:tx,ReactCurrentOwner:AR};Nt.Children={map:Mb,forEach:function(t,e,n){Mb(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Mb(t,function(){e++}),e},toArray:function(t){return Mb(t,function(e){return e})||[]},only:function(t){if(!$R(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Nt.Component=zm;Nt.Fragment=wee;Nt.Profiler=Cee;Nt.PureComponent=NR;Nt.StrictMode=See;Nt.Suspense=_ee;Nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Dee;Nt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Xz({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=AR.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(u in e)Qz.call(e,u)&&!Zz.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){a=Array(u);for(var c=0;c<u;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:g0,type:t.type,key:i,ref:o,props:r,_owner:s}};Nt.createContext=function(t){return t={$$typeof:Tee,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kee,_context:t},t.Consumer=t};Nt.createElement=eW;Nt.createFactory=function(t){var e=eW.bind(null,t);return e.type=t,e};Nt.createRef=function(){return{current:null}};Nt.forwardRef=function(t){return{$$typeof:Eee,render:t}};Nt.isValidElement=$R;Nt.lazy=function(t){return{$$typeof:Ree,_payload:{_status:-1,_result:t},_init:$ee}};Nt.memo=function(t,e){return{$$typeof:Iee,type:t,compare:e===void 0?null:e}};Nt.startTransition=function(t){var e=tx.transition;tx.transition={};try{t()}finally{tx.transition=e}};Nt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Nt.useCallback=function(t,e){return Fi.current.useCallback(t,e)};Nt.useContext=function(t){return Fi.current.useContext(t)};Nt.useDebugValue=function(){};Nt.useDeferredValue=function(t){return Fi.current.useDeferredValue(t)};Nt.useEffect=function(t,e){return Fi.current.useEffect(t,e)};Nt.useId=function(){return Fi.current.useId()};Nt.useImperativeHandle=function(t,e,n){return Fi.current.useImperativeHandle(t,e,n)};Nt.useInsertionEffect=function(t,e){return Fi.current.useInsertionEffect(t,e)};Nt.useLayoutEffect=function(t,e){return Fi.current.useLayoutEffect(t,e)};Nt.useMemo=function(t,e){return Fi.current.useMemo(t,e)};Nt.useReducer=function(t,e,n){return Fi.current.useReducer(t,e,n)};Nt.useRef=function(t){return Fi.current.useRef(t)};Nt.useState=function(t){return Fi.current.useState(t)};Nt.useSyncExternalStore=function(t,e,n){return Fi.current.useSyncExternalStore(t,e,n)};Nt.useTransition=function(){return Fi.current.useTransition()};Nt.version="18.2.0";qz.exports=Nt;var A=qz.exports;const Do=m0(A),gE=Gz({__proto__:null,default:Do},[A]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oee=A,Fee=Symbol.for("react.element"),Lee=Symbol.for("react.fragment"),Mee=Object.prototype.hasOwnProperty,Bee=Oee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Uee={key:!0,ref:!0,__self:!0,__source:!0};function tW(t,e,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Mee.call(e,r)&&!Uee.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Fee,type:t,key:o,ref:s,props:i,_owner:Bee.current}}LS.Fragment=Lee;LS.jsx=tW;LS.jsxs=tW;Hz.exports=LS;var P=Hz.exports,vE={},nW={exports:{}},Vo={},rW={exports:{}},iW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(q,Z){var se=q.length;q.push(Z);e:for(;0<se;){var fe=se-1>>>1,xe=q[fe];if(0<i(xe,Z))q[fe]=Z,q[se]=xe,se=fe;else break e}}function n(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var Z=q[0],se=q.pop();if(se!==Z){q[0]=se;e:for(var fe=0,xe=q.length,be=xe>>>1;fe<be;){var pe=2*(fe+1)-1,ge=q[pe],Ce=pe+1,$e=q[Ce];if(0>i(ge,se))Ce<xe&&0>i($e,ge)?(q[fe]=$e,q[Ce]=se,fe=Ce):(q[fe]=ge,q[pe]=se,fe=pe);else if(Ce<xe&&0>i($e,se))q[fe]=$e,q[Ce]=se,fe=Ce;else break e}}return Z}function i(q,Z){var se=q.sortIndex-Z.sortIndex;return se!==0?se:q.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var u=[],c=[],l=1,d=null,f=3,h=!1,p=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(q){for(var Z=n(c);Z!==null;){if(Z.callback===null)r(c);else if(Z.startTime<=q)r(c),Z.sortIndex=Z.expirationTime,e(u,Z);else break;Z=n(c)}}function x(q){if(m=!1,b(q),!p)if(n(u)!==null)p=!0,ne(S);else{var Z=n(c);Z!==null&&oe(x,Z.startTime-q)}}function S(q,Z){p=!1,m&&(m=!1,g(E),E=-1),h=!0;var se=f;try{for(b(Z),d=n(u);d!==null&&(!(d.expirationTime>Z)||q&&!$());){var fe=d.callback;if(typeof fe=="function"){d.callback=null,f=d.priorityLevel;var xe=fe(d.expirationTime<=Z);Z=t.unstable_now(),typeof xe=="function"?d.callback=xe:d===n(u)&&r(u),b(Z)}else r(u);d=n(u)}if(d!==null)var be=!0;else{var pe=n(c);pe!==null&&oe(x,pe.startTime-Z),be=!1}return be}finally{d=null,f=se,h=!1}}var C=!1,T=null,E=-1,I=5,N=-1;function $(){return!(t.unstable_now()-N<I)}function F(){if(T!==null){var q=t.unstable_now();N=q;var Z=!0;try{Z=T(!0,q)}finally{Z?H():(C=!1,T=null)}}else C=!1}var H;if(typeof y=="function")H=function(){y(F)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,J=G.port2;G.port1.onmessage=F,H=function(){J.postMessage(null)}}else H=function(){v(F,0)};function ne(q){T=q,C||(C=!0,H())}function oe(q,Z){E=v(function(){q(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_continueExecution=function(){p||h||(p=!0,ne(S))},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(q){switch(f){case 1:case 2:case 3:var Z=3;break;default:Z=f}var se=f;f=Z;try{return q()}finally{f=se}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(q,Z){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var se=f;f=q;try{return Z()}finally{f=se}},t.unstable_scheduleCallback=function(q,Z,se){var fe=t.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?fe+se:fe):se=fe,q){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=se+xe,q={id:l++,callback:Z,priorityLevel:q,startTime:se,expirationTime:xe,sortIndex:-1},se>fe?(q.sortIndex=se,e(c,q),n(u)===null&&q===n(c)&&(m?(g(E),E=-1):m=!0,oe(x,se-fe))):(q.sortIndex=xe,e(u,q),p||h||(p=!0,ne(S))),q},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(q){var Z=f;return function(){var se=f;f=Z;try{return q.apply(this,arguments)}finally{f=se}}}})(iW);rW.exports=iW;var Vee=rW.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oW=A,Bo=Vee;function Te(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sW=new Set,ny={};function nh(t,e){dm(t,e),dm(t+"Capture",e)}function dm(t,e){for(ny[t]=e,t=0;t<e.length;t++)sW.add(e[t])}var Nc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yE=Object.prototype.hasOwnProperty,zee=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I3={},R3={};function Wee(t){return yE.call(R3,t)?!0:yE.call(I3,t)?!1:zee.test(t)?R3[t]=!0:(I3[t]=!0,!1)}function jee(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Gee(t,e,n,r){if(e===null||typeof e>"u"||jee(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Li(t,e,n,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var zr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){zr[t]=new Li(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];zr[e]=new Li(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){zr[t]=new Li(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){zr[t]=new Li(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){zr[t]=new Li(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){zr[t]=new Li(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){zr[t]=new Li(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){zr[t]=new Li(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){zr[t]=new Li(t,5,!1,t.toLowerCase(),null,!1,!1)});var DR=/[\-:]([a-z])/g;function OR(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(DR,OR);zr[e]=new Li(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(DR,OR);zr[e]=new Li(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(DR,OR);zr[e]=new Li(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){zr[t]=new Li(t,1,!1,t.toLowerCase(),null,!1,!1)});zr.xlinkHref=new Li("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){zr[t]=new Li(t,1,!1,t.toLowerCase(),null,!0,!0)});function FR(t,e,n,r){var i=zr.hasOwnProperty(e)?zr[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Gee(e,n,i,r)&&(n=null),r||i===null?Wee(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Gc=oW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Bb=Symbol.for("react.element"),cp=Symbol.for("react.portal"),lp=Symbol.for("react.fragment"),LR=Symbol.for("react.strict_mode"),bE=Symbol.for("react.profiler"),aW=Symbol.for("react.provider"),uW=Symbol.for("react.context"),MR=Symbol.for("react.forward_ref"),xE=Symbol.for("react.suspense"),wE=Symbol.for("react.suspense_list"),BR=Symbol.for("react.memo"),bl=Symbol.for("react.lazy"),cW=Symbol.for("react.offscreen"),N3=Symbol.iterator;function Ag(t){return t===null||typeof t!="object"?null:(t=N3&&t[N3]||t["@@iterator"],typeof t=="function"?t:null)}var Dn=Object.assign,Q2;function sv(t){if(Q2===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Q2=e&&e[1]||""}return`
`+Q2+t}var Z2=!1;function ek(t,e){if(!t||Z2)return"";Z2=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var u=`
`+i[s].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=s&&0<=a);break}}}finally{Z2=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?sv(t):""}function Hee(t){switch(t.tag){case 5:return sv(t.type);case 16:return sv("Lazy");case 13:return sv("Suspense");case 19:return sv("SuspenseList");case 0:case 2:case 15:return t=ek(t.type,!1),t;case 11:return t=ek(t.type.render,!1),t;case 1:return t=ek(t.type,!0),t;default:return""}}function SE(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case lp:return"Fragment";case cp:return"Portal";case bE:return"Profiler";case LR:return"StrictMode";case xE:return"Suspense";case wE:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case uW:return(t.displayName||"Context")+".Consumer";case aW:return(t._context.displayName||"Context")+".Provider";case MR:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case BR:return e=t.displayName||null,e!==null?e:SE(t.type)||"Memo";case bl:e=t._payload,t=t._init;try{return SE(t(e))}catch{}}return null}function qee(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return SE(e);case 8:return e===LR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function od(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function lW(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Kee(t){var e=lW(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ub(t){t._valueTracker||(t._valueTracker=Kee(t))}function dW(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=lW(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Kx(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function CE(t,e){var n=e.checked;return Dn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function P3(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=od(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function fW(t,e){e=e.checked,e!=null&&FR(t,"checked",e,!1)}function kE(t,e){fW(t,e);var n=od(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?TE(t,e.type,n):e.hasOwnProperty("defaultValue")&&TE(t,e.type,od(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function A3(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function TE(t,e,n){(e!=="number"||Kx(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var av=Array.isArray;function Dp(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+od(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function EE(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Te(91));return Dn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function $3(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Te(92));if(av(n)){if(1<n.length)throw Error(Te(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:od(n)}}function hW(t,e){var n=od(e.value),r=od(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function D3(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function pW(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _E(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?pW(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Vb,mW=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Vb=Vb||document.createElement("div"),Vb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Vb.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ry(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ev={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xee=["Webkit","ms","Moz","O"];Object.keys(Ev).forEach(function(t){Xee.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ev[e]=Ev[t]})});function gW(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ev.hasOwnProperty(t)&&Ev[t]?(""+e).trim():e+"px"}function vW(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=gW(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Jee=Dn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function IE(t,e){if(e){if(Jee[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Te(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Te(62))}}function RE(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var NE=null;function UR(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var PE=null,Op=null,Fp=null;function O3(t){if(t=b0(t)){if(typeof PE!="function")throw Error(Te(280));var e=t.stateNode;e&&(e=zS(e),PE(t.stateNode,t.type,e))}}function yW(t){Op?Fp?Fp.push(t):Fp=[t]:Op=t}function bW(){if(Op){var t=Op,e=Fp;if(Fp=Op=null,O3(t),e)for(t=0;t<e.length;t++)O3(e[t])}}function xW(t,e){return t(e)}function wW(){}var tk=!1;function SW(t,e,n){if(tk)return t(e,n);tk=!0;try{return xW(t,e,n)}finally{tk=!1,(Op!==null||Fp!==null)&&(wW(),bW())}}function iy(t,e){var n=t.stateNode;if(n===null)return null;var r=zS(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Te(231,e,typeof n));return n}var AE=!1;if(Nc)try{var $g={};Object.defineProperty($g,"passive",{get:function(){AE=!0}}),window.addEventListener("test",$g,$g),window.removeEventListener("test",$g,$g)}catch{AE=!1}function Yee(t,e,n,r,i,o,s,a,u){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(l){this.onError(l)}}var _v=!1,Xx=null,Jx=!1,$E=null,Qee={onError:function(t){_v=!0,Xx=t}};function Zee(t,e,n,r,i,o,s,a,u){_v=!1,Xx=null,Yee.apply(Qee,arguments)}function ete(t,e,n,r,i,o,s,a,u){if(Zee.apply(this,arguments),_v){if(_v){var c=Xx;_v=!1,Xx=null}else throw Error(Te(198));Jx||(Jx=!0,$E=c)}}function rh(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function CW(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function F3(t){if(rh(t)!==t)throw Error(Te(188))}function tte(t){var e=t.alternate;if(!e){if(e=rh(t),e===null)throw Error(Te(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return F3(i),t;if(o===r)return F3(i),e;o=o.sibling}throw Error(Te(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s)throw Error(Te(189))}}if(n.alternate!==r)throw Error(Te(190))}if(n.tag!==3)throw Error(Te(188));return n.stateNode.current===n?t:e}function kW(t){return t=tte(t),t!==null?TW(t):null}function TW(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=TW(t);if(e!==null)return e;t=t.sibling}return null}var EW=Bo.unstable_scheduleCallback,L3=Bo.unstable_cancelCallback,nte=Bo.unstable_shouldYield,rte=Bo.unstable_requestPaint,Gn=Bo.unstable_now,ite=Bo.unstable_getCurrentPriorityLevel,VR=Bo.unstable_ImmediatePriority,_W=Bo.unstable_UserBlockingPriority,Yx=Bo.unstable_NormalPriority,ote=Bo.unstable_LowPriority,IW=Bo.unstable_IdlePriority,MS=null,eu=null;function ste(t){if(eu&&typeof eu.onCommitFiberRoot=="function")try{eu.onCommitFiberRoot(MS,t,void 0,(t.current.flags&128)===128)}catch{}}var ra=Math.clz32?Math.clz32:cte,ate=Math.log,ute=Math.LN2;function cte(t){return t>>>=0,t===0?32:31-(ate(t)/ute|0)|0}var zb=64,Wb=4194304;function uv(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Qx(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~i;a!==0?r=uv(a):(o&=s,o!==0&&(r=uv(o)))}else s=n&~i,s!==0?r=uv(s):o!==0&&(r=uv(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-ra(e),i=1<<n,r|=t[n],e&=~i;return r}function lte(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dte(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-ra(o),a=1<<s,u=i[s];u===-1?(!(a&n)||a&r)&&(i[s]=lte(a,e)):u<=e&&(t.expiredLanes|=a),o&=~a}}function DE(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function RW(){var t=zb;return zb<<=1,!(zb&4194240)&&(zb=64),t}function nk(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function v0(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ra(e),t[e]=n}function fte(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-ra(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function zR(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-ra(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Yt=0;function NW(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var PW,WR,AW,$W,DW,OE=!1,jb=[],Vl=null,zl=null,Wl=null,oy=new Map,sy=new Map,Cl=[],hte="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function M3(t,e){switch(t){case"focusin":case"focusout":Vl=null;break;case"dragenter":case"dragleave":zl=null;break;case"mouseover":case"mouseout":Wl=null;break;case"pointerover":case"pointerout":oy.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":sy.delete(e.pointerId)}}function Dg(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=b0(e),e!==null&&WR(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function pte(t,e,n,r,i){switch(e){case"focusin":return Vl=Dg(Vl,t,e,n,r,i),!0;case"dragenter":return zl=Dg(zl,t,e,n,r,i),!0;case"mouseover":return Wl=Dg(Wl,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return oy.set(o,Dg(oy.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,sy.set(o,Dg(sy.get(o)||null,t,e,n,r,i)),!0}return!1}function OW(t){var e=uf(t.target);if(e!==null){var n=rh(e);if(n!==null){if(e=n.tag,e===13){if(e=CW(n),e!==null){t.blockedOn=e,DW(t.priority,function(){AW(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function nx(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=FE(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);NE=r,n.target.dispatchEvent(r),NE=null}else return e=b0(n),e!==null&&WR(e),t.blockedOn=n,!1;e.shift()}return!0}function B3(t,e,n){nx(t)&&n.delete(e)}function mte(){OE=!1,Vl!==null&&nx(Vl)&&(Vl=null),zl!==null&&nx(zl)&&(zl=null),Wl!==null&&nx(Wl)&&(Wl=null),oy.forEach(B3),sy.forEach(B3)}function Og(t,e){t.blockedOn===e&&(t.blockedOn=null,OE||(OE=!0,Bo.unstable_scheduleCallback(Bo.unstable_NormalPriority,mte)))}function ay(t){function e(i){return Og(i,t)}if(0<jb.length){Og(jb[0],t);for(var n=1;n<jb.length;n++){var r=jb[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Vl!==null&&Og(Vl,t),zl!==null&&Og(zl,t),Wl!==null&&Og(Wl,t),oy.forEach(e),sy.forEach(e),n=0;n<Cl.length;n++)r=Cl[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Cl.length&&(n=Cl[0],n.blockedOn===null);)OW(n),n.blockedOn===null&&Cl.shift()}var Lp=Gc.ReactCurrentBatchConfig,Zx=!0;function gte(t,e,n,r){var i=Yt,o=Lp.transition;Lp.transition=null;try{Yt=1,jR(t,e,n,r)}finally{Yt=i,Lp.transition=o}}function vte(t,e,n,r){var i=Yt,o=Lp.transition;Lp.transition=null;try{Yt=4,jR(t,e,n,r)}finally{Yt=i,Lp.transition=o}}function jR(t,e,n,r){if(Zx){var i=FE(t,e,n,r);if(i===null)fk(t,e,r,ew,n),M3(t,r);else if(pte(i,t,e,n,r))r.stopPropagation();else if(M3(t,r),e&4&&-1<hte.indexOf(t)){for(;i!==null;){var o=b0(i);if(o!==null&&PW(o),o=FE(t,e,n,r),o===null&&fk(t,e,r,ew,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else fk(t,e,r,null,n)}}var ew=null;function FE(t,e,n,r){if(ew=null,t=UR(r),t=uf(t),t!==null)if(e=rh(t),e===null)t=null;else if(n=e.tag,n===13){if(t=CW(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ew=t,null}function FW(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ite()){case VR:return 1;case _W:return 4;case Yx:case ote:return 16;case IW:return 536870912;default:return 16}default:return 16}}var _l=null,GR=null,rx=null;function LW(){if(rx)return rx;var t,e=GR,n=e.length,r,i="value"in _l?_l.value:_l.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[o-r];r++);return rx=i.slice(t,1<r?1-r:void 0)}function ix(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Gb(){return!0}function U3(){return!1}function zo(t){function e(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Gb:U3,this.isPropagationStopped=U3,this}return Dn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Gb)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Gb)},persist:function(){},isPersistent:Gb}),e}var Wm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},HR=zo(Wm),y0=Dn({},Wm,{view:0,detail:0}),yte=zo(y0),rk,ik,Fg,BS=Dn({},y0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qR,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Fg&&(Fg&&t.type==="mousemove"?(rk=t.screenX-Fg.screenX,ik=t.screenY-Fg.screenY):ik=rk=0,Fg=t),rk)},movementY:function(t){return"movementY"in t?t.movementY:ik}}),V3=zo(BS),bte=Dn({},BS,{dataTransfer:0}),xte=zo(bte),wte=Dn({},y0,{relatedTarget:0}),ok=zo(wte),Ste=Dn({},Wm,{animationName:0,elapsedTime:0,pseudoElement:0}),Cte=zo(Ste),kte=Dn({},Wm,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Tte=zo(kte),Ete=Dn({},Wm,{data:0}),z3=zo(Ete),_te={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ite={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Rte={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nte(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Rte[t])?!!e[t]:!1}function qR(){return Nte}var Pte=Dn({},y0,{key:function(t){if(t.key){var e=_te[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ix(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ite[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qR,charCode:function(t){return t.type==="keypress"?ix(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ix(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ate=zo(Pte),$te=Dn({},BS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),W3=zo($te),Dte=Dn({},y0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qR}),Ote=zo(Dte),Fte=Dn({},Wm,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lte=zo(Fte),Mte=Dn({},BS,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Bte=zo(Mte),Ute=[9,13,27,32],KR=Nc&&"CompositionEvent"in window,Iv=null;Nc&&"documentMode"in document&&(Iv=document.documentMode);var Vte=Nc&&"TextEvent"in window&&!Iv,MW=Nc&&(!KR||Iv&&8<Iv&&11>=Iv),j3=String.fromCharCode(32),G3=!1;function BW(t,e){switch(t){case"keyup":return Ute.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function UW(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var dp=!1;function zte(t,e){switch(t){case"compositionend":return UW(e);case"keypress":return e.which!==32?null:(G3=!0,j3);case"textInput":return t=e.data,t===j3&&G3?null:t;default:return null}}function Wte(t,e){if(dp)return t==="compositionend"||!KR&&BW(t,e)?(t=LW(),rx=GR=_l=null,dp=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return MW&&e.locale!=="ko"?null:e.data;default:return null}}var jte={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function H3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!jte[t.type]:e==="textarea"}function VW(t,e,n,r){yW(r),e=tw(e,"onChange"),0<e.length&&(n=new HR("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Rv=null,uy=null;function Gte(t){QW(t,0)}function US(t){var e=pp(t);if(dW(e))return t}function Hte(t,e){if(t==="change")return e}var zW=!1;if(Nc){var sk;if(Nc){var ak="oninput"in document;if(!ak){var q3=document.createElement("div");q3.setAttribute("oninput","return;"),ak=typeof q3.oninput=="function"}sk=ak}else sk=!1;zW=sk&&(!document.documentMode||9<document.documentMode)}function K3(){Rv&&(Rv.detachEvent("onpropertychange",WW),uy=Rv=null)}function WW(t){if(t.propertyName==="value"&&US(uy)){var e=[];VW(e,uy,t,UR(t)),SW(Gte,e)}}function qte(t,e,n){t==="focusin"?(K3(),Rv=e,uy=n,Rv.attachEvent("onpropertychange",WW)):t==="focusout"&&K3()}function Kte(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return US(uy)}function Xte(t,e){if(t==="click")return US(e)}function Jte(t,e){if(t==="input"||t==="change")return US(e)}function Yte(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var aa=typeof Object.is=="function"?Object.is:Yte;function cy(t,e){if(aa(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!yE.call(e,i)||!aa(t[i],e[i]))return!1}return!0}function X3(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function J3(t,e){var n=X3(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=X3(n)}}function jW(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?jW(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function GW(){for(var t=window,e=Kx();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Kx(t.document)}return e}function XR(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Qte(t){var e=GW(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&jW(n.ownerDocument.documentElement,n)){if(r!==null&&XR(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=J3(n,o);var s=J3(n,r);i&&s&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Zte=Nc&&"documentMode"in document&&11>=document.documentMode,fp=null,LE=null,Nv=null,ME=!1;function Y3(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ME||fp==null||fp!==Kx(r)||(r=fp,"selectionStart"in r&&XR(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Nv&&cy(Nv,r)||(Nv=r,r=tw(LE,"onSelect"),0<r.length&&(e=new HR("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=fp)))}function Hb(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var hp={animationend:Hb("Animation","AnimationEnd"),animationiteration:Hb("Animation","AnimationIteration"),animationstart:Hb("Animation","AnimationStart"),transitionend:Hb("Transition","TransitionEnd")},uk={},HW={};Nc&&(HW=document.createElement("div").style,"AnimationEvent"in window||(delete hp.animationend.animation,delete hp.animationiteration.animation,delete hp.animationstart.animation),"TransitionEvent"in window||delete hp.transitionend.transition);function VS(t){if(uk[t])return uk[t];if(!hp[t])return t;var e=hp[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in HW)return uk[t]=e[n];return t}var qW=VS("animationend"),KW=VS("animationiteration"),XW=VS("animationstart"),JW=VS("transitionend"),YW=new Map,Q3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vd(t,e){YW.set(t,e),nh(e,[t])}for(var ck=0;ck<Q3.length;ck++){var lk=Q3[ck],ene=lk.toLowerCase(),tne=lk[0].toUpperCase()+lk.slice(1);vd(ene,"on"+tne)}vd(qW,"onAnimationEnd");vd(KW,"onAnimationIteration");vd(XW,"onAnimationStart");vd("dblclick","onDoubleClick");vd("focusin","onFocus");vd("focusout","onBlur");vd(JW,"onTransitionEnd");dm("onMouseEnter",["mouseout","mouseover"]);dm("onMouseLeave",["mouseout","mouseover"]);dm("onPointerEnter",["pointerout","pointerover"]);dm("onPointerLeave",["pointerout","pointerover"]);nh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));nh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));nh("onBeforeInput",["compositionend","keypress","textInput","paste"]);nh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));nh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));nh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nne=new Set("cancel close invalid load scroll toggle".split(" ").concat(cv));function Z3(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,ete(r,e,void 0,t),t.currentTarget=null}function QW(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],u=a.instance,c=a.currentTarget;if(a=a.listener,u!==o&&i.isPropagationStopped())break e;Z3(i,a,c),o=u}else for(s=0;s<r.length;s++){if(a=r[s],u=a.instance,c=a.currentTarget,a=a.listener,u!==o&&i.isPropagationStopped())break e;Z3(i,a,c),o=u}}}if(Jx)throw t=$E,Jx=!1,$E=null,t}function wn(t,e){var n=e[WE];n===void 0&&(n=e[WE]=new Set);var r=t+"__bubble";n.has(r)||(ZW(e,t,2,!1),n.add(r))}function dk(t,e,n){var r=0;e&&(r|=4),ZW(n,t,r,e)}var qb="_reactListening"+Math.random().toString(36).slice(2);function ly(t){if(!t[qb]){t[qb]=!0,sW.forEach(function(n){n!=="selectionchange"&&(nne.has(n)||dk(n,!1,t),dk(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[qb]||(e[qb]=!0,dk("selectionchange",!1,e))}}function ZW(t,e,n,r){switch(FW(e)){case 1:var i=gte;break;case 4:i=vte;break;default:i=jR}n=i.bind(null,e,n,t),i=void 0,!AE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function fk(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var u=s.tag;if((u===3||u===4)&&(u=s.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;s=s.return}for(;a!==null;){if(s=uf(a),s===null)return;if(u=s.tag,u===5||u===6){r=o=s;continue e}a=a.parentNode}}r=r.return}SW(function(){var c=o,l=UR(n),d=[];e:{var f=YW.get(t);if(f!==void 0){var h=HR,p=t;switch(t){case"keypress":if(ix(n)===0)break e;case"keydown":case"keyup":h=Ate;break;case"focusin":p="focus",h=ok;break;case"focusout":p="blur",h=ok;break;case"beforeblur":case"afterblur":h=ok;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=V3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=xte;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Ote;break;case qW:case KW:case XW:h=Cte;break;case JW:h=Lte;break;case"scroll":h=yte;break;case"wheel":h=Bte;break;case"copy":case"cut":case"paste":h=Tte;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=W3}var m=(e&4)!==0,v=!m&&t==="scroll",g=m?f!==null?f+"Capture":null:f;m=[];for(var y=c,b;y!==null;){b=y;var x=b.stateNode;if(b.tag===5&&x!==null&&(b=x,g!==null&&(x=iy(y,g),x!=null&&m.push(dy(y,x,b)))),v)break;y=y.return}0<m.length&&(f=new h(f,p,null,n,l),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==NE&&(p=n.relatedTarget||n.fromElement)&&(uf(p)||p[Pc]))break e;if((h||f)&&(f=l.window===l?l:(f=l.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=n.relatedTarget||n.toElement,h=c,p=p?uf(p):null,p!==null&&(v=rh(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=c),h!==p)){if(m=V3,x="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(m=W3,x="onPointerLeave",g="onPointerEnter",y="pointer"),v=h==null?f:pp(h),b=p==null?f:pp(p),f=new m(x,y+"leave",h,n,l),f.target=v,f.relatedTarget=b,x=null,uf(l)===c&&(m=new m(g,y+"enter",p,n,l),m.target=b,m.relatedTarget=v,x=m),v=x,h&&p)t:{for(m=h,g=p,y=0,b=m;b;b=zh(b))y++;for(b=0,x=g;x;x=zh(x))b++;for(;0<y-b;)m=zh(m),y--;for(;0<b-y;)g=zh(g),b--;for(;y--;){if(m===g||g!==null&&m===g.alternate)break t;m=zh(m),g=zh(g)}m=null}else m=null;h!==null&&eL(d,f,h,m,!1),p!==null&&v!==null&&eL(d,v,p,m,!0)}}e:{if(f=c?pp(c):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var S=Hte;else if(H3(f))if(zW)S=Jte;else{S=Kte;var C=qte}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=Xte);if(S&&(S=S(t,c))){VW(d,S,n,l);break e}C&&C(t,f,c),t==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&TE(f,"number",f.value)}switch(C=c?pp(c):window,t){case"focusin":(H3(C)||C.contentEditable==="true")&&(fp=C,LE=c,Nv=null);break;case"focusout":Nv=LE=fp=null;break;case"mousedown":ME=!0;break;case"contextmenu":case"mouseup":case"dragend":ME=!1,Y3(d,n,l);break;case"selectionchange":if(Zte)break;case"keydown":case"keyup":Y3(d,n,l)}var T;if(KR)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else dp?BW(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(MW&&n.locale!=="ko"&&(dp||E!=="onCompositionStart"?E==="onCompositionEnd"&&dp&&(T=LW()):(_l=l,GR="value"in _l?_l.value:_l.textContent,dp=!0)),C=tw(c,E),0<C.length&&(E=new z3(E,t,null,n,l),d.push({event:E,listeners:C}),T?E.data=T:(T=UW(n),T!==null&&(E.data=T)))),(T=Vte?zte(t,n):Wte(t,n))&&(c=tw(c,"onBeforeInput"),0<c.length&&(l=new z3("onBeforeInput","beforeinput",null,n,l),d.push({event:l,listeners:c}),l.data=T))}QW(d,e)})}function dy(t,e,n){return{instance:t,listener:e,currentTarget:n}}function tw(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=iy(t,n),o!=null&&r.unshift(dy(t,o,i)),o=iy(t,e),o!=null&&r.push(dy(t,o,i))),t=t.return}return r}function zh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function eL(t,e,n,r,i){for(var o=e._reactName,s=[];n!==null&&n!==r;){var a=n,u=a.alternate,c=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&c!==null&&(a=c,i?(u=iy(n,o),u!=null&&s.unshift(dy(n,u,a))):i||(u=iy(n,o),u!=null&&s.push(dy(n,u,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var rne=/\r\n?/g,ine=/\u0000|\uFFFD/g;function tL(t){return(typeof t=="string"?t:""+t).replace(rne,`
`).replace(ine,"")}function Kb(t,e,n){if(e=tL(e),tL(t)!==e&&n)throw Error(Te(425))}function nw(){}var BE=null,UE=null;function VE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var zE=typeof setTimeout=="function"?setTimeout:void 0,one=typeof clearTimeout=="function"?clearTimeout:void 0,nL=typeof Promise=="function"?Promise:void 0,sne=typeof queueMicrotask=="function"?queueMicrotask:typeof nL<"u"?function(t){return nL.resolve(null).then(t).catch(ane)}:zE;function ane(t){setTimeout(function(){throw t})}function hk(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),ay(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);ay(e)}function jl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function rL(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var jm=Math.random().toString(36).slice(2),Aa="__reactFiber$"+jm,fy="__reactProps$"+jm,Pc="__reactContainer$"+jm,WE="__reactEvents$"+jm,une="__reactListeners$"+jm,cne="__reactHandles$"+jm;function uf(t){var e=t[Aa];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Pc]||n[Aa]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=rL(t);t!==null;){if(n=t[Aa])return n;t=rL(t)}return e}t=n,n=t.parentNode}return null}function b0(t){return t=t[Aa]||t[Pc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function pp(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Te(33))}function zS(t){return t[fy]||null}var jE=[],mp=-1;function yd(t){return{current:t}}function kn(t){0>mp||(t.current=jE[mp],jE[mp]=null,mp--)}function hn(t,e){mp++,jE[mp]=t.current,t.current=e}var sd={},gi=yd(sd),ro=yd(!1),$f=sd;function fm(t,e){var n=t.type.contextTypes;if(!n)return sd;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function io(t){return t=t.childContextTypes,t!=null}function rw(){kn(ro),kn(gi)}function iL(t,e,n){if(gi.current!==sd)throw Error(Te(168));hn(gi,e),hn(ro,n)}function ej(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Te(108,qee(t)||"Unknown",i));return Dn({},n,r)}function iw(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||sd,$f=gi.current,hn(gi,t),hn(ro,ro.current),!0}function oL(t,e,n){var r=t.stateNode;if(!r)throw Error(Te(169));n?(t=ej(t,e,$f),r.__reactInternalMemoizedMergedChildContext=t,kn(ro),kn(gi),hn(gi,t)):kn(ro),hn(ro,n)}var Ou=null,WS=!1,pk=!1;function tj(t){Ou===null?Ou=[t]:Ou.push(t)}function lne(t){WS=!0,tj(t)}function bd(){if(!pk&&Ou!==null){pk=!0;var t=0,e=Yt;try{var n=Ou;for(Yt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ou=null,WS=!1}catch(i){throw Ou!==null&&(Ou=Ou.slice(t+1)),EW(VR,bd),i}finally{Yt=e,pk=!1}}return null}var gp=[],vp=0,ow=null,sw=0,ss=[],as=0,Df=null,Gu=1,Hu="";function Hd(t,e){gp[vp++]=sw,gp[vp++]=ow,ow=t,sw=e}function nj(t,e,n){ss[as++]=Gu,ss[as++]=Hu,ss[as++]=Df,Df=t;var r=Gu;t=Hu;var i=32-ra(r)-1;r&=~(1<<i),n+=1;var o=32-ra(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Gu=1<<32-ra(e)+i|n<<i|r,Hu=o+t}else Gu=1<<o|n<<i|r,Hu=t}function JR(t){t.return!==null&&(Hd(t,1),nj(t,1,0))}function YR(t){for(;t===ow;)ow=gp[--vp],gp[vp]=null,sw=gp[--vp],gp[vp]=null;for(;t===Df;)Df=ss[--as],ss[as]=null,Hu=ss[--as],ss[as]=null,Gu=ss[--as],ss[as]=null}var Oo=null,_o=null,_n=!1,zs=null;function rj(t,e){var n=ds(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function sL(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Oo=t,_o=jl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Oo=t,_o=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Df!==null?{id:Gu,overflow:Hu}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ds(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Oo=t,_o=null,!0):!1;default:return!1}}function GE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function HE(t){if(_n){var e=_o;if(e){var n=e;if(!sL(t,e)){if(GE(t))throw Error(Te(418));e=jl(n.nextSibling);var r=Oo;e&&sL(t,e)?rj(r,n):(t.flags=t.flags&-4097|2,_n=!1,Oo=t)}}else{if(GE(t))throw Error(Te(418));t.flags=t.flags&-4097|2,_n=!1,Oo=t}}}function aL(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Oo=t}function Xb(t){if(t!==Oo)return!1;if(!_n)return aL(t),_n=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!VE(t.type,t.memoizedProps)),e&&(e=_o)){if(GE(t))throw ij(),Error(Te(418));for(;e;)rj(t,e),e=jl(e.nextSibling)}if(aL(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Te(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){_o=jl(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}_o=null}}else _o=Oo?jl(t.stateNode.nextSibling):null;return!0}function ij(){for(var t=_o;t;)t=jl(t.nextSibling)}function hm(){_o=Oo=null,_n=!1}function QR(t){zs===null?zs=[t]:zs.push(t)}var dne=Gc.ReactCurrentBatchConfig;function Ms(t,e){if(t&&t.defaultProps){e=Dn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var aw=yd(null),uw=null,yp=null,ZR=null;function eN(){ZR=yp=uw=null}function tN(t){var e=aw.current;kn(aw),t._currentValue=e}function qE(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Mp(t,e){uw=t,ZR=yp=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Zi=!0),t.firstContext=null)}function Es(t){var e=t._currentValue;if(ZR!==t)if(t={context:t,memoizedValue:e,next:null},yp===null){if(uw===null)throw Error(Te(308));yp=t,uw.dependencies={lanes:0,firstContext:t}}else yp=yp.next=t;return e}var cf=null;function nN(t){cf===null?cf=[t]:cf.push(t)}function oj(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,nN(e)):(n.next=i.next,i.next=n),e.interleaved=n,Ac(t,r)}function Ac(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xl=!1;function rN(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sj(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function xc(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Gl(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Bt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Ac(t,n)}return i=r.interleaved,i===null?(e.next=e,nN(r)):(e.next=i.next,i.next=e),r.interleaved=e,Ac(t,n)}function ox(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zR(t,n)}}function uL(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function cw(t,e,n,r){var i=t.updateQueue;xl=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var u=a,c=u.next;u.next=null,s===null?o=c:s.next=c,s=u;var l=t.alternate;l!==null&&(l=l.updateQueue,a=l.lastBaseUpdate,a!==s&&(a===null?l.firstBaseUpdate=c:a.next=c,l.lastBaseUpdate=u))}if(o!==null){var d=i.baseState;s=0,l=c=u=null,a=o;do{var f=a.lane,h=a.eventTime;if((r&f)===f){l!==null&&(l=l.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(f=e,h=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=Dn({},d,f);break e;case 2:xl=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else h={eventTime:h,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},l===null?(c=l=h,u=d):l=l.next=h,s|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(l===null&&(u=d),i.baseState=u,i.firstBaseUpdate=c,i.lastBaseUpdate=l,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Ff|=s,t.lanes=s,t.memoizedState=d}}function cL(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Te(191,i));i.call(r)}}}var aj=new oW.Component().refs;function KE(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Dn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var jS={isMounted:function(t){return(t=t._reactInternals)?rh(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=$i(),i=ql(t),o=xc(r,i);o.payload=e,n!=null&&(o.callback=n),e=Gl(t,o,i),e!==null&&(ia(e,t,i,r),ox(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=$i(),i=ql(t),o=xc(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=Gl(t,o,i),e!==null&&(ia(e,t,i,r),ox(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=$i(),r=ql(t),i=xc(n,r);i.tag=2,e!=null&&(i.callback=e),e=Gl(t,i,r),e!==null&&(ia(e,t,r,n),ox(e,t,r))}};function lL(t,e,n,r,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!cy(n,r)||!cy(i,o):!0}function uj(t,e,n){var r=!1,i=sd,o=e.contextType;return typeof o=="object"&&o!==null?o=Es(o):(i=io(e)?$f:gi.current,r=e.contextTypes,o=(r=r!=null)?fm(t,i):sd),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=jS,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function dL(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&jS.enqueueReplaceState(e,e.state,null)}function XE(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=aj,rN(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Es(o):(o=io(e)?$f:gi.current,i.context=fm(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(KE(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&jS.enqueueReplaceState(i,i.state,null),cw(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Lg(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Te(309));var r=n.stateNode}if(!r)throw Error(Te(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;a===aj&&(a=i.refs={}),s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(Te(284));if(!n._owner)throw Error(Te(290,t))}return t}function Jb(t,e){throw t=Object.prototype.toString.call(e),Error(Te(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fL(t){var e=t._init;return e(t._payload)}function cj(t){function e(g,y){if(t){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function n(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function r(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function i(g,y){return g=Kl(g,y),g.index=0,g.sibling=null,g}function o(g,y,b){return g.index=b,t?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function s(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,y,b,x){return y===null||y.tag!==6?(y=wk(b,g.mode,x),y.return=g,y):(y=i(y,b),y.return=g,y)}function u(g,y,b,x){var S=b.type;return S===lp?l(g,y,b.props.children,x,b.key):y!==null&&(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===bl&&fL(S)===y.type)?(x=i(y,b.props),x.ref=Lg(g,y,b),x.return=g,x):(x=dx(b.type,b.key,b.props,null,g.mode,x),x.ref=Lg(g,y,b),x.return=g,x)}function c(g,y,b,x){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=Sk(b,g.mode,x),y.return=g,y):(y=i(y,b.children||[]),y.return=g,y)}function l(g,y,b,x,S){return y===null||y.tag!==7?(y=bf(b,g.mode,x,S),y.return=g,y):(y=i(y,b),y.return=g,y)}function d(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=wk(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Bb:return b=dx(y.type,y.key,y.props,null,g.mode,b),b.ref=Lg(g,null,y),b.return=g,b;case cp:return y=Sk(y,g.mode,b),y.return=g,y;case bl:var x=y._init;return d(g,x(y._payload),b)}if(av(y)||Ag(y))return y=bf(y,g.mode,b,null),y.return=g,y;Jb(g,y)}return null}function f(g,y,b,x){var S=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return S!==null?null:a(g,y,""+b,x);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Bb:return b.key===S?u(g,y,b,x):null;case cp:return b.key===S?c(g,y,b,x):null;case bl:return S=b._init,f(g,y,S(b._payload),x)}if(av(b)||Ag(b))return S!==null?null:l(g,y,b,x,null);Jb(g,b)}return null}function h(g,y,b,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(b)||null,a(y,g,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Bb:return g=g.get(x.key===null?b:x.key)||null,u(y,g,x,S);case cp:return g=g.get(x.key===null?b:x.key)||null,c(y,g,x,S);case bl:var C=x._init;return h(g,y,b,C(x._payload),S)}if(av(x)||Ag(x))return g=g.get(b)||null,l(y,g,x,S,null);Jb(y,x)}return null}function p(g,y,b,x){for(var S=null,C=null,T=y,E=y=0,I=null;T!==null&&E<b.length;E++){T.index>E?(I=T,T=null):I=T.sibling;var N=f(g,T,b[E],x);if(N===null){T===null&&(T=I);break}t&&T&&N.alternate===null&&e(g,T),y=o(N,y,E),C===null?S=N:C.sibling=N,C=N,T=I}if(E===b.length)return n(g,T),_n&&Hd(g,E),S;if(T===null){for(;E<b.length;E++)T=d(g,b[E],x),T!==null&&(y=o(T,y,E),C===null?S=T:C.sibling=T,C=T);return _n&&Hd(g,E),S}for(T=r(g,T);E<b.length;E++)I=h(T,g,E,b[E],x),I!==null&&(t&&I.alternate!==null&&T.delete(I.key===null?E:I.key),y=o(I,y,E),C===null?S=I:C.sibling=I,C=I);return t&&T.forEach(function($){return e(g,$)}),_n&&Hd(g,E),S}function m(g,y,b,x){var S=Ag(b);if(typeof S!="function")throw Error(Te(150));if(b=S.call(b),b==null)throw Error(Te(151));for(var C=S=null,T=y,E=y=0,I=null,N=b.next();T!==null&&!N.done;E++,N=b.next()){T.index>E?(I=T,T=null):I=T.sibling;var $=f(g,T,N.value,x);if($===null){T===null&&(T=I);break}t&&T&&$.alternate===null&&e(g,T),y=o($,y,E),C===null?S=$:C.sibling=$,C=$,T=I}if(N.done)return n(g,T),_n&&Hd(g,E),S;if(T===null){for(;!N.done;E++,N=b.next())N=d(g,N.value,x),N!==null&&(y=o(N,y,E),C===null?S=N:C.sibling=N,C=N);return _n&&Hd(g,E),S}for(T=r(g,T);!N.done;E++,N=b.next())N=h(T,g,E,N.value,x),N!==null&&(t&&N.alternate!==null&&T.delete(N.key===null?E:N.key),y=o(N,y,E),C===null?S=N:C.sibling=N,C=N);return t&&T.forEach(function(F){return e(g,F)}),_n&&Hd(g,E),S}function v(g,y,b,x){if(typeof b=="object"&&b!==null&&b.type===lp&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Bb:e:{for(var S=b.key,C=y;C!==null;){if(C.key===S){if(S=b.type,S===lp){if(C.tag===7){n(g,C.sibling),y=i(C,b.props.children),y.return=g,g=y;break e}}else if(C.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===bl&&fL(S)===C.type){n(g,C.sibling),y=i(C,b.props),y.ref=Lg(g,C,b),y.return=g,g=y;break e}n(g,C);break}else e(g,C);C=C.sibling}b.type===lp?(y=bf(b.props.children,g.mode,x,b.key),y.return=g,g=y):(x=dx(b.type,b.key,b.props,null,g.mode,x),x.ref=Lg(g,y,b),x.return=g,g=x)}return s(g);case cp:e:{for(C=b.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){n(g,y.sibling),y=i(y,b.children||[]),y.return=g,g=y;break e}else{n(g,y);break}else e(g,y);y=y.sibling}y=Sk(b,g.mode,x),y.return=g,g=y}return s(g);case bl:return C=b._init,v(g,y,C(b._payload),x)}if(av(b))return p(g,y,b,x);if(Ag(b))return m(g,y,b,x);Jb(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(n(g,y.sibling),y=i(y,b),y.return=g,g=y):(n(g,y),y=wk(b,g.mode,x),y.return=g,g=y),s(g)):n(g,y)}return v}var pm=cj(!0),lj=cj(!1),x0={},tu=yd(x0),hy=yd(x0),py=yd(x0);function lf(t){if(t===x0)throw Error(Te(174));return t}function iN(t,e){switch(hn(py,e),hn(hy,t),hn(tu,x0),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_E(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=_E(e,t)}kn(tu),hn(tu,e)}function mm(){kn(tu),kn(hy),kn(py)}function dj(t){lf(py.current);var e=lf(tu.current),n=_E(e,t.type);e!==n&&(hn(hy,t),hn(tu,n))}function oN(t){hy.current===t&&(kn(tu),kn(hy))}var Rn=yd(0);function lw(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mk=[];function sN(){for(var t=0;t<mk.length;t++)mk[t]._workInProgressVersionPrimary=null;mk.length=0}var sx=Gc.ReactCurrentDispatcher,gk=Gc.ReactCurrentBatchConfig,Of=0,$n=null,rr=null,br=null,dw=!1,Pv=!1,my=0,fne=0;function qr(){throw Error(Te(321))}function aN(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!aa(t[n],e[n]))return!1;return!0}function uN(t,e,n,r,i,o){if(Of=o,$n=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,sx.current=t===null||t.memoizedState===null?gne:vne,t=n(r,i),Pv){o=0;do{if(Pv=!1,my=0,25<=o)throw Error(Te(301));o+=1,br=rr=null,e.updateQueue=null,sx.current=yne,t=n(r,i)}while(Pv)}if(sx.current=fw,e=rr!==null&&rr.next!==null,Of=0,br=rr=$n=null,dw=!1,e)throw Error(Te(300));return t}function cN(){var t=my!==0;return my=0,t}function ka(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return br===null?$n.memoizedState=br=t:br=br.next=t,br}function _s(){if(rr===null){var t=$n.alternate;t=t!==null?t.memoizedState:null}else t=rr.next;var e=br===null?$n.memoizedState:br.next;if(e!==null)br=e,rr=t;else{if(t===null)throw Error(Te(310));rr=t,t={memoizedState:rr.memoizedState,baseState:rr.baseState,baseQueue:rr.baseQueue,queue:rr.queue,next:null},br===null?$n.memoizedState=br=t:br=br.next=t}return br}function gy(t,e){return typeof e=="function"?e(t):e}function vk(t){var e=_s(),n=e.queue;if(n===null)throw Error(Te(311));n.lastRenderedReducer=t;var r=rr,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,u=null,c=o;do{var l=c.lane;if((Of&l)===l)u!==null&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var d={lane:l,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};u===null?(a=u=d,s=r):u=u.next=d,$n.lanes|=l,Ff|=l}c=c.next}while(c!==null&&c!==o);u===null?s=r:u.next=a,aa(r,e.memoizedState)||(Zi=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,$n.lanes|=o,Ff|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function yk(t){var e=_s(),n=e.queue;if(n===null)throw Error(Te(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);aa(o,e.memoizedState)||(Zi=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function fj(){}function hj(t,e){var n=$n,r=_s(),i=e(),o=!aa(r.memoizedState,i);if(o&&(r.memoizedState=i,Zi=!0),r=r.queue,lN(gj.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||br!==null&&br.memoizedState.tag&1){if(n.flags|=2048,vy(9,mj.bind(null,n,r,i,e),void 0,null),Sr===null)throw Error(Te(349));Of&30||pj(n,e,i)}return i}function pj(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=$n.updateQueue,e===null?(e={lastEffect:null,stores:null},$n.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function mj(t,e,n,r){e.value=n,e.getSnapshot=r,vj(e)&&yj(t)}function gj(t,e,n){return n(function(){vj(e)&&yj(t)})}function vj(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!aa(t,n)}catch{return!0}}function yj(t){var e=Ac(t,1);e!==null&&ia(e,t,1,-1)}function hL(t){var e=ka();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gy,lastRenderedState:t},e.queue=t,t=t.dispatch=mne.bind(null,$n,t),[e.memoizedState,t]}function vy(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=$n.updateQueue,e===null?(e={lastEffect:null,stores:null},$n.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function bj(){return _s().memoizedState}function ax(t,e,n,r){var i=ka();$n.flags|=t,i.memoizedState=vy(1|e,n,void 0,r===void 0?null:r)}function GS(t,e,n,r){var i=_s();r=r===void 0?null:r;var o=void 0;if(rr!==null){var s=rr.memoizedState;if(o=s.destroy,r!==null&&aN(r,s.deps)){i.memoizedState=vy(e,n,o,r);return}}$n.flags|=t,i.memoizedState=vy(1|e,n,o,r)}function pL(t,e){return ax(8390656,8,t,e)}function lN(t,e){return GS(2048,8,t,e)}function xj(t,e){return GS(4,2,t,e)}function wj(t,e){return GS(4,4,t,e)}function Sj(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Cj(t,e,n){return n=n!=null?n.concat([t]):null,GS(4,4,Sj.bind(null,e,t),n)}function dN(){}function kj(t,e){var n=_s();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&aN(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Tj(t,e){var n=_s();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&aN(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ej(t,e,n){return Of&21?(aa(n,e)||(n=RW(),$n.lanes|=n,Ff|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Zi=!0),t.memoizedState=n)}function hne(t,e){var n=Yt;Yt=n!==0&&4>n?n:4,t(!0);var r=gk.transition;gk.transition={};try{t(!1),e()}finally{Yt=n,gk.transition=r}}function _j(){return _s().memoizedState}function pne(t,e,n){var r=ql(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ij(t))Rj(e,n);else if(n=oj(t,e,n,r),n!==null){var i=$i();ia(n,t,r,i),Nj(n,e,r)}}function mne(t,e,n){var r=ql(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ij(t))Rj(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,aa(a,s)){var u=e.interleaved;u===null?(i.next=i,nN(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=oj(t,e,i,r),n!==null&&(i=$i(),ia(n,t,r,i),Nj(n,e,r))}}function Ij(t){var e=t.alternate;return t===$n||e!==null&&e===$n}function Rj(t,e){Pv=dw=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Nj(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zR(t,n)}}var fw={readContext:Es,useCallback:qr,useContext:qr,useEffect:qr,useImperativeHandle:qr,useInsertionEffect:qr,useLayoutEffect:qr,useMemo:qr,useReducer:qr,useRef:qr,useState:qr,useDebugValue:qr,useDeferredValue:qr,useTransition:qr,useMutableSource:qr,useSyncExternalStore:qr,useId:qr,unstable_isNewReconciler:!1},gne={readContext:Es,useCallback:function(t,e){return ka().memoizedState=[t,e===void 0?null:e],t},useContext:Es,useEffect:pL,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ax(4194308,4,Sj.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ax(4194308,4,t,e)},useInsertionEffect:function(t,e){return ax(4,2,t,e)},useMemo:function(t,e){var n=ka();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ka();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=pne.bind(null,$n,t),[r.memoizedState,t]},useRef:function(t){var e=ka();return t={current:t},e.memoizedState=t},useState:hL,useDebugValue:dN,useDeferredValue:function(t){return ka().memoizedState=t},useTransition:function(){var t=hL(!1),e=t[0];return t=hne.bind(null,t[1]),ka().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=$n,i=ka();if(_n){if(n===void 0)throw Error(Te(407));n=n()}else{if(n=e(),Sr===null)throw Error(Te(349));Of&30||pj(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,pL(gj.bind(null,r,o,t),[t]),r.flags|=2048,vy(9,mj.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=ka(),e=Sr.identifierPrefix;if(_n){var n=Hu,r=Gu;n=(r&~(1<<32-ra(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=my++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=fne++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},vne={readContext:Es,useCallback:kj,useContext:Es,useEffect:lN,useImperativeHandle:Cj,useInsertionEffect:xj,useLayoutEffect:wj,useMemo:Tj,useReducer:vk,useRef:bj,useState:function(){return vk(gy)},useDebugValue:dN,useDeferredValue:function(t){var e=_s();return Ej(e,rr.memoizedState,t)},useTransition:function(){var t=vk(gy)[0],e=_s().memoizedState;return[t,e]},useMutableSource:fj,useSyncExternalStore:hj,useId:_j,unstable_isNewReconciler:!1},yne={readContext:Es,useCallback:kj,useContext:Es,useEffect:lN,useImperativeHandle:Cj,useInsertionEffect:xj,useLayoutEffect:wj,useMemo:Tj,useReducer:yk,useRef:bj,useState:function(){return yk(gy)},useDebugValue:dN,useDeferredValue:function(t){var e=_s();return rr===null?e.memoizedState=t:Ej(e,rr.memoizedState,t)},useTransition:function(){var t=yk(gy)[0],e=_s().memoizedState;return[t,e]},useMutableSource:fj,useSyncExternalStore:hj,useId:_j,unstable_isNewReconciler:!1};function gm(t,e){try{var n="",r=e;do n+=Hee(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function bk(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function JE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var bne=typeof WeakMap=="function"?WeakMap:Map;function Pj(t,e,n){n=xc(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){pw||(pw=!0,s_=r),JE(t,e)},n}function Aj(t,e,n){n=xc(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){JE(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){JE(t,e),typeof r!="function"&&(Hl===null?Hl=new Set([this]):Hl.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function mL(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new bne;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=$ne.bind(null,t,e,n),e.then(t,t))}function gL(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vL(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=xc(-1,1),e.tag=2,Gl(n,e,1))),n.lanes|=1),t)}var xne=Gc.ReactCurrentOwner,Zi=!1;function ki(t,e,n,r){e.child=t===null?lj(e,null,n,r):pm(e,t.child,n,r)}function yL(t,e,n,r,i){n=n.render;var o=e.ref;return Mp(e,i),r=uN(t,e,n,r,o,i),n=cN(),t!==null&&!Zi?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,$c(t,e,i)):(_n&&n&&JR(e),e.flags|=1,ki(t,e,r,i),e.child)}function bL(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!bN(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,$j(t,e,o,r,i)):(t=dx(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:cy,n(s,r)&&t.ref===e.ref)return $c(t,e,i)}return e.flags|=1,t=Kl(o,r),t.ref=e.ref,t.return=e,e.child=t}function $j(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(cy(o,r)&&t.ref===e.ref)if(Zi=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(Zi=!0);else return e.lanes=t.lanes,$c(t,e,i)}return YE(t,e,n,r,i)}function Dj(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},hn(xp,ko),ko|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,hn(xp,ko),ko|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,hn(xp,ko),ko|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,hn(xp,ko),ko|=r;return ki(t,e,i,n),e.child}function Oj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function YE(t,e,n,r,i){var o=io(n)?$f:gi.current;return o=fm(e,o),Mp(e,i),n=uN(t,e,n,r,o,i),r=cN(),t!==null&&!Zi?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,$c(t,e,i)):(_n&&r&&JR(e),e.flags|=1,ki(t,e,n,i),e.child)}function xL(t,e,n,r,i){if(io(n)){var o=!0;iw(e)}else o=!1;if(Mp(e,i),e.stateNode===null)ux(t,e),uj(e,n,r),XE(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var u=s.context,c=n.contextType;typeof c=="object"&&c!==null?c=Es(c):(c=io(n)?$f:gi.current,c=fm(e,c));var l=n.getDerivedStateFromProps,d=typeof l=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||u!==c)&&dL(e,s,r,c),xl=!1;var f=e.memoizedState;s.state=f,cw(e,r,s,i),u=e.memoizedState,a!==r||f!==u||ro.current||xl?(typeof l=="function"&&(KE(e,n,l,r),u=e.memoizedState),(a=xl||lL(e,n,a,r,f,u,c))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),s.props=r,s.state=u,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,sj(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ms(e.type,a),s.props=c,d=e.pendingProps,f=s.context,u=n.contextType,typeof u=="object"&&u!==null?u=Es(u):(u=io(n)?$f:gi.current,u=fm(e,u));var h=n.getDerivedStateFromProps;(l=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==d||f!==u)&&dL(e,s,r,u),xl=!1,f=e.memoizedState,s.state=f,cw(e,r,s,i);var p=e.memoizedState;a!==d||f!==p||ro.current||xl?(typeof h=="function"&&(KE(e,n,h,r),p=e.memoizedState),(c=xl||lL(e,n,c,r,f,p,u)||!1)?(l||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,p,u),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,p,u)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),s.props=r,s.state=p,s.context=u,r=c):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return QE(t,e,n,r,o,i)}function QE(t,e,n,r,i,o){Oj(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&oL(e,n,!1),$c(t,e,o);r=e.stateNode,xne.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=pm(e,t.child,null,o),e.child=pm(e,null,a,o)):ki(t,e,a,o),e.memoizedState=r.state,i&&oL(e,n,!0),e.child}function Fj(t){var e=t.stateNode;e.pendingContext?iL(t,e.pendingContext,e.pendingContext!==e.context):e.context&&iL(t,e.context,!1),iN(t,e.containerInfo)}function wL(t,e,n,r,i){return hm(),QR(i),e.flags|=256,ki(t,e,n,r),e.child}var ZE={dehydrated:null,treeContext:null,retryLane:0};function e_(t){return{baseLanes:t,cachePool:null,transitions:null}}function Lj(t,e,n){var r=e.pendingProps,i=Rn.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),hn(Rn,i&1),t===null)return HE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=KS(s,r,0,null),t=bf(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=e_(n),e.memoizedState=ZE,t):fN(e,s));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return wne(t,e,s,r,a,i,n);if(o){o=r.fallback,s=e.mode,i=t.child,a=i.sibling;var u={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Kl(i,u),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Kl(a,o):(o=bf(o,s,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=t.child.memoizedState,s=s===null?e_(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~n,e.memoizedState=ZE,r}return o=t.child,t=o.sibling,r=Kl(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function fN(t,e){return e=KS({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Yb(t,e,n,r){return r!==null&&QR(r),pm(e,t.child,null,n),t=fN(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function wne(t,e,n,r,i,o,s){if(n)return e.flags&256?(e.flags&=-257,r=bk(Error(Te(422))),Yb(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=KS({mode:"visible",children:r.children},i,0,null),o=bf(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&pm(e,t.child,null,s),e.child.memoizedState=e_(s),e.memoizedState=ZE,o);if(!(e.mode&1))return Yb(t,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Te(419)),r=bk(o,r,void 0),Yb(t,e,s,r)}if(a=(s&t.childLanes)!==0,Zi||a){if(r=Sr,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Ac(t,i),ia(r,t,i,-1))}return yN(),r=bk(Error(Te(421))),Yb(t,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Dne.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,_o=jl(i.nextSibling),Oo=e,_n=!0,zs=null,t!==null&&(ss[as++]=Gu,ss[as++]=Hu,ss[as++]=Df,Gu=t.id,Hu=t.overflow,Df=e),e=fN(e,r.children),e.flags|=4096,e)}function SL(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),qE(t.return,e,n)}function xk(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Mj(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(ki(t,e,r.children,n),r=Rn.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&SL(t,n,e);else if(t.tag===19)SL(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(hn(Rn,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&lw(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),xk(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&lw(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}xk(e,!0,n,null,o);break;case"together":xk(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ux(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function $c(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ff|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Te(153));if(e.child!==null){for(t=e.child,n=Kl(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Kl(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Sne(t,e,n){switch(e.tag){case 3:Fj(e),hm();break;case 5:dj(e);break;case 1:io(e.type)&&iw(e);break;case 4:iN(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;hn(aw,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(hn(Rn,Rn.current&1),e.flags|=128,null):n&e.child.childLanes?Lj(t,e,n):(hn(Rn,Rn.current&1),t=$c(t,e,n),t!==null?t.sibling:null);hn(Rn,Rn.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Mj(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),hn(Rn,Rn.current),r)break;return null;case 22:case 23:return e.lanes=0,Dj(t,e,n)}return $c(t,e,n)}var Bj,t_,Uj,Vj;Bj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};t_=function(){};Uj=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,lf(tu.current);var o=null;switch(n){case"input":i=CE(t,i),r=CE(t,r),o=[];break;case"select":i=Dn({},i,{value:void 0}),r=Dn({},r,{value:void 0}),o=[];break;case"textarea":i=EE(t,i),r=EE(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=nw)}IE(n,r);var s;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ny.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var u=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&u!==a&&(u!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&a[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(o||(o=[]),o.push(c,n)),n=u;else c==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(o=o||[]).push(c,u)):c==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(c,""+u):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ny.hasOwnProperty(c)?(u!=null&&c==="onScroll"&&wn("scroll",t),o||a===u||(o=[])):(o=o||[]).push(c,u))}n&&(o=o||[]).push("style",n);var c=o;(e.updateQueue=c)&&(e.flags|=4)}};Vj=function(t,e,n,r){n!==r&&(e.flags|=4)};function Mg(t,e){if(!_n)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Kr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Cne(t,e,n){var r=e.pendingProps;switch(YR(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kr(e),null;case 1:return io(e.type)&&rw(),Kr(e),null;case 3:return r=e.stateNode,mm(),kn(ro),kn(gi),sN(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Xb(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zs!==null&&(c_(zs),zs=null))),t_(t,e),Kr(e),null;case 5:oN(e);var i=lf(py.current);if(n=e.type,t!==null&&e.stateNode!=null)Uj(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Te(166));return Kr(e),null}if(t=lf(tu.current),Xb(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[Aa]=e,r[fy]=o,t=(e.mode&1)!==0,n){case"dialog":wn("cancel",r),wn("close",r);break;case"iframe":case"object":case"embed":wn("load",r);break;case"video":case"audio":for(i=0;i<cv.length;i++)wn(cv[i],r);break;case"source":wn("error",r);break;case"img":case"image":case"link":wn("error",r),wn("load",r);break;case"details":wn("toggle",r);break;case"input":P3(r,o),wn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},wn("invalid",r);break;case"textarea":$3(r,o),wn("invalid",r)}IE(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&Kb(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Kb(r.textContent,a,t),i=["children",""+a]):ny.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&wn("scroll",r)}switch(n){case"input":Ub(r),A3(r,o,!0);break;case"textarea":Ub(r),D3(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=nw)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=pW(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[Aa]=e,t[fy]=r,Bj(t,e,!1,!1),e.stateNode=t;e:{switch(s=RE(n,r),n){case"dialog":wn("cancel",t),wn("close",t),i=r;break;case"iframe":case"object":case"embed":wn("load",t),i=r;break;case"video":case"audio":for(i=0;i<cv.length;i++)wn(cv[i],t);i=r;break;case"source":wn("error",t),i=r;break;case"img":case"image":case"link":wn("error",t),wn("load",t),i=r;break;case"details":wn("toggle",t),i=r;break;case"input":P3(t,r),i=CE(t,r),wn("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Dn({},r,{value:void 0}),wn("invalid",t);break;case"textarea":$3(t,r),i=EE(t,r),wn("invalid",t);break;default:i=r}IE(n,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var u=a[o];o==="style"?vW(t,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&mW(t,u)):o==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&ry(t,u):typeof u=="number"&&ry(t,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(ny.hasOwnProperty(o)?u!=null&&o==="onScroll"&&wn("scroll",t):u!=null&&FR(t,o,u,s))}switch(n){case"input":Ub(t),A3(t,r,!1);break;case"textarea":Ub(t),D3(t);break;case"option":r.value!=null&&t.setAttribute("value",""+od(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?Dp(t,!!r.multiple,o,!1):r.defaultValue!=null&&Dp(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=nw)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Kr(e),null;case 6:if(t&&e.stateNode!=null)Vj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Te(166));if(n=lf(py.current),lf(tu.current),Xb(e)){if(r=e.stateNode,n=e.memoizedProps,r[Aa]=e,(o=r.nodeValue!==n)&&(t=Oo,t!==null))switch(t.tag){case 3:Kb(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Kb(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Aa]=e,e.stateNode=r}return Kr(e),null;case 13:if(kn(Rn),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_n&&_o!==null&&e.mode&1&&!(e.flags&128))ij(),hm(),e.flags|=98560,o=!1;else if(o=Xb(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(Te(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Te(317));o[Aa]=e}else hm(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Kr(e),o=!1}else zs!==null&&(c_(zs),zs=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Rn.current&1?ar===0&&(ar=3):yN())),e.updateQueue!==null&&(e.flags|=4),Kr(e),null);case 4:return mm(),t_(t,e),t===null&&ly(e.stateNode.containerInfo),Kr(e),null;case 10:return tN(e.type._context),Kr(e),null;case 17:return io(e.type)&&rw(),Kr(e),null;case 19:if(kn(Rn),o=e.memoizedState,o===null)return Kr(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)Mg(o,!1);else{if(ar!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=lw(t),s!==null){for(e.flags|=128,Mg(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return hn(Rn,Rn.current&1|2),e.child}t=t.sibling}o.tail!==null&&Gn()>vm&&(e.flags|=128,r=!0,Mg(o,!1),e.lanes=4194304)}else{if(!r)if(t=lw(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Mg(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!_n)return Kr(e),null}else 2*Gn()-o.renderingStartTime>vm&&n!==1073741824&&(e.flags|=128,r=!0,Mg(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(n=o.last,n!==null?n.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Gn(),e.sibling=null,n=Rn.current,hn(Rn,r?n&1|2:n&1),e):(Kr(e),null);case 22:case 23:return vN(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ko&1073741824&&(Kr(e),e.subtreeFlags&6&&(e.flags|=8192)):Kr(e),null;case 24:return null;case 25:return null}throw Error(Te(156,e.tag))}function kne(t,e){switch(YR(e),e.tag){case 1:return io(e.type)&&rw(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mm(),kn(ro),kn(gi),sN(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return oN(e),null;case 13:if(kn(Rn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Te(340));hm()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return kn(Rn),null;case 4:return mm(),null;case 10:return tN(e.type._context),null;case 22:case 23:return vN(),null;case 24:return null;default:return null}}var Qb=!1,ri=!1,Tne=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function bp(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Mn(t,e,r)}else n.current=null}function n_(t,e,n){try{n()}catch(r){Mn(t,e,r)}}var CL=!1;function Ene(t,e){if(BE=Zx,t=GW(),XR(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,a=-1,u=-1,c=0,l=0,d=t,f=null;t:for(;;){for(var h;d!==n||i!==0&&d.nodeType!==3||(a=s+i),d!==o||r!==0&&d.nodeType!==3||(u=s+r),d.nodeType===3&&(s+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++c===i&&(a=s),f===o&&++l===r&&(u=s),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=a===-1||u===-1?null:{start:a,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(UE={focusedElem:t,selectionRange:n},Zx=!1,Ve=e;Ve!==null;)if(e=Ve,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ve=t;else for(;Ve!==null;){e=Ve;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,v=p.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ms(e.type,m),v);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Te(163))}}catch(x){Mn(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,Ve=t;break}Ve=e.return}return p=CL,CL=!1,p}function Av(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&n_(e,n,o)}i=i.next}while(i!==r)}}function HS(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function r_(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function zj(t){var e=t.alternate;e!==null&&(t.alternate=null,zj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Aa],delete e[fy],delete e[WE],delete e[une],delete e[cne])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Wj(t){return t.tag===5||t.tag===3||t.tag===4}function kL(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Wj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function i_(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=nw));else if(r!==4&&(t=t.child,t!==null))for(i_(t,e,n),t=t.sibling;t!==null;)i_(t,e,n),t=t.sibling}function o_(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(o_(t,e,n),t=t.sibling;t!==null;)o_(t,e,n),t=t.sibling}var Dr=null,Us=!1;function ll(t,e,n){for(n=n.child;n!==null;)jj(t,e,n),n=n.sibling}function jj(t,e,n){if(eu&&typeof eu.onCommitFiberUnmount=="function")try{eu.onCommitFiberUnmount(MS,n)}catch{}switch(n.tag){case 5:ri||bp(n,e);case 6:var r=Dr,i=Us;Dr=null,ll(t,e,n),Dr=r,Us=i,Dr!==null&&(Us?(t=Dr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Dr.removeChild(n.stateNode));break;case 18:Dr!==null&&(Us?(t=Dr,n=n.stateNode,t.nodeType===8?hk(t.parentNode,n):t.nodeType===1&&hk(t,n),ay(t)):hk(Dr,n.stateNode));break;case 4:r=Dr,i=Us,Dr=n.stateNode.containerInfo,Us=!0,ll(t,e,n),Dr=r,Us=i;break;case 0:case 11:case 14:case 15:if(!ri&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&n_(n,e,s),i=i.next}while(i!==r)}ll(t,e,n);break;case 1:if(!ri&&(bp(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Mn(n,e,a)}ll(t,e,n);break;case 21:ll(t,e,n);break;case 22:n.mode&1?(ri=(r=ri)||n.memoizedState!==null,ll(t,e,n),ri=r):ll(t,e,n);break;default:ll(t,e,n)}}function TL(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Tne),e.forEach(function(r){var i=One.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Fs(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Dr=a.stateNode,Us=!1;break e;case 3:Dr=a.stateNode.containerInfo,Us=!0;break e;case 4:Dr=a.stateNode.containerInfo,Us=!0;break e}a=a.return}if(Dr===null)throw Error(Te(160));jj(o,s,i),Dr=null,Us=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(c){Mn(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Gj(e,t),e=e.sibling}function Gj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Fs(e,t),wa(t),r&4){try{Av(3,t,t.return),HS(3,t)}catch(m){Mn(t,t.return,m)}try{Av(5,t,t.return)}catch(m){Mn(t,t.return,m)}}break;case 1:Fs(e,t),wa(t),r&512&&n!==null&&bp(n,n.return);break;case 5:if(Fs(e,t),wa(t),r&512&&n!==null&&bp(n,n.return),t.flags&32){var i=t.stateNode;try{ry(i,"")}catch(m){Mn(t,t.return,m)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,s=n!==null?n.memoizedProps:o,a=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&fW(i,o),RE(a,s);var c=RE(a,o);for(s=0;s<u.length;s+=2){var l=u[s],d=u[s+1];l==="style"?vW(i,d):l==="dangerouslySetInnerHTML"?mW(i,d):l==="children"?ry(i,d):FR(i,l,d,c)}switch(a){case"input":kE(i,o);break;case"textarea":hW(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var h=o.value;h!=null?Dp(i,!!o.multiple,h,!1):f!==!!o.multiple&&(o.defaultValue!=null?Dp(i,!!o.multiple,o.defaultValue,!0):Dp(i,!!o.multiple,o.multiple?[]:"",!1))}i[fy]=o}catch(m){Mn(t,t.return,m)}}break;case 6:if(Fs(e,t),wa(t),r&4){if(t.stateNode===null)throw Error(Te(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(m){Mn(t,t.return,m)}}break;case 3:if(Fs(e,t),wa(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ay(e.containerInfo)}catch(m){Mn(t,t.return,m)}break;case 4:Fs(e,t),wa(t);break;case 13:Fs(e,t),wa(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(mN=Gn())),r&4&&TL(t);break;case 22:if(l=n!==null&&n.memoizedState!==null,t.mode&1?(ri=(c=ri)||l,Fs(e,t),ri=c):Fs(e,t),wa(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!l&&t.mode&1)for(Ve=t,l=t.child;l!==null;){for(d=Ve=l;Ve!==null;){switch(f=Ve,h=f.child,f.tag){case 0:case 11:case 14:case 15:Av(4,f,f.return);break;case 1:bp(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){Mn(r,n,m)}}break;case 5:bp(f,f.return);break;case 22:if(f.memoizedState!==null){_L(d);continue}}h!==null?(h.return=f,Ve=h):_L(d)}l=l.sibling}e:for(l=null,d=t;;){if(d.tag===5){if(l===null){l=d;try{i=d.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,u=d.memoizedProps.style,s=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=gW("display",s))}catch(m){Mn(t,t.return,m)}}}else if(d.tag===6){if(l===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){Mn(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;l===d&&(l=null),d=d.return}l===d&&(l=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Fs(e,t),wa(t),r&4&&TL(t);break;case 21:break;default:Fs(e,t),wa(t)}}function wa(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Wj(n)){var r=n;break e}n=n.return}throw Error(Te(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ry(i,""),r.flags&=-33);var o=kL(t);o_(t,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=kL(t);i_(t,a,s);break;default:throw Error(Te(161))}}catch(u){Mn(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function _ne(t,e,n){Ve=t,Hj(t)}function Hj(t,e,n){for(var r=(t.mode&1)!==0;Ve!==null;){var i=Ve,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||Qb;if(!s){var a=i.alternate,u=a!==null&&a.memoizedState!==null||ri;a=Qb;var c=ri;if(Qb=s,(ri=u)&&!c)for(Ve=i;Ve!==null;)s=Ve,u=s.child,s.tag===22&&s.memoizedState!==null?IL(i):u!==null?(u.return=s,Ve=u):IL(i);for(;o!==null;)Ve=o,Hj(o),o=o.sibling;Ve=i,Qb=a,ri=c}EL(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,Ve=o):EL(t)}}function EL(t){for(;Ve!==null;){var e=Ve;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ri||HS(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ri)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Ms(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&cL(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}cL(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var l=c.memoizedState;if(l!==null){var d=l.dehydrated;d!==null&&ay(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Te(163))}ri||e.flags&512&&r_(e)}catch(f){Mn(e,e.return,f)}}if(e===t){Ve=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ve=n;break}Ve=e.return}}function _L(t){for(;Ve!==null;){var e=Ve;if(e===t){Ve=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ve=n;break}Ve=e.return}}function IL(t){for(;Ve!==null;){var e=Ve;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{HS(4,e)}catch(u){Mn(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){Mn(e,i,u)}}var o=e.return;try{r_(e)}catch(u){Mn(e,o,u)}break;case 5:var s=e.return;try{r_(e)}catch(u){Mn(e,s,u)}}}catch(u){Mn(e,e.return,u)}if(e===t){Ve=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ve=a;break}Ve=e.return}}var Ine=Math.ceil,hw=Gc.ReactCurrentDispatcher,hN=Gc.ReactCurrentOwner,Ss=Gc.ReactCurrentBatchConfig,Bt=0,Sr=null,Jn=null,Ur=0,ko=0,xp=yd(0),ar=0,yy=null,Ff=0,qS=0,pN=0,$v=null,Ki=null,mN=0,vm=1/0,Du=null,pw=!1,s_=null,Hl=null,Zb=!1,Il=null,mw=0,Dv=0,a_=null,cx=-1,lx=0;function $i(){return Bt&6?Gn():cx!==-1?cx:cx=Gn()}function ql(t){return t.mode&1?Bt&2&&Ur!==0?Ur&-Ur:dne.transition!==null?(lx===0&&(lx=RW()),lx):(t=Yt,t!==0||(t=window.event,t=t===void 0?16:FW(t.type)),t):1}function ia(t,e,n,r){if(50<Dv)throw Dv=0,a_=null,Error(Te(185));v0(t,n,r),(!(Bt&2)||t!==Sr)&&(t===Sr&&(!(Bt&2)&&(qS|=n),ar===4&&kl(t,Ur)),oo(t,r),n===1&&Bt===0&&!(e.mode&1)&&(vm=Gn()+500,WS&&bd()))}function oo(t,e){var n=t.callbackNode;dte(t,e);var r=Qx(t,t===Sr?Ur:0);if(r===0)n!==null&&L3(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&L3(n),e===1)t.tag===0?lne(RL.bind(null,t)):tj(RL.bind(null,t)),sne(function(){!(Bt&6)&&bd()}),n=null;else{switch(NW(r)){case 1:n=VR;break;case 4:n=_W;break;case 16:n=Yx;break;case 536870912:n=IW;break;default:n=Yx}n=e5(n,qj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function qj(t,e){if(cx=-1,lx=0,Bt&6)throw Error(Te(327));var n=t.callbackNode;if(Bp()&&t.callbackNode!==n)return null;var r=Qx(t,t===Sr?Ur:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=gw(t,r);else{e=r;var i=Bt;Bt|=2;var o=Xj();(Sr!==t||Ur!==e)&&(Du=null,vm=Gn()+500,yf(t,e));do try{Pne();break}catch(a){Kj(t,a)}while(1);eN(),hw.current=o,Bt=i,Jn!==null?e=0:(Sr=null,Ur=0,e=ar)}if(e!==0){if(e===2&&(i=DE(t),i!==0&&(r=i,e=u_(t,i))),e===1)throw n=yy,yf(t,0),kl(t,r),oo(t,Gn()),n;if(e===6)kl(t,r);else{if(i=t.current.alternate,!(r&30)&&!Rne(i)&&(e=gw(t,r),e===2&&(o=DE(t),o!==0&&(r=o,e=u_(t,o))),e===1))throw n=yy,yf(t,0),kl(t,r),oo(t,Gn()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(Te(345));case 2:qd(t,Ki,Du);break;case 3:if(kl(t,r),(r&130023424)===r&&(e=mN+500-Gn(),10<e)){if(Qx(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){$i(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=zE(qd.bind(null,t,Ki,Du),e);break}qd(t,Ki,Du);break;case 4:if(kl(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var s=31-ra(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Gn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ine(r/1960))-r,10<r){t.timeoutHandle=zE(qd.bind(null,t,Ki,Du),r);break}qd(t,Ki,Du);break;case 5:qd(t,Ki,Du);break;default:throw Error(Te(329))}}}return oo(t,Gn()),t.callbackNode===n?qj.bind(null,t):null}function u_(t,e){var n=$v;return t.current.memoizedState.isDehydrated&&(yf(t,e).flags|=256),t=gw(t,e),t!==2&&(e=Ki,Ki=n,e!==null&&c_(e)),t}function c_(t){Ki===null?Ki=t:Ki.push.apply(Ki,t)}function Rne(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!aa(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function kl(t,e){for(e&=~pN,e&=~qS,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ra(e),r=1<<n;t[n]=-1,e&=~r}}function RL(t){if(Bt&6)throw Error(Te(327));Bp();var e=Qx(t,0);if(!(e&1))return oo(t,Gn()),null;var n=gw(t,e);if(t.tag!==0&&n===2){var r=DE(t);r!==0&&(e=r,n=u_(t,r))}if(n===1)throw n=yy,yf(t,0),kl(t,e),oo(t,Gn()),n;if(n===6)throw Error(Te(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,qd(t,Ki,Du),oo(t,Gn()),null}function gN(t,e){var n=Bt;Bt|=1;try{return t(e)}finally{Bt=n,Bt===0&&(vm=Gn()+500,WS&&bd())}}function Lf(t){Il!==null&&Il.tag===0&&!(Bt&6)&&Bp();var e=Bt;Bt|=1;var n=Ss.transition,r=Yt;try{if(Ss.transition=null,Yt=1,t)return t()}finally{Yt=r,Ss.transition=n,Bt=e,!(Bt&6)&&bd()}}function vN(){ko=xp.current,kn(xp)}function yf(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,one(n)),Jn!==null)for(n=Jn.return;n!==null;){var r=n;switch(YR(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&rw();break;case 3:mm(),kn(ro),kn(gi),sN();break;case 5:oN(r);break;case 4:mm();break;case 13:kn(Rn);break;case 19:kn(Rn);break;case 10:tN(r.type._context);break;case 22:case 23:vN()}n=n.return}if(Sr=t,Jn=t=Kl(t.current,null),Ur=ko=e,ar=0,yy=null,pN=qS=Ff=0,Ki=$v=null,cf!==null){for(e=0;e<cf.length;e++)if(n=cf[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}n.pending=r}cf=null}return t}function Kj(t,e){do{var n=Jn;try{if(eN(),sx.current=fw,dw){for(var r=$n.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}dw=!1}if(Of=0,br=rr=$n=null,Pv=!1,my=0,hN.current=null,n===null||n.return===null){ar=1,yy=e,Jn=null;break}e:{var o=t,s=n.return,a=n,u=e;if(e=Ur,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var c=u,l=a,d=l.tag;if(!(l.mode&1)&&(d===0||d===11||d===15)){var f=l.alternate;f?(l.updateQueue=f.updateQueue,l.memoizedState=f.memoizedState,l.lanes=f.lanes):(l.updateQueue=null,l.memoizedState=null)}var h=gL(s);if(h!==null){h.flags&=-257,vL(h,s,a,o,e),h.mode&1&&mL(o,c,e),e=h,u=c;var p=e.updateQueue;if(p===null){var m=new Set;m.add(u),e.updateQueue=m}else p.add(u);break e}else{if(!(e&1)){mL(o,c,e),yN();break e}u=Error(Te(426))}}else if(_n&&a.mode&1){var v=gL(s);if(v!==null){!(v.flags&65536)&&(v.flags|=256),vL(v,s,a,o,e),QR(gm(u,a));break e}}o=u=gm(u,a),ar!==4&&(ar=2),$v===null?$v=[o]:$v.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var g=Pj(o,u,e);uL(o,g);break e;case 1:a=u;var y=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Hl===null||!Hl.has(b)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=Aj(o,a,e);uL(o,x);break e}}o=o.return}while(o!==null)}Yj(n)}catch(S){e=S,Jn===n&&n!==null&&(Jn=n=n.return);continue}break}while(1)}function Xj(){var t=hw.current;return hw.current=fw,t===null?fw:t}function yN(){(ar===0||ar===3||ar===2)&&(ar=4),Sr===null||!(Ff&268435455)&&!(qS&268435455)||kl(Sr,Ur)}function gw(t,e){var n=Bt;Bt|=2;var r=Xj();(Sr!==t||Ur!==e)&&(Du=null,yf(t,e));do try{Nne();break}catch(i){Kj(t,i)}while(1);if(eN(),Bt=n,hw.current=r,Jn!==null)throw Error(Te(261));return Sr=null,Ur=0,ar}function Nne(){for(;Jn!==null;)Jj(Jn)}function Pne(){for(;Jn!==null&&!nte();)Jj(Jn)}function Jj(t){var e=Zj(t.alternate,t,ko);t.memoizedProps=t.pendingProps,e===null?Yj(t):Jn=e,hN.current=null}function Yj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=kne(n,e),n!==null){n.flags&=32767,Jn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ar=6,Jn=null;return}}else if(n=Cne(n,e,ko),n!==null){Jn=n;return}if(e=e.sibling,e!==null){Jn=e;return}Jn=e=t}while(e!==null);ar===0&&(ar=5)}function qd(t,e,n){var r=Yt,i=Ss.transition;try{Ss.transition=null,Yt=1,Ane(t,e,n,r)}finally{Ss.transition=i,Yt=r}return null}function Ane(t,e,n,r){do Bp();while(Il!==null);if(Bt&6)throw Error(Te(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Te(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(fte(t,o),t===Sr&&(Jn=Sr=null,Ur=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Zb||(Zb=!0,e5(Yx,function(){return Bp(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Ss.transition,Ss.transition=null;var s=Yt;Yt=1;var a=Bt;Bt|=4,hN.current=null,Ene(t,n),Gj(n,t),Qte(UE),Zx=!!BE,UE=BE=null,t.current=n,_ne(n),rte(),Bt=a,Yt=s,Ss.transition=o}else t.current=n;if(Zb&&(Zb=!1,Il=t,mw=i),o=t.pendingLanes,o===0&&(Hl=null),ste(n.stateNode),oo(t,Gn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(pw)throw pw=!1,t=s_,s_=null,t;return mw&1&&t.tag!==0&&Bp(),o=t.pendingLanes,o&1?t===a_?Dv++:(Dv=0,a_=t):Dv=0,bd(),null}function Bp(){if(Il!==null){var t=NW(mw),e=Ss.transition,n=Yt;try{if(Ss.transition=null,Yt=16>t?16:t,Il===null)var r=!1;else{if(t=Il,Il=null,mw=0,Bt&6)throw Error(Te(331));var i=Bt;for(Bt|=4,Ve=t.current;Ve!==null;){var o=Ve,s=o.child;if(Ve.flags&16){var a=o.deletions;if(a!==null){for(var u=0;u<a.length;u++){var c=a[u];for(Ve=c;Ve!==null;){var l=Ve;switch(l.tag){case 0:case 11:case 15:Av(8,l,o)}var d=l.child;if(d!==null)d.return=l,Ve=d;else for(;Ve!==null;){l=Ve;var f=l.sibling,h=l.return;if(zj(l),l===c){Ve=null;break}if(f!==null){f.return=h,Ve=f;break}Ve=h}}}var p=o.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}Ve=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,Ve=s;else e:for(;Ve!==null;){if(o=Ve,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Av(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,Ve=g;break e}Ve=o.return}}var y=t.current;for(Ve=y;Ve!==null;){s=Ve;var b=s.child;if(s.subtreeFlags&2064&&b!==null)b.return=s,Ve=b;else e:for(s=y;Ve!==null;){if(a=Ve,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:HS(9,a)}}catch(S){Mn(a,a.return,S)}if(a===s){Ve=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,Ve=x;break e}Ve=a.return}}if(Bt=i,bd(),eu&&typeof eu.onPostCommitFiberRoot=="function")try{eu.onPostCommitFiberRoot(MS,t)}catch{}r=!0}return r}finally{Yt=n,Ss.transition=e}}return!1}function NL(t,e,n){e=gm(n,e),e=Pj(t,e,1),t=Gl(t,e,1),e=$i(),t!==null&&(v0(t,1,e),oo(t,e))}function Mn(t,e,n){if(t.tag===3)NL(t,t,n);else for(;e!==null;){if(e.tag===3){NL(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Hl===null||!Hl.has(r))){t=gm(n,t),t=Aj(e,t,1),e=Gl(e,t,1),t=$i(),e!==null&&(v0(e,1,t),oo(e,t));break}}e=e.return}}function $ne(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=$i(),t.pingedLanes|=t.suspendedLanes&n,Sr===t&&(Ur&n)===n&&(ar===4||ar===3&&(Ur&130023424)===Ur&&500>Gn()-mN?yf(t,0):pN|=n),oo(t,e)}function Qj(t,e){e===0&&(t.mode&1?(e=Wb,Wb<<=1,!(Wb&130023424)&&(Wb=4194304)):e=1);var n=$i();t=Ac(t,e),t!==null&&(v0(t,e,n),oo(t,n))}function Dne(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Qj(t,n)}function One(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Te(314))}r!==null&&r.delete(e),Qj(t,n)}var Zj;Zj=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ro.current)Zi=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Zi=!1,Sne(t,e,n);Zi=!!(t.flags&131072)}else Zi=!1,_n&&e.flags&1048576&&nj(e,sw,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ux(t,e),t=e.pendingProps;var i=fm(e,gi.current);Mp(e,n),i=uN(null,e,r,t,i,n);var o=cN();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,io(r)?(o=!0,iw(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,rN(e),i.updater=jS,e.stateNode=i,i._reactInternals=e,XE(e,r,t,n),e=QE(null,e,r,!0,o,n)):(e.tag=0,_n&&o&&JR(e),ki(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ux(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Lne(r),t=Ms(r,t),i){case 0:e=YE(null,e,r,t,n);break e;case 1:e=xL(null,e,r,t,n);break e;case 11:e=yL(null,e,r,t,n);break e;case 14:e=bL(null,e,r,Ms(r.type,t),n);break e}throw Error(Te(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ms(r,i),YE(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ms(r,i),xL(t,e,r,i,n);case 3:e:{if(Fj(e),t===null)throw Error(Te(387));r=e.pendingProps,o=e.memoizedState,i=o.element,sj(t,e),cw(e,r,null,n);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=gm(Error(Te(423)),e),e=wL(t,e,r,n,i);break e}else if(r!==i){i=gm(Error(Te(424)),e),e=wL(t,e,r,n,i);break e}else for(_o=jl(e.stateNode.containerInfo.firstChild),Oo=e,_n=!0,zs=null,n=lj(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(hm(),r===i){e=$c(t,e,n);break e}ki(t,e,r,n)}e=e.child}return e;case 5:return dj(e),t===null&&HE(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,VE(r,i)?s=null:o!==null&&VE(r,o)&&(e.flags|=32),Oj(t,e),ki(t,e,s,n),e.child;case 6:return t===null&&HE(e),null;case 13:return Lj(t,e,n);case 4:return iN(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=pm(e,null,r,n):ki(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ms(r,i),yL(t,e,r,i,n);case 7:return ki(t,e,e.pendingProps,n),e.child;case 8:return ki(t,e,e.pendingProps.children,n),e.child;case 12:return ki(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,hn(aw,r._currentValue),r._currentValue=s,o!==null)if(aa(o.value,s)){if(o.children===i.children&&!ro.current){e=$c(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=xc(-1,n&-n),u.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var l=c.pending;l===null?u.next=u:(u.next=l.next,l.next=u),c.pending=u}}o.lanes|=n,u=o.alternate,u!==null&&(u.lanes|=n),qE(o.return,n,e),a.lanes|=n;break}u=u.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Te(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),qE(s,n,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}ki(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Mp(e,n),i=Es(i),r=r(i),e.flags|=1,ki(t,e,r,n),e.child;case 14:return r=e.type,i=Ms(r,e.pendingProps),i=Ms(r.type,i),bL(t,e,r,i,n);case 15:return $j(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ms(r,i),ux(t,e),e.tag=1,io(r)?(t=!0,iw(e)):t=!1,Mp(e,n),uj(e,r,i),XE(e,r,i,n),QE(null,e,r,!0,t,n);case 19:return Mj(t,e,n);case 22:return Dj(t,e,n)}throw Error(Te(156,e.tag))};function e5(t,e){return EW(t,e)}function Fne(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ds(t,e,n,r){return new Fne(t,e,n,r)}function bN(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Lne(t){if(typeof t=="function")return bN(t)?1:0;if(t!=null){if(t=t.$$typeof,t===MR)return 11;if(t===BR)return 14}return 2}function Kl(t,e){var n=t.alternate;return n===null?(n=ds(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dx(t,e,n,r,i,o){var s=2;if(r=t,typeof t=="function")bN(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case lp:return bf(n.children,i,o,e);case LR:s=8,i|=8;break;case bE:return t=ds(12,n,e,i|2),t.elementType=bE,t.lanes=o,t;case xE:return t=ds(13,n,e,i),t.elementType=xE,t.lanes=o,t;case wE:return t=ds(19,n,e,i),t.elementType=wE,t.lanes=o,t;case cW:return KS(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case aW:s=10;break e;case uW:s=9;break e;case MR:s=11;break e;case BR:s=14;break e;case bl:s=16,r=null;break e}throw Error(Te(130,t==null?t:typeof t,""))}return e=ds(s,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function bf(t,e,n,r){return t=ds(7,t,r,e),t.lanes=n,t}function KS(t,e,n,r){return t=ds(22,t,r,e),t.elementType=cW,t.lanes=n,t.stateNode={isHidden:!1},t}function wk(t,e,n){return t=ds(6,t,null,e),t.lanes=n,t}function Sk(t,e,n){return e=ds(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Mne(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nk(0),this.expirationTimes=nk(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nk(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function xN(t,e,n,r,i,o,s,a,u){return t=new Mne(t,e,n,a,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=ds(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},rN(o),t}function Bne(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cp,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function t5(t){if(!t)return sd;t=t._reactInternals;e:{if(rh(t)!==t||t.tag!==1)throw Error(Te(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(io(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Te(171))}if(t.tag===1){var n=t.type;if(io(n))return ej(t,n,e)}return e}function n5(t,e,n,r,i,o,s,a,u){return t=xN(n,r,!0,t,i,o,s,a,u),t.context=t5(null),n=t.current,r=$i(),i=ql(n),o=xc(r,i),o.callback=e??null,Gl(n,o,i),t.current.lanes=i,v0(t,i,r),oo(t,r),t}function XS(t,e,n,r){var i=e.current,o=$i(),s=ql(i);return n=t5(n),e.context===null?e.context=n:e.pendingContext=n,e=xc(o,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Gl(i,e,s),t!==null&&(ia(t,i,s,o),ox(t,i,s)),s}function vw(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function PL(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function wN(t,e){PL(t,e),(t=t.alternate)&&PL(t,e)}function Une(){return null}var r5=typeof reportError=="function"?reportError:function(t){console.error(t)};function SN(t){this._internalRoot=t}JS.prototype.render=SN.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Te(409));XS(t,e,null,null)};JS.prototype.unmount=SN.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Lf(function(){XS(null,t,null,null)}),e[Pc]=null}};function JS(t){this._internalRoot=t}JS.prototype.unstable_scheduleHydration=function(t){if(t){var e=$W();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Cl.length&&e!==0&&e<Cl[n].priority;n++);Cl.splice(n,0,t),n===0&&OW(t)}};function CN(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function YS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function AL(){}function Vne(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=vw(s);o.call(c)}}var s=n5(e,r,t,0,null,!1,!1,"",AL);return t._reactRootContainer=s,t[Pc]=s.current,ly(t.nodeType===8?t.parentNode:t),Lf(),s}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=vw(u);a.call(c)}}var u=xN(t,0,!1,null,null,!1,!1,"",AL);return t._reactRootContainer=u,t[Pc]=u.current,ly(t.nodeType===8?t.parentNode:t),Lf(function(){XS(e,u,n,r)}),u}function QS(t,e,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var u=vw(s);a.call(u)}}XS(e,s,t,i)}else s=Vne(n,e,t,i,r);return vw(s)}PW=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=uv(e.pendingLanes);n!==0&&(zR(e,n|1),oo(e,Gn()),!(Bt&6)&&(vm=Gn()+500,bd()))}break;case 13:Lf(function(){var r=Ac(t,1);if(r!==null){var i=$i();ia(r,t,1,i)}}),wN(t,1)}};WR=function(t){if(t.tag===13){var e=Ac(t,134217728);if(e!==null){var n=$i();ia(e,t,134217728,n)}wN(t,134217728)}};AW=function(t){if(t.tag===13){var e=ql(t),n=Ac(t,e);if(n!==null){var r=$i();ia(n,t,e,r)}wN(t,e)}};$W=function(){return Yt};DW=function(t,e){var n=Yt;try{return Yt=t,e()}finally{Yt=n}};PE=function(t,e,n){switch(e){case"input":if(kE(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=zS(r);if(!i)throw Error(Te(90));dW(r),kE(r,i)}}}break;case"textarea":hW(t,n);break;case"select":e=n.value,e!=null&&Dp(t,!!n.multiple,e,!1)}};xW=gN;wW=Lf;var zne={usingClientEntryPoint:!1,Events:[b0,pp,zS,yW,bW,gN]},Bg={findFiberByHostInstance:uf,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Wne={bundleType:Bg.bundleType,version:Bg.version,rendererPackageName:Bg.rendererPackageName,rendererConfig:Bg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Gc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=kW(t),t===null?null:t.stateNode},findFiberByHostInstance:Bg.findFiberByHostInstance||Une,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var e1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e1.isDisabled&&e1.supportsFiber)try{MS=e1.inject(Wne),eu=e1}catch{}}Vo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zne;Vo.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!CN(e))throw Error(Te(200));return Bne(t,e,null,n)};Vo.createRoot=function(t,e){if(!CN(t))throw Error(Te(299));var n=!1,r="",i=r5;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=xN(t,1,!1,null,null,n,!1,r,i),t[Pc]=e.current,ly(t.nodeType===8?t.parentNode:t),new SN(e)};Vo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Te(188)):(t=Object.keys(t).join(","),Error(Te(268,t)));return t=kW(e),t=t===null?null:t.stateNode,t};Vo.flushSync=function(t){return Lf(t)};Vo.hydrate=function(t,e,n){if(!YS(e))throw Error(Te(200));return QS(null,t,e,!0,n)};Vo.hydrateRoot=function(t,e,n){if(!CN(t))throw Error(Te(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",s=r5;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=n5(e,null,t,1,n??null,i,!1,o,s),t[Pc]=e.current,ly(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new JS(e)};Vo.render=function(t,e,n){if(!YS(e))throw Error(Te(200));return QS(null,t,e,!1,n)};Vo.unmountComponentAtNode=function(t){if(!YS(t))throw Error(Te(40));return t._reactRootContainer?(Lf(function(){QS(null,null,t,!1,function(){t._reactRootContainer=null,t[Pc]=null})}),!0):!1};Vo.unstable_batchedUpdates=gN;Vo.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!YS(n))throw Error(Te(200));if(t==null||t._reactInternals===void 0)throw Error(Te(38));return QS(t,e,n,!1,r)};Vo.version="18.2.0-next-9e3b772b8-20220608";function i5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i5)}catch(t){console.error(t)}}i5(),nW.exports=Vo;var kN=nW.exports,$L=kN;vE.createRoot=$L.createRoot,vE.hydrateRoot=$L.hydrateRoot;function o5(t,e){return function(){return t.apply(e,arguments)}}const{toString:jne}=Object.prototype,{getPrototypeOf:TN}=Object,ZS=(t=>e=>{const n=jne.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),gu=t=>(t=t.toLowerCase(),e=>ZS(e)===t),eC=t=>e=>typeof e===t,{isArray:Gm}=Array,by=eC("undefined");function Gne(t){return t!==null&&!by(t)&&t.constructor!==null&&!by(t.constructor)&&Cs(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const s5=gu("ArrayBuffer");function Hne(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&s5(t.buffer),e}const qne=eC("string"),Cs=eC("function"),a5=eC("number"),tC=t=>t!==null&&typeof t=="object",Kne=t=>t===!0||t===!1,fx=t=>{if(ZS(t)!=="object")return!1;const e=TN(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Xne=gu("Date"),Jne=gu("File"),Yne=gu("Blob"),Qne=gu("FileList"),Zne=t=>tC(t)&&Cs(t.pipe),ere=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Cs(t.append)&&((e=ZS(t))==="formdata"||e==="object"&&Cs(t.toString)&&t.toString()==="[object FormData]"))},tre=gu("URLSearchParams"),nre=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function w0(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,i;if(typeof t!="object"&&(t=[t]),Gm(t))for(r=0,i=t.length;r<i;r++)e.call(null,t[r],r,t);else{const o=n?Object.getOwnPropertyNames(t):Object.keys(t),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,t[a],a,t)}}function u5(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,i;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const c5=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),l5=t=>!by(t)&&t!==c5;function l_(){const{caseless:t}=l5(this)&&this||{},e={},n=(r,i)=>{const o=t&&u5(e,i)||i;fx(e[o])&&fx(r)?e[o]=l_(e[o],r):fx(r)?e[o]=l_({},r):Gm(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&w0(arguments[r],n);return e}const rre=(t,e,n,{allOwnKeys:r}={})=>(w0(e,(i,o)=>{n&&Cs(i)?t[o]=o5(i,n):t[o]=i},{allOwnKeys:r}),t),ire=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ore=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},sre=(t,e,n,r)=>{let i,o,s;const a={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),o=i.length;o-- >0;)s=i[o],(!r||r(s,t,e))&&!a[s]&&(e[s]=t[s],a[s]=!0);t=n!==!1&&TN(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},are=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},ure=t=>{if(!t)return null;if(Gm(t))return t;let e=t.length;if(!a5(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},cre=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&TN(Uint8Array)),lre=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=r.next())&&!i.done;){const o=i.value;e.call(t,o[0],o[1])}},dre=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},fre=gu("HTMLFormElement"),hre=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,i){return r.toUpperCase()+i}),DL=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),pre=gu("RegExp"),d5=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};w0(n,(i,o)=>{let s;(s=e(i,o,t))!==!1&&(r[o]=s||i)}),Object.defineProperties(t,r)},mre=t=>{d5(t,(e,n)=>{if(Cs(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(Cs(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},gre=(t,e)=>{const n={},r=i=>{i.forEach(o=>{n[o]=!0})};return Gm(t)?r(t):r(String(t).split(e)),n},vre=()=>{},yre=(t,e)=>(t=+t,Number.isFinite(t)?t:e),Ck="abcdefghijklmnopqrstuvwxyz",OL="0123456789",f5={DIGIT:OL,ALPHA:Ck,ALPHA_DIGIT:Ck+Ck.toUpperCase()+OL},bre=(t=16,e=f5.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function xre(t){return!!(t&&Cs(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const wre=t=>{const e=new Array(10),n=(r,i)=>{if(tC(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=Gm(r)?[]:{};return w0(r,(s,a)=>{const u=n(s,i+1);!by(u)&&(o[a]=u)}),e[i]=void 0,o}}return r};return n(t,0)},Sre=gu("AsyncFunction"),Cre=t=>t&&(tC(t)||Cs(t))&&Cs(t.then)&&Cs(t.catch),ye={isArray:Gm,isArrayBuffer:s5,isBuffer:Gne,isFormData:ere,isArrayBufferView:Hne,isString:qne,isNumber:a5,isBoolean:Kne,isObject:tC,isPlainObject:fx,isUndefined:by,isDate:Xne,isFile:Jne,isBlob:Yne,isRegExp:pre,isFunction:Cs,isStream:Zne,isURLSearchParams:tre,isTypedArray:cre,isFileList:Qne,forEach:w0,merge:l_,extend:rre,trim:nre,stripBOM:ire,inherits:ore,toFlatObject:sre,kindOf:ZS,kindOfTest:gu,endsWith:are,toArray:ure,forEachEntry:lre,matchAll:dre,isHTMLForm:fre,hasOwnProperty:DL,hasOwnProp:DL,reduceDescriptors:d5,freezeMethods:mre,toObjectSet:gre,toCamelCase:hre,noop:vre,toFiniteNumber:yre,findKey:u5,global:c5,isContextDefined:l5,ALPHABET:f5,generateString:bre,isSpecCompliantForm:xre,toJSONObject:wre,isAsyncFn:Sre,isThenable:Cre};function Ft(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}ye.inherits(Ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ye.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const h5=Ft.prototype,p5={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{p5[t]={value:t}});Object.defineProperties(Ft,p5);Object.defineProperty(h5,"isAxiosError",{value:!0});Ft.from=(t,e,n,r,i,o)=>{const s=Object.create(h5);return ye.toFlatObject(t,s,function(u){return u!==Error.prototype},a=>a!=="isAxiosError"),Ft.call(s,t.message,e,n,r,i),s.cause=t,s.name=t.name,o&&Object.assign(s,o),s};const kre=null;function d_(t){return ye.isPlainObject(t)||ye.isArray(t)}function m5(t){return ye.endsWith(t,"[]")?t.slice(0,-2):t}function FL(t,e,n){return t?t.concat(e).map(function(i,o){return i=m5(i),!n&&o?"["+i+"]":i}).join(n?".":""):e}function Tre(t){return ye.isArray(t)&&!t.some(d_)}const Ere=ye.toFlatObject(ye,{},null,function(e){return/^is[A-Z]/.test(e)});function nC(t,e,n){if(!ye.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=ye.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,v){return!ye.isUndefined(v[m])});const r=n.metaTokens,i=n.visitor||l,o=n.dots,s=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&ye.isSpecCompliantForm(e);if(!ye.isFunction(i))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(ye.isDate(p))return p.toISOString();if(!u&&ye.isBlob(p))throw new Ft("Blob is not supported. Use a Buffer instead.");return ye.isArrayBuffer(p)||ye.isTypedArray(p)?u&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function l(p,m,v){let g=p;if(p&&!v&&typeof p=="object"){if(ye.endsWith(m,"{}"))m=r?m:m.slice(0,-2),p=JSON.stringify(p);else if(ye.isArray(p)&&Tre(p)||(ye.isFileList(p)||ye.endsWith(m,"[]"))&&(g=ye.toArray(p)))return m=m5(m),g.forEach(function(b,x){!(ye.isUndefined(b)||b===null)&&e.append(s===!0?FL([m],x,o):s===null?m:m+"[]",c(b))}),!1}return d_(p)?!0:(e.append(FL(v,m,o),c(p)),!1)}const d=[],f=Object.assign(Ere,{defaultVisitor:l,convertValue:c,isVisitable:d_});function h(p,m){if(!ye.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(p),ye.forEach(p,function(g,y){(!(ye.isUndefined(g)||g===null)&&i.call(e,g,ye.isString(y)?y.trim():y,m,f))===!0&&h(g,m?m.concat(y):[y])}),d.pop()}}if(!ye.isObject(t))throw new TypeError("data must be an object");return h(t),e}function LL(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function EN(t,e){this._pairs=[],t&&nC(t,this,e)}const g5=EN.prototype;g5.append=function(e,n){this._pairs.push([e,n])};g5.toString=function(e){const n=e?function(r){return e.call(this,r,LL)}:LL;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function _re(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function v5(t,e,n){if(!e)return t;const r=n&&n.encode||_re,i=n&&n.serialize;let o;if(i?o=i(e,n):o=ye.isURLSearchParams(e)?e.toString():new EN(e,n).toString(r),o){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class Ire{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ye.forEach(this.handlers,function(r){r!==null&&e(r)})}}const ML=Ire,y5={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rre=typeof URLSearchParams<"u"?URLSearchParams:EN,Nre=typeof FormData<"u"?FormData:null,Pre=typeof Blob<"u"?Blob:null,Are=(()=>{let t;return typeof navigator<"u"&&((t=navigator.product)==="ReactNative"||t==="NativeScript"||t==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),$re=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Ks={isBrowser:!0,classes:{URLSearchParams:Rre,FormData:Nre,Blob:Pre},isStandardBrowserEnv:Are,isStandardBrowserWebWorkerEnv:$re,protocols:["http","https","file","blob","url","data"]};function Dre(t,e){return nC(t,new Ks.classes.URLSearchParams,Object.assign({visitor:function(n,r,i,o){return Ks.isNode&&ye.isBuffer(n)?(this.append(r,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Ore(t){return ye.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Fre(t){const e={},n=Object.keys(t);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],e[o]=t[o];return e}function b5(t){function e(n,r,i,o){let s=n[o++];const a=Number.isFinite(+s),u=o>=n.length;return s=!s&&ye.isArray(i)?i.length:s,u?(ye.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!ye.isObject(i[s]))&&(i[s]=[]),e(n,r,i[s],o)&&ye.isArray(i[s])&&(i[s]=Fre(i[s])),!a)}if(ye.isFormData(t)&&ye.isFunction(t.entries)){const n={};return ye.forEachEntry(t,(r,i)=>{e(Ore(r),i,n,0)}),n}return null}function Lre(t,e,n){if(ye.isString(t))try{return(e||JSON.parse)(t),ye.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const _N={transitional:y5,adapter:Ks.isNode?"http":"xhr",transformRequest:[function(e,n){const r=n.getContentType()||"",i=r.indexOf("application/json")>-1,o=ye.isObject(e);if(o&&ye.isHTMLForm(e)&&(e=new FormData(e)),ye.isFormData(e))return i&&i?JSON.stringify(b5(e)):e;if(ye.isArrayBuffer(e)||ye.isBuffer(e)||ye.isStream(e)||ye.isFile(e)||ye.isBlob(e))return e;if(ye.isArrayBufferView(e))return e.buffer;if(ye.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Dre(e,this.formSerializer).toString();if((a=ye.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return nC(a?{"files[]":e}:e,u&&new u,this.formSerializer)}}return o||i?(n.setContentType("application/json",!1),Lre(e)):e}],transformResponse:[function(e){const n=this.transitional||_N.transitional,r=n&&n.forcedJSONParsing,i=this.responseType==="json";if(e&&ye.isString(e)&&(r&&!this.responseType||i)){const s=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Ft.from(a,Ft.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ks.classes.FormData,Blob:Ks.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ye.forEach(["delete","get","head","post","put","patch"],t=>{_N.headers[t]={}});const IN=_N,Mre=ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Bre=t=>{const e={};let n,r,i;return t&&t.split(`
`).forEach(function(s){i=s.indexOf(":"),n=s.substring(0,i).trim().toLowerCase(),r=s.substring(i+1).trim(),!(!n||e[n]&&Mre[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},BL=Symbol("internals");function Ug(t){return t&&String(t).trim().toLowerCase()}function hx(t){return t===!1||t==null?t:ye.isArray(t)?t.map(hx):String(t)}function Ure(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const Vre=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function kk(t,e,n,r,i){if(ye.isFunction(r))return r.call(this,e,n);if(i&&(e=n),!!ye.isString(e)){if(ye.isString(r))return e.indexOf(r)!==-1;if(ye.isRegExp(r))return r.test(e)}}function zre(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function Wre(t,e){const n=ye.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}let rC=class{constructor(e){e&&this.set(e)}set(e,n,r){const i=this;function o(a,u,c){const l=Ug(u);if(!l)throw new Error("header name must be a non-empty string");const d=ye.findKey(i,l);(!d||i[d]===void 0||c===!0||c===void 0&&i[d]!==!1)&&(i[d||u]=hx(a))}const s=(a,u)=>ye.forEach(a,(c,l)=>o(c,l,u));return ye.isPlainObject(e)||e instanceof this.constructor?s(e,n):ye.isString(e)&&(e=e.trim())&&!Vre(e)?s(Bre(e),n):e!=null&&o(n,e,r),this}get(e,n){if(e=Ug(e),e){const r=ye.findKey(this,e);if(r){const i=this[r];if(!n)return i;if(n===!0)return Ure(i);if(ye.isFunction(n))return n.call(this,i,r);if(ye.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Ug(e),e){const r=ye.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||kk(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let i=!1;function o(s){if(s=Ug(s),s){const a=ye.findKey(r,s);a&&(!n||kk(r,r[a],a,n))&&(delete r[a],i=!0)}}return ye.isArray(e)?e.forEach(o):o(e),i}clear(e){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const o=n[r];(!e||kk(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const n=this,r={};return ye.forEach(this,(i,o)=>{const s=ye.findKey(r,o);if(s){n[s]=hx(i),delete n[o];return}const a=e?zre(o):String(o).trim();a!==o&&delete n[o],n[a]=hx(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return ye.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=e&&ye.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[BL]=this[BL]={accessors:{}}).accessors,i=this.prototype;function o(s){const a=Ug(s);r[a]||(Wre(i,s),r[a]=!0)}return ye.isArray(e)?e.forEach(o):o(e),this}};rC.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ye.reduceDescriptors(rC.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});ye.freezeMethods(rC);const wc=rC;function Tk(t,e){const n=this||IN,r=e||n,i=wc.from(r.headers);let o=r.data;return ye.forEach(t,function(a){o=a.call(n,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function x5(t){return!!(t&&t.__CANCEL__)}function S0(t,e,n){Ft.call(this,t??"canceled",Ft.ERR_CANCELED,e,n),this.name="CanceledError"}ye.inherits(S0,Ft,{__CANCEL__:!0});function jre(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Ft("Request failed with status code "+n.status,[Ft.ERR_BAD_REQUEST,Ft.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}const Gre=Ks.isStandardBrowserEnv?function(){return{write:function(n,r,i,o,s,a){const u=[];u.push(n+"="+encodeURIComponent(r)),ye.isNumber(i)&&u.push("expires="+new Date(i).toGMTString()),ye.isString(o)&&u.push("path="+o),ye.isString(s)&&u.push("domain="+s),a===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(n){const r=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Hre(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function qre(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}function w5(t,e){return t&&!Hre(e)?qre(t,e):e}const Kre=Ks.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");let r;function i(o){let s=o;return e&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return r=i(window.location.href),function(s){const a=ye.isString(s)?i(s):s;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}();function Xre(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Jre(t,e){t=t||10;const n=new Array(t),r=new Array(t);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(u){const c=Date.now(),l=r[o];s||(s=c),n[i]=u,r[i]=c;let d=o,f=0;for(;d!==i;)f+=n[d++],d=d%t;if(i=(i+1)%t,i===o&&(o=(o+1)%t),c-s<e)return;const h=l&&c-l;return h?Math.round(f*1e3/h):void 0}}function UL(t,e){let n=0;const r=Jre(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-n,u=r(a),c=o<=s;n=o;const l={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:u||void 0,estimated:u&&s&&c?(s-o)/u:void 0,event:i};l[e?"download":"upload"]=!0,t(l)}}const Yre=typeof XMLHttpRequest<"u",Qre=Yre&&function(t){return new Promise(function(n,r){let i=t.data;const o=wc.from(t.headers).normalize(),s=t.responseType;let a;function u(){t.cancelToken&&t.cancelToken.unsubscribe(a),t.signal&&t.signal.removeEventListener("abort",a)}ye.isFormData(i)&&(Ks.isStandardBrowserEnv||Ks.isStandardBrowserWebWorkerEnv?o.setContentType(!1):o.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(t.auth){const h=t.auth.username||"",p=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";o.set("Authorization","Basic "+btoa(h+":"+p))}const l=w5(t.baseURL,t.url);c.open(t.method.toUpperCase(),v5(l,t.params,t.paramsSerializer),!0),c.timeout=t.timeout;function d(){if(!c)return;const h=wc.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),m={data:!s||s==="text"||s==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:h,config:t,request:c};jre(function(g){n(g),u()},function(g){r(g),u()},m),c=null}if("onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(d)},c.onabort=function(){c&&(r(new Ft("Request aborted",Ft.ECONNABORTED,t,c)),c=null)},c.onerror=function(){r(new Ft("Network Error",Ft.ERR_NETWORK,t,c)),c=null},c.ontimeout=function(){let p=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const m=t.transitional||y5;t.timeoutErrorMessage&&(p=t.timeoutErrorMessage),r(new Ft(p,m.clarifyTimeoutError?Ft.ETIMEDOUT:Ft.ECONNABORTED,t,c)),c=null},Ks.isStandardBrowserEnv){const h=(t.withCredentials||Kre(l))&&t.xsrfCookieName&&Gre.read(t.xsrfCookieName);h&&o.set(t.xsrfHeaderName,h)}i===void 0&&o.setContentType(null),"setRequestHeader"in c&&ye.forEach(o.toJSON(),function(p,m){c.setRequestHeader(m,p)}),ye.isUndefined(t.withCredentials)||(c.withCredentials=!!t.withCredentials),s&&s!=="json"&&(c.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&c.addEventListener("progress",UL(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",UL(t.onUploadProgress)),(t.cancelToken||t.signal)&&(a=h=>{c&&(r(!h||h.type?new S0(null,t,c):h),c.abort(),c=null)},t.cancelToken&&t.cancelToken.subscribe(a),t.signal&&(t.signal.aborted?a():t.signal.addEventListener("abort",a)));const f=Xre(l);if(f&&Ks.protocols.indexOf(f)===-1){r(new Ft("Unsupported protocol "+f+":",Ft.ERR_BAD_REQUEST,t));return}c.send(i||null)})},px={http:kre,xhr:Qre};ye.forEach(px,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const S5={getAdapter:t=>{t=ye.isArray(t)?t:[t];const{length:e}=t;let n,r;for(let i=0;i<e&&(n=t[i],!(r=ye.isString(n)?px[n.toLowerCase()]:n));i++);if(!r)throw r===!1?new Ft(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(ye.hasOwnProp(px,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`);if(!ye.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:px};function Ek(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new S0(null,t)}function VL(t){return Ek(t),t.headers=wc.from(t.headers),t.data=Tk.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),S5.getAdapter(t.adapter||IN.adapter)(t).then(function(r){return Ek(t),r.data=Tk.call(t,t.transformResponse,r),r.headers=wc.from(r.headers),r},function(r){return x5(r)||(Ek(t),r&&r.response&&(r.response.data=Tk.call(t,t.transformResponse,r.response),r.response.headers=wc.from(r.response.headers))),Promise.reject(r)})}const zL=t=>t instanceof wc?t.toJSON():t;function ym(t,e){e=e||{};const n={};function r(c,l,d){return ye.isPlainObject(c)&&ye.isPlainObject(l)?ye.merge.call({caseless:d},c,l):ye.isPlainObject(l)?ye.merge({},l):ye.isArray(l)?l.slice():l}function i(c,l,d){if(ye.isUndefined(l)){if(!ye.isUndefined(c))return r(void 0,c,d)}else return r(c,l,d)}function o(c,l){if(!ye.isUndefined(l))return r(void 0,l)}function s(c,l){if(ye.isUndefined(l)){if(!ye.isUndefined(c))return r(void 0,c)}else return r(void 0,l)}function a(c,l,d){if(d in e)return r(c,l);if(d in t)return r(void 0,c)}const u={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(c,l)=>i(zL(c),zL(l),!0)};return ye.forEach(Object.keys(Object.assign({},t,e)),function(l){const d=u[l]||i,f=d(t[l],e[l],l);ye.isUndefined(f)&&d!==a||(n[l]=f)}),n}const C5="1.5.0",RN={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{RN[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const WL={};RN.transitional=function(e,n,r){function i(o,s){return"[Axios v"+C5+"] Transitional option '"+o+"'"+s+(r?". "+r:"")}return(o,s,a)=>{if(e===!1)throw new Ft(i(s," has been removed"+(n?" in "+n:"")),Ft.ERR_DEPRECATED);return n&&!WL[s]&&(WL[s]=!0,console.warn(i(s," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(o,s,a):!0}};function Zre(t,e,n){if(typeof t!="object")throw new Ft("options must be an object",Ft.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=t[o],u=a===void 0||s(a,o,t);if(u!==!0)throw new Ft("option "+o+" must be "+u,Ft.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ft("Unknown option "+o,Ft.ERR_BAD_OPTION)}}const f_={assertOptions:Zre,validators:RN},dl=f_.validators;let yw=class{constructor(e){this.defaults=e,this.interceptors={request:new ML,response:new ML}}request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=ym(this.defaults,n);const{transitional:r,paramsSerializer:i,headers:o}=n;r!==void 0&&f_.assertOptions(r,{silentJSONParsing:dl.transitional(dl.boolean),forcedJSONParsing:dl.transitional(dl.boolean),clarifyTimeoutError:dl.transitional(dl.boolean)},!1),i!=null&&(ye.isFunction(i)?n.paramsSerializer={serialize:i}:f_.assertOptions(i,{encode:dl.function,serialize:dl.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let s=o&&ye.merge(o.common,o[n.method]);o&&ye.forEach(["delete","get","head","post","put","patch","common"],p=>{delete o[p]}),n.headers=wc.concat(s,o);const a=[];let u=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(n)===!1||(u=u&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let l,d=0,f;if(!u){const p=[VL.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,c),f=p.length,l=Promise.resolve(n);d<f;)l=l.then(p[d++],p[d++]);return l}f=a.length;let h=n;for(d=0;d<f;){const p=a[d++],m=a[d++];try{h=p(h)}catch(v){m.call(this,v);break}}try{l=VL.call(this,h)}catch(p){return Promise.reject(p)}for(d=0,f=c.length;d<f;)l=l.then(c[d++],c[d++]);return l}getUri(e){e=ym(this.defaults,e);const n=w5(e.baseURL,e.url);return v5(n,e.params,e.paramsSerializer)}};ye.forEach(["delete","get","head","options"],function(e){yw.prototype[e]=function(n,r){return this.request(ym(r||{},{method:e,url:n,data:(r||{}).data}))}});ye.forEach(["post","put","patch"],function(e){function n(r){return function(o,s,a){return this.request(ym(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}yw.prototype[e]=n(),yw.prototype[e+"Form"]=n(!0)});const mx=yw;let eie=class k5{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(o,s,a){r.reason||(r.reason=new S0(o,s,a),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new k5(function(i){e=i}),cancel:e}}};const tie=eie;function nie(t){return function(n){return t.apply(null,n)}}function rie(t){return ye.isObject(t)&&t.isAxiosError===!0}const h_={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(h_).forEach(([t,e])=>{h_[e]=t});const iie=h_;function T5(t){const e=new mx(t),n=o5(mx.prototype.request,e);return ye.extend(n,mx.prototype,e,{allOwnKeys:!0}),ye.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return T5(ym(t,i))},n}const er=T5(IN);er.Axios=mx;er.CanceledError=S0;er.CancelToken=tie;er.isCancel=x5;er.VERSION=C5;er.toFormData=nC;er.AxiosError=Ft;er.Cancel=er.CanceledError;er.all=function(e){return Promise.all(e)};er.spread=nie;er.isAxiosError=rie;er.mergeConfig=ym;er.AxiosHeaders=wc;er.formToJSON=t=>b5(ye.isHTMLForm(t)?new FormData(t):t);er.getAdapter=S5.getAdapter;er.HttpStatusCode=iie;er.default=er;const E5=er,{Axios:E9e,AxiosError:_9e,CanceledError:oie,isCancel:I9e,CancelToken:R9e,VERSION:N9e,all:P9e,Cancel:A9e,isAxiosError:$9e,spread:D9e,toFormData:O9e,AxiosHeaders:F9e,HttpStatusCode:L9e,formToJSON:M9e,getAdapter:B9e,mergeConfig:U9e}=E5,_5=E5.create({baseURL:"https://eyedentify-69d961d5a478.herokuapp.com/api"}),sie=(t,e,n,r=1e3)=>{const[i,o]=A.useState([]),[s,a]=A.useState(""),[u,c]=A.useState(!1);return A.useEffect(()=>{const l=new AbortController,d=async()=>{c(!0);try{const h=await _5.get(t,{signal:l.signal,...e});o(h.data),c(!1)}catch(h){if(h instanceof oie)return;a(h.message),c(!1)}};d();const f=setInterval(d,r);return()=>{l.abort(),clearInterval(f)}},n?[...n]:[]),{data:i,error:s,loading:u}},iC=()=>sie("/all_users");/**
 * @remix-run/router v1.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xy(){return xy=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},xy.apply(this,arguments)}var Rl;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Rl||(Rl={}));const jL="popstate";function aie(t){t===void 0&&(t={});function e(i,o){let{pathname:s="/",search:a="",hash:u=""}=ih(i.location.hash.substr(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),p_("",{pathname:s,search:a,hash:u},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(i,o){let s=i.document.querySelector("base"),a="";if(s&&s.getAttribute("href")){let u=i.location.href,c=u.indexOf("#");a=c===-1?u:u.slice(0,c)}return a+"#"+(typeof o=="string"?o:bw(o))}function r(i,o){oC(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return cie(e,n,r,t)}function Zn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function oC(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function uie(){return Math.random().toString(36).substr(2,8)}function GL(t,e){return{usr:t.state,key:t.key,idx:e}}function p_(t,e,n,r){return n===void 0&&(n=null),xy({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ih(e):e,{state:n,key:e&&e.key||r||uie()})}function bw(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ih(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function cie(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a=Rl.Pop,u=null,c=l();c==null&&(c=0,s.replaceState(xy({},s.state,{idx:c}),""));function l(){return(s.state||{idx:null}).idx}function d(){a=Rl.Pop;let v=l(),g=v==null?null:v-c;c=v,u&&u({action:a,location:m.location,delta:g})}function f(v,g){a=Rl.Push;let y=p_(m.location,v,g);n&&n(y,v),c=l()+1;let b=GL(y,c),x=m.createHref(y);try{s.pushState(b,"",x)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;i.location.assign(x)}o&&u&&u({action:a,location:m.location,delta:1})}function h(v,g){a=Rl.Replace;let y=p_(m.location,v,g);n&&n(y,v),c=l();let b=GL(y,c),x=m.createHref(y);s.replaceState(b,"",x),o&&u&&u({action:a,location:m.location,delta:0})}function p(v){let g=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof v=="string"?v:bw(v);return Zn(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let m={get action(){return a},get location(){return t(i,s)},listen(v){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(jL,d),u=v,()=>{i.removeEventListener(jL,d),u=null}},createHref(v){return e(i,v)},createURL:p,encodeLocation(v){let g=p(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:h,go(v){return s.go(v)}};return m}var HL;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(HL||(HL={}));function lie(t,e,n){n===void 0&&(n="/");let r=typeof e=="string"?ih(e):e,i=NN(r.pathname||"/",n);if(i==null)return null;let o=I5(t);die(o);let s=null;for(let a=0;s==null&&a<o.length;++a)s=xie(o[a],Cie(i));return s}function I5(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(o,s,a)=>{let u={relativePath:a===void 0?o.path||"":a,caseSensitive:o.caseSensitive===!0,childrenIndex:s,route:o};u.relativePath.startsWith("/")&&(Zn(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let c=Xl([r,u.relativePath]),l=n.concat(u);o.children&&o.children.length>0&&(Zn(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),I5(o.children,e,l,c)),!(o.path==null&&!o.index)&&e.push({path:c,score:yie(c,o.index),routesMeta:l})};return t.forEach((o,s)=>{var a;if(o.path===""||!((a=o.path)!=null&&a.includes("?")))i(o,s);else for(let u of R5(o.path))i(o,s,u)}),e}function R5(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let s=R5(r.join("/")),a=[];return a.push(...s.map(u=>u===""?o:[o,u].join("/"))),i&&a.push(...s),a.map(u=>t.startsWith("/")&&u===""?"/":u)}function die(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:bie(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const fie=/^:\w+$/,hie=3,pie=2,mie=1,gie=10,vie=-2,qL=t=>t==="*";function yie(t,e){let n=t.split("/"),r=n.length;return n.some(qL)&&(r+=vie),e&&(r+=pie),n.filter(i=>!qL(i)).reduce((i,o)=>i+(fie.test(o)?hie:o===""?mie:gie),r)}function bie(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function xie(t,e){let{routesMeta:n}=t,r={},i="/",o=[];for(let s=0;s<n.length;++s){let a=n[s],u=s===n.length-1,c=i==="/"?e:e.slice(i.length)||"/",l=wie({path:a.relativePath,caseSensitive:a.caseSensitive,end:u},c);if(!l)return null;Object.assign(r,l.params);let d=a.route;o.push({params:r,pathname:Xl([i,l.pathname]),pathnameBase:_ie(Xl([i,l.pathnameBase])),route:d}),l.pathnameBase!=="/"&&(i=Xl([i,l.pathnameBase]))}return o}function wie(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Sie(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((c,l,d)=>{if(l==="*"){let f=a[d]||"";s=o.slice(0,o.length-f.length).replace(/(.)\/+$/,"$1")}return c[l]=kie(a[d]||"",l),c},{}),pathname:o,pathnameBase:s,pattern:t}}function Sie(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),oC(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(s,a)=>(r.push(a),"/([^\\/]+)"));return t.endsWith("*")?(r.push("*"),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function Cie(t){try{return decodeURI(t)}catch(e){return oC(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function kie(t,e){try{return decodeURIComponent(t)}catch(n){return oC(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+n+").")),t}}function NN(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function Tie(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?ih(t):t;return{pathname:n?n.startsWith("/")?n:Eie(n,e):e,search:Iie(r),hash:Rie(i)}}function Eie(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function _k(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function N5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function P5(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=ih(t):(i=xy({},t),Zn(!i.pathname||!i.pathname.includes("?"),_k("?","pathname","search",i)),Zn(!i.pathname||!i.pathname.includes("#"),_k("#","pathname","hash",i)),Zn(!i.search||!i.search.includes("#"),_k("#","search","hash",i)));let o=t===""||i.pathname==="",s=o?"/":i.pathname,a;if(r||s==null)a=n;else{let d=e.length-1;if(s.startsWith("..")){let f=s.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let u=Tie(i,a),c=s&&s!=="/"&&s.endsWith("/"),l=(o||s===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(c||l)&&(u.pathname+="/"),u}const Xl=t=>t.join("/").replace(/\/\/+/g,"/"),_ie=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Iie=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Rie=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Nie(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const A5=["post","put","patch","delete"];new Set(A5);const Pie=["get",...A5];new Set(Pie);/**
 * React Router v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xw(){return xw=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},xw.apply(this,arguments)}const PN=A.createContext(null),Aie=A.createContext(null),Hm=A.createContext(null),sC=A.createContext(null),xd=A.createContext({outlet:null,matches:[],isDataRoute:!1}),$5=A.createContext(null);function $ie(t,e){let{relative:n}=e===void 0?{}:e;C0()||Zn(!1);let{basename:r,navigator:i}=A.useContext(Hm),{hash:o,pathname:s,search:a}=O5(t,{relative:n}),u=s;return r!=="/"&&(u=s==="/"?r:Xl([r,s])),i.createHref({pathname:u,search:a,hash:o})}function C0(){return A.useContext(sC)!=null}function k0(){return C0()||Zn(!1),A.useContext(sC).location}function D5(t){A.useContext(Hm).static||A.useLayoutEffect(t)}function oh(){let{isDataRoute:t}=A.useContext(xd);return t?Kie():Die()}function Die(){C0()||Zn(!1);let t=A.useContext(PN),{basename:e,navigator:n}=A.useContext(Hm),{matches:r}=A.useContext(xd),{pathname:i}=k0(),o=JSON.stringify(N5(r).map(u=>u.pathnameBase)),s=A.useRef(!1);return D5(()=>{s.current=!0}),A.useCallback(function(u,c){if(c===void 0&&(c={}),!s.current)return;if(typeof u=="number"){n.go(u);return}let l=P5(u,JSON.parse(o),i,c.relative==="path");t==null&&e!=="/"&&(l.pathname=l.pathname==="/"?e:Xl([e,l.pathname])),(c.replace?n.replace:n.push)(l,c.state,c)},[e,n,o,i,t])}const Oie=A.createContext(null);function Fie(t){let e=A.useContext(xd).outlet;return e&&A.createElement(Oie.Provider,{value:t},e)}function O5(t,e){let{relative:n}=e===void 0?{}:e,{matches:r}=A.useContext(xd),{pathname:i}=k0(),o=JSON.stringify(N5(r).map(s=>s.pathnameBase));return A.useMemo(()=>P5(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function Lie(t,e){return Mie(t,e)}function Mie(t,e,n){C0()||Zn(!1);let{navigator:r}=A.useContext(Hm),{matches:i}=A.useContext(xd),o=i[i.length-1],s=o?o.params:{};o&&o.pathname;let a=o?o.pathnameBase:"/";o&&o.route;let u=k0(),c;if(e){var l;let m=typeof e=="string"?ih(e):e;a==="/"||(l=m.pathname)!=null&&l.startsWith(a)||Zn(!1),c=m}else c=u;let d=c.pathname||"/",f=a==="/"?d:d.slice(a.length)||"/",h=lie(t,{pathname:f}),p=Wie(h&&h.map(m=>Object.assign({},m,{params:Object.assign({},s,m.params),pathname:Xl([a,r.encodeLocation?r.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?a:Xl([a,r.encodeLocation?r.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),i,n);return e&&p?A.createElement(sC.Provider,{value:{location:xw({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Rl.Pop}},p):p}function Bie(){let t=qie(),e=Nie(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},o=null;return A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),n?A.createElement("pre",{style:i},n):null,o)}const Uie=A.createElement(Bie,null);class Vie extends A.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error?A.createElement(xd.Provider,{value:this.props.routeContext},A.createElement($5.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zie(t){let{routeContext:e,match:n,children:r}=t,i=A.useContext(PN);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),A.createElement(xd.Provider,{value:e},r)}function Wie(t,e,n){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),t==null){var i;if((i=n)!=null&&i.errors)t=n.matches;else return null}let o=t,s=(r=n)==null?void 0:r.errors;if(s!=null){let a=o.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id]));a>=0||Zn(!1),o=o.slice(0,Math.min(o.length,a+1))}return o.reduceRight((a,u,c)=>{let l=u.route.id?s==null?void 0:s[u.route.id]:null,d=null;n&&(d=u.route.errorElement||Uie);let f=e.concat(o.slice(0,c+1)),h=()=>{let p;return l?p=d:u.route.Component?p=A.createElement(u.route.Component,null):u.route.element?p=u.route.element:p=a,A.createElement(zie,{match:u,routeContext:{outlet:a,matches:f,isDataRoute:n!=null},children:p})};return n&&(u.route.ErrorBoundary||u.route.errorElement||c===0)?A.createElement(Vie,{location:n.location,revalidation:n.revalidation,component:d,error:l,children:h(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):h()},null)}var F5=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(F5||{}),ww=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ww||{});function jie(t){let e=A.useContext(PN);return e||Zn(!1),e}function Gie(t){let e=A.useContext(Aie);return e||Zn(!1),e}function Hie(t){let e=A.useContext(xd);return e||Zn(!1),e}function L5(t){let e=Hie(),n=e.matches[e.matches.length-1];return n.route.id||Zn(!1),n.route.id}function qie(){var t;let e=A.useContext($5),n=Gie(ww.UseRouteError),r=L5(ww.UseRouteError);return e||((t=n.errors)==null?void 0:t[r])}function Kie(){let{router:t}=jie(F5.UseNavigateStable),e=L5(ww.UseNavigateStable),n=A.useRef(!1);return D5(()=>{n.current=!0}),A.useCallback(function(i,o){o===void 0&&(o={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,xw({fromRouteId:e},o)))},[t,e])}function Xie(t){return Fie(t.context)}function Kd(t){Zn(!1)}function Jie(t){let{basename:e="/",children:n=null,location:r,navigationType:i=Rl.Pop,navigator:o,static:s=!1}=t;C0()&&Zn(!1);let a=e.replace(/^\/*/,"/"),u=A.useMemo(()=>({basename:a,navigator:o,static:s}),[a,o,s]);typeof r=="string"&&(r=ih(r));let{pathname:c="/",search:l="",hash:d="",state:f=null,key:h="default"}=r,p=A.useMemo(()=>{let m=NN(c,a);return m==null?null:{location:{pathname:m,search:l,hash:d,state:f,key:h},navigationType:i}},[a,c,l,d,f,h,i]);return p==null?null:A.createElement(Hm.Provider,{value:u},A.createElement(sC.Provider,{children:n,value:p}))}function Yie(t){let{children:e,location:n}=t;return Lie(m_(e),n)}new Promise(()=>{});function m_(t,e){e===void 0&&(e=[]);let n=[];return A.Children.forEach(t,(r,i)=>{if(!A.isValidElement(r))return;let o=[...e,i];if(r.type===A.Fragment){n.push.apply(n,m_(r.props.children,o));return}r.type!==Kd&&Zn(!1),!r.props.index||!r.props.children||Zn(!1);let s={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(s.children=m_(r.props.children,o)),n.push(s)}),n}/**
 * React Router DOM v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function g_(){return g_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},g_.apply(this,arguments)}function Qie(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Zie(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function eoe(t,e){return t.button===0&&(!e||e==="_self")&&!Zie(t)}const toe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],noe="startTransition",KL=gE[noe];function roe(t){let{basename:e,children:n,future:r,window:i}=t,o=A.useRef();o.current==null&&(o.current=aie({window:i,v5Compat:!0}));let s=o.current,[a,u]=A.useState({action:s.action,location:s.location}),{v7_startTransition:c}=r||{},l=A.useCallback(d=>{c&&KL?KL(()=>u(d)):u(d)},[u,c]);return A.useLayoutEffect(()=>s.listen(l),[s,l]),A.createElement(Jie,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:s})}const ioe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ooe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,soe=A.forwardRef(function(e,n){let{onClick:r,relative:i,reloadDocument:o,replace:s,state:a,target:u,to:c,preventScrollReset:l}=e,d=Qie(e,toe),{basename:f}=A.useContext(Hm),h,p=!1;if(typeof c=="string"&&ooe.test(c)&&(h=c,ioe))try{let y=new URL(window.location.href),b=c.startsWith("//")?new URL(y.protocol+c):new URL(c),x=NN(b.pathname,f);b.origin===y.origin&&x!=null?c=x+b.search+b.hash:p=!0}catch{}let m=$ie(c,{relative:i}),v=aoe(c,{replace:s,state:a,target:u,preventScrollReset:l,relative:i});function g(y){r&&r(y),y.defaultPrevented||v(y)}return A.createElement("a",g_({},d,{href:h||m,onClick:p||o?r:g,ref:n,target:u}))});var XL;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher"})(XL||(XL={}));var JL;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(JL||(JL={}));function aoe(t,e){let{target:n,replace:r,state:i,preventScrollReset:o,relative:s}=e===void 0?{}:e,a=oh(),u=k0(),c=O5(t,{relative:s});return A.useCallback(l=>{if(eoe(l,n)){l.preventDefault();let d=r!==void 0?r:bw(u)===bw(c);a(t,{replace:d,state:i,preventScrollReset:o,relative:s})}},[u,a,c,r,i,n,t,o,s])}function uoe(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function coe(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var loe=function(){function t(n){var r=this;this._insertTag=function(i){var o;r.tags.length===0?r.insertionPoint?o=r.insertionPoint.nextSibling:r.prepend?o=r.container.firstChild:o=r.before:o=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,o),r.tags.push(i)},this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.prepend=n.prepend,this.insertionPoint=n.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(coe(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var o=uoe(i);try{o.insertRule(r,o.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){return r.parentNode&&r.parentNode.removeChild(r)}),this.tags=[],this.ctr=0},t}(),Xr="-ms-",Sw="-moz-",jt="-webkit-",M5="comm",AN="rule",$N="decl",doe="@import",B5="@keyframes",foe="@layer",hoe=Math.abs,aC=String.fromCharCode,poe=Object.assign;function moe(t,e){return Mr(t,0)^45?(((e<<2^Mr(t,0))<<2^Mr(t,1))<<2^Mr(t,2))<<2^Mr(t,3):0}function U5(t){return t.trim()}function goe(t,e){return(t=e.exec(t))?t[0]:t}function Gt(t,e,n){return t.replace(e,n)}function v_(t,e){return t.indexOf(e)}function Mr(t,e){return t.charCodeAt(e)|0}function wy(t,e,n){return t.slice(e,n)}function Ia(t){return t.length}function DN(t){return t.length}function t1(t,e){return e.push(t),t}function voe(t,e){return t.map(e).join("")}var uC=1,bm=1,V5=0,lo=0,Xn=0,qm="";function cC(t,e,n,r,i,o,s){return{value:t,root:e,parent:n,type:r,props:i,children:o,line:uC,column:bm,length:s,return:""}}function Vg(t,e){return poe(cC("",null,null,"",null,null,0),t,{length:-t.length},e)}function yoe(){return Xn}function boe(){return Xn=lo>0?Mr(qm,--lo):0,bm--,Xn===10&&(bm=1,uC--),Xn}function Fo(){return Xn=lo<V5?Mr(qm,lo++):0,bm++,Xn===10&&(bm=1,uC++),Xn}function nu(){return Mr(qm,lo)}function gx(){return lo}function T0(t,e){return wy(qm,t,e)}function Sy(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function z5(t){return uC=bm=1,V5=Ia(qm=t),lo=0,[]}function W5(t){return qm="",t}function vx(t){return U5(T0(lo-1,y_(t===91?t+2:t===40?t+1:t)))}function xoe(t){for(;(Xn=nu())&&Xn<33;)Fo();return Sy(t)>2||Sy(Xn)>3?"":" "}function woe(t,e){for(;--e&&Fo()&&!(Xn<48||Xn>102||Xn>57&&Xn<65||Xn>70&&Xn<97););return T0(t,gx()+(e<6&&nu()==32&&Fo()==32))}function y_(t){for(;Fo();)switch(Xn){case t:return lo;case 34:case 39:t!==34&&t!==39&&y_(Xn);break;case 40:t===41&&y_(t);break;case 92:Fo();break}return lo}function Soe(t,e){for(;Fo()&&t+Xn!==47+10;)if(t+Xn===42+42&&nu()===47)break;return"/*"+T0(e,lo-1)+"*"+aC(t===47?t:Fo())}function Coe(t){for(;!Sy(nu());)Fo();return T0(t,lo)}function koe(t){return W5(yx("",null,null,null,[""],t=z5(t),0,[0],t))}function yx(t,e,n,r,i,o,s,a,u){for(var c=0,l=0,d=s,f=0,h=0,p=0,m=1,v=1,g=1,y=0,b="",x=i,S=o,C=r,T=b;v;)switch(p=y,y=Fo()){case 40:if(p!=108&&Mr(T,d-1)==58){v_(T+=Gt(vx(y),"&","&\f"),"&\f")!=-1&&(g=-1);break}case 34:case 39:case 91:T+=vx(y);break;case 9:case 10:case 13:case 32:T+=xoe(p);break;case 92:T+=woe(gx()-1,7);continue;case 47:switch(nu()){case 42:case 47:t1(Toe(Soe(Fo(),gx()),e,n),u);break;default:T+="/"}break;case 123*m:a[c++]=Ia(T)*g;case 125*m:case 59:case 0:switch(y){case 0:case 125:v=0;case 59+l:g==-1&&(T=Gt(T,/\f/g,"")),h>0&&Ia(T)-d&&t1(h>32?QL(T+";",r,n,d-1):QL(Gt(T," ","")+";",r,n,d-2),u);break;case 59:T+=";";default:if(t1(C=YL(T,e,n,c,l,i,a,b,x=[],S=[],d),o),y===123)if(l===0)yx(T,e,C,C,x,o,d,a,S);else switch(f===99&&Mr(T,3)===110?100:f){case 100:case 108:case 109:case 115:yx(t,C,C,r&&t1(YL(t,C,C,0,0,i,a,b,i,x=[],d),S),i,S,d,a,r?x:S);break;default:yx(T,C,C,C,[""],S,0,a,S)}}c=l=h=0,m=g=1,b=T="",d=s;break;case 58:d=1+Ia(T),h=p;default:if(m<1){if(y==123)--m;else if(y==125&&m++==0&&boe()==125)continue}switch(T+=aC(y),y*m){case 38:g=l>0?1:(T+="\f",-1);break;case 44:a[c++]=(Ia(T)-1)*g,g=1;break;case 64:nu()===45&&(T+=vx(Fo())),f=nu(),l=d=Ia(b=T+=Coe(gx())),y++;break;case 45:p===45&&Ia(T)==2&&(m=0)}}return o}function YL(t,e,n,r,i,o,s,a,u,c,l){for(var d=i-1,f=i===0?o:[""],h=DN(f),p=0,m=0,v=0;p<r;++p)for(var g=0,y=wy(t,d+1,d=hoe(m=s[p])),b=t;g<h;++g)(b=U5(m>0?f[g]+" "+y:Gt(y,/&\f/g,f[g])))&&(u[v++]=b);return cC(t,e,n,i===0?AN:a,u,c,l)}function Toe(t,e,n){return cC(t,e,n,M5,aC(yoe()),wy(t,2,-2),0)}function QL(t,e,n,r){return cC(t,e,n,$N,wy(t,0,r),wy(t,r+1,-1),r)}function Up(t,e){for(var n="",r=DN(t),i=0;i<r;i++)n+=e(t[i],i,t,e)||"";return n}function Eoe(t,e,n,r){switch(t.type){case foe:if(t.children.length)break;case doe:case $N:return t.return=t.return||t.value;case M5:return"";case B5:return t.return=t.value+"{"+Up(t.children,r)+"}";case AN:t.value=t.props.join(",")}return Ia(n=Up(t.children,r))?t.return=t.value+"{"+n+"}":""}function _oe(t){var e=DN(t);return function(n,r,i,o){for(var s="",a=0;a<e;a++)s+=t[a](n,r,i,o)||"";return s}}function Ioe(t){return function(e){e.root||(e=e.return)&&t(e)}}var ZL=function(e){var n=new WeakMap;return function(r){if(n.has(r))return n.get(r);var i=e(r);return n.set(r,i),i}};function j5(t){var e=Object.create(null);return function(n){return e[n]===void 0&&(e[n]=t(n)),e[n]}}var Roe=function(e,n,r){for(var i=0,o=0;i=o,o=nu(),i===38&&o===12&&(n[r]=1),!Sy(o);)Fo();return T0(e,lo)},Noe=function(e,n){var r=-1,i=44;do switch(Sy(i)){case 0:i===38&&nu()===12&&(n[r]=1),e[r]+=Roe(lo-1,n,r);break;case 2:e[r]+=vx(i);break;case 4:if(i===44){e[++r]=nu()===58?"&\f":"",n[r]=e[r].length;break}default:e[r]+=aC(i)}while(i=Fo());return e},Poe=function(e,n){return W5(Noe(z5(e),n))},eM=new WeakMap,Aoe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var n=e.value,r=e.parent,i=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&n.charCodeAt(0)!==58&&!eM.get(r))&&!i){eM.set(e,!0);for(var o=[],s=Poe(n,o),a=r.props,u=0,c=0;u<s.length;u++)for(var l=0;l<a.length;l++,c++)e.props[c]=o[u]?s[u].replace(/&\f/g,a[l]):a[l]+" "+s[u]}}},$oe=function(e){if(e.type==="decl"){var n=e.value;n.charCodeAt(0)===108&&n.charCodeAt(2)===98&&(e.return="",e.value="")}};function G5(t,e){switch(moe(t,e)){case 5103:return jt+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return jt+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return jt+t+Sw+t+Xr+t+t;case 6828:case 4268:return jt+t+Xr+t+t;case 6165:return jt+t+Xr+"flex-"+t+t;case 5187:return jt+t+Gt(t,/(\w+).+(:[^]+)/,jt+"box-$1$2"+Xr+"flex-$1$2")+t;case 5443:return jt+t+Xr+"flex-item-"+Gt(t,/flex-|-self/,"")+t;case 4675:return jt+t+Xr+"flex-line-pack"+Gt(t,/align-content|flex-|-self/,"")+t;case 5548:return jt+t+Xr+Gt(t,"shrink","negative")+t;case 5292:return jt+t+Xr+Gt(t,"basis","preferred-size")+t;case 6060:return jt+"box-"+Gt(t,"-grow","")+jt+t+Xr+Gt(t,"grow","positive")+t;case 4554:return jt+Gt(t,/([^-])(transform)/g,"$1"+jt+"$2")+t;case 6187:return Gt(Gt(Gt(t,/(zoom-|grab)/,jt+"$1"),/(image-set)/,jt+"$1"),t,"")+t;case 5495:case 3959:return Gt(t,/(image-set\([^]*)/,jt+"$1$`$1");case 4968:return Gt(Gt(t,/(.+:)(flex-)?(.*)/,jt+"box-pack:$3"+Xr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+jt+t+t;case 4095:case 3583:case 4068:case 2532:return Gt(t,/(.+)-inline(.+)/,jt+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ia(t)-1-e>6)switch(Mr(t,e+1)){case 109:if(Mr(t,e+4)!==45)break;case 102:return Gt(t,/(.+:)(.+)-([^]+)/,"$1"+jt+"$2-$3$1"+Sw+(Mr(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~v_(t,"stretch")?G5(Gt(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(Mr(t,e+1)!==115)break;case 6444:switch(Mr(t,Ia(t)-3-(~v_(t,"!important")&&10))){case 107:return Gt(t,":",":"+jt)+t;case 101:return Gt(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+jt+(Mr(t,14)===45?"inline-":"")+"box$3$1"+jt+"$2$3$1"+Xr+"$2box$3")+t}break;case 5936:switch(Mr(t,e+11)){case 114:return jt+t+Xr+Gt(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return jt+t+Xr+Gt(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return jt+t+Xr+Gt(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return jt+t+Xr+t+t}return t}var Doe=function(e,n,r,i){if(e.length>-1&&!e.return)switch(e.type){case $N:e.return=G5(e.value,e.length);break;case B5:return Up([Vg(e,{value:Gt(e.value,"@","@"+jt)})],i);case AN:if(e.length)return voe(e.props,function(o){switch(goe(o,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Up([Vg(e,{props:[Gt(o,/:(read-\w+)/,":"+Sw+"$1")]})],i);case"::placeholder":return Up([Vg(e,{props:[Gt(o,/:(plac\w+)/,":"+jt+"input-$1")]}),Vg(e,{props:[Gt(o,/:(plac\w+)/,":"+Sw+"$1")]}),Vg(e,{props:[Gt(o,/:(plac\w+)/,Xr+"input-$1")]})],i)}return""})}},Ooe=[Doe],Foe=function(e){var n=e.key;if(n==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(m){var v=m.getAttribute("data-emotion");v.indexOf(" ")!==-1&&(document.head.appendChild(m),m.setAttribute("data-s",""))})}var i=e.stylisPlugins||Ooe,o={},s,a=[];s=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+n+' "]'),function(m){for(var v=m.getAttribute("data-emotion").split(" "),g=1;g<v.length;g++)o[v[g]]=!0;a.push(m)});var u,c=[Aoe,$oe];{var l,d=[Eoe,Ioe(function(m){l.insert(m)})],f=_oe(c.concat(i,d)),h=function(v){return Up(koe(v),f)};u=function(v,g,y,b){l=y,h(v?v+"{"+g.styles+"}":g.styles),b&&(p.inserted[g.name]=!0)}}var p={key:n,sheet:new loe({key:n,container:s,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:u};return p.sheet.hydrate(a),p};function Mf(){return Mf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Mf.apply(this,arguments)}var H5={exports:{}},Zt={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tr=typeof Symbol=="function"&&Symbol.for,ON=Tr?Symbol.for("react.element"):60103,FN=Tr?Symbol.for("react.portal"):60106,lC=Tr?Symbol.for("react.fragment"):60107,dC=Tr?Symbol.for("react.strict_mode"):60108,fC=Tr?Symbol.for("react.profiler"):60114,hC=Tr?Symbol.for("react.provider"):60109,pC=Tr?Symbol.for("react.context"):60110,LN=Tr?Symbol.for("react.async_mode"):60111,mC=Tr?Symbol.for("react.concurrent_mode"):60111,gC=Tr?Symbol.for("react.forward_ref"):60112,vC=Tr?Symbol.for("react.suspense"):60113,Loe=Tr?Symbol.for("react.suspense_list"):60120,yC=Tr?Symbol.for("react.memo"):60115,bC=Tr?Symbol.for("react.lazy"):60116,Moe=Tr?Symbol.for("react.block"):60121,Boe=Tr?Symbol.for("react.fundamental"):60117,Uoe=Tr?Symbol.for("react.responder"):60118,Voe=Tr?Symbol.for("react.scope"):60119;function Wo(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case ON:switch(t=t.type,t){case LN:case mC:case lC:case fC:case dC:case vC:return t;default:switch(t=t&&t.$$typeof,t){case pC:case gC:case bC:case yC:case hC:return t;default:return e}}case FN:return e}}}function q5(t){return Wo(t)===mC}Zt.AsyncMode=LN;Zt.ConcurrentMode=mC;Zt.ContextConsumer=pC;Zt.ContextProvider=hC;Zt.Element=ON;Zt.ForwardRef=gC;Zt.Fragment=lC;Zt.Lazy=bC;Zt.Memo=yC;Zt.Portal=FN;Zt.Profiler=fC;Zt.StrictMode=dC;Zt.Suspense=vC;Zt.isAsyncMode=function(t){return q5(t)||Wo(t)===LN};Zt.isConcurrentMode=q5;Zt.isContextConsumer=function(t){return Wo(t)===pC};Zt.isContextProvider=function(t){return Wo(t)===hC};Zt.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===ON};Zt.isForwardRef=function(t){return Wo(t)===gC};Zt.isFragment=function(t){return Wo(t)===lC};Zt.isLazy=function(t){return Wo(t)===bC};Zt.isMemo=function(t){return Wo(t)===yC};Zt.isPortal=function(t){return Wo(t)===FN};Zt.isProfiler=function(t){return Wo(t)===fC};Zt.isStrictMode=function(t){return Wo(t)===dC};Zt.isSuspense=function(t){return Wo(t)===vC};Zt.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===lC||t===mC||t===fC||t===dC||t===vC||t===Loe||typeof t=="object"&&t!==null&&(t.$$typeof===bC||t.$$typeof===yC||t.$$typeof===hC||t.$$typeof===pC||t.$$typeof===gC||t.$$typeof===Boe||t.$$typeof===Uoe||t.$$typeof===Voe||t.$$typeof===Moe)};Zt.typeOf=Wo;H5.exports=Zt;var zoe=H5.exports,K5=zoe,Woe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},joe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},X5={};X5[K5.ForwardRef]=Woe;X5[K5.Memo]=joe;var Goe=!0;function Hoe(t,e,n){var r="";return n.split(" ").forEach(function(i){t[i]!==void 0?e.push(t[i]+";"):r+=i+" "}),r}var J5=function(e,n,r){var i=e.key+"-"+n.name;(r===!1||Goe===!1)&&e.registered[i]===void 0&&(e.registered[i]=n.styles)},Y5=function(e,n,r){J5(e,n,r);var i=e.key+"-"+n.name;if(e.inserted[n.name]===void 0){var o=n;do e.insert(n===o?"."+i:"",o,e.sheet,!0),o=o.next;while(o!==void 0)}};function qoe(t){for(var e=0,n,r=0,i=t.length;i>=4;++r,i-=4)n=t.charCodeAt(r)&255|(t.charCodeAt(++r)&255)<<8|(t.charCodeAt(++r)&255)<<16|(t.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(i){case 3:e^=(t.charCodeAt(r+2)&255)<<16;case 2:e^=(t.charCodeAt(r+1)&255)<<8;case 1:e^=t.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var Koe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Xoe=/[A-Z]|^ms/g,Joe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Q5=function(e){return e.charCodeAt(1)===45},tM=function(e){return e!=null&&typeof e!="boolean"},Ik=j5(function(t){return Q5(t)?t:t.replace(Xoe,"-$&").toLowerCase()}),nM=function(e,n){switch(e){case"animation":case"animationName":if(typeof n=="string")return n.replace(Joe,function(r,i,o){return Ra={name:i,styles:o,next:Ra},i})}return Koe[e]!==1&&!Q5(e)&&typeof n=="number"&&n!==0?n+"px":n};function Cy(t,e,n){if(n==null)return"";if(n.__emotion_styles!==void 0)return n;switch(typeof n){case"boolean":return"";case"object":{if(n.anim===1)return Ra={name:n.name,styles:n.styles,next:Ra},n.name;if(n.styles!==void 0){var r=n.next;if(r!==void 0)for(;r!==void 0;)Ra={name:r.name,styles:r.styles,next:Ra},r=r.next;var i=n.styles+";";return i}return Yoe(t,e,n)}case"function":{if(t!==void 0){var o=Ra,s=n(t);return Ra=o,Cy(t,e,s)}break}}if(e==null)return n;var a=e[n];return a!==void 0?a:n}function Yoe(t,e,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=Cy(t,e,n[i])+";";else for(var o in n){var s=n[o];if(typeof s!="object")e!=null&&e[s]!==void 0?r+=o+"{"+e[s]+"}":tM(s)&&(r+=Ik(o)+":"+nM(o,s)+";");else if(Array.isArray(s)&&typeof s[0]=="string"&&(e==null||e[s[0]]===void 0))for(var a=0;a<s.length;a++)tM(s[a])&&(r+=Ik(o)+":"+nM(o,s[a])+";");else{var u=Cy(t,e,s);switch(o){case"animation":case"animationName":{r+=Ik(o)+":"+u+";";break}default:r+=o+"{"+u+"}"}}}return r}var rM=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Ra,MN=function(e,n,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var i=!0,o="";Ra=void 0;var s=e[0];s==null||s.raw===void 0?(i=!1,o+=Cy(r,n,s)):o+=s[0];for(var a=1;a<e.length;a++)o+=Cy(r,n,e[a]),i&&(o+=s[a]);rM.lastIndex=0;for(var u="",c;(c=rM.exec(o))!==null;)u+="-"+c[1];var l=qoe(o)+u;return{name:l,styles:o,next:Ra}},Qoe=function(e){return e()},Z5=gE["useInsertionEffect"]?gE["useInsertionEffect"]:!1,Zoe=Z5||Qoe,iM=Z5||A.useLayoutEffect,e6=A.createContext(typeof HTMLElement<"u"?Foe({key:"css"}):null);e6.Provider;var t6=function(e){return A.forwardRef(function(n,r){var i=A.useContext(e6);return e(n,i,r)})},ky=A.createContext({}),ese=function(e,n){if(typeof n=="function"){var r=n(e);return r}return Mf({},e,n)},tse=ZL(function(t){return ZL(function(e){return ese(t,e)})}),nse=function(e){var n=A.useContext(ky);return e.theme!==n&&(n=tse(n)(e.theme)),A.createElement(ky.Provider,{value:n},e.children)},xC=t6(function(t,e){var n=t.styles,r=MN([n],void 0,A.useContext(ky)),i=A.useRef();return iM(function(){var o=e.key+"-global",s=new e.sheet.constructor({key:o,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),a=!1,u=document.querySelector('style[data-emotion="'+o+" "+r.name+'"]');return e.sheet.tags.length&&(s.before=e.sheet.tags[0]),u!==null&&(a=!0,u.setAttribute("data-emotion",o),s.hydrate([u])),i.current=[s,a],function(){s.flush()}},[e]),iM(function(){var o=i.current,s=o[0],a=o[1];if(a){o[1]=!1;return}if(r.next!==void 0&&Y5(e,r.next,!0),s.tags.length){var u=s.tags[s.tags.length-1].nextElementSibling;s.before=u,s.flush()}e.insert("",r,s,!1)},[e,r.name]),null});function rse(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return MN(e)}var sh=function(){var e=rse.apply(void 0,arguments),n="animation-"+e.name;return{name:n,styles:"@keyframes "+n+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},n6=String.raw,r6=n6`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,ise=()=>P.jsx(xC,{styles:r6}),ose=({scope:t=""})=>P.jsx(xC,{styles:n6`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${t} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${t} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${t} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${t} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${t} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${t} :where(b, strong) {
        font-weight: bold;
      }

      ${t} small {
        font-size: 80%;
      }

      ${t} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${t} sub {
        bottom: -0.25em;
      }

      ${t} sup {
        top: -0.5em;
      }

      ${t} img {
        border-style: none;
      }

      ${t} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${t} :where(button, input) {
        overflow: visible;
      }

      ${t} :where(button, select) {
        text-transform: none;
      }

      ${t} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${t} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${t} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${t} progress {
        vertical-align: baseline;
      }

      ${t} textarea {
        overflow: auto;
      }

      ${t} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${t} input[type="number"]::-webkit-inner-spin-button,
      ${t} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${t} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${t} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${t} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${t} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${t} details {
        display: block;
      }

      ${t} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${t} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${t} button {
        background: transparent;
        padding: 0;
      }

      ${t} fieldset {
        margin: 0;
        padding: 0;
      }

      ${t} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${t} textarea {
        resize: vertical;
      }

      ${t} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${t} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${t} table {
        border-collapse: collapse;
      }

      ${t} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${t} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${t} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${t} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${t} select::-ms-expand {
        display: none;
      }

      ${r6}
    `});function sse(t,e){return`${t} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function jo(t={}){const{name:e,strict:n=!0,hookName:r="useContext",providerName:i="Provider",errorMessage:o,defaultValue:s}=t,a=A.createContext(s);a.displayName=e;function u(){var c;const l=A.useContext(a);if(!l&&n){const d=new Error(o??sse(r,i));throw d.name="ContextError",(c=Error.captureStackTrace)==null||c.call(Error,d,u),d}return l}return[a.Provider,u,a]}var[ase,use]=jo({strict:!1,name:"PortalManagerContext"});function i6(t){const{children:e,zIndex:n}=t;return P.jsx(ase,{value:{zIndex:n},children:e})}i6.displayName="PortalManager";var Cw=globalThis!=null&&globalThis.document?A.useLayoutEffect:A.useEffect,[o6,cse]=jo({strict:!1,name:"PortalContext"}),BN="chakra-portal",lse=".chakra-portal",dse=t=>P.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:t.zIndex,top:0,left:0,right:0},children:t.children}),fse=t=>{const{appendToParentPortal:e,children:n}=t,[r,i]=A.useState(null),o=A.useRef(null),[,s]=A.useState({});A.useEffect(()=>s({}),[]);const a=cse(),u=use();Cw(()=>{if(!r)return;const l=r.ownerDocument,d=e?a??l.body:l.body;if(!d)return;o.current=l.createElement("div"),o.current.className=BN,d.appendChild(o.current),s({});const f=o.current;return()=>{d.contains(f)&&d.removeChild(f)}},[r]);const c=u!=null&&u.zIndex?P.jsx(dse,{zIndex:u==null?void 0:u.zIndex,children:n}):n;return o.current?kN.createPortal(P.jsx(o6,{value:o.current,children:c}),o.current):P.jsx("span",{ref:l=>{l&&i(l)}})},hse=t=>{const{children:e,containerRef:n,appendToParentPortal:r}=t,i=n.current,o=i??(typeof window<"u"?document.body:void 0),s=A.useMemo(()=>{const u=i==null?void 0:i.ownerDocument.createElement("div");return u&&(u.className=BN),u},[i]),[,a]=A.useState({});return Cw(()=>a({}),[]),Cw(()=>{if(!(!s||!o))return o.appendChild(s),()=>{o.removeChild(s)}},[s,o]),o&&s?kN.createPortal(P.jsx(o6,{value:r?s:null,children:e}),s):null};function E0(t){const e={appendToParentPortal:!0,...t},{containerRef:n,...r}=e;return n?P.jsx(hse,{containerRef:n,...r}):P.jsx(fse,{...r})}E0.className=BN;E0.selector=lse;E0.displayName="Portal";function s6(){const t=A.useContext(ky);if(!t)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return t}var UN=A.createContext({});UN.displayName="ColorModeContext";function VN(){const t=A.useContext(UN);if(t===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return t}var n1={light:"chakra-ui-light",dark:"chakra-ui-dark"};function pse(t={}){const{preventTransition:e=!0}=t,n={setDataset:r=>{const i=e?n.preventTransition():void 0;document.documentElement.dataset.theme=r,document.documentElement.style.colorScheme=r,i==null||i()},setClassName(r){document.body.classList.add(r?n1.dark:n1.light),document.body.classList.remove(r?n1.light:n1.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(r){var i;return((i=n.query().matches)!=null?i:r==="dark")?"dark":"light"},addListener(r){const i=n.query(),o=s=>{r(s.matches?"dark":"light")};return typeof i.addListener=="function"?i.addListener(o):i.addEventListener("change",o),()=>{typeof i.removeListener=="function"?i.removeListener(o):i.removeEventListener("change",o)}},preventTransition(){const r=document.createElement("style");return r.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(r),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(r)})})}}};return n}var mse="chakra-ui-color-mode";function gse(t){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let n;try{n=localStorage.getItem(t)||e}catch{}return n||e},set(e){try{localStorage.setItem(t,e)}catch{}}}}var vse=gse(mse),oM=()=>{};function sM(t,e){return t.type==="cookie"&&t.ssr?t.get(e):e}function a6(t){const{value:e,children:n,options:{useSystemColorMode:r,initialColorMode:i,disableTransitionOnChange:o}={},colorModeManager:s=vse}=t,a=i==="dark"?"dark":"light",[u,c]=A.useState(()=>sM(s,a)),[l,d]=A.useState(()=>sM(s)),{getSystemTheme:f,setClassName:h,setDataset:p,addListener:m}=A.useMemo(()=>pse({preventTransition:o}),[o]),v=i==="system"&&!u?l:u,g=A.useCallback(x=>{const S=x==="system"?f():x;c(S),h(S==="dark"),p(S),s.set(S)},[s,f,h,p]);Cw(()=>{i==="system"&&d(f())},[]),A.useEffect(()=>{const x=s.get();if(x){g(x);return}if(i==="system"){g("system");return}g(a)},[s,a,i,g]);const y=A.useCallback(()=>{g(v==="dark"?"light":"dark")},[v,g]);A.useEffect(()=>{if(r)return m(g)},[r,m,g]);const b=A.useMemo(()=>({colorMode:e??v,toggleColorMode:e?oM:y,setColorMode:e?oM:g,forced:e!==void 0}),[v,y,g,e]);return P.jsx(UN.Provider,{value:b,children:n})}a6.displayName="ColorModeProvider";var yse=new Set(["dark","light","system"]);function bse(t){let e=t;return yse.has(e)||(e="light"),e}function xse(t={}){const{initialColorMode:e="light",type:n="localStorage",storageKey:r="chakra-ui-color-mode"}=t,i=bse(e),o=n==="cookie",s=`(function(){try{var a=function(o){var l="(prefers-color-scheme: dark)",v=window.matchMedia(l).matches?"dark":"light",e=o==="system"?v:o,d=document.documentElement,m=document.body,i="chakra-ui-light",n="chakra-ui-dark",s=e==="dark";return m.classList.add(s?n:i),m.classList.remove(s?i:n),d.style.colorScheme=e,d.dataset.theme=e,e},u=a,h="${i}",r="${r}",t=document.cookie.match(new RegExp("(^| )".concat(r,"=([^;]+)"))),c=t?t[2]:null;c?a(c):document.cookie="".concat(r,"=").concat(a(h),"; max-age=31536000; path=/")}catch(a){}})();
  `,a=`(function(){try{var a=function(c){var v="(prefers-color-scheme: dark)",h=window.matchMedia(v).matches?"dark":"light",r=c==="system"?h:c,o=document.documentElement,s=document.body,l="chakra-ui-light",d="chakra-ui-dark",i=r==="dark";return s.classList.add(i?d:l),s.classList.remove(i?l:d),o.style.colorScheme=r,o.dataset.theme=r,r},n=a,m="${i}",e="${r}",t=localStorage.getItem(e);t?a(t):localStorage.setItem(e,a(m))}catch(a){}})();
  `;return`!${o?s:a}`.trim()}function wse(t={}){const{nonce:e}=t;return P.jsx("script",{id:"chakra-script",nonce:e,dangerouslySetInnerHTML:{__html:xse(t)}})}function Sse(){const t=VN(),e=s6();return{...t,theme:e}}function Cse(t,e,n){var r,i;if(e==null)return e;const o=s=>{var a,u;return(u=(a=t.__breakpoints)==null?void 0:a.asArray)==null?void 0:u[s]};return(i=(r=o(e))!=null?r:o(n))!=null?i:n}function kse(t,e,n){var r,i;if(e==null)return e;const o=s=>{var a,u;return(u=(a=t.__cssMap)==null?void 0:a[s])==null?void 0:u.value};return(i=(r=o(e))!=null?r:o(n))!=null?i:n}function Tse(t,e,n){const r=s6();return Ese(t,e,n)(r)}function Ese(t,e,n){const r=Array.isArray(e)?e:[e],i=Array.isArray(n)?n:[n];return o=>{const s=i.filter(Boolean),a=r.map((u,c)=>{var l,d;if(t==="breakpoints")return Cse(o,u,(l=s[c])!=null?l:u);const f=`${t}.${u}`;return kse(o,f,(d=s[c])!=null?d:u)});return Array.isArray(e)?a:a[0]}}var zt=(...t)=>t.filter(Boolean).join(" ");function so(t){const e=typeof t;return t!=null&&(e==="object"||e==="function")&&!Array.isArray(t)}function Nl(t,...e){return _se(t)?t(...e):t}var _se=t=>typeof t=="function",zn=t=>t?"":void 0,Vp=t=>t?!0:void 0;function Qr(...t){return function(n){t.some(r=>(r==null||r(n),n==null?void 0:n.defaultPrevented))}}function Ise(...t){return function(n){t.forEach(r=>{r==null||r(n)})}}var kw={exports:{}};kw.exports;(function(t,e){var n=200,r="__lodash_hash_undefined__",i=800,o=16,s=9007199254740991,a="[object Arguments]",u="[object Array]",c="[object AsyncFunction]",l="[object Boolean]",d="[object Date]",f="[object Error]",h="[object Function]",p="[object GeneratorFunction]",m="[object Map]",v="[object Number]",g="[object Null]",y="[object Object]",b="[object Proxy]",x="[object RegExp]",S="[object Set]",C="[object String]",T="[object Undefined]",E="[object WeakMap]",I="[object ArrayBuffer]",N="[object DataView]",$="[object Float32Array]",F="[object Float64Array]",H="[object Int8Array]",G="[object Int16Array]",J="[object Int32Array]",ne="[object Uint8Array]",oe="[object Uint8ClampedArray]",q="[object Uint16Array]",Z="[object Uint32Array]",se=/[\\^$.*+?()[\]{}|]/g,fe=/^\[object .+?Constructor\]$/,xe=/^(?:0|[1-9]\d*)$/,be={};be[$]=be[F]=be[H]=be[G]=be[J]=be[ne]=be[oe]=be[q]=be[Z]=!0,be[a]=be[u]=be[I]=be[l]=be[N]=be[d]=be[f]=be[h]=be[m]=be[v]=be[y]=be[x]=be[S]=be[C]=be[E]=!1;var pe=typeof Ii=="object"&&Ii&&Ii.Object===Object&&Ii,ge=typeof self=="object"&&self&&self.Object===Object&&self,Ce=pe||ge||Function("return this")(),$e=e&&!e.nodeType&&e,Ge=$e&&!0&&t&&!t.nodeType&&t,tt=Ge&&Ge.exports===$e,mt=tt&&pe.process,Ie=function(){try{var U=Ge&&Ge.require&&Ge.require("util").types;return U||mt&&mt.binding&&mt.binding("util")}catch{}}(),lt=Ie&&Ie.isTypedArray;function He(U,te,ce){switch(ce.length){case 0:return U.call(te);case 1:return U.call(te,ce[0]);case 2:return U.call(te,ce[0],ce[1]);case 3:return U.call(te,ce[0],ce[1],ce[2])}return U.apply(te,ce)}function yt(U,te){for(var ce=-1,Me=Array(U);++ce<U;)Me[ce]=te(ce);return Me}function en(U){return function(te){return U(te)}}function sn(U,te){return U==null?void 0:U[te]}function xi(U,te){return function(ce){return U(te(ce))}}var wi=Array.prototype,gr=Function.prototype,Bi=Object.prototype,Gr=Ce["__core-js_shared__"],Ir=gr.toString,Fn=Bi.hasOwnProperty,Rr=function(){var U=/[^.]+$/.exec(Gr&&Gr.keys&&Gr.keys.IE_PROTO||"");return U?"Symbol(src)_1."+U:""}(),Si=Bi.toString,va=Ir.call(Object),qo=RegExp("^"+Ir.call(Fn).replace(se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nr=tt?Ce.Buffer:void 0,ku=Ce.Symbol,Nh=Ce.Uint8Array,Pd=Nr?Nr.allocUnsafe:void 0,Ad=xi(Object.getPrototypeOf,Object),Ko=Object.create,Tu=Bi.propertyIsEnumerable,nl=wi.splice,Eu=ku?ku.toStringTag:void 0,$d=function(){try{var U=Oh(Object,"defineProperty");return U({},"",{}),U}catch{}}(),vg=Nr?Nr.isBuffer:void 0,ya=Math.max,Dd=Date.now,yg=Oh(Ce,"Map"),rl=Oh(Object,"create"),bg=function(){function U(){}return function(te){if(!xa(te))return{};if(Ko)return Ko(te);U.prototype=te;var ce=new U;return U.prototype=void 0,ce}}();function ba(U){var te=-1,ce=U==null?0:U.length;for(this.clear();++te<ce;){var Me=U[te];this.set(Me[0],Me[1])}}function _u(){this.__data__=rl?rl(null):{},this.size=0}function xg(U){var te=this.has(U)&&delete this.__data__[U];return this.size-=te?1:0,te}function gb(U){var te=this.__data__;if(rl){var ce=te[U];return ce===r?void 0:ce}return Fn.call(te,U)?te[U]:void 0}function Ph(U){var te=this.__data__;return rl?te[U]!==void 0:Fn.call(te,U)}function Ah(U,te){var ce=this.__data__;return this.size+=this.has(U)?0:1,ce[U]=rl&&te===void 0?r:te,this}ba.prototype.clear=_u,ba.prototype.delete=xg,ba.prototype.get=gb,ba.prototype.has=Ph,ba.prototype.set=Ah;function $s(U){var te=-1,ce=U==null?0:U.length;for(this.clear();++te<ce;){var Me=U[te];this.set(Me[0],Me[1])}}function il(){this.__data__=[],this.size=0}function L2(U){var te=this.__data__,ce=ol(te,U);if(ce<0)return!1;var Me=te.length-1;return ce==Me?te.pop():nl.call(te,ce,1),--this.size,!0}function Ds(U){var te=this.__data__,ce=ol(te,U);return ce<0?void 0:te[ce][1]}function Iu(U){return ol(this.__data__,U)>-1}function vb(U,te){var ce=this.__data__,Me=ol(ce,U);return Me<0?(++this.size,ce.push([U,te])):ce[Me][1]=te,this}$s.prototype.clear=il,$s.prototype.delete=L2,$s.prototype.get=Ds,$s.prototype.has=Iu,$s.prototype.set=vb;function tn(U){var te=-1,ce=U==null?0:U.length;for(this.clear();++te<ce;){var Me=U[te];this.set(Me[0],Me[1])}}function Xo(){this.size=0,this.__data__={hash:new ba,map:new(yg||$s),string:new ba}}function wg(U){var te=Bd(this,U).delete(U);return this.size-=te?1:0,te}function M2(U){return Bd(this,U).get(U)}function $h(U){return Bd(this,U).has(U)}function Sg(U,te){var ce=Bd(this,U),Me=ce.size;return ce.set(U,te),this.size+=ce.size==Me?0:1,this}tn.prototype.clear=Xo,tn.prototype.delete=wg,tn.prototype.get=M2,tn.prototype.has=$h,tn.prototype.set=Sg;function Os(U){var te=this.__data__=new $s(U);this.size=te.size}function Od(){this.__data__=new $s,this.size=0}function yb(U){var te=this.__data__,ce=te.delete(U);return this.size=te.size,ce}function Cg(U){return this.__data__.get(U)}function kg(U){return this.__data__.has(U)}function bb(U,te){var ce=this.__data__;if(ce instanceof $s){var Me=ce.__data__;if(!yg||Me.length<n-1)return Me.push([U,te]),this.size=++ce.size,this;ce=this.__data__=new tn(Me)}return ce.set(U,te),this.size=ce.size,this}Os.prototype.clear=Od,Os.prototype.delete=yb,Os.prototype.get=Cg,Os.prototype.has=kg,Os.prototype.set=bb;function xo(U,te){var ce=Nu(U),Me=!ce&&Ud(U),Rt=!ce&&!Me&&Pb(U),Ot=!ce&&!Me&&!Rt&&Vi(U),an=ce||Me||Rt||Ot,St=an?yt(U.length,String):[],ln=St.length;for(var zi in U)(te||Fn.call(U,zi))&&!(an&&(zi=="length"||Rt&&(zi=="offset"||zi=="parent")||Ot&&(zi=="buffer"||zi=="byteLength"||zi=="byteOffset")||Eg(zi,ln)))&&St.push(zi);return St}function Ui(U,te,ce){(ce!==void 0&&!Mh(U[te],ce)||ce===void 0&&!(te in U))&&Ld(U,te,ce)}function Fd(U,te,ce){var Me=U[te];(!(Fn.call(U,te)&&Mh(Me,ce))||ce===void 0&&!(te in U))&&Ld(U,te,ce)}function ol(U,te){for(var ce=U.length;ce--;)if(Mh(U[ce][0],te))return ce;return-1}function Ld(U,te,ce){te=="__proto__"&&$d?$d(U,te,{configurable:!0,enumerable:!0,value:ce,writable:!0}):U[te]=ce}var xb=Hr();function sl(U){return U==null?U===void 0?T:g:Eu&&Eu in Object(U)?Fh(U):Rb(U)}function wo(U){return al(U)&&sl(U)==a}function wb(U){if(!xa(U)||Ib(U))return!1;var te=Rg(U)?qo:fe;return te.test(H2(U))}function Dh(U){return al(U)&&Bh(U.length)&&!!be[sl(U)]}function Jo(U){if(!xa(U))return Lh(U);var te=_g(U),ce=[];for(var Me in U)Me=="constructor"&&(te||!Fn.call(U,Me))||ce.push(Me);return ce}function Md(U,te,ce,Me,Rt){U!==te&&xb(te,function(Ot,an){if(Rt||(Rt=new Os),xa(Ot))B2(U,te,an,ce,Md,Me,Rt);else{var St=Me?Me(Ru(U,an),Ot,an+"",U,te,Rt):void 0;St===void 0&&(St=Ot),Ui(U,an,St)}},Ab)}function B2(U,te,ce,Me,Rt,Ot,an){var St=Ru(U,ce),ln=Ru(te,ce),zi=an.get(ln);if(zi){Ui(U,ce,zi);return}var vr=Ot?Ot(St,ln,ce+"",U,te,an):void 0,ul=vr===void 0;if(ul){var Pg=Nu(ln),Vh=!Pg&&Pb(ln),Ob=!Pg&&!Vh&&Vi(ln);vr=ln,Pg||Vh||Ob?Nu(St)?vr=St:q2(St)?vr=kb(St):Vh?(ul=!1,vr=U2(ln,!0)):Ob?(ul=!1,vr=Cb(ln,!0)):vr=[]:Vd(ln)||Ud(ln)?(vr=St,Ud(St)?vr=K2(St):(!xa(St)||Rg(St))&&(vr=_b(ln))):ul=!1}ul&&(an.set(ln,vr),Rt(vr,ln,Me,Ot,an),an.delete(ln)),Ui(U,ce,vr)}function Sb(U,te){return j2(Nb(U,te,Uh),U+"")}var Tg=$d?function(U,te){return $d(U,"toString",{configurable:!0,enumerable:!1,value:Db(te),writable:!0})}:Uh;function U2(U,te){if(te)return U.slice();var ce=U.length,Me=Pd?Pd(ce):new U.constructor(ce);return U.copy(Me),Me}function V2(U){var te=new U.constructor(U.byteLength);return new Nh(te).set(new Nh(U)),te}function Cb(U,te){var ce=te?V2(U.buffer):U.buffer;return new U.constructor(ce,U.byteOffset,U.length)}function kb(U,te){var ce=-1,Me=U.length;for(te||(te=Array(Me));++ce<Me;)te[ce]=U[ce];return te}function Tb(U,te,ce,Me){var Rt=!ce;ce||(ce={});for(var Ot=-1,an=te.length;++Ot<an;){var St=te[Ot],ln=Me?Me(ce[St],U[St],St,ce,U):void 0;ln===void 0&&(ln=U[St]),Rt?Ld(ce,St,ln):Fd(ce,St,ln)}return ce}function Eb(U){return Sb(function(te,ce){var Me=-1,Rt=ce.length,Ot=Rt>1?ce[Rt-1]:void 0,an=Rt>2?ce[2]:void 0;for(Ot=U.length>3&&typeof Ot=="function"?(Rt--,Ot):void 0,an&&z2(ce[0],ce[1],an)&&(Ot=Rt<3?void 0:Ot,Rt=1),te=Object(te);++Me<Rt;){var St=ce[Me];St&&U(te,St,Me,Ot)}return te})}function Hr(U){return function(te,ce,Me){for(var Rt=-1,Ot=Object(te),an=Me(te),St=an.length;St--;){var ln=an[U?St:++Rt];if(ce(Ot[ln],ln,Ot)===!1)break}return te}}function Bd(U,te){var ce=U.__data__;return W2(te)?ce[typeof te=="string"?"string":"hash"]:ce.map}function Oh(U,te){var ce=sn(U,te);return wb(ce)?ce:void 0}function Fh(U){var te=Fn.call(U,Eu),ce=U[Eu];try{U[Eu]=void 0;var Me=!0}catch{}var Rt=Si.call(U);return Me&&(te?U[Eu]=ce:delete U[Eu]),Rt}function _b(U){return typeof U.constructor=="function"&&!_g(U)?bg(Ad(U)):{}}function Eg(U,te){var ce=typeof U;return te=te??s,!!te&&(ce=="number"||ce!="symbol"&&xe.test(U))&&U>-1&&U%1==0&&U<te}function z2(U,te,ce){if(!xa(ce))return!1;var Me=typeof te;return(Me=="number"?Ig(ce)&&Eg(te,ce.length):Me=="string"&&te in ce)?Mh(ce[te],U):!1}function W2(U){var te=typeof U;return te=="string"||te=="number"||te=="symbol"||te=="boolean"?U!=="__proto__":U===null}function Ib(U){return!!Rr&&Rr in U}function _g(U){var te=U&&U.constructor,ce=typeof te=="function"&&te.prototype||Bi;return U===ce}function Lh(U){var te=[];if(U!=null)for(var ce in Object(U))te.push(ce);return te}function Rb(U){return Si.call(U)}function Nb(U,te,ce){return te=ya(te===void 0?U.length-1:te,0),function(){for(var Me=arguments,Rt=-1,Ot=ya(Me.length-te,0),an=Array(Ot);++Rt<Ot;)an[Rt]=Me[te+Rt];Rt=-1;for(var St=Array(te+1);++Rt<te;)St[Rt]=Me[Rt];return St[te]=ce(an),He(U,this,St)}}function Ru(U,te){if(!(te==="constructor"&&typeof U[te]=="function")&&te!="__proto__")return U[te]}var j2=G2(Tg);function G2(U){var te=0,ce=0;return function(){var Me=Dd(),Rt=o-(Me-ce);if(ce=Me,Rt>0){if(++te>=i)return arguments[0]}else te=0;return U.apply(void 0,arguments)}}function H2(U){if(U!=null){try{return Ir.call(U)}catch{}try{return U+""}catch{}}return""}function Mh(U,te){return U===te||U!==U&&te!==te}var Ud=wo(function(){return arguments}())?wo:function(U){return al(U)&&Fn.call(U,"callee")&&!Tu.call(U,"callee")},Nu=Array.isArray;function Ig(U){return U!=null&&Bh(U.length)&&!Rg(U)}function q2(U){return al(U)&&Ig(U)}var Pb=vg||Ng;function Rg(U){if(!xa(U))return!1;var te=sl(U);return te==h||te==p||te==c||te==b}function Bh(U){return typeof U=="number"&&U>-1&&U%1==0&&U<=s}function xa(U){var te=typeof U;return U!=null&&(te=="object"||te=="function")}function al(U){return U!=null&&typeof U=="object"}function Vd(U){if(!al(U)||sl(U)!=y)return!1;var te=Ad(U);if(te===null)return!0;var ce=Fn.call(te,"constructor")&&te.constructor;return typeof ce=="function"&&ce instanceof ce&&Ir.call(ce)==va}var Vi=lt?en(lt):Dh;function K2(U){return Tb(U,Ab(U))}function Ab(U){return Ig(U)?xo(U,!0):Jo(U)}var $b=Eb(function(U,te,ce,Me){Md(U,te,ce,Me)});function Db(U){return function(){return U}}function Uh(U){return U}function Ng(){return!1}t.exports=$b})(kw,kw.exports);var Rse=kw.exports;const fs=m0(Rse);var Nse=t=>/!(important)?$/.test(t),aM=t=>typeof t=="string"?t.replace(/!(important)?$/,"").trim():t,Pse=(t,e)=>n=>{const r=String(e),i=Nse(r),o=aM(r),s=t?`${t}.${o}`:o;let a=so(n.__cssMap)&&s in n.__cssMap?n.__cssMap[s].varRef:e;return a=aM(a),i?`${a} !important`:a};function zN(t){const{scale:e,transform:n,compose:r}=t;return(o,s)=>{var a;const u=Pse(e,o)(s);let c=(a=n==null?void 0:n(u,s))!=null?a:u;return r&&(c=r(c,s)),c}}var r1=(...t)=>e=>t.reduce((n,r)=>r(n),e);function Qo(t,e){return n=>{const r={property:n,scale:t};return r.transform=zN({scale:t,transform:e}),r}}var Ase=({rtl:t,ltr:e})=>n=>n.direction==="rtl"?t:e;function $se(t){const{property:e,scale:n,transform:r}=t;return{scale:n,property:Ase(e),transform:n?zN({scale:n,compose:r}):r}}var u6=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function Dse(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...u6].join(" ")}function Ose(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...u6].join(" ")}var Fse={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Lse={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function Mse(t){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":t,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var Bse={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},b_={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Use=new Set(Object.values(b_)),x_=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Vse=t=>t.trim();function zse(t,e){if(t==null||x_.has(t))return t;if(!(w_(t)||x_.has(t)))return`url('${t}')`;const i=/(^[a-z-A-Z]+)\((.*)\)/g.exec(t),o=i==null?void 0:i[1],s=i==null?void 0:i[2];if(!o||!s)return t;const a=o.includes("-gradient")?o:`${o}-gradient`,[u,...c]=s.split(",").map(Vse).filter(Boolean);if((c==null?void 0:c.length)===0)return t;const l=u in b_?b_[u]:u;c.unshift(l);const d=c.map(f=>{if(Use.has(f))return f;const h=f.indexOf(" "),[p,m]=h!==-1?[f.substr(0,h),f.substr(h+1)]:[f],v=w_(m)?m:m&&m.split(" "),g=`colors.${p}`,y=g in e.__cssMap?e.__cssMap[g].varRef:p;return v?[y,...Array.isArray(v)?v:[v]].join(" "):y});return`${a}(${d.join(", ")})`}var w_=t=>typeof t=="string"&&t.includes("(")&&t.includes(")"),Wse=(t,e)=>zse(t,e??{});function jse(t){return/^var\(--.+\)$/.test(t)}var Gse=t=>{const e=parseFloat(t.toString()),n=t.toString().replace(String(e),"");return{unitless:!n,value:e,unit:n}},Sa=t=>e=>`${t}(${e})`,Vt={filter(t){return t!=="auto"?t:Fse},backdropFilter(t){return t!=="auto"?t:Lse},ring(t){return Mse(Vt.px(t))},bgClip(t){return t==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:t}},transform(t){return t==="auto"?Dse():t==="auto-gpu"?Ose():t},vh(t){return t==="$100vh"?"var(--chakra-vh)":t},px(t){if(t==null)return t;const{unitless:e}=Gse(t);return e||typeof t=="number"?`${t}px`:t},fraction(t){return typeof t!="number"||t>1?t:`${t*100}%`},float(t,e){const n={left:"right",right:"left"};return e.direction==="rtl"?n[t]:t},degree(t){if(jse(t)||t==null)return t;const e=typeof t=="string"&&!t.endsWith("deg");return typeof t=="number"||e?`${t}deg`:t},gradient:Wse,blur:Sa("blur"),opacity:Sa("opacity"),brightness:Sa("brightness"),contrast:Sa("contrast"),dropShadow:Sa("drop-shadow"),grayscale:Sa("grayscale"),hueRotate:Sa("hue-rotate"),invert:Sa("invert"),saturate:Sa("saturate"),sepia:Sa("sepia"),bgImage(t){return t==null||w_(t)||x_.has(t)?t:`url(${t})`},outline(t){const e=String(t)==="0"||String(t)==="none";return t!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:t}},flexDirection(t){var e;const{space:n,divide:r}=(e=Bse[t])!=null?e:{},i={flexDirection:t};return n&&(i[n]=1),r&&(i[r]=1),i}},re={borderWidths:Qo("borderWidths"),borderStyles:Qo("borderStyles"),colors:Qo("colors"),borders:Qo("borders"),gradients:Qo("gradients",Vt.gradient),radii:Qo("radii",Vt.px),space:Qo("space",r1(Vt.vh,Vt.px)),spaceT:Qo("space",r1(Vt.vh,Vt.px)),degreeT(t){return{property:t,transform:Vt.degree}},prop(t,e,n){return{property:t,scale:e,...e&&{transform:zN({scale:e,transform:n})}}},propT(t,e){return{property:t,transform:e}},sizes:Qo("sizes",r1(Vt.vh,Vt.px)),sizesT:Qo("sizes",r1(Vt.vh,Vt.fraction)),shadows:Qo("shadows"),logical:$se,blur:Qo("blur",Vt.blur)},bx={background:re.colors("background"),backgroundColor:re.colors("backgroundColor"),backgroundImage:re.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Vt.bgClip},bgSize:re.prop("backgroundSize"),bgPosition:re.prop("backgroundPosition"),bg:re.colors("background"),bgColor:re.colors("backgroundColor"),bgPos:re.prop("backgroundPosition"),bgRepeat:re.prop("backgroundRepeat"),bgAttachment:re.prop("backgroundAttachment"),bgGradient:re.gradients("backgroundImage"),bgClip:{transform:Vt.bgClip}};Object.assign(bx,{bgImage:bx.backgroundImage,bgImg:bx.backgroundImage});var Wt={border:re.borders("border"),borderWidth:re.borderWidths("borderWidth"),borderStyle:re.borderStyles("borderStyle"),borderColor:re.colors("borderColor"),borderRadius:re.radii("borderRadius"),borderTop:re.borders("borderTop"),borderBlockStart:re.borders("borderBlockStart"),borderTopLeftRadius:re.radii("borderTopLeftRadius"),borderStartStartRadius:re.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:re.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:re.radii("borderTopRightRadius"),borderStartEndRadius:re.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:re.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:re.borders("borderRight"),borderInlineEnd:re.borders("borderInlineEnd"),borderBottom:re.borders("borderBottom"),borderBlockEnd:re.borders("borderBlockEnd"),borderBottomLeftRadius:re.radii("borderBottomLeftRadius"),borderBottomRightRadius:re.radii("borderBottomRightRadius"),borderLeft:re.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:re.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:re.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:re.borders(["borderLeft","borderRight"]),borderInline:re.borders("borderInline"),borderY:re.borders(["borderTop","borderBottom"]),borderBlock:re.borders("borderBlock"),borderTopWidth:re.borderWidths("borderTopWidth"),borderBlockStartWidth:re.borderWidths("borderBlockStartWidth"),borderTopColor:re.colors("borderTopColor"),borderBlockStartColor:re.colors("borderBlockStartColor"),borderTopStyle:re.borderStyles("borderTopStyle"),borderBlockStartStyle:re.borderStyles("borderBlockStartStyle"),borderBottomWidth:re.borderWidths("borderBottomWidth"),borderBlockEndWidth:re.borderWidths("borderBlockEndWidth"),borderBottomColor:re.colors("borderBottomColor"),borderBlockEndColor:re.colors("borderBlockEndColor"),borderBottomStyle:re.borderStyles("borderBottomStyle"),borderBlockEndStyle:re.borderStyles("borderBlockEndStyle"),borderLeftWidth:re.borderWidths("borderLeftWidth"),borderInlineStartWidth:re.borderWidths("borderInlineStartWidth"),borderLeftColor:re.colors("borderLeftColor"),borderInlineStartColor:re.colors("borderInlineStartColor"),borderLeftStyle:re.borderStyles("borderLeftStyle"),borderInlineStartStyle:re.borderStyles("borderInlineStartStyle"),borderRightWidth:re.borderWidths("borderRightWidth"),borderInlineEndWidth:re.borderWidths("borderInlineEndWidth"),borderRightColor:re.colors("borderRightColor"),borderInlineEndColor:re.colors("borderInlineEndColor"),borderRightStyle:re.borderStyles("borderRightStyle"),borderInlineEndStyle:re.borderStyles("borderInlineEndStyle"),borderTopRadius:re.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:re.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:re.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:re.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Wt,{rounded:Wt.borderRadius,roundedTop:Wt.borderTopRadius,roundedTopLeft:Wt.borderTopLeftRadius,roundedTopRight:Wt.borderTopRightRadius,roundedTopStart:Wt.borderStartStartRadius,roundedTopEnd:Wt.borderStartEndRadius,roundedBottom:Wt.borderBottomRadius,roundedBottomLeft:Wt.borderBottomLeftRadius,roundedBottomRight:Wt.borderBottomRightRadius,roundedBottomStart:Wt.borderEndStartRadius,roundedBottomEnd:Wt.borderEndEndRadius,roundedLeft:Wt.borderLeftRadius,roundedRight:Wt.borderRightRadius,roundedStart:Wt.borderInlineStartRadius,roundedEnd:Wt.borderInlineEndRadius,borderStart:Wt.borderInlineStart,borderEnd:Wt.borderInlineEnd,borderTopStartRadius:Wt.borderStartStartRadius,borderTopEndRadius:Wt.borderStartEndRadius,borderBottomStartRadius:Wt.borderEndStartRadius,borderBottomEndRadius:Wt.borderEndEndRadius,borderStartRadius:Wt.borderInlineStartRadius,borderEndRadius:Wt.borderInlineEndRadius,borderStartWidth:Wt.borderInlineStartWidth,borderEndWidth:Wt.borderInlineEndWidth,borderStartColor:Wt.borderInlineStartColor,borderEndColor:Wt.borderInlineEndColor,borderStartStyle:Wt.borderInlineStartStyle,borderEndStyle:Wt.borderInlineEndStyle});var Hse={color:re.colors("color"),textColor:re.colors("color"),fill:re.colors("fill"),stroke:re.colors("stroke")},S_={boxShadow:re.shadows("boxShadow"),mixBlendMode:!0,blendMode:re.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:re.prop("backgroundBlendMode"),opacity:!0};Object.assign(S_,{shadow:S_.boxShadow});var qse={filter:{transform:Vt.filter},blur:re.blur("--chakra-blur"),brightness:re.propT("--chakra-brightness",Vt.brightness),contrast:re.propT("--chakra-contrast",Vt.contrast),hueRotate:re.degreeT("--chakra-hue-rotate"),invert:re.propT("--chakra-invert",Vt.invert),saturate:re.propT("--chakra-saturate",Vt.saturate),dropShadow:re.propT("--chakra-drop-shadow",Vt.dropShadow),backdropFilter:{transform:Vt.backdropFilter},backdropBlur:re.blur("--chakra-backdrop-blur"),backdropBrightness:re.propT("--chakra-backdrop-brightness",Vt.brightness),backdropContrast:re.propT("--chakra-backdrop-contrast",Vt.contrast),backdropHueRotate:re.degreeT("--chakra-backdrop-hue-rotate"),backdropInvert:re.propT("--chakra-backdrop-invert",Vt.invert),backdropSaturate:re.propT("--chakra-backdrop-saturate",Vt.saturate)},Tw={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Vt.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:re.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:re.space("gap"),rowGap:re.space("rowGap"),columnGap:re.space("columnGap")};Object.assign(Tw,{flexDir:Tw.flexDirection});var c6={gridGap:re.space("gridGap"),gridColumnGap:re.space("gridColumnGap"),gridRowGap:re.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},Kse={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Vt.outline},outlineOffset:!0,outlineColor:re.colors("outlineColor")},ts={width:re.sizesT("width"),inlineSize:re.sizesT("inlineSize"),height:re.sizes("height"),blockSize:re.sizes("blockSize"),boxSize:re.sizes(["width","height"]),minWidth:re.sizes("minWidth"),minInlineSize:re.sizes("minInlineSize"),minHeight:re.sizes("minHeight"),minBlockSize:re.sizes("minBlockSize"),maxWidth:re.sizes("maxWidth"),maxInlineSize:re.sizes("maxInlineSize"),maxHeight:re.sizes("maxHeight"),maxBlockSize:re.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(t,e)=>{var n,r,i;return{[`@media screen and (min-width: ${(i=(r=(n=e.__breakpoints)==null?void 0:n.get(t))==null?void 0:r.minW)!=null?i:t})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(t,e)=>{var n,r,i;return{[`@media screen and (max-width: ${(i=(r=(n=e.__breakpoints)==null?void 0:n.get(t))==null?void 0:r._minW)!=null?i:t})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:re.propT("float",Vt.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(ts,{w:ts.width,h:ts.height,minW:ts.minWidth,maxW:ts.maxWidth,minH:ts.minHeight,maxH:ts.maxHeight,overscroll:ts.overscrollBehavior,overscrollX:ts.overscrollBehaviorX,overscrollY:ts.overscrollBehaviorY});var Xse={listStyleType:!0,listStylePosition:!0,listStylePos:re.prop("listStylePosition"),listStyleImage:!0,listStyleImg:re.prop("listStyleImage")};function Jse(t,e,n,r){const i=typeof e=="string"?e.split("."):[e];for(r=0;r<i.length&&t;r+=1)t=t[i[r]];return t===void 0?n:t}var Yse=t=>{const e=new WeakMap;return(r,i,o,s)=>{if(typeof r>"u")return t(r,i,o);e.has(r)||e.set(r,new Map);const a=e.get(r);if(a.has(i))return a.get(i);const u=t(r,i,o,s);return a.set(i,u),u}},Qse=Yse(Jse),Zse={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},eae={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},Rk=(t,e,n)=>{const r={},i=Qse(t,e,{});for(const o in i)o in n&&n[o]!=null||(r[o]=i[o]);return r},tae={srOnly:{transform(t){return t===!0?Zse:t==="focusable"?eae:{}}},layerStyle:{processResult:!0,transform:(t,e,n)=>Rk(e,`layerStyles.${t}`,n)},textStyle:{processResult:!0,transform:(t,e,n)=>Rk(e,`textStyles.${t}`,n)},apply:{processResult:!0,transform:(t,e,n)=>Rk(e,t,n)}},Ov={position:!0,pos:re.prop("position"),zIndex:re.prop("zIndex","zIndices"),inset:re.spaceT("inset"),insetX:re.spaceT(["left","right"]),insetInline:re.spaceT("insetInline"),insetY:re.spaceT(["top","bottom"]),insetBlock:re.spaceT("insetBlock"),top:re.spaceT("top"),insetBlockStart:re.spaceT("insetBlockStart"),bottom:re.spaceT("bottom"),insetBlockEnd:re.spaceT("insetBlockEnd"),left:re.spaceT("left"),insetInlineStart:re.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:re.spaceT("right"),insetInlineEnd:re.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Ov,{insetStart:Ov.insetInlineStart,insetEnd:Ov.insetInlineEnd});var nae={ring:{transform:Vt.ring},ringColor:re.colors("--chakra-ring-color"),ringOffset:re.prop("--chakra-ring-offset-width"),ringOffsetColor:re.colors("--chakra-ring-offset-color"),ringInset:re.prop("--chakra-ring-inset")},Sn={margin:re.spaceT("margin"),marginTop:re.spaceT("marginTop"),marginBlockStart:re.spaceT("marginBlockStart"),marginRight:re.spaceT("marginRight"),marginInlineEnd:re.spaceT("marginInlineEnd"),marginBottom:re.spaceT("marginBottom"),marginBlockEnd:re.spaceT("marginBlockEnd"),marginLeft:re.spaceT("marginLeft"),marginInlineStart:re.spaceT("marginInlineStart"),marginX:re.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:re.spaceT("marginInline"),marginY:re.spaceT(["marginTop","marginBottom"]),marginBlock:re.spaceT("marginBlock"),padding:re.space("padding"),paddingTop:re.space("paddingTop"),paddingBlockStart:re.space("paddingBlockStart"),paddingRight:re.space("paddingRight"),paddingBottom:re.space("paddingBottom"),paddingBlockEnd:re.space("paddingBlockEnd"),paddingLeft:re.space("paddingLeft"),paddingInlineStart:re.space("paddingInlineStart"),paddingInlineEnd:re.space("paddingInlineEnd"),paddingX:re.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:re.space("paddingInline"),paddingY:re.space(["paddingTop","paddingBottom"]),paddingBlock:re.space("paddingBlock")};Object.assign(Sn,{m:Sn.margin,mt:Sn.marginTop,mr:Sn.marginRight,me:Sn.marginInlineEnd,marginEnd:Sn.marginInlineEnd,mb:Sn.marginBottom,ml:Sn.marginLeft,ms:Sn.marginInlineStart,marginStart:Sn.marginInlineStart,mx:Sn.marginX,my:Sn.marginY,p:Sn.padding,pt:Sn.paddingTop,py:Sn.paddingY,px:Sn.paddingX,pb:Sn.paddingBottom,pl:Sn.paddingLeft,ps:Sn.paddingInlineStart,paddingStart:Sn.paddingInlineStart,pr:Sn.paddingRight,pe:Sn.paddingInlineEnd,paddingEnd:Sn.paddingInlineEnd});var rae={textDecorationColor:re.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:re.shadows("textShadow")},iae={clipPath:!0,transform:re.propT("transform",Vt.transform),transformOrigin:!0,translateX:re.spaceT("--chakra-translate-x"),translateY:re.spaceT("--chakra-translate-y"),skewX:re.degreeT("--chakra-skew-x"),skewY:re.degreeT("--chakra-skew-y"),scaleX:re.prop("--chakra-scale-x"),scaleY:re.prop("--chakra-scale-y"),scale:re.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:re.degreeT("--chakra-rotate")},oae={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:re.prop("transitionDuration","transition.duration"),transitionProperty:re.prop("transitionProperty","transition.property"),transitionTimingFunction:re.prop("transitionTimingFunction","transition.easing")},sae={fontFamily:re.prop("fontFamily","fonts"),fontSize:re.prop("fontSize","fontSizes",Vt.px),fontWeight:re.prop("fontWeight","fontWeights"),lineHeight:re.prop("lineHeight","lineHeights"),letterSpacing:re.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(t){if(t===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},aae={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:re.spaceT("scrollMargin"),scrollMarginTop:re.spaceT("scrollMarginTop"),scrollMarginBottom:re.spaceT("scrollMarginBottom"),scrollMarginLeft:re.spaceT("scrollMarginLeft"),scrollMarginRight:re.spaceT("scrollMarginRight"),scrollMarginX:re.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:re.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:re.spaceT("scrollPadding"),scrollPaddingTop:re.spaceT("scrollPaddingTop"),scrollPaddingBottom:re.spaceT("scrollPaddingBottom"),scrollPaddingLeft:re.spaceT("scrollPaddingLeft"),scrollPaddingRight:re.spaceT("scrollPaddingRight"),scrollPaddingX:re.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:re.spaceT(["scrollPaddingTop","scrollPaddingBottom"])};function l6(t){return so(t)&&t.reference?t.reference:String(t)}var wC=(t,...e)=>e.map(l6).join(` ${t} `).replace(/calc/g,""),uM=(...t)=>`calc(${wC("+",...t)})`,cM=(...t)=>`calc(${wC("-",...t)})`,C_=(...t)=>`calc(${wC("*",...t)})`,lM=(...t)=>`calc(${wC("/",...t)})`,dM=t=>{const e=l6(t);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:C_(e,-1)},ef=Object.assign(t=>({add:(...e)=>ef(uM(t,...e)),subtract:(...e)=>ef(cM(t,...e)),multiply:(...e)=>ef(C_(t,...e)),divide:(...e)=>ef(lM(t,...e)),negate:()=>ef(dM(t)),toString:()=>t.toString()}),{add:uM,subtract:cM,multiply:C_,divide:lM,negate:dM});function uae(t,e="-"){return t.replace(/\s+/g,e)}function cae(t){const e=uae(t.toString());return dae(lae(e))}function lae(t){return t.includes("\\.")?t:!Number.isInteger(parseFloat(t.toString()))?t.replace(".","\\."):t}function dae(t){return t.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function fae(t,e=""){return[e,t].filter(Boolean).join("-")}function hae(t,e){return`var(${t}${e?`, ${e}`:""})`}function pae(t,e=""){return cae(`--${fae(t,e)}`)}function rt(t,e,n){const r=pae(t,n);return{variable:r,reference:hae(r,e)}}function mae(t,e){const n={};for(const r of e){if(Array.isArray(r)){const[i,o]=r;n[i]=rt(`${t}-${i}`,o);continue}n[r]=rt(`${t}-${r}`)}return n}function gae(t){const e=t==null?0:t.length;return e?t[e-1]:void 0}function vae(t){const e=parseFloat(t.toString()),n=t.toString().replace(String(e),"");return{unitless:!n,value:e,unit:n}}function k_(t){if(t==null)return t;const{unitless:e}=vae(t);return e||typeof t=="number"?`${t}px`:t}var d6=(t,e)=>parseInt(t[1],10)>parseInt(e[1],10)?1:-1,WN=t=>Object.fromEntries(Object.entries(t).sort(d6));function fM(t){const e=WN(t);return Object.assign(Object.values(e),e)}function yae(t){const e=Object.keys(WN(t));return new Set(e)}function hM(t){var e;if(!t)return t;t=(e=k_(t))!=null?e:t;const n=-.02;return typeof t=="number"?`${t+n}`:t.replace(/(\d+\.?\d*)/u,r=>`${parseFloat(r)+n}`)}function lv(t,e){const n=["@media screen"];return t&&n.push("and",`(min-width: ${k_(t)})`),e&&n.push("and",`(max-width: ${k_(e)})`),n.join(" ")}function bae(t){var e;if(!t)return null;t.base=(e=t.base)!=null?e:"0px";const n=fM(t),r=Object.entries(t).sort(d6).map(([s,a],u,c)=>{var l;let[,d]=(l=c[u+1])!=null?l:[];return d=parseFloat(d)>0?hM(d):void 0,{_minW:hM(a),breakpoint:s,minW:a,maxW:d,maxWQuery:lv(null,d),minWQuery:lv(a),minMaxQuery:lv(a,d)}}),i=yae(t),o=Array.from(i.values());return{keys:i,normalized:n,isResponsive(s){const a=Object.keys(s);return a.length>0&&a.every(u=>i.has(u))},asObject:WN(t),asArray:fM(t),details:r,get(s){return r.find(a=>a.breakpoint===s)},media:[null,...n.map(s=>lv(s)).slice(1)],toArrayValue(s){if(!so(s))throw new Error("toArrayValue: value must be an object");const a=o.map(u=>{var c;return(c=s[u])!=null?c:null});for(;gae(a)===null;)a.pop();return a},toObjectValue(s){if(!Array.isArray(s))throw new Error("toObjectValue: value must be an array");return s.reduce((a,u,c)=>{const l=o[c];return l!=null&&u!=null&&(a[l]=u),a},{})}}}var $r={hover:(t,e)=>`${t}:hover ${e}, ${t}[data-hover] ${e}`,focus:(t,e)=>`${t}:focus ${e}, ${t}[data-focus] ${e}`,focusVisible:(t,e)=>`${t}:focus-visible ${e}`,focusWithin:(t,e)=>`${t}:focus-within ${e}`,active:(t,e)=>`${t}:active ${e}, ${t}[data-active] ${e}`,disabled:(t,e)=>`${t}:disabled ${e}, ${t}[data-disabled] ${e}`,invalid:(t,e)=>`${t}:invalid ${e}, ${t}[data-invalid] ${e}`,checked:(t,e)=>`${t}:checked ${e}, ${t}[data-checked] ${e}`,indeterminate:(t,e)=>`${t}:indeterminate ${e}, ${t}[aria-checked=mixed] ${e}, ${t}[data-indeterminate] ${e}`,readOnly:(t,e)=>`${t}:read-only ${e}, ${t}[readonly] ${e}, ${t}[data-read-only] ${e}`,expanded:(t,e)=>`${t}:read-only ${e}, ${t}[aria-expanded=true] ${e}, ${t}[data-expanded] ${e}`,placeholderShown:(t,e)=>`${t}:placeholder-shown ${e}`},fl=t=>f6(e=>t(e,"&"),"[role=group]","[data-group]",".group"),Pu=t=>f6(e=>t(e,"~ &"),"[data-peer]",".peer"),f6=(t,...e)=>e.map(t).join(", "),SC={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:fl($r.hover),_peerHover:Pu($r.hover),_groupFocus:fl($r.focus),_peerFocus:Pu($r.focus),_groupFocusVisible:fl($r.focusVisible),_peerFocusVisible:Pu($r.focusVisible),_groupActive:fl($r.active),_peerActive:Pu($r.active),_groupDisabled:fl($r.disabled),_peerDisabled:Pu($r.disabled),_groupInvalid:fl($r.invalid),_peerInvalid:Pu($r.invalid),_groupChecked:fl($r.checked),_peerChecked:Pu($r.checked),_groupFocusWithin:fl($r.focusWithin),_peerFocusWithin:Pu($r.focusWithin),_peerPlaceholderShown:Pu($r.placeholderShown),_placeholder:"&::placeholder",_placeholderShown:"&:placeholder-shown",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]"},h6=Object.keys(SC);function pM(t,e){return rt(String(t).replace(/\./g,"-"),void 0,e)}function xae(t,e){let n={};const r={};for(const[i,o]of Object.entries(t)){const{isSemantic:s,value:a}=o,{variable:u,reference:c}=pM(i,e==null?void 0:e.cssVarPrefix);if(!s){if(i.startsWith("space")){const f=i.split("."),[h,...p]=f,m=`${h}.-${p.join(".")}`,v=ef.negate(a),g=ef.negate(c);r[m]={value:v,var:u,varRef:g}}n[u]=a,r[i]={value:a,var:u,varRef:c};continue}const l=f=>{const p=[String(i).split(".")[0],f].join(".");if(!t[p])return f;const{reference:v}=pM(p,e==null?void 0:e.cssVarPrefix);return v},d=so(a)?a:{default:a};n=fs(n,Object.entries(d).reduce((f,[h,p])=>{var m,v;if(!p)return f;const g=l(`${p}`);if(h==="default")return f[u]=g,f;const y=(v=(m=SC)==null?void 0:m[h])!=null?v:h;return f[y]={[u]:g},f},{})),r[i]={value:c,var:u,varRef:c}}return{cssVars:n,cssMap:r}}function wae(t,e=[]){const n=Object.assign({},t);for(const r of e)r in n&&delete n[r];return n}function Sae(t,e){const n={};for(const r of e)r in t&&(n[r]=t[r]);return n}function Cae(t){return typeof t=="object"&&t!=null&&!Array.isArray(t)}function mM(t,e,n={}){const{stop:r,getKey:i}=n;function o(s,a=[]){var u;if(Cae(s)||Array.isArray(s)){const c={};for(const[l,d]of Object.entries(s)){const f=(u=i==null?void 0:i(l))!=null?u:l,h=[...a,f];if(r!=null&&r(s,h))return e(s,a);c[f]=o(d,h)}return c}return e(s,a)}return o(t)}var kae=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Tae(t){return Sae(t,kae)}function Eae(t){return t.semanticTokens}function _ae(t){const{__cssMap:e,__cssVars:n,__breakpoints:r,...i}=t;return i}var Iae=t=>h6.includes(t)||t==="default";function Rae({tokens:t,semanticTokens:e}){const n={};return mM(t,(r,i)=>{r!=null&&(n[i.join(".")]={isSemantic:!1,value:r})}),mM(e,(r,i)=>{r!=null&&(n[i.join(".")]={isSemantic:!0,value:r})},{stop:r=>Object.keys(r).every(Iae)}),n}function Nae(t){var e;const n=_ae(t),r=Tae(n),i=Eae(n),o=Rae({tokens:r,semanticTokens:i}),s=(e=n.config)==null?void 0:e.cssVarPrefix,{cssMap:a,cssVars:u}=xae(o,{cssVarPrefix:s});return Object.assign(n,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...u},__cssMap:a,__breakpoints:bae(n.breakpoints)}),n}var jN=fs({},bx,Wt,Hse,Tw,ts,qse,nae,Kse,c6,tae,Ov,S_,Sn,aae,sae,rae,iae,Xse,oae),Pae=Object.assign({},Sn,ts,Tw,c6,Ov),Aae=Object.keys(Pae),$ae=[...Object.keys(jN),...h6],Dae={...jN,...SC},Oae=t=>t in Dae,Fae=t=>e=>{if(!e.__breakpoints)return t;const{isResponsive:n,toArrayValue:r,media:i}=e.__breakpoints,o={};for(const s in t){let a=Nl(t[s],e);if(a==null)continue;if(a=so(a)&&n(a)?r(a):a,!Array.isArray(a)){o[s]=a;continue}const u=a.slice(0,i.length).length;for(let c=0;c<u;c+=1){const l=i==null?void 0:i[c];if(!l){o[s]=a[c];continue}o[l]=o[l]||{},a[c]!=null&&(o[l][s]=a[c])}}return o};function Lae(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==="("?(r=!0,n+=o):o===")"?(r=!1,n+=o):o===","&&!r?(e.push(n),n=""):n+=o}return n=n.trim(),n&&e.push(n),e}function Mae(t){return/^var\(--.+\)$/.test(t)}var Bae=(t,e)=>t.startsWith("--")&&typeof e=="string"&&!Mae(e),Uae=(t,e)=>{var n,r;if(e==null)return e;const i=u=>{var c,l;return(l=(c=t.__cssMap)==null?void 0:c[u])==null?void 0:l.varRef},o=u=>{var c;return(c=i(u))!=null?c:u},[s,a]=Lae(e);return e=(r=(n=i(s))!=null?n:o(a))!=null?r:o(e),e};function Vae(t){const{configs:e={},pseudos:n={},theme:r}=t,i=(o,s=!1)=>{var a,u,c;const l=Nl(o,r),d=Fae(l)(r);let f={};for(let h in d){const p=d[h];let m=Nl(p,r);h in n&&(h=n[h]),Bae(h,m)&&(m=Uae(r,m));let v=e[h];if(v===!0&&(v={property:h}),so(m)){f[h]=(a=f[h])!=null?a:{},f[h]=fs({},f[h],i(m,!0));continue}let g=(c=(u=v==null?void 0:v.transform)==null?void 0:u.call(v,m,r,l))!=null?c:m;g=v!=null&&v.processResult?i(g,!0):g;const y=Nl(v==null?void 0:v.property,r);if(!s&&(v!=null&&v.static)){const b=Nl(v.static,r);f=fs({},f,b)}if(y&&Array.isArray(y)){for(const b of y)f[b]=g;continue}if(y){y==="&"&&so(g)?f=fs({},f,g):f[y]=g;continue}if(so(g)){f=fs({},f,g);continue}f[h]=g}return f};return i}var p6=t=>e=>Vae({theme:e,pseudos:SC,configs:jN})(t);function bn(t){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:t,...e}}}}function zae(t,e){if(Array.isArray(t))return t;if(so(t))return e(t);if(t!=null)return[t]}function Wae(t,e){for(let n=e+1;n<t.length;n++)if(t[n]!=null)return n;return-1}function jae(t){const e=t.__breakpoints;return function(r,i,o,s){var a,u;if(!e)return;const c={},l=zae(o,e.toArrayValue);if(!l)return c;const d=l.length,f=d===1,h=!!r.parts;for(let p=0;p<d;p++){const m=e.details[p],v=e.details[Wae(l,p)],g=lv(m.minW,v==null?void 0:v._minW),y=Nl((a=r[i])==null?void 0:a[l[p]],s);if(y){if(h){(u=r.parts)==null||u.forEach(b=>{fs(c,{[b]:f?y[b]:{[g]:y[b]}})});continue}if(!h){f?fs(c,y):c[g]=y;continue}c[g]=y}}return c}}function Gae(t){return e=>{var n;const{variant:r,size:i,theme:o}=e,s=jae(o);return fs({},Nl((n=t.baseStyle)!=null?n:{},e),s(t,"sizes",i,e),s(t,"variants",r,e))}}function go(t){return wae(t,["styleConfig","size","variant","colorScheme"])}var Hae=["borders","breakpoints","colors","components","config","direction","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","shadows","sizes","space","styles","transition","zIndices"];function qae(t){return so(t)?Hae.every(e=>Object.prototype.hasOwnProperty.call(t,e)):!1}var Kae={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},Xae={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},Jae={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},Yae={property:Kae,easing:Xae,duration:Jae},Qae=Yae,Zae={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},eue=Zae,tue={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},nue=tue,rue={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},iue=rue,oue={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},sue=oue,aue={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},uue=aue,cue={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},lue=cue,due={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},fue=due,hue={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},m6=hue,g6={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},pue={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},mue={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},gue={...g6,...pue,container:mue},v6=gue,vue={breakpoints:iue,zIndices:eue,radii:uue,blur:fue,colors:sue,...m6,sizes:v6,shadows:lue,space:g6,borders:nue,transition:Qae},{defineMultiStyleConfig:yue,definePartsStyle:dv}=bn(["stepper","step","title","description","indicator","separator","icon","number"]),Bu=rt("stepper-indicator-size"),wp=rt("stepper-icon-size"),Sp=rt("stepper-title-font-size"),fv=rt("stepper-description-font-size"),zg=rt("stepper-accent-color"),bue=dv(({colorScheme:t})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[zg.variable]:`colors.${t}.500`,_dark:{[zg.variable]:`colors.${t}.200`}},title:{fontSize:Sp.reference,fontWeight:"medium"},description:{fontSize:fv.reference,color:"chakra-subtle-text"},number:{fontSize:Sp.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:wp.reference,height:wp.reference},indicator:{flexShrink:0,borderRadius:"full",width:Bu.reference,height:Bu.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:zg.reference},"&[data-status=complete]":{bg:zg.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:zg.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Bu.reference} - 8px)`,top:`calc(${Bu.reference} + 4px)`,insetStart:`calc(${Bu.reference} / 2 - 1px)`}}})),xue=yue({baseStyle:bue,sizes:{xs:dv({stepper:{[Bu.variable]:"sizes.4",[wp.variable]:"sizes.3",[Sp.variable]:"fontSizes.xs",[fv.variable]:"fontSizes.xs"}}),sm:dv({stepper:{[Bu.variable]:"sizes.6",[wp.variable]:"sizes.4",[Sp.variable]:"fontSizes.sm",[fv.variable]:"fontSizes.xs"}}),md:dv({stepper:{[Bu.variable]:"sizes.8",[wp.variable]:"sizes.5",[Sp.variable]:"fontSizes.md",[fv.variable]:"fontSizes.sm"}}),lg:dv({stepper:{[Bu.variable]:"sizes.10",[wp.variable]:"sizes.6",[Sp.variable]:"fontSizes.lg",[fv.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}});function Kt(t,e={}){let n=!1;function r(){if(!n){n=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function i(...l){r();for(const d of l)e[d]=u(d);return Kt(t,e)}function o(...l){for(const d of l)d in e||(e[d]=u(d));return Kt(t,e)}function s(){return Object.fromEntries(Object.entries(e).map(([d,f])=>[d,f.selector]))}function a(){return Object.fromEntries(Object.entries(e).map(([d,f])=>[d,f.className]))}function u(l){const h=`chakra-${(["container","root"].includes(l??"")?[t]:[t,l]).filter(Boolean).join("__")}`;return{className:h,selector:`.${h}`,toString:()=>l}}return{parts:i,toPart:u,extend:o,selectors:s,classnames:a,get keys(){return Object.keys(e)},__type:{}}}var wue=Kt("accordion").parts("root","container","button","panel").extend("icon"),Sue=Kt("alert").parts("title","description","container").extend("icon","spinner"),Cue=Kt("avatar").parts("label","badge","container").extend("excessLabel","group"),kue=Kt("breadcrumb").parts("link","item","container").extend("separator");Kt("button").parts();var Tue=Kt("checkbox").parts("control","icon","container").extend("label");Kt("progress").parts("track","filledTrack").extend("label");var Eue=Kt("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),_ue=Kt("editable").parts("preview","input","textarea"),Iue=Kt("form").parts("container","requiredIndicator","helperText"),Rue=Kt("formError").parts("text","icon"),Nue=Kt("input").parts("addon","field","element","group"),Pue=Kt("list").parts("container","item","icon"),Aue=Kt("menu").parts("button","list","item").extend("groupTitle","icon","command","divider"),$ue=Kt("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Due=Kt("numberinput").parts("root","field","stepperGroup","stepper");Kt("pininput").parts("field");var Oue=Kt("popover").parts("content","header","body","footer").extend("popper","arrow","closeButton"),Fue=Kt("progress").parts("label","filledTrack","track"),Lue=Kt("radio").parts("container","control","label"),Mue=Kt("select").parts("field","icon"),Bue=Kt("slider").parts("container","track","thumb","filledTrack","mark"),Uue=Kt("stat").parts("container","label","helpText","number","icon"),Vue=Kt("switch").parts("container","track","thumb"),zue=Kt("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Wue=Kt("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),jue=Kt("tag").parts("container","label","closeButton"),Gue=Kt("card").parts("container","header","body","footer");function df(t,e,n){return Math.min(Math.max(t,n),e)}class Hue extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var hv=Hue;function GN(t){if(typeof t!="string")throw new hv(t);if(t.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=t.trim();e=ece.test(t)?Xue(t):t;const n=Jue.exec(e);if(n){const s=Array.from(n).slice(1);return[...s.slice(0,3).map(a=>parseInt(Ty(a,2),16)),parseInt(Ty(s[3]||"f",2),16)/255]}const r=Yue.exec(e);if(r){const s=Array.from(r).slice(1);return[...s.slice(0,3).map(a=>parseInt(a,16)),parseInt(s[3]||"ff",16)/255]}const i=Que.exec(e);if(i){const s=Array.from(i).slice(1);return[...s.slice(0,3).map(a=>parseInt(a,10)),parseFloat(s[3]||"1")]}const o=Zue.exec(e);if(o){const[s,a,u,c]=Array.from(o).slice(1).map(parseFloat);if(df(0,100,a)!==a)throw new hv(t);if(df(0,100,u)!==u)throw new hv(t);return[...tce(s,a,u),Number.isNaN(c)?1:c]}throw new hv(t)}function que(t){let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return(e>>>0)%2341}const gM=t=>parseInt(t.replace(/_/g,""),36),Kue="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((t,e)=>{const n=gM(e.substring(0,3)),r=gM(e.substring(3)).toString(16);let i="";for(let o=0;o<6-r.length;o++)i+="0";return t[n]=`${i}${r}`,t},{});function Xue(t){const e=t.toLowerCase().trim(),n=Kue[que(e)];if(!n)throw new hv(t);return`#${n}`}const Ty=(t,e)=>Array.from(Array(e)).map(()=>t).join(""),Jue=new RegExp(`^#${Ty("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Yue=new RegExp(`^#${Ty("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Que=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Ty(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Zue=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,ece=/^[a-z]+$/i,vM=t=>Math.round(t*255),tce=(t,e,n)=>{let r=n/100;if(e===0)return[r,r,r].map(vM);const i=(t%360+360)%360/60,o=(1-Math.abs(2*r-1))*(e/100),s=o*(1-Math.abs(i%2-1));let a=0,u=0,c=0;i>=0&&i<1?(a=o,u=s):i>=1&&i<2?(a=s,u=o):i>=2&&i<3?(u=o,c=s):i>=3&&i<4?(u=s,c=o):i>=4&&i<5?(a=s,c=o):i>=5&&i<6&&(a=o,c=s);const l=r-o/2,d=a+l,f=u+l,h=c+l;return[d,f,h].map(vM)};function nce(t,e,n,r){return`rgba(${df(0,255,t).toFixed()}, ${df(0,255,e).toFixed()}, ${df(0,255,n).toFixed()}, ${parseFloat(df(0,1,r).toFixed(3))})`}function rce(t,e){const[n,r,i,o]=GN(t);return nce(n,r,i,o-e)}function ice(t){const[e,n,r,i]=GN(t);let o=s=>{const a=df(0,255,s).toString(16);return a.length===1?`0${a}`:a};return`#${o(e)}${o(n)}${o(r)}${i<1?o(Math.round(i*255)):""}`}function oce(t,e,n,r,i){for(e=e.split?e.split("."):e,r=0;r<e.length;r++)t=t?t[e[r]]:i;return t===i?n:t}var sce=t=>Object.keys(t).length===0,Ri=(t,e,n)=>{const r=oce(t,`colors.${e}`,e);try{return ice(r),r}catch{return n??"#000000"}},ace=t=>{const[e,n,r]=GN(t);return(e*299+n*587+r*114)/1e3},uce=t=>e=>{const n=Ri(e,t);return ace(n)<128?"dark":"light"},cce=t=>e=>uce(t)(e)==="dark",xm=(t,e)=>n=>{const r=Ri(n,t);return rce(r,1-e)};function yM(t="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${t} ${t}`}}var lce=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function dce(t){const e=lce();return!t||sce(t)?e:t.string&&t.colors?hce(t.string,t.colors):t.string&&!t.colors?fce(t.string):t.colors&&!t.string?pce(t.colors):e}function fce(t){let e=0;if(t.length===0)return e.toString();for(let r=0;r<t.length;r+=1)e=t.charCodeAt(r)+((e<<5)-e),e=e&e;let n="#";for(let r=0;r<3;r+=1){const i=e>>r*8&255;n+=`00${i.toString(16)}`.substr(-2)}return n}function hce(t,e){let n=0;if(t.length===0)return e[0];for(let r=0;r<t.length;r+=1)n=t.charCodeAt(r)+((n<<5)-n),n=n&n;return n=(n%e.length+e.length)%e.length,e[n]}function pce(t){return t[Math.floor(Math.random()*t.length)]}function st(t,e){return n=>n.colorMode==="dark"?e:t}function HN(t){const{orientation:e,vertical:n,horizontal:r}=t;return e?e==="vertical"?n:r:{}}function y6(t){return so(t)&&t.reference?t.reference:String(t)}var CC=(t,...e)=>e.map(y6).join(` ${t} `).replace(/calc/g,""),bM=(...t)=>`calc(${CC("+",...t)})`,xM=(...t)=>`calc(${CC("-",...t)})`,T_=(...t)=>`calc(${CC("*",...t)})`,wM=(...t)=>`calc(${CC("/",...t)})`,SM=t=>{const e=y6(t);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:T_(e,-1)},Uu=Object.assign(t=>({add:(...e)=>Uu(bM(t,...e)),subtract:(...e)=>Uu(xM(t,...e)),multiply:(...e)=>Uu(T_(t,...e)),divide:(...e)=>Uu(wM(t,...e)),negate:()=>Uu(SM(t)),toString:()=>t.toString()}),{add:bM,subtract:xM,multiply:T_,divide:wM,negate:SM});function mce(t){return!Number.isInteger(parseFloat(t.toString()))}function gce(t,e="-"){return t.replace(/\s+/g,e)}function b6(t){const e=gce(t.toString());return e.includes("\\.")?t:mce(t)?e.replace(".","\\."):t}function vce(t,e=""){return[e,b6(t)].filter(Boolean).join("-")}function yce(t,e){return`var(${b6(t)}${e?`, ${e}`:""})`}function bce(t,e=""){return`--${vce(t,e)}`}function pr(t,e){const n=bce(t,e==null?void 0:e.prefix);return{variable:n,reference:yce(n,xce(e==null?void 0:e.fallback))}}function xce(t){return typeof t=="string"?t:t==null?void 0:t.reference}var{defineMultiStyleConfig:wce,definePartsStyle:xx}=bn(Vue.keys),Fv=pr("switch-track-width"),xf=pr("switch-track-height"),Nk=pr("switch-track-diff"),Sce=Uu.subtract(Fv,xf),E_=pr("switch-thumb-x"),Wg=pr("switch-bg"),Cce=t=>{const{colorScheme:e}=t;return{borderRadius:"full",p:"0.5",width:[Fv.reference],height:[xf.reference],transitionProperty:"common",transitionDuration:"fast",[Wg.variable]:"colors.gray.300",_dark:{[Wg.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Wg.variable]:`colors.${e}.500`,_dark:{[Wg.variable]:`colors.${e}.200`}},bg:Wg.reference}},kce={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[xf.reference],height:[xf.reference],_checked:{transform:`translateX(${E_.reference})`}},Tce=xx(t=>({container:{[Nk.variable]:Sce,[E_.variable]:Nk.reference,_rtl:{[E_.variable]:Uu(Nk).negate().toString()}},track:Cce(t),thumb:kce})),Ece={sm:xx({container:{[Fv.variable]:"1.375rem",[xf.variable]:"sizes.3"}}),md:xx({container:{[Fv.variable]:"1.875rem",[xf.variable]:"sizes.4"}}),lg:xx({container:{[Fv.variable]:"2.875rem",[xf.variable]:"sizes.6"}})},_ce=wce({baseStyle:Tce,sizes:Ece,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Ice,definePartsStyle:zp}=bn(zue.keys),Rce=zp({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Ew={"&[data-is-numeric=true]":{textAlign:"end"}},Nce=zp(t=>{const{colorScheme:e}=t;return{th:{color:st("gray.600","gray.400")(t),borderBottom:"1px",borderColor:st(`${e}.100`,`${e}.700`)(t),...Ew},td:{borderBottom:"1px",borderColor:st(`${e}.100`,`${e}.700`)(t),...Ew},caption:{color:st("gray.600","gray.100")(t)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Pce=zp(t=>{const{colorScheme:e}=t;return{th:{color:st("gray.600","gray.400")(t),borderBottom:"1px",borderColor:st(`${e}.100`,`${e}.700`)(t),...Ew},td:{borderBottom:"1px",borderColor:st(`${e}.100`,`${e}.700`)(t),...Ew},caption:{color:st("gray.600","gray.100")(t)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:st(`${e}.100`,`${e}.700`)(t)},td:{background:st(`${e}.100`,`${e}.700`)(t)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Ace={simple:Nce,striped:Pce,unstyled:{}},$ce={sm:zp({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:zp({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:zp({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Dce=Ice({baseStyle:Rce,variants:Ace,sizes:$ce,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Yi=rt("tabs-color"),qs=rt("tabs-bg"),i1=rt("tabs-border-color"),{defineMultiStyleConfig:Oce,definePartsStyle:ru}=bn(Wue.keys),Fce=t=>{const{orientation:e}=t;return{display:e==="vertical"?"flex":"block"}},Lce=t=>{const{isFitted:e}=t;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},Mce=t=>{const{align:e="start",orientation:n}=t;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:n==="vertical"?"column":"row"}},Bce={p:4},Uce=ru(t=>({root:Fce(t),tab:Lce(t),tablist:Mce(t),tabpanel:Bce})),Vce={sm:ru({tab:{py:1,px:4,fontSize:"sm"}}),md:ru({tab:{fontSize:"md",py:2,px:4}}),lg:ru({tab:{fontSize:"lg",py:3,px:4}})},zce=ru(t=>{const{colorScheme:e,orientation:n}=t,r=n==="vertical",i=r?"borderStart":"borderBottom",o=r?"marginStart":"marginBottom";return{tablist:{[i]:"2px solid",borderColor:"inherit"},tab:{[i]:"2px solid",borderColor:"transparent",[o]:"-2px",_selected:{[Yi.variable]:`colors.${e}.600`,_dark:{[Yi.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[qs.variable]:"colors.gray.200",_dark:{[qs.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Yi.reference,bg:qs.reference}}}),Wce=ru(t=>{const{colorScheme:e}=t;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[i1.variable]:"transparent",_selected:{[Yi.variable]:`colors.${e}.600`,[i1.variable]:"colors.white",_dark:{[Yi.variable]:`colors.${e}.300`,[i1.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:i1.reference},color:Yi.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),jce=ru(t=>{const{colorScheme:e}=t;return{tab:{border:"1px solid",borderColor:"inherit",[qs.variable]:"colors.gray.50",_dark:{[qs.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[qs.variable]:"colors.white",[Yi.variable]:`colors.${e}.600`,_dark:{[qs.variable]:"colors.gray.800",[Yi.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Yi.reference,bg:qs.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Gce=ru(t=>{const{colorScheme:e,theme:n}=t;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Ri(n,`${e}.700`),bg:Ri(n,`${e}.100`)}}}}),Hce=ru(t=>{const{colorScheme:e}=t;return{tab:{borderRadius:"full",fontWeight:"semibold",[Yi.variable]:"colors.gray.600",_dark:{[Yi.variable]:"inherit"},_selected:{[Yi.variable]:"colors.white",[qs.variable]:`colors.${e}.600`,_dark:{[Yi.variable]:"colors.gray.800",[qs.variable]:`colors.${e}.300`}},color:Yi.reference,bg:qs.reference}}}),qce=ru({}),Kce={line:zce,enclosed:Wce,"enclosed-colored":jce,"soft-rounded":Gce,"solid-rounded":Hce,unstyled:qce},Xce=Oce({baseStyle:Uce,sizes:Vce,variants:Kce,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),Hn=mae("badge",["bg","color","shadow"]),Jce={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Hn.bg.reference,color:Hn.color.reference,boxShadow:Hn.shadow.reference},Yce=t=>{const{colorScheme:e,theme:n}=t,r=xm(`${e}.500`,.6)(n);return{[Hn.bg.variable]:`colors.${e}.500`,[Hn.color.variable]:"colors.white",_dark:{[Hn.bg.variable]:r,[Hn.color.variable]:"colors.whiteAlpha.800"}}},Qce=t=>{const{colorScheme:e,theme:n}=t,r=xm(`${e}.200`,.16)(n);return{[Hn.bg.variable]:`colors.${e}.100`,[Hn.color.variable]:`colors.${e}.800`,_dark:{[Hn.bg.variable]:r,[Hn.color.variable]:`colors.${e}.200`}}},Zce=t=>{const{colorScheme:e,theme:n}=t,r=xm(`${e}.200`,.8)(n);return{[Hn.color.variable]:`colors.${e}.500`,_dark:{[Hn.color.variable]:r},[Hn.shadow.variable]:`inset 0 0 0px 1px ${Hn.color.reference}`}},ele={solid:Yce,subtle:Qce,outline:Zce},Lv={baseStyle:Jce,variants:ele,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:tle,definePartsStyle:wf}=bn(jue.keys),CM=rt("tag-bg"),kM=rt("tag-color"),Pk=rt("tag-shadow"),wx=rt("tag-min-height"),Sx=rt("tag-min-width"),Cx=rt("tag-font-size"),kx=rt("tag-padding-inline"),nle={fontWeight:"medium",lineHeight:1.2,outline:0,[kM.variable]:Hn.color.reference,[CM.variable]:Hn.bg.reference,[Pk.variable]:Hn.shadow.reference,color:kM.reference,bg:CM.reference,boxShadow:Pk.reference,borderRadius:"md",minH:wx.reference,minW:Sx.reference,fontSize:Cx.reference,px:kx.reference,_focusVisible:{[Pk.variable]:"shadows.outline"}},rle={lineHeight:1.2,overflow:"visible"},ile={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},ole=wf({container:nle,label:rle,closeButton:ile}),sle={sm:wf({container:{[wx.variable]:"sizes.5",[Sx.variable]:"sizes.5",[Cx.variable]:"fontSizes.xs",[kx.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:wf({container:{[wx.variable]:"sizes.6",[Sx.variable]:"sizes.6",[Cx.variable]:"fontSizes.sm",[kx.variable]:"space.2"}}),lg:wf({container:{[wx.variable]:"sizes.8",[Sx.variable]:"sizes.8",[Cx.variable]:"fontSizes.md",[kx.variable]:"space.3"}})},ale={subtle:wf(t=>{var e;return{container:(e=Lv.variants)==null?void 0:e.subtle(t)}}),solid:wf(t=>{var e;return{container:(e=Lv.variants)==null?void 0:e.solid(t)}}),outline:wf(t=>{var e;return{container:(e=Lv.variants)==null?void 0:e.outline(t)}})},ule=tle({variants:ale,baseStyle:ole,sizes:sle,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}}),{definePartsStyle:qu,defineMultiStyleConfig:cle}=bn(Nue.keys),Cp=rt("input-height"),kp=rt("input-font-size"),Tp=rt("input-padding"),Ep=rt("input-border-radius"),lle=qu({addon:{height:Cp.reference,fontSize:kp.reference,px:Tp.reference,borderRadius:Ep.reference},field:{width:"100%",height:Cp.reference,fontSize:kp.reference,px:Tp.reference,borderRadius:Ep.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),hl={lg:{[kp.variable]:"fontSizes.lg",[Tp.variable]:"space.4",[Ep.variable]:"radii.md",[Cp.variable]:"sizes.12"},md:{[kp.variable]:"fontSizes.md",[Tp.variable]:"space.4",[Ep.variable]:"radii.md",[Cp.variable]:"sizes.10"},sm:{[kp.variable]:"fontSizes.sm",[Tp.variable]:"space.3",[Ep.variable]:"radii.sm",[Cp.variable]:"sizes.8"},xs:{[kp.variable]:"fontSizes.xs",[Tp.variable]:"space.2",[Ep.variable]:"radii.sm",[Cp.variable]:"sizes.6"}},dle={lg:qu({field:hl.lg,group:hl.lg}),md:qu({field:hl.md,group:hl.md}),sm:qu({field:hl.sm,group:hl.sm}),xs:qu({field:hl.xs,group:hl.xs})};function qN(t){const{focusBorderColor:e,errorBorderColor:n}=t;return{focusBorderColor:e||st("blue.500","blue.300")(t),errorBorderColor:n||st("red.500","red.300")(t)}}var fle=qu(t=>{const{theme:e}=t,{focusBorderColor:n,errorBorderColor:r}=qN(t);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:st("gray.300","whiteAlpha.400")(t)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ri(e,r),boxShadow:`0 0 0 1px ${Ri(e,r)}`},_focusVisible:{zIndex:1,borderColor:Ri(e,n),boxShadow:`0 0 0 1px ${Ri(e,n)}`}},addon:{border:"1px solid",borderColor:st("inherit","whiteAlpha.50")(t),bg:st("gray.100","whiteAlpha.300")(t)}}}),hle=qu(t=>{const{theme:e}=t,{focusBorderColor:n,errorBorderColor:r}=qN(t);return{field:{border:"2px solid",borderColor:"transparent",bg:st("gray.100","whiteAlpha.50")(t),_hover:{bg:st("gray.200","whiteAlpha.100")(t)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ri(e,r)},_focusVisible:{bg:"transparent",borderColor:Ri(e,n)}},addon:{border:"2px solid",borderColor:"transparent",bg:st("gray.100","whiteAlpha.50")(t)}}}),ple=qu(t=>{const{theme:e}=t,{focusBorderColor:n,errorBorderColor:r}=qN(t);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ri(e,r),boxShadow:`0px 1px 0px 0px ${Ri(e,r)}`},_focusVisible:{borderColor:Ri(e,n),boxShadow:`0px 1px 0px 0px ${Ri(e,n)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),mle=qu({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),gle={outline:fle,filled:hle,flushed:ple,unstyled:mle},Ht=cle({baseStyle:lle,sizes:dle,variants:gle,defaultProps:{size:"md",variant:"outline"}}),TM,vle={...(TM=Ht.baseStyle)==null?void 0:TM.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"},EM,_M,yle={outline:t=>{var e,n;return(n=(e=Ht.variants)==null?void 0:e.outline(t).field)!=null?n:{}},flushed:t=>{var e,n;return(n=(e=Ht.variants)==null?void 0:e.flushed(t).field)!=null?n:{}},filled:t=>{var e,n;return(n=(e=Ht.variants)==null?void 0:e.filled(t).field)!=null?n:{}},unstyled:(_M=(EM=Ht.variants)==null?void 0:EM.unstyled.field)!=null?_M:{}},IM,RM,NM,PM,AM,$M,DM,OM,ble={xs:(RM=(IM=Ht.sizes)==null?void 0:IM.xs.field)!=null?RM:{},sm:(PM=(NM=Ht.sizes)==null?void 0:NM.sm.field)!=null?PM:{},md:($M=(AM=Ht.sizes)==null?void 0:AM.md.field)!=null?$M:{},lg:(OM=(DM=Ht.sizes)==null?void 0:DM.lg.field)!=null?OM:{}},xle={baseStyle:vle,sizes:ble,variants:yle,defaultProps:{size:"md",variant:"outline"}},o1=pr("tooltip-bg"),Ak=pr("tooltip-fg"),wle=pr("popper-arrow-bg"),Sle={bg:o1.reference,color:Ak.reference,[o1.variable]:"colors.gray.700",[Ak.variable]:"colors.whiteAlpha.900",_dark:{[o1.variable]:"colors.gray.300",[Ak.variable]:"colors.gray.900"},[wle.variable]:o1.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},Cle={baseStyle:Sle},{defineMultiStyleConfig:kle,definePartsStyle:pv}=bn(Fue.keys),Tle=t=>{const{colorScheme:e,theme:n,isIndeterminate:r,hasStripe:i}=t,o=st(yM(),yM("1rem","rgba(0,0,0,0.1)"))(t),s=st(`${e}.500`,`${e}.200`)(t),a=`linear-gradient(
    to right,
    transparent 0%,
    ${Ri(n,s)} 50%,
    transparent 100%
  )`;return{...!r&&i&&o,...r?{bgImage:a}:{bgColor:s}}},Ele={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},_le=t=>({bg:st("gray.100","whiteAlpha.300")(t)}),Ile=t=>({transitionProperty:"common",transitionDuration:"slow",...Tle(t)}),Rle=pv(t=>({label:Ele,filledTrack:Ile(t),track:_le(t)})),Nle={xs:pv({track:{h:"1"}}),sm:pv({track:{h:"2"}}),md:pv({track:{h:"3"}}),lg:pv({track:{h:"4"}})},Ple=kle({sizes:Nle,baseStyle:Rle,defaultProps:{size:"md",colorScheme:"blue"}}),Ale=t=>typeof t=="function";function Di(t,...e){return Ale(t)?t(...e):t}var{definePartsStyle:Tx,defineMultiStyleConfig:$le}=bn(Tue.keys),Mv=rt("checkbox-size"),Dle=t=>{const{colorScheme:e}=t;return{w:Mv.reference,h:Mv.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:st(`${e}.500`,`${e}.200`)(t),borderColor:st(`${e}.500`,`${e}.200`)(t),color:st("white","gray.900")(t),_hover:{bg:st(`${e}.600`,`${e}.300`)(t),borderColor:st(`${e}.600`,`${e}.300`)(t)},_disabled:{borderColor:st("gray.200","transparent")(t),bg:st("gray.200","whiteAlpha.300")(t),color:st("gray.500","whiteAlpha.500")(t)}},_indeterminate:{bg:st(`${e}.500`,`${e}.200`)(t),borderColor:st(`${e}.500`,`${e}.200`)(t),color:st("white","gray.900")(t)},_disabled:{bg:st("gray.100","whiteAlpha.100")(t),borderColor:st("gray.100","transparent")(t)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:st("red.500","red.300")(t)}}},Ole={_disabled:{cursor:"not-allowed"}},Fle={userSelect:"none",_disabled:{opacity:.4}},Lle={transitionProperty:"transform",transitionDuration:"normal"},Mle=Tx(t=>({icon:Lle,container:Ole,control:Di(Dle,t),label:Fle})),Ble={sm:Tx({control:{[Mv.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:Tx({control:{[Mv.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:Tx({control:{[Mv.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},_w=$le({baseStyle:Mle,sizes:Ble,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Ule,definePartsStyle:Ex}=bn(Lue.keys),Vle=t=>{var e;const n=(e=Di(_w.baseStyle,t))==null?void 0:e.control;return{...n,borderRadius:"full",_checked:{...n==null?void 0:n._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},zle=Ex(t=>{var e,n,r,i;return{label:(n=(e=_w).baseStyle)==null?void 0:n.call(e,t).label,container:(i=(r=_w).baseStyle)==null?void 0:i.call(r,t).container,control:Vle(t)}}),Wle={md:Ex({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:Ex({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:Ex({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},jle=Ule({baseStyle:zle,sizes:Wle,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Gle,definePartsStyle:Hle}=bn(Mue.keys),s1=rt("select-bg"),FM,qle={...(FM=Ht.baseStyle)==null?void 0:FM.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:s1.reference,[s1.variable]:"colors.white",_dark:{[s1.variable]:"colors.gray.700"},"> option, > optgroup":{bg:s1.reference}},Kle={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Xle=Hle({field:qle,icon:Kle}),a1={paddingInlineEnd:"8"},LM,MM,BM,UM,VM,zM,WM,jM,Jle={lg:{...(LM=Ht.sizes)==null?void 0:LM.lg,field:{...(MM=Ht.sizes)==null?void 0:MM.lg.field,...a1}},md:{...(BM=Ht.sizes)==null?void 0:BM.md,field:{...(UM=Ht.sizes)==null?void 0:UM.md.field,...a1}},sm:{...(VM=Ht.sizes)==null?void 0:VM.sm,field:{...(zM=Ht.sizes)==null?void 0:zM.sm.field,...a1}},xs:{...(WM=Ht.sizes)==null?void 0:WM.xs,field:{...(jM=Ht.sizes)==null?void 0:jM.xs.field,...a1},icon:{insetEnd:"1"}}},Yle=Gle({baseStyle:Xle,sizes:Jle,variants:Ht.variants,defaultProps:Ht.defaultProps}),$k=rt("skeleton-start-color"),Dk=rt("skeleton-end-color"),Qle={[$k.variable]:"colors.gray.100",[Dk.variable]:"colors.gray.400",_dark:{[$k.variable]:"colors.gray.800",[Dk.variable]:"colors.gray.600"},background:$k.reference,borderColor:Dk.reference,opacity:.7,borderRadius:"sm"},Zle={baseStyle:Qle},Ok=rt("skip-link-bg"),ede={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[Ok.variable]:"colors.white",_dark:{[Ok.variable]:"colors.gray.700"},bg:Ok.reference}},tde={baseStyle:ede},{defineMultiStyleConfig:nde,definePartsStyle:kC}=bn(Bue.keys),Ey=rt("slider-thumb-size"),_y=rt("slider-track-size"),Tl=rt("slider-bg"),rde=t=>{const{orientation:e}=t;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...HN({orientation:e,vertical:{h:"100%"},horizontal:{w:"100%"}})}},ide=t=>({...HN({orientation:t.orientation,horizontal:{h:_y.reference},vertical:{w:_y.reference}}),overflow:"hidden",borderRadius:"sm",[Tl.variable]:"colors.gray.200",_dark:{[Tl.variable]:"colors.whiteAlpha.200"},_disabled:{[Tl.variable]:"colors.gray.300",_dark:{[Tl.variable]:"colors.whiteAlpha.300"}},bg:Tl.reference}),ode=t=>{const{orientation:e}=t;return{...HN({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Ey.reference,h:Ey.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},sde=t=>{const{colorScheme:e}=t;return{width:"inherit",height:"inherit",[Tl.variable]:`colors.${e}.500`,_dark:{[Tl.variable]:`colors.${e}.200`},bg:Tl.reference}},ade=kC(t=>({container:rde(t),track:ide(t),thumb:ode(t),filledTrack:sde(t)})),ude=kC({container:{[Ey.variable]:"sizes.4",[_y.variable]:"sizes.1"}}),cde=kC({container:{[Ey.variable]:"sizes.3.5",[_y.variable]:"sizes.1"}}),lde=kC({container:{[Ey.variable]:"sizes.2.5",[_y.variable]:"sizes.0.5"}}),dde={lg:ude,md:cde,sm:lde},fde=nde({baseStyle:ade,sizes:dde,defaultProps:{size:"md",colorScheme:"blue"}}),tf=pr("spinner-size"),hde={width:[tf.reference],height:[tf.reference]},pde={xs:{[tf.variable]:"sizes.3"},sm:{[tf.variable]:"sizes.4"},md:{[tf.variable]:"sizes.6"},lg:{[tf.variable]:"sizes.8"},xl:{[tf.variable]:"sizes.12"}},mde={baseStyle:hde,sizes:pde,defaultProps:{size:"md"}},{defineMultiStyleConfig:gde,definePartsStyle:x6}=bn(Uue.keys),vde={fontWeight:"medium"},yde={opacity:.8,marginBottom:"2"},bde={verticalAlign:"baseline",fontWeight:"semibold"},xde={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},wde=x6({container:{},label:vde,helpText:yde,number:bde,icon:xde}),Sde={md:x6({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Cde=gde({baseStyle:wde,sizes:Sde,defaultProps:{size:"md"}}),Fk=rt("kbd-bg"),kde={[Fk.variable]:"colors.gray.100",_dark:{[Fk.variable]:"colors.whiteAlpha.100"},bg:Fk.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},Tde={baseStyle:kde},Ede={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},_de={baseStyle:Ede},{defineMultiStyleConfig:Ide,definePartsStyle:Rde}=bn(Pue.keys),Nde={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},Pde=Rde({icon:Nde}),Ade=Ide({baseStyle:Pde}),{defineMultiStyleConfig:$de,definePartsStyle:Dde}=bn(Aue.keys),_a=rt("menu-bg"),Lk=rt("menu-shadow"),Ode={[_a.variable]:"#fff",[Lk.variable]:"shadows.sm",_dark:{[_a.variable]:"colors.gray.700",[Lk.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px",bg:_a.reference,boxShadow:Lk.reference},Fde={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[_a.variable]:"colors.gray.100",_dark:{[_a.variable]:"colors.whiteAlpha.100"}},_active:{[_a.variable]:"colors.gray.200",_dark:{[_a.variable]:"colors.whiteAlpha.200"}},_expanded:{[_a.variable]:"colors.gray.100",_dark:{[_a.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:_a.reference},Lde={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Mde={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},Bde={opacity:.6},Ude={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Vde={transitionProperty:"common",transitionDuration:"normal"},zde=Dde({button:Vde,list:Ode,item:Fde,groupTitle:Lde,icon:Mde,command:Bde,divider:Ude}),Wde=$de({baseStyle:zde}),{defineMultiStyleConfig:jde,definePartsStyle:__}=bn($ue.keys),Mk=rt("modal-bg"),Bk=rt("modal-shadow"),Gde={bg:"blackAlpha.600",zIndex:"modal"},Hde=t=>{const{isCentered:e,scrollBehavior:n}=t;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:n==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},qde=t=>{const{isCentered:e,scrollBehavior:n}=t;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:n==="inside"?"calc(100% - 7.5rem)":void 0,[Mk.variable]:"colors.white",[Bk.variable]:"shadows.lg",_dark:{[Mk.variable]:"colors.gray.700",[Bk.variable]:"shadows.dark-lg"},bg:Mk.reference,boxShadow:Bk.reference}},Kde={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Xde={position:"absolute",top:"2",insetEnd:"3"},Jde=t=>{const{scrollBehavior:e}=t;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},Yde={px:"6",py:"4"},Qde=__(t=>({overlay:Gde,dialogContainer:Di(Hde,t),dialog:Di(qde,t),header:Kde,closeButton:Xde,body:Di(Jde,t),footer:Yde}));function Ls(t){return __(t==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:t}})}var Zde={xs:Ls("xs"),sm:Ls("sm"),md:Ls("md"),lg:Ls("lg"),xl:Ls("xl"),"2xl":Ls("2xl"),"3xl":Ls("3xl"),"4xl":Ls("4xl"),"5xl":Ls("5xl"),"6xl":Ls("6xl"),full:Ls("full")},efe=jde({baseStyle:Qde,sizes:Zde,defaultProps:{size:"md"}}),{defineMultiStyleConfig:tfe,definePartsStyle:w6}=bn(Due.keys),KN=pr("number-input-stepper-width"),S6=pr("number-input-input-padding"),nfe=Uu(KN).add("0.5rem").toString(),Uk=pr("number-input-bg"),Vk=pr("number-input-color"),zk=pr("number-input-border-color"),rfe={[KN.variable]:"sizes.6",[S6.variable]:nfe},ife=t=>{var e,n;return(n=(e=Di(Ht.baseStyle,t))==null?void 0:e.field)!=null?n:{}},ofe={width:KN.reference},sfe={borderStart:"1px solid",borderStartColor:zk.reference,color:Vk.reference,bg:Uk.reference,[Vk.variable]:"colors.chakra-body-text",[zk.variable]:"colors.chakra-border-color",_dark:{[Vk.variable]:"colors.whiteAlpha.800",[zk.variable]:"colors.whiteAlpha.300"},_active:{[Uk.variable]:"colors.gray.200",_dark:{[Uk.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},afe=w6(t=>{var e;return{root:rfe,field:(e=Di(ife,t))!=null?e:{},stepperGroup:ofe,stepper:sfe}});function u1(t){var e,n,r;const i=(e=Ht.sizes)==null?void 0:e[t],o={lg:"md",md:"md",sm:"sm",xs:"sm"},s=(r=(n=i.field)==null?void 0:n.fontSize)!=null?r:"md",a=m6.fontSizes[s];return w6({field:{...i.field,paddingInlineEnd:S6.reference,verticalAlign:"top"},stepper:{fontSize:Uu(a).multiply(.75).toString(),_first:{borderTopEndRadius:o[t]},_last:{borderBottomEndRadius:o[t],mt:"-1px",borderTopWidth:1}}})}var ufe={xs:u1("xs"),sm:u1("sm"),md:u1("md"),lg:u1("lg")},cfe=tfe({baseStyle:afe,sizes:ufe,variants:Ht.variants,defaultProps:Ht.defaultProps}),GM,lfe={...(GM=Ht.baseStyle)==null?void 0:GM.field,textAlign:"center"},dfe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},HM,qM,ffe={outline:t=>{var e,n,r;return(r=(n=Di((e=Ht.variants)==null?void 0:e.outline,t))==null?void 0:n.field)!=null?r:{}},flushed:t=>{var e,n,r;return(r=(n=Di((e=Ht.variants)==null?void 0:e.flushed,t))==null?void 0:n.field)!=null?r:{}},filled:t=>{var e,n,r;return(r=(n=Di((e=Ht.variants)==null?void 0:e.filled,t))==null?void 0:n.field)!=null?r:{}},unstyled:(qM=(HM=Ht.variants)==null?void 0:HM.unstyled.field)!=null?qM:{}},hfe={baseStyle:lfe,sizes:dfe,variants:ffe,defaultProps:Ht.defaultProps},{defineMultiStyleConfig:pfe,definePartsStyle:mfe}=bn(Oue.keys),c1=pr("popper-bg"),gfe=pr("popper-arrow-bg"),KM=pr("popper-arrow-shadow-color"),vfe={zIndex:10},yfe={[c1.variable]:"colors.white",bg:c1.reference,[gfe.variable]:c1.reference,[KM.variable]:"colors.gray.200",_dark:{[c1.variable]:"colors.gray.700",[KM.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},bfe={px:3,py:2,borderBottomWidth:"1px"},xfe={px:3,py:2},wfe={px:3,py:2,borderTopWidth:"1px"},Sfe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},Cfe=mfe({popper:vfe,content:yfe,header:bfe,body:xfe,footer:wfe,closeButton:Sfe}),kfe=pfe({baseStyle:Cfe}),{definePartsStyle:I_,defineMultiStyleConfig:Tfe}=bn(Eue.keys),Wk=rt("drawer-bg"),jk=rt("drawer-box-shadow");function Wh(t){return I_(t==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:t}})}var Efe={bg:"blackAlpha.600",zIndex:"overlay"},_fe={display:"flex",zIndex:"modal",justifyContent:"center"},Ife=t=>{const{isFullHeight:e}=t;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[Wk.variable]:"colors.white",[jk.variable]:"shadows.lg",_dark:{[Wk.variable]:"colors.gray.700",[jk.variable]:"shadows.dark-lg"},bg:Wk.reference,boxShadow:jk.reference}},Rfe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Nfe={position:"absolute",top:"2",insetEnd:"3"},Pfe={px:"6",py:"2",flex:"1",overflow:"auto"},Afe={px:"6",py:"4"},$fe=I_(t=>({overlay:Efe,dialogContainer:_fe,dialog:Di(Ife,t),header:Rfe,closeButton:Nfe,body:Pfe,footer:Afe})),Dfe={xs:Wh("xs"),sm:Wh("md"),md:Wh("lg"),lg:Wh("2xl"),xl:Wh("4xl"),full:Wh("full")},Ofe=Tfe({baseStyle:$fe,sizes:Dfe,defaultProps:{size:"xs"}}),{definePartsStyle:Ffe,defineMultiStyleConfig:Lfe}=bn(_ue.keys),Mfe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Bfe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Ufe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Vfe=Ffe({preview:Mfe,input:Bfe,textarea:Ufe}),zfe=Lfe({baseStyle:Vfe}),{definePartsStyle:Wfe,defineMultiStyleConfig:jfe}=bn(Iue.keys),Wp=rt("form-control-color"),Gfe={marginStart:"1",[Wp.variable]:"colors.red.500",_dark:{[Wp.variable]:"colors.red.300"},color:Wp.reference},Hfe={mt:"2",[Wp.variable]:"colors.gray.600",_dark:{[Wp.variable]:"colors.whiteAlpha.600"},color:Wp.reference,lineHeight:"normal",fontSize:"sm"},qfe=Wfe({container:{width:"100%",position:"relative"},requiredIndicator:Gfe,helperText:Hfe}),Kfe=jfe({baseStyle:qfe}),{definePartsStyle:Xfe,defineMultiStyleConfig:Jfe}=bn(Rue.keys),jp=rt("form-error-color"),Yfe={[jp.variable]:"colors.red.500",_dark:{[jp.variable]:"colors.red.300"},color:jp.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Qfe={marginEnd:"0.5em",[jp.variable]:"colors.red.500",_dark:{[jp.variable]:"colors.red.300"},color:jp.reference},Zfe=Xfe({text:Yfe,icon:Qfe}),ehe=Jfe({baseStyle:Zfe}),the={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},nhe={baseStyle:the},rhe={fontFamily:"heading",fontWeight:"bold"},ihe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},ohe={baseStyle:rhe,sizes:ihe,defaultProps:{size:"xl"}},{defineMultiStyleConfig:she,definePartsStyle:ahe}=bn(kue.keys),Gk=rt("breadcrumb-link-decor"),uhe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:Gk.reference,[Gk.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[Gk.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},che=ahe({link:uhe}),lhe=she({baseStyle:che}),dhe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},C6=t=>{const{colorScheme:e,theme:n}=t;if(e==="gray")return{color:st("gray.800","whiteAlpha.900")(t),_hover:{bg:st("gray.100","whiteAlpha.200")(t)},_active:{bg:st("gray.200","whiteAlpha.300")(t)}};const r=xm(`${e}.200`,.12)(n),i=xm(`${e}.200`,.24)(n);return{color:st(`${e}.600`,`${e}.200`)(t),bg:"transparent",_hover:{bg:st(`${e}.50`,r)(t)},_active:{bg:st(`${e}.100`,i)(t)}}},fhe=t=>{const{colorScheme:e}=t,n=st("gray.200","whiteAlpha.300")(t);return{border:"1px solid",borderColor:e==="gray"?n:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Di(C6,t)}},hhe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},phe=t=>{var e;const{colorScheme:n}=t;if(n==="gray"){const u=st("gray.100","whiteAlpha.200")(t);return{bg:u,color:st("gray.800","whiteAlpha.900")(t),_hover:{bg:st("gray.200","whiteAlpha.300")(t),_disabled:{bg:u}},_active:{bg:st("gray.300","whiteAlpha.400")(t)}}}const{bg:r=`${n}.500`,color:i="white",hoverBg:o=`${n}.600`,activeBg:s=`${n}.700`}=(e=hhe[n])!=null?e:{},a=st(r,`${n}.200`)(t);return{bg:a,color:st(i,"gray.800")(t),_hover:{bg:st(o,`${n}.300`)(t),_disabled:{bg:a}},_active:{bg:st(s,`${n}.400`)(t)}}},mhe=t=>{const{colorScheme:e}=t;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:st(`${e}.500`,`${e}.200`)(t),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:st(`${e}.700`,`${e}.500`)(t)}}},ghe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},vhe={ghost:C6,outline:fhe,solid:phe,link:mhe,unstyled:ghe},yhe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},bhe={baseStyle:dhe,variants:vhe,sizes:yhe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Sf,defineMultiStyleConfig:xhe}=bn(Gue.keys),Iw=rt("card-bg"),Sc=rt("card-padding"),k6=rt("card-shadow"),_x=rt("card-radius"),T6=rt("card-border-width","0"),E6=rt("card-border-color"),whe=Sf({container:{[Iw.variable]:"colors.chakra-body-bg",backgroundColor:Iw.reference,boxShadow:k6.reference,borderRadius:_x.reference,color:"chakra-body-text",borderWidth:T6.reference,borderColor:E6.reference},body:{padding:Sc.reference,flex:"1 1 0%"},header:{padding:Sc.reference},footer:{padding:Sc.reference}}),She={sm:Sf({container:{[_x.variable]:"radii.base",[Sc.variable]:"space.3"}}),md:Sf({container:{[_x.variable]:"radii.md",[Sc.variable]:"space.5"}}),lg:Sf({container:{[_x.variable]:"radii.xl",[Sc.variable]:"space.7"}})},Che={elevated:Sf({container:{[k6.variable]:"shadows.base",_dark:{[Iw.variable]:"colors.gray.700"}}}),outline:Sf({container:{[T6.variable]:"1px",[E6.variable]:"colors.chakra-border-color"}}),filled:Sf({container:{[Iw.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Sc.variable]:0},header:{[Sc.variable]:0},footer:{[Sc.variable]:0}}},khe=xhe({baseStyle:whe,variants:Che,sizes:She,defaultProps:{variant:"elevated",size:"md"}}),Bv=pr("close-button-size"),jg=pr("close-button-bg"),The={w:[Bv.reference],h:[Bv.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[jg.variable]:"colors.blackAlpha.100",_dark:{[jg.variable]:"colors.whiteAlpha.100"}},_active:{[jg.variable]:"colors.blackAlpha.200",_dark:{[jg.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:jg.reference},Ehe={lg:{[Bv.variable]:"sizes.10",fontSize:"md"},md:{[Bv.variable]:"sizes.8",fontSize:"xs"},sm:{[Bv.variable]:"sizes.6",fontSize:"2xs"}},_he={baseStyle:The,sizes:Ehe,defaultProps:{size:"md"}},{variants:Ihe,defaultProps:Rhe}=Lv,Nhe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Hn.bg.reference,color:Hn.color.reference,boxShadow:Hn.shadow.reference},Phe={baseStyle:Nhe,variants:Ihe,defaultProps:Rhe},Ahe={w:"100%",mx:"auto",maxW:"prose",px:"4"},$he={baseStyle:Ahe},Dhe={opacity:.6,borderColor:"inherit"},Ohe={borderStyle:"solid"},Fhe={borderStyle:"dashed"},Lhe={solid:Ohe,dashed:Fhe},Mhe={baseStyle:Dhe,variants:Lhe,defaultProps:{variant:"solid"}},{definePartsStyle:Bhe,defineMultiStyleConfig:Uhe}=bn(wue.keys),Vhe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},zhe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Whe={pt:"2",px:"4",pb:"5"},jhe={fontSize:"1.25em"},Ghe=Bhe({container:Vhe,button:zhe,panel:Whe,icon:jhe}),Hhe=Uhe({baseStyle:Ghe}),{definePartsStyle:_0,defineMultiStyleConfig:qhe}=bn(Sue.keys),Lo=rt("alert-fg"),Dc=rt("alert-bg"),Khe=_0({container:{bg:Dc.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Lo.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Lo.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function XN(t){const{theme:e,colorScheme:n}=t,r=xm(`${n}.200`,.16)(e);return{light:`colors.${n}.100`,dark:r}}var Xhe=_0(t=>{const{colorScheme:e}=t,n=XN(t);return{container:{[Lo.variable]:`colors.${e}.500`,[Dc.variable]:n.light,_dark:{[Lo.variable]:`colors.${e}.200`,[Dc.variable]:n.dark}}}}),Jhe=_0(t=>{const{colorScheme:e}=t,n=XN(t);return{container:{[Lo.variable]:`colors.${e}.500`,[Dc.variable]:n.light,_dark:{[Lo.variable]:`colors.${e}.200`,[Dc.variable]:n.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Lo.reference}}}),Yhe=_0(t=>{const{colorScheme:e}=t,n=XN(t);return{container:{[Lo.variable]:`colors.${e}.500`,[Dc.variable]:n.light,_dark:{[Lo.variable]:`colors.${e}.200`,[Dc.variable]:n.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Lo.reference}}}),Qhe=_0(t=>{const{colorScheme:e}=t;return{container:{[Lo.variable]:"colors.white",[Dc.variable]:`colors.${e}.500`,_dark:{[Lo.variable]:"colors.gray.900",[Dc.variable]:`colors.${e}.200`},color:Lo.reference}}}),Zhe={subtle:Xhe,"left-accent":Jhe,"top-accent":Yhe,solid:Qhe},epe=qhe({baseStyle:Khe,variants:Zhe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),{definePartsStyle:_6,defineMultiStyleConfig:tpe}=bn(Cue.keys),Gp=rt("avatar-border-color"),Uv=rt("avatar-bg"),Iy=rt("avatar-font-size"),wm=rt("avatar-size"),npe={borderRadius:"full",border:"0.2em solid",borderColor:Gp.reference,[Gp.variable]:"white",_dark:{[Gp.variable]:"colors.gray.800"}},rpe={bg:Uv.reference,fontSize:Iy.reference,width:wm.reference,height:wm.reference,lineHeight:"1",[Uv.variable]:"colors.gray.200",_dark:{[Uv.variable]:"colors.whiteAlpha.400"}},ipe=t=>{const{name:e,theme:n}=t,r=e?dce({string:e}):"colors.gray.400",i=cce(r)(n);let o="white";return i||(o="gray.800"),{bg:Uv.reference,fontSize:Iy.reference,color:o,borderColor:Gp.reference,verticalAlign:"top",width:wm.reference,height:wm.reference,"&:not([data-loaded])":{[Uv.variable]:r},[Gp.variable]:"colors.white",_dark:{[Gp.variable]:"colors.gray.800"}}},ope={fontSize:Iy.reference,lineHeight:"1"},spe=_6(t=>({badge:Di(npe,t),excessLabel:Di(rpe,t),container:Di(ipe,t),label:ope}));function pl(t){const e=t!=="100%"?v6[t]:void 0;return _6({container:{[wm.variable]:e??t,[Iy.variable]:`calc(${e??t} / 2.5)`},excessLabel:{[wm.variable]:e??t,[Iy.variable]:`calc(${e??t} / 2.5)`}})}var ape={"2xs":pl(4),xs:pl(6),sm:pl(8),md:pl(12),lg:pl(16),xl:pl(24),"2xl":pl(32),full:pl("100%")},upe=tpe({baseStyle:spe,sizes:ape,defaultProps:{size:"md"}}),cpe={Accordion:Hhe,Alert:epe,Avatar:upe,Badge:Lv,Breadcrumb:lhe,Button:bhe,Checkbox:_w,CloseButton:_he,Code:Phe,Container:$he,Divider:Mhe,Drawer:Ofe,Editable:zfe,Form:Kfe,FormError:ehe,FormLabel:nhe,Heading:ohe,Input:Ht,Kbd:Tde,Link:_de,List:Ade,Menu:Wde,Modal:efe,NumberInput:cfe,PinInput:hfe,Popover:kfe,Progress:Ple,Radio:jle,Select:Yle,Skeleton:Zle,SkipLink:tde,Slider:fde,Spinner:mde,Stat:Cde,Switch:_ce,Table:Dce,Tabs:Xce,Tag:ule,Textarea:xle,Tooltip:Cle,Card:khe,Stepper:xue},lpe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},dpe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},fpe="ltr",hpe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},I6={semanticTokens:lpe,direction:fpe,...vue,components:cpe,styles:dpe,config:hpe};function mv(t){return typeof t=="function"}function ppe(...t){return e=>t.reduce((n,r)=>r(n),e)}var mpe=t=>function(...n){let r=[...n],i=n[n.length-1];return qae(i)&&r.length>1?r=r.slice(0,r.length-1):i=t,ppe(...r.map(o=>s=>mv(o)?o(s):vpe(s,o)))(i)},gpe=mpe(I6);function vpe(...t){return fs({},...t,R6)}function R6(t,e,n,r){if((mv(t)||mv(e))&&Object.prototype.hasOwnProperty.call(r,n))return(...i)=>{const o=mv(t)?t(...i):t,s=mv(e)?e(...i):e;return fs({},o,s,R6)}}function ype(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var bpe=ype();function xpe(t,e){const n={};return Object.keys(t).forEach(r=>{e.includes(r)||(n[r]=t[r])}),n}function wpe(t,e,n,r){const i=typeof e=="string"?e.split("."):[e];for(r=0;r<i.length&&t;r+=1)t=t[i[r]];return t===void 0?n:t}var Spe=t=>{const e=new WeakMap;return(r,i,o,s)=>{if(typeof r>"u")return t(r,i,o);e.has(r)||e.set(r,new Map);const a=e.get(r);if(a.has(i))return a.get(i);const u=t(r,i,o,s);return a.set(i,u),u}},N6=Spe(wpe);function P6(t,e){const n={};return Object.keys(t).forEach(r=>{const i=t[r];e(i,r,t)&&(n[r]=i)}),n}var A6=t=>P6(t,e=>e!=null);function Cpe(t){return typeof t=="function"}function $6(t,...e){return Cpe(t)?t(...e):t}function kpe(...t){return function(n){t.some(r=>(r==null||r(n),n==null?void 0:n.defaultPrevented))}}var Tpe=typeof Element<"u",Epe=typeof Map=="function",_pe=typeof Set=="function",Ipe=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ix(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Ix(t[r],e[r]))return!1;return!0}var o;if(Epe&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(o=t.entries();!(r=o.next()).done;)if(!e.has(r.value[0]))return!1;for(o=t.entries();!(r=o.next()).done;)if(!Ix(r.value[1],e.get(r.value[0])))return!1;return!0}if(_pe&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(o=t.entries();!(r=o.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(Ipe&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(Tpe&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Ix(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Rpe=function(e,n){try{return Ix(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const Npe=m0(Rpe);function D6(t,e={}){var n;const{styleConfig:r,...i}=e,{theme:o,colorMode:s}=Sse(),a=t?N6(o,`components.${t}`):void 0,u=r||a,c=fs({theme:o,colorMode:s},(n=u==null?void 0:u.defaultProps)!=null?n:{},A6(xpe(i,["children"]))),l=A.useRef({});if(u){const f=Gae(u)(c);Npe(l.current,f)||(l.current=f)}return l.current}function wd(t,e={}){return D6(t,e)}function Sd(t,e={}){return D6(t,e)}var Ppe=new Set([...$ae,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),Ape=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function $pe(t){return Ape.has(t)||!Ppe.has(t)}function Dpe(t,...e){if(t==null)throw new TypeError("Cannot convert undefined or null to object");const n={...t};for(const r of e)if(r!=null)for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&(i in n&&delete n[i],n[i]=r[i]);return n}function JN(t){const e=Object.assign({},t);for(let n in e)e[n]===void 0&&delete e[n];return e}var Ope=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Fpe=j5(function(t){return Ope.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),Lpe=Fpe,Mpe=function(e){return e!=="theme"},XM=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?Lpe:Mpe},JM=function(e,n,r){var i;if(n){var o=n.shouldForwardProp;i=e.__emotion_forwardProp&&o?function(s){return e.__emotion_forwardProp(s)&&o(s)}:o}return typeof i!="function"&&r&&(i=e.__emotion_forwardProp),i},Bpe=function(e){var n=e.cache,r=e.serialized,i=e.isStringTag;return J5(n,r,i),Zoe(function(){return Y5(n,r,i)}),null},Upe=function t(e,n){var r=e.__emotion_real===e,i=r&&e.__emotion_base||e,o,s;n!==void 0&&(o=n.label,s=n.target);var a=JM(e,n,r),u=a||XM(i),c=!u("as");return function(){var l=arguments,d=r&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(o!==void 0&&d.push("label:"+o+";"),l[0]==null||l[0].raw===void 0)d.push.apply(d,l);else{d.push(l[0][0]);for(var f=l.length,h=1;h<f;h++)d.push(l[h],l[0][h])}var p=t6(function(m,v,g){var y=c&&m.as||i,b="",x=[],S=m;if(m.theme==null){S={};for(var C in m)S[C]=m[C];S.theme=A.useContext(ky)}typeof m.className=="string"?b=Hoe(v.registered,x,m.className):m.className!=null&&(b=m.className+" ");var T=MN(d.concat(x),v.registered,S);b+=v.key+"-"+T.name,s!==void 0&&(b+=" "+s);var E=c&&a===void 0?XM(y):u,I={};for(var N in m)c&&N==="as"||E(N)&&(I[N]=m[N]);return I.className=b,I.ref=g,A.createElement(A.Fragment,null,A.createElement(Bpe,{cache:v,serialized:T,isStringTag:typeof y=="string"}),A.createElement(y,I))});return p.displayName=o!==void 0?o:"Styled("+(typeof i=="string"?i:i.displayName||i.name||"Component")+")",p.defaultProps=e.defaultProps,p.__emotion_real=p,p.__emotion_base=i,p.__emotion_styles=d,p.__emotion_forwardProp=a,Object.defineProperty(p,"toString",{value:function(){return"."+s}}),p.withComponent=function(m,v){return t(m,Mf({},n,v,{shouldForwardProp:JM(p,v,!0)})).apply(void 0,d)},p}},Vpe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Rw=Upe.bind();Vpe.forEach(function(t){Rw[t]=Rw(t)});var YM,zpe=(YM=Rw.default)!=null?YM:Rw,Wpe=({baseStyle:t})=>e=>{const{theme:n,css:r,__css:i,sx:o,...s}=e,a=P6(s,(d,f)=>Oae(f)),u=$6(t,e),c=Dpe({},i,u,A6(a),o),l=p6(c)(e.theme);return r?[l,r]:l};function Hk(t,e){const{baseStyle:n,...r}=e??{};r.shouldForwardProp||(r.shouldForwardProp=$pe);const i=Wpe({baseStyle:n}),o=zpe(t,r)(i);return Do.forwardRef(function(u,c){const{colorMode:l,forced:d}=VN();return Do.createElement(o,{ref:c,"data-theme":d?l:void 0,...u})})}function jpe(){const t=new Map;return new Proxy(Hk,{apply(e,n,r){return Hk(...r)},get(e,n){return t.has(n)||t.set(n,Hk(n)),t.get(n)}})}var ft=jpe();function wt(t){return A.forwardRef(t)}function O6(t={}){const{strict:e=!0,errorMessage:n="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:r}=t,i=A.createContext(void 0);i.displayName=r;function o(){var s;const a=A.useContext(i);if(!a&&e){const u=new Error(n);throw u.name="ContextError",(s=Error.captureStackTrace)==null||s.call(Error,u,o),u}return a}return[i.Provider,o,i]}function Gpe(t){const{cssVarsRoot:e,theme:n,children:r}=t,i=A.useMemo(()=>Nae(n),[n]);return P.jsxs(nse,{theme:i,children:[P.jsx(Hpe,{root:e}),r]})}function Hpe({root:t=":host, :root"}){const e=[t,"[data-theme]"].join(",");return P.jsx(xC,{styles:n=>({[e]:n.__cssVars})})}O6({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function qpe(t){return O6({name:`${t}StylesContext`,errorMessage:`useStyles: "styles" is undefined. Seems you forgot to wrap the components in "<${t} />" `})}function Kpe(){const{colorMode:t}=VN();return P.jsx(xC,{styles:e=>{const n=N6(e,"styles.global"),r=$6(n,{theme:e,colorMode:t});return r?p6(r)(e):void 0}})}var F6=A.createContext({getDocument(){return document},getWindow(){return window}});F6.displayName="EnvironmentContext";function L6(t){const{children:e,environment:n,disabled:r}=t,i=A.useRef(null),o=A.useMemo(()=>n||{getDocument:()=>{var a,u;return(u=(a=i.current)==null?void 0:a.ownerDocument)!=null?u:document},getWindow:()=>{var a,u;return(u=(a=i.current)==null?void 0:a.ownerDocument.defaultView)!=null?u:window}},[n]),s=!r||!n;return P.jsxs(F6.Provider,{value:o,children:[e,s&&P.jsx("span",{id:"__chakra_env",hidden:!0,ref:i})]})}L6.displayName="EnvironmentProvider";var Xpe=t=>{const{children:e,colorModeManager:n,portalZIndex:r,resetScope:i,resetCSS:o=!0,theme:s={},environment:a,cssVarsRoot:u,disableEnvironment:c,disableGlobalStyle:l}=t,d=P.jsx(L6,{environment:a,disabled:c,children:e});return P.jsx(Gpe,{theme:s,cssVarsRoot:u,children:P.jsxs(a6,{colorModeManager:n,options:s.config,children:[o?P.jsx(ose,{scope:i}):P.jsx(ise,{}),!l&&P.jsx(Kpe,{}),r?P.jsx(i6,{zIndex:r,children:d}):d]})})},Jpe=(t,e)=>t.find(n=>n.id===e);function QM(t,e){const n=M6(t,e),r=n?t[n].findIndex(i=>i.id===e):-1;return{position:n,index:r}}function M6(t,e){for(const[n,r]of Object.entries(t))if(Jpe(r,e))return n}function Ype(t){const e=t.includes("right"),n=t.includes("left");let r="center";return e&&(r="flex-end"),n&&(r="flex-start"),{display:"flex",flexDirection:"column",alignItems:r}}function Qpe(t){const n=t==="top"||t==="bottom"?"0 auto":void 0,r=t.includes("top")?"env(safe-area-inset-top, 0px)":void 0,i=t.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,o=t.includes("left")?void 0:"env(safe-area-inset-right, 0px)",s=t.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:n,top:r,bottom:i,right:o,left:s}}function Zpe(t,e=[]){const n=A.useRef(t);return A.useEffect(()=>{n.current=t}),A.useCallback((...r)=>{var i;return(i=n.current)==null?void 0:i.call(n,...r)},e)}function eme(t,e){const n=Zpe(t);A.useEffect(()=>{if(e==null)return;let r=null;return r=window.setTimeout(()=>{n()},e),()=>{r&&window.clearTimeout(r)}},[e,n])}function ZM(t,e){const n=A.useRef(!1),r=A.useRef(!1);A.useEffect(()=>{if(n.current&&r.current)return t();r.current=!0},e),A.useEffect(()=>(n.current=!0,()=>{n.current=!1}),[])}const B6=A.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),TC=A.createContext({}),I0=A.createContext(null),EC=typeof document<"u",YN=EC?A.useLayoutEffect:A.useEffect,U6=A.createContext({strict:!1});function tme(t,e,n,r){const{visualElement:i}=A.useContext(TC),o=A.useContext(U6),s=A.useContext(I0),a=A.useContext(B6).reducedMotion,u=A.useRef();r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:a}));const c=u.current;A.useInsertionEffect(()=>{c&&c.update(n,s)});const l=A.useRef(!!window.HandoffAppearAnimations);return YN(()=>{c&&(c.render(),l.current&&c.animationState&&c.animationState.animateChanges())}),A.useEffect(()=>{c&&(c.updateFeatures(),!l.current&&c.animationState&&c.animationState.animateChanges(),window.HandoffAppearAnimations=void 0,l.current=!1)}),c}function _p(t){return typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function nme(t,e,n){return A.useCallback(r=>{r&&t.mount&&t.mount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):_p(n)&&(n.current=r))},[e])}function Ry(t){return typeof t=="string"||Array.isArray(t)}function _C(t){return typeof t=="object"&&typeof t.start=="function"}const QN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ZN=["initial",...QN];function IC(t){return _C(t.animate)||ZN.some(e=>Ry(t[e]))}function V6(t){return!!(IC(t)||t.variants)}function rme(t,e){if(IC(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Ry(n)?n:void 0,animate:Ry(r)?r:void 0}}return t.inherit!==!1?e:{}}function ime(t){const{initial:e,animate:n}=rme(t,A.useContext(TC));return A.useMemo(()=>({initial:e,animate:n}),[e4(e),e4(n)])}function e4(t){return Array.isArray(t)?t.join(" "):t}const t4={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ny={};for(const t in t4)Ny[t]={isEnabled:e=>t4[t].some(n=>!!e[n])};function ome(t){for(const e in t)Ny[e]={...Ny[e],...t[e]}}const eP=A.createContext({}),z6=A.createContext({}),sme=Symbol.for("motionComponentSymbol");function ame({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:r,Component:i}){t&&ome(t);function o(a,u){let c;const l={...A.useContext(B6),...a,layoutId:ume(a)},{isStatic:d}=l,f=ime(a),h=r(a,d);if(!d&&EC){f.visualElement=tme(i,h,l,e);const p=A.useContext(z6),m=A.useContext(U6).strict;f.visualElement&&(c=f.visualElement.loadFeatures(l,m,t,p))}return A.createElement(TC.Provider,{value:f},c&&f.visualElement?A.createElement(c,{visualElement:f.visualElement,...l}):null,n(i,a,nme(h,f.visualElement,u),h,d,f.visualElement))}const s=A.forwardRef(o);return s[sme]=i,s}function ume({layoutId:t}){const e=A.useContext(eP).id;return e&&t!==void 0?e+"-"+t:t}function cme(t){function e(r,i={}){return ame(t(r,i))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(r,i)=>(n.has(i)||n.set(i,e(i)),n.get(i))})}const lme=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tP(t){return typeof t!="string"||t.includes("-")?!1:!!(lme.indexOf(t)>-1||/[A-Z]/.test(t))}const Nw={};function dme(t){Object.assign(Nw,t)}const R0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ah=new Set(R0);function W6(t,{layout:e,layoutId:n}){return ah.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!Nw[t]||t==="opacity")}const fo=t=>!!(t&&t.getVelocity),fme={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},hme=R0.length;function pme(t,{enableHardwareAcceleration:e=!0,allowTransformNone:n=!0},r,i){let o="";for(let s=0;s<hme;s++){const a=R0[s];if(t[a]!==void 0){const u=fme[a]||a;o+=`${u}(${t[a]}) `}}return e&&!t.z&&(o+="translateZ(0)"),o=o.trim(),i?o=i(t,r?"":o):n&&r&&(o="none"),o}const j6=t=>e=>typeof e=="string"&&e.startsWith(t),G6=j6("--"),R_=j6("var(--"),mme=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,gme=(t,e)=>e&&typeof t=="number"?e.transform(t):t,ad=(t,e,n)=>Math.min(Math.max(n,t),e),uh={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Vv={...uh,transform:t=>ad(0,1,t)},l1={...uh,default:1},zv=t=>Math.round(t*1e5)/1e5,RC=/(-)?([\d]*\.?[\d])+/g,H6=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,vme=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function N0(t){return typeof t=="string"}const P0=t=>({test:e=>N0(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),yl=P0("deg"),iu=P0("%"),at=P0("px"),yme=P0("vh"),bme=P0("vw"),n4={...iu,parse:t=>iu.parse(t)/100,transform:t=>iu.transform(t*100)},r4={...uh,transform:Math.round},q6={borderWidth:at,borderTopWidth:at,borderRightWidth:at,borderBottomWidth:at,borderLeftWidth:at,borderRadius:at,radius:at,borderTopLeftRadius:at,borderTopRightRadius:at,borderBottomRightRadius:at,borderBottomLeftRadius:at,width:at,maxWidth:at,height:at,maxHeight:at,size:at,top:at,right:at,bottom:at,left:at,padding:at,paddingTop:at,paddingRight:at,paddingBottom:at,paddingLeft:at,margin:at,marginTop:at,marginRight:at,marginBottom:at,marginLeft:at,rotate:yl,rotateX:yl,rotateY:yl,rotateZ:yl,scale:l1,scaleX:l1,scaleY:l1,scaleZ:l1,skew:yl,skewX:yl,skewY:yl,distance:at,translateX:at,translateY:at,translateZ:at,x:at,y:at,z:at,perspective:at,transformPerspective:at,opacity:Vv,originX:n4,originY:n4,originZ:at,zIndex:r4,fillOpacity:Vv,strokeOpacity:Vv,numOctaves:r4};function nP(t,e,n,r){const{style:i,vars:o,transform:s,transformOrigin:a}=t;let u=!1,c=!1,l=!0;for(const d in e){const f=e[d];if(G6(d)){o[d]=f;continue}const h=q6[d],p=gme(f,h);if(ah.has(d)){if(u=!0,s[d]=p,!l)continue;f!==(h.default||0)&&(l=!1)}else d.startsWith("origin")?(c=!0,a[d]=p):i[d]=p}if(e.transform||(u||r?i.transform=pme(t.transform,n,l,r):i.transform&&(i.transform="none")),c){const{originX:d="50%",originY:f="50%",originZ:h=0}=a;i.transformOrigin=`${d} ${f} ${h}`}}const rP=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function K6(t,e,n){for(const r in e)!fo(e[r])&&!W6(r,n)&&(t[r]=e[r])}function xme({transformTemplate:t},e,n){return A.useMemo(()=>{const r=rP();return nP(r,e,{enableHardwareAcceleration:!n},t),Object.assign({},r.vars,r.style)},[e])}function wme(t,e,n){const r=t.style||{},i={};return K6(i,r,t),Object.assign(i,xme(t,e,n)),t.transformValues?t.transformValues(i):i}function Sme(t,e,n){const r={},i=wme(t,e,n);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=i,r}const Cme=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","ignoreStrict","viewport"]);function Pw(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||Cme.has(t)}let X6=t=>!Pw(t);function kme(t){t&&(X6=e=>e.startsWith("on")?!Pw(e):t(e))}try{kme(require("@emotion/is-prop-valid").default)}catch{}function Tme(t,e,n){const r={};for(const i in t)i==="values"&&typeof t.values=="object"||(X6(i)||n===!0&&Pw(i)||!e&&!Pw(i)||t.draggable&&i.startsWith("onDrag"))&&(r[i]=t[i]);return r}function i4(t,e,n){return typeof t=="string"?t:at.transform(e+n*t)}function Eme(t,e,n){const r=i4(e,t.x,t.width),i=i4(n,t.y,t.height);return`${r} ${i}`}const _me={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ime={offset:"strokeDashoffset",array:"strokeDasharray"};function Rme(t,e,n=1,r=0,i=!0){t.pathLength=1;const o=i?_me:Ime;t[o.offset]=at.transform(-r);const s=at.transform(e),a=at.transform(n);t[o.array]=`${s} ${a}`}function iP(t,{attrX:e,attrY:n,attrScale:r,originX:i,originY:o,pathLength:s,pathSpacing:a=1,pathOffset:u=0,...c},l,d,f){if(nP(t,c,l,f),d){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:p,dimensions:m}=t;h.transform&&(m&&(p.transform=h.transform),delete h.transform),m&&(i!==void 0||o!==void 0||p.transform)&&(p.transformOrigin=Eme(m,i!==void 0?i:.5,o!==void 0?o:.5)),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),r!==void 0&&(h.scale=r),s!==void 0&&Rme(h,s,a,u,!1)}const J6=()=>({...rP(),attrs:{}}),oP=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Nme(t,e,n,r){const i=A.useMemo(()=>{const o=J6();return iP(o,e,{enableHardwareAcceleration:!1},oP(r),t.transformTemplate),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};K6(o,t.style,t),i.style={...o,...i.style}}return i}function Pme(t=!1){return(n,r,i,{latestValues:o},s)=>{const u=(tP(n)?Nme:Sme)(r,o,s,n),l={...Tme(r,typeof n=="string",t),...u,ref:i},{children:d}=r,f=A.useMemo(()=>fo(d)?d.get():d,[d]);return A.createElement(n,{...l,children:f})}}const sP=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();function Y6(t,{style:e,vars:n},r,i){Object.assign(t.style,e,i&&i.getProjectionStyles(r));for(const o in n)t.style.setProperty(o,n[o])}const Q6=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Z6(t,e,n,r){Y6(t,e,void 0,r);for(const i in e.attrs)t.setAttribute(Q6.has(i)?i:sP(i),e.attrs[i])}function aP(t,e){const{style:n}=t,r={};for(const i in n)(fo(n[i])||e.style&&fo(e.style[i])||W6(i,t))&&(r[i]=n[i]);return r}function eG(t,e){const n=aP(t,e);for(const r in t)if(fo(t[r])||fo(e[r])){const i=R0.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[i]=t[r]}return n}function uP(t,e,n,r={},i={}){return typeof e=="function"&&(e=e(n!==void 0?n:t.custom,r,i)),typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"&&(e=e(n!==void 0?n:t.custom,r,i)),e}function tG(t){const e=A.useRef(null);return e.current===null&&(e.current=t()),e.current}const Aw=t=>Array.isArray(t),Ame=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),$me=t=>Aw(t)?t[t.length-1]||0:t;function Rx(t){const e=fo(t)?t.get():t;return Ame(e)?e.toValue():e}function Dme({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},r,i,o){const s={latestValues:Ome(r,i,o,t),renderState:e()};return n&&(s.mount=a=>n(r,a,s)),s}const nG=t=>(e,n)=>{const r=A.useContext(TC),i=A.useContext(I0),o=()=>Dme(t,e,r,i);return n?o():tG(o)};function Ome(t,e,n,r){const i={},o=r(t,{});for(const f in o)i[f]=Rx(o[f]);let{initial:s,animate:a}=t;const u=IC(t),c=V6(t);e&&c&&!u&&t.inherit!==!1&&(s===void 0&&(s=e.initial),a===void 0&&(a=e.animate));let l=n?n.initial===!1:!1;l=l||s===!1;const d=l?a:s;return d&&typeof d!="boolean"&&!_C(d)&&(Array.isArray(d)?d:[d]).forEach(h=>{const p=uP(t,h);if(!p)return;const{transitionEnd:m,transition:v,...g}=p;for(const y in g){let b=g[y];if(Array.isArray(b)){const x=l?b.length-1:0;b=b[x]}b!==null&&(i[y]=b)}for(const y in m)i[y]=m[y]}),i}const Un=t=>t;function Fme(t){let e=[],n=[],r=0,i=!1,o=!1;const s=new WeakSet,a={schedule:(u,c=!1,l=!1)=>{const d=l&&i,f=d?e:n;return c&&s.add(u),f.indexOf(u)===-1&&(f.push(u),d&&i&&(r=e.length)),u},cancel:u=>{const c=n.indexOf(u);c!==-1&&n.splice(c,1),s.delete(u)},process:u=>{if(i){o=!0;return}if(i=!0,[e,n]=[n,e],n.length=0,r=e.length,r)for(let c=0;c<r;c++){const l=e[c];l(u),s.has(l)&&(a.schedule(l),t())}i=!1,o&&(o=!1,a.process(u))}};return a}const d1=["prepare","read","update","preRender","render","postRender"],Lme=40;function Mme(t,e){let n=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=d1.reduce((d,f)=>(d[f]=Fme(()=>n=!0),d),{}),s=d=>o[d].process(i),a=()=>{const d=performance.now();n=!1,i.delta=r?1e3/60:Math.max(Math.min(d-i.timestamp,Lme),1),i.timestamp=d,i.isProcessing=!0,d1.forEach(s),i.isProcessing=!1,n&&e&&(r=!1,t(a))},u=()=>{n=!0,r=!0,i.isProcessing||t(a)};return{schedule:d1.reduce((d,f)=>{const h=o[f];return d[f]=(p,m=!1,v=!1)=>(n||u(),h.schedule(p,m,v)),d},{}),cancel:d=>d1.forEach(f=>o[f].cancel(d)),state:i,steps:o}}const{schedule:pn,cancel:Oc,state:Yr,steps:qk}=Mme(typeof requestAnimationFrame<"u"?requestAnimationFrame:Un,!0),Bme={useVisualState:nG({scrapeMotionValuesFromProps:eG,createRenderState:J6,onMount:(t,e,{renderState:n,latestValues:r})=>{pn.read(()=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),pn.render(()=>{iP(n,r,{enableHardwareAcceleration:!1},oP(e.tagName),t.transformTemplate),Z6(e,n)})}})},Ume={useVisualState:nG({scrapeMotionValuesFromProps:aP,createRenderState:rP})};function Vme(t,{forwardMotionProps:e=!1},n,r){return{...tP(t)?Bme:Ume,preloadedFeatures:n,useRender:Pme(e),createVisualElement:r,Component:t}}function Ku(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}const rG=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function NC(t,e="page"){return{point:{x:t[e+"X"],y:t[e+"Y"]}}}const zme=t=>e=>rG(e)&&t(e,NC(e));function Cc(t,e,n,r){return Ku(t,e,zme(n),r)}const Wme=(t,e)=>n=>e(t(n)),Jl=(...t)=>t.reduce(Wme);function iG(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const o4=iG("dragHorizontal"),s4=iG("dragVertical");function oG(t){let e=!1;if(t==="y")e=s4();else if(t==="x")e=o4();else{const n=o4(),r=s4();n&&r?e=()=>{n(),r()}:(n&&n(),r&&r())}return e}function sG(){const t=oG(!0);return t?(t(),!1):!0}class Cd{constructor(e){this.isMounted=!1,this.node=e}update(){}}function a4(t,e){const n="pointer"+(e?"enter":"leave"),r="onHover"+(e?"Start":"End"),i=(o,s)=>{if(o.type==="touch"||sG())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e),a[r]&&pn.update(()=>a[r](o,s))};return Cc(t.current,n,i,{passive:!t.getProps()[r]})}class jme extends Cd{mount(){this.unmount=Jl(a4(this.node,!0),a4(this.node,!1))}unmount(){}}class Gme extends Cd{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Jl(Ku(this.node.current,"focus",()=>this.onFocus()),Ku(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const aG=(t,e)=>e?t===e?!0:aG(t,e.parentElement):!1;function Kk(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,NC(n))}class Hme extends Cd{constructor(){super(...arguments),this.removeStartListeners=Un,this.removeEndListeners=Un,this.removeAccessibleListeners=Un,this.startPointerPress=(e,n)=>{if(this.removeEndListeners(),this.isPressing)return;const r=this.node.getProps(),o=Cc(window,"pointerup",(a,u)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:l}=this.node.getProps();pn.update(()=>{aG(this.node.current,a.target)?c&&c(a,u):l&&l(a,u)})},{passive:!(r.onTap||r.onPointerUp)}),s=Cc(window,"pointercancel",(a,u)=>this.cancelPress(a,u),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=Jl(o,s),this.startPress(e,n)},this.startAccessiblePress=()=>{const e=o=>{if(o.key!=="Enter"||this.isPressing)return;const s=a=>{a.key!=="Enter"||!this.checkPressEnd()||Kk("up",(u,c)=>{const{onTap:l}=this.node.getProps();l&&pn.update(()=>l(u,c))})};this.removeEndListeners(),this.removeEndListeners=Ku(this.node.current,"keyup",s),Kk("down",(a,u)=>{this.startPress(a,u)})},n=Ku(this.node.current,"keydown",e),r=()=>{this.isPressing&&Kk("cancel",(o,s)=>this.cancelPress(o,s))},i=Ku(this.node.current,"blur",r);this.removeAccessibleListeners=Jl(n,i)}}startPress(e,n){this.isPressing=!0;const{onTapStart:r,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&pn.update(()=>r(e,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!sG()}cancelPress(e,n){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&pn.update(()=>r(e,n))}mount(){const e=this.node.getProps(),n=Cc(this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),r=Ku(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Jl(n,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const N_=new WeakMap,Xk=new WeakMap,qme=t=>{const e=N_.get(t.target);e&&e(t)},Kme=t=>{t.forEach(qme)};function Xme({root:t,...e}){const n=t||document;Xk.has(n)||Xk.set(n,{});const r=Xk.get(n),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(Kme,{root:t,...e})),r[i]}function Jme(t,e,n){const r=Xme(e);return N_.set(t,n),r.observe(t),()=>{N_.delete(t),r.unobserve(t)}}const Yme={some:0,all:1};class Qme extends Cd{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:i="some",once:o}=e,s={root:n?n.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:Yme[i]},a=u=>{const{isIntersecting:c}=u;if(this.isInView===c||(this.isInView=c,o&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:l,onViewportLeave:d}=this.node.getProps(),f=c?l:d;f&&f(u)};return Jme(this.node.current,s,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(Zme(e,n))&&this.startObserver()}unmount(){}}function Zme({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const ege={inView:{Feature:Qme},tap:{Feature:Hme},focus:{Feature:Gme},hover:{Feature:jme}};function uG(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function tge(t){const e={};return t.values.forEach((n,r)=>e[r]=n.get()),e}function nge(t){const e={};return t.values.forEach((n,r)=>e[r]=n.getVelocity()),e}function PC(t,e,n){const r=t.getProps();return uP(r,e,n!==void 0?n:r.custom,tge(t),nge(t))}const rge="framerAppearId",ige="data-"+sP(rge);let oge=Un,cP=Un;const Yl=t=>t*1e3,kc=t=>t/1e3,sge={current:!1},cG=t=>Array.isArray(t)&&typeof t[0]=="number";function lG(t){return!!(!t||typeof t=="string"&&dG[t]||cG(t)||Array.isArray(t)&&t.every(lG))}const gv=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,dG={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:gv([0,.65,.55,1]),circOut:gv([.55,0,1,.45]),backIn:gv([.31,.01,.66,-.59]),backOut:gv([.33,1.53,.69,.99])};function fG(t){if(t)return cG(t)?gv(t):Array.isArray(t)?t.map(fG):dG[t]}function age(t,e,n,{delay:r=0,duration:i,repeat:o=0,repeatType:s="loop",ease:a,times:u}={}){const c={[e]:n};u&&(c.offset=u);const l=fG(a);return Array.isArray(l)&&(c.easing=l),t.animate(c,{delay:r,duration:i,easing:Array.isArray(l)?"linear":l,fill:"both",iterations:o+1,direction:s==="reverse"?"alternate":"normal"})}function uge(t,{repeat:e,repeatType:n="loop"}){const r=e&&n!=="loop"&&e%2===1?0:t.length-1;return t[r]}const hG=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,cge=1e-7,lge=12;function dge(t,e,n,r,i){let o,s,a=0;do s=e+(n-e)/2,o=hG(s,r,i)-t,o>0?n=s:e=s;while(Math.abs(o)>cge&&++a<lge);return s}function A0(t,e,n,r){if(t===e&&n===r)return Un;const i=o=>dge(o,0,1,t,n);return o=>o===0||o===1?o:hG(i(o),e,r)}const fge=A0(.42,0,1,1),hge=A0(0,0,.58,1),pG=A0(.42,0,.58,1),pge=t=>Array.isArray(t)&&typeof t[0]!="number",mG=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,gG=t=>e=>1-t(1-e),vG=t=>1-Math.sin(Math.acos(t)),lP=gG(vG),mge=mG(lP),yG=A0(.33,1.53,.69,.99),dP=gG(yG),gge=mG(dP),vge=t=>(t*=2)<1?.5*dP(t):.5*(2-Math.pow(2,-10*(t-1))),yge={linear:Un,easeIn:fge,easeInOut:pG,easeOut:hge,circIn:vG,circInOut:mge,circOut:lP,backIn:dP,backInOut:gge,backOut:yG,anticipate:vge},u4=t=>{if(Array.isArray(t)){cP(t.length===4);const[e,n,r,i]=t;return A0(e,n,r,i)}else if(typeof t=="string")return yge[t];return t},fP=(t,e)=>n=>!!(N0(n)&&vme.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),bG=(t,e,n)=>r=>{if(!N0(r))return r;const[i,o,s,a]=r.match(RC);return{[t]:parseFloat(i),[e]:parseFloat(o),[n]:parseFloat(s),alpha:a!==void 0?parseFloat(a):1}},bge=t=>ad(0,255,t),Jk={...uh,transform:t=>Math.round(bge(t))},ff={test:fP("rgb","red"),parse:bG("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+Jk.transform(t)+", "+Jk.transform(e)+", "+Jk.transform(n)+", "+zv(Vv.transform(r))+")"};function xge(t){let e="",n="",r="",i="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),i=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),i=t.substring(4,5),e+=e,n+=n,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const P_={test:fP("#"),parse:xge,transform:ff.transform},Ip={test:fP("hsl","hue"),parse:bG("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+iu.transform(zv(e))+", "+iu.transform(zv(n))+", "+zv(Vv.transform(r))+")"},Ci={test:t=>ff.test(t)||P_.test(t)||Ip.test(t),parse:t=>ff.test(t)?ff.parse(t):Ip.test(t)?Ip.parse(t):P_.parse(t),transform:t=>N0(t)?t:t.hasOwnProperty("red")?ff.transform(t):Ip.transform(t)},Pn=(t,e,n)=>-n*t+n*e+t;function Yk(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function wge({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let i=0,o=0,s=0;if(!e)i=o=s=n;else{const a=n<.5?n*(1+e):n+e-n*e,u=2*n-a;i=Yk(u,a,t+1/3),o=Yk(u,a,t),s=Yk(u,a,t-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(s*255),alpha:r}}const Qk=(t,e,n)=>{const r=t*t;return Math.sqrt(Math.max(0,n*(e*e-r)+r))},Sge=[P_,ff,Ip],Cge=t=>Sge.find(e=>e.test(t));function c4(t){const e=Cge(t);let n=e.parse(t);return e===Ip&&(n=wge(n)),n}const xG=(t,e)=>{const n=c4(t),r=c4(e),i={...n};return o=>(i.red=Qk(n.red,r.red,o),i.green=Qk(n.green,r.green,o),i.blue=Qk(n.blue,r.blue,o),i.alpha=Pn(n.alpha,r.alpha,o),ff.transform(i))};function kge(t){var e,n;return isNaN(t)&&N0(t)&&(((e=t.match(RC))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(H6))===null||n===void 0?void 0:n.length)||0)>0}const wG={regex:mme,countKey:"Vars",token:"${v}",parse:Un},SG={regex:H6,countKey:"Colors",token:"${c}",parse:Ci.parse},CG={regex:RC,countKey:"Numbers",token:"${n}",parse:uh.parse};function Zk(t,{regex:e,countKey:n,token:r,parse:i}){const o=t.tokenised.match(e);o&&(t["num"+n]=o.length,t.tokenised=t.tokenised.replace(e,r),t.values.push(...o.map(i)))}function $w(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&Zk(n,wG),Zk(n,SG),Zk(n,CG),n}function kG(t){return $w(t).values}function TG(t){const{values:e,numColors:n,numVars:r,tokenised:i}=$w(t),o=e.length;return s=>{let a=i;for(let u=0;u<o;u++)u<r?a=a.replace(wG.token,s[u]):u<r+n?a=a.replace(SG.token,Ci.transform(s[u])):a=a.replace(CG.token,zv(s[u]));return a}}const Tge=t=>typeof t=="number"?0:t;function Ege(t){const e=kG(t);return TG(t)(e.map(Tge))}const ud={test:kge,parse:kG,createTransformer:TG,getAnimatableNone:Ege},EG=(t,e)=>n=>`${n>0?e:t}`;function _G(t,e){return typeof t=="number"?n=>Pn(t,e,n):Ci.test(t)?xG(t,e):t.startsWith("var(")?EG(t,e):RG(t,e)}const IG=(t,e)=>{const n=[...t],r=n.length,i=t.map((o,s)=>_G(o,e[s]));return o=>{for(let s=0;s<r;s++)n[s]=i[s](o);return n}},_ge=(t,e)=>{const n={...t,...e},r={};for(const i in n)t[i]!==void 0&&e[i]!==void 0&&(r[i]=_G(t[i],e[i]));return i=>{for(const o in r)n[o]=r[o](i);return n}},RG=(t,e)=>{const n=ud.createTransformer(e),r=$w(t),i=$w(e);return r.numVars===i.numVars&&r.numColors===i.numColors&&r.numNumbers>=i.numNumbers?Jl(IG(r.values,i.values),n):EG(t,e)},Py=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r},l4=(t,e)=>n=>Pn(t,e,n);function Ige(t){return typeof t=="number"?l4:typeof t=="string"?Ci.test(t)?xG:RG:Array.isArray(t)?IG:typeof t=="object"?_ge:l4}function Rge(t,e,n){const r=[],i=n||Ige(t[0]),o=t.length-1;for(let s=0;s<o;s++){let a=i(t[s],t[s+1]);if(e){const u=Array.isArray(e)?e[s]||Un:e;a=Jl(u,a)}r.push(a)}return r}function NG(t,e,{clamp:n=!0,ease:r,mixer:i}={}){const o=t.length;if(cP(o===e.length),o===1)return()=>e[0];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const s=Rge(e,r,i),a=s.length,u=c=>{let l=0;if(a>1)for(;l<t.length-2&&!(c<t[l+1]);l++);const d=Py(t[l],t[l+1],c);return s[l](d)};return n?c=>u(ad(t[0],t[o-1],c)):u}function Nge(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const i=Py(0,e,r);t.push(Pn(n,1,i))}}function Pge(t){const e=[0];return Nge(e,t.length-1),e}function Age(t,e){return t.map(n=>n*e)}function $ge(t,e){return t.map(()=>e||pG).splice(0,t.length-1)}function Dw({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const i=pge(r)?r.map(u4):u4(r),o={done:!1,value:e[0]},s=Age(n&&n.length===e.length?n:Pge(e),t),a=NG(s,e,{ease:Array.isArray(i)?i:$ge(e,i)});return{calculatedDuration:t,next:u=>(o.value=a(u),o.done=u>=t,o)}}function PG(t,e){return e?t*(1e3/e):0}const Dge=5;function AG(t,e,n){const r=Math.max(e-Dge,0);return PG(n-t(r),e-r)}const eT=.001,Oge=.01,d4=10,Fge=.05,Lge=1;function Mge({duration:t=800,bounce:e=.25,velocity:n=0,mass:r=1}){let i,o;oge(t<=Yl(d4));let s=1-e;s=ad(Fge,Lge,s),t=ad(Oge,d4,kc(t)),s<1?(i=c=>{const l=c*s,d=l*t,f=l-n,h=A_(c,s),p=Math.exp(-d);return eT-f/h*p},o=c=>{const d=c*s*t,f=d*n+n,h=Math.pow(s,2)*Math.pow(c,2)*t,p=Math.exp(-d),m=A_(Math.pow(c,2),s);return(-i(c)+eT>0?-1:1)*((f-h)*p)/m}):(i=c=>{const l=Math.exp(-c*t),d=(c-n)*t+1;return-eT+l*d},o=c=>{const l=Math.exp(-c*t),d=(n-c)*(t*t);return l*d});const a=5/t,u=Uge(i,o,a);if(t=Yl(t),isNaN(u))return{stiffness:100,damping:10,duration:t};{const c=Math.pow(u,2)*r;return{stiffness:c,damping:s*2*Math.sqrt(r*c),duration:t}}}const Bge=12;function Uge(t,e,n){let r=n;for(let i=1;i<Bge;i++)r=r-t(r)/e(r);return r}function A_(t,e){return t*Math.sqrt(1-e*e)}const Vge=["duration","bounce"],zge=["stiffness","damping","mass"];function f4(t,e){return e.some(n=>t[n]!==void 0)}function Wge(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!f4(t,zge)&&f4(t,Vge)){const n=Mge(t);e={...e,...n,velocity:0,mass:1},e.isResolvedFromDuration=!0}return e}function $G({keyframes:t,restDelta:e,restSpeed:n,...r}){const i=t[0],o=t[t.length-1],s={done:!1,value:i},{stiffness:a,damping:u,mass:c,velocity:l,duration:d,isResolvedFromDuration:f}=Wge(r),h=l?-kc(l):0,p=u/(2*Math.sqrt(a*c)),m=o-i,v=kc(Math.sqrt(a/c)),g=Math.abs(m)<5;n||(n=g?.01:2),e||(e=g?.005:.5);let y;if(p<1){const b=A_(v,p);y=x=>{const S=Math.exp(-p*v*x);return o-S*((h+p*v*m)/b*Math.sin(b*x)+m*Math.cos(b*x))}}else if(p===1)y=b=>o-Math.exp(-v*b)*(m+(h+v*m)*b);else{const b=v*Math.sqrt(p*p-1);y=x=>{const S=Math.exp(-p*v*x),C=Math.min(b*x,300);return o-S*((h+p*v*m)*Math.sinh(C)+b*m*Math.cosh(C))/b}}return{calculatedDuration:f&&d||null,next:b=>{const x=y(b);if(f)s.done=b>=d;else{let S=h;b!==0&&(p<1?S=AG(y,b,x):S=0);const C=Math.abs(S)<=n,T=Math.abs(o-x)<=e;s.done=C&&T}return s.value=s.done?o:x,s}}}function h4({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:s,min:a,max:u,restDelta:c=.5,restSpeed:l}){const d=t[0],f={done:!1,value:d},h=E=>a!==void 0&&E<a||u!==void 0&&E>u,p=E=>a===void 0?u:u===void 0||Math.abs(a-E)<Math.abs(u-E)?a:u;let m=n*e;const v=d+m,g=s===void 0?v:s(v);g!==v&&(m=g-d);const y=E=>-m*Math.exp(-E/r),b=E=>g+y(E),x=E=>{const I=y(E),N=b(E);f.done=Math.abs(I)<=c,f.value=f.done?g:N};let S,C;const T=E=>{h(f.value)&&(S=E,C=$G({keyframes:[f.value,p(f.value)],velocity:AG(b,E,f.value),damping:i,stiffness:o,restDelta:c,restSpeed:l}))};return T(0),{calculatedDuration:null,next:E=>{let I=!1;return!C&&S===void 0&&(I=!0,x(E),T(E)),S!==void 0&&E>S?C.next(E-S):(!I&&x(E),f)}}}const jge=t=>{const e=({timestamp:n})=>t(n);return{start:()=>pn.update(e,!0),stop:()=>Oc(e),now:()=>Yr.isProcessing?Yr.timestamp:performance.now()}},p4=2e4;function m4(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<p4;)e+=n,r=t.next(e);return e>=p4?1/0:e}const Gge={decay:h4,inertia:h4,tween:Dw,keyframes:Dw,spring:$G};function Ow({autoplay:t=!0,delay:e=0,driver:n=jge,keyframes:r,type:i="keyframes",repeat:o=0,repeatDelay:s=0,repeatType:a="loop",onPlay:u,onStop:c,onComplete:l,onUpdate:d,...f}){let h=1,p=!1,m,v;const g=()=>{v=new Promise(fe=>{m=fe})};g();let y;const b=Gge[i]||Dw;let x;b!==Dw&&typeof r[0]!="number"&&(x=NG([0,100],r,{clamp:!1}),r=[0,100]);const S=b({...f,keyframes:r});let C;a==="mirror"&&(C=b({...f,keyframes:[...r].reverse(),velocity:-(f.velocity||0)}));let T="idle",E=null,I=null,N=null;S.calculatedDuration===null&&o&&(S.calculatedDuration=m4(S));const{calculatedDuration:$}=S;let F=1/0,H=1/0;$!==null&&(F=$+s,H=F*(o+1)-s);let G=0;const J=fe=>{if(I===null)return;h>0&&(I=Math.min(I,fe)),h<0&&(I=Math.min(fe-H/h,I)),E!==null?G=E:G=Math.round(fe-I)*h;const xe=G-e*(h>=0?1:-1),be=h>=0?xe<0:xe>H;G=Math.max(xe,0),T==="finished"&&E===null&&(G=H);let pe=G,ge=S;if(o){const tt=G/F;let mt=Math.floor(tt),Ie=tt%1;!Ie&&tt>=1&&(Ie=1),Ie===1&&mt--,mt=Math.min(mt,o+1);const lt=!!(mt%2);lt&&(a==="reverse"?(Ie=1-Ie,s&&(Ie-=s/F)):a==="mirror"&&(ge=C));let He=ad(0,1,Ie);G>H&&(He=a==="reverse"&&lt?1:0),pe=He*F}const Ce=be?{done:!1,value:r[0]}:ge.next(pe);x&&(Ce.value=x(Ce.value));let{done:$e}=Ce;!be&&$!==null&&($e=h>=0?G>=H:G<=0);const Ge=E===null&&(T==="finished"||T==="running"&&$e);return d&&d(Ce.value),Ge&&q(),Ce},ne=()=>{y&&y.stop(),y=void 0},oe=()=>{T="idle",ne(),m(),g(),I=N=null},q=()=>{T="finished",l&&l(),ne(),m()},Z=()=>{if(p)return;y||(y=n(J));const fe=y.now();u&&u(),E!==null?I=fe-E:(!I||T==="finished")&&(I=fe),T==="finished"&&g(),N=I,E=null,T="running",y.start()};t&&Z();const se={then(fe,xe){return v.then(fe,xe)},get time(){return kc(G)},set time(fe){fe=Yl(fe),G=fe,E!==null||!y||h===0?E=fe:I=y.now()-fe/h},get duration(){const fe=S.calculatedDuration===null?m4(S):S.calculatedDuration;return kc(fe)},get speed(){return h},set speed(fe){fe===h||!y||(h=fe,se.time=kc(G))},get state(){return T},play:Z,pause:()=>{T="paused",E=G},stop:()=>{p=!0,T!=="idle"&&(T="idle",c&&c(),oe())},cancel:()=>{N!==null&&J(N),oe()},complete:()=>{T="finished"},sample:fe=>(I=0,J(fe))};return se}function Hge(t){let e;return()=>(e===void 0&&(e=t()),e)}const qge=Hge(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Kge=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),f1=10,Xge=2e4,Jge=(t,e)=>e.type==="spring"||t==="backgroundColor"||!lG(e.ease);function Yge(t,e,{onUpdate:n,onComplete:r,...i}){if(!(qge()&&Kge.has(e)&&!i.repeatDelay&&i.repeatType!=="mirror"&&i.damping!==0&&i.type!=="inertia"))return!1;let s=!1,a,u;const c=()=>{u=new Promise(y=>{a=y})};c();let{keyframes:l,duration:d=300,ease:f,times:h}=i;if(Jge(e,i)){const y=Ow({...i,repeat:0,delay:0});let b={done:!1,value:l[0]};const x=[];let S=0;for(;!b.done&&S<Xge;)b=y.sample(S),x.push(b.value),S+=f1;h=void 0,l=x,d=S-f1,f="linear"}const p=age(t.owner.current,e,l,{...i,duration:d,ease:f,times:h}),m=()=>p.cancel(),v=()=>{pn.update(m),a(),c()};return p.onfinish=()=>{t.set(uge(l,i)),r&&r(),v()},{then(y,b){return u.then(y,b)},attachTimeline(y){return p.timeline=y,p.onfinish=null,Un},get time(){return kc(p.currentTime||0)},set time(y){p.currentTime=Yl(y)},get speed(){return p.playbackRate},set speed(y){p.playbackRate=y},get duration(){return kc(d)},play:()=>{s||(p.play(),Oc(m))},pause:()=>p.pause(),stop:()=>{if(s=!0,p.playState==="idle")return;const{currentTime:y}=p;if(y){const b=Ow({...i,autoplay:!1});t.setWithVelocity(b.sample(y-f1).value,b.sample(y).value,f1)}v()},complete:()=>p.finish(),cancel:v}}function Qge({keyframes:t,delay:e,onUpdate:n,onComplete:r}){const i=()=>(n&&n(t[t.length-1]),r&&r(),{time:0,speed:1,duration:0,play:Un,pause:Un,stop:Un,then:o=>(o(),Promise.resolve()),cancel:Un,complete:Un});return e?Ow({keyframes:[0,1],duration:0,delay:e,onComplete:i}):i()}const Zge={type:"spring",stiffness:500,damping:25,restSpeed:10},eve=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),tve={type:"keyframes",duration:.8},nve={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},rve=(t,{keyframes:e})=>e.length>2?tve:ah.has(t)?t.startsWith("scale")?eve(e[1]):Zge:nve,$_=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(ud.test(e)||e==="0")&&!e.startsWith("url(")),ive=new Set(["brightness","contrast","saturate","opacity"]);function ove(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(RC)||[];if(!r)return t;const i=n.replace(r,"");let o=ive.has(e)?1:0;return r!==n&&(o*=100),e+"("+o+i+")"}const sve=/([a-z-]*)\(.*?\)/g,D_={...ud,getAnimatableNone:t=>{const e=t.match(sve);return e?e.map(ove).join(" "):t}},ave={...q6,color:Ci,backgroundColor:Ci,outlineColor:Ci,fill:Ci,stroke:Ci,borderColor:Ci,borderTopColor:Ci,borderRightColor:Ci,borderBottomColor:Ci,borderLeftColor:Ci,filter:D_,WebkitFilter:D_},hP=t=>ave[t];function DG(t,e){let n=hP(t);return n!==D_&&(n=ud),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const OG=t=>/^0[^.\s]+$/.test(t);function uve(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||OG(t)}function cve(t,e,n,r){const i=$_(e,n);let o;Array.isArray(n)?o=[...n]:o=[null,n];const s=r.from!==void 0?r.from:t.get();let a;const u=[];for(let c=0;c<o.length;c++)o[c]===null&&(o[c]=c===0?s:o[c-1]),uve(o[c])&&u.push(c),typeof o[c]=="string"&&o[c]!=="none"&&o[c]!=="0"&&(a=o[c]);if(i&&u.length&&a)for(let c=0;c<u.length;c++){const l=u[c];o[l]=DG(e,a)}return o}function lve({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:i,repeat:o,repeatType:s,repeatDelay:a,from:u,elapsed:c,...l}){return!!Object.keys(l).length}function FG(t,e){return t[e]||t.default||t}const pP=(t,e,n,r={})=>i=>{const o=FG(r,t)||{},s=o.delay||r.delay||0;let{elapsed:a=0}=r;a=a-Yl(s);const u=cve(e,t,n,o),c=u[0],l=u[u.length-1],d=$_(t,c),f=$_(t,l);let h={keyframes:u,velocity:e.getVelocity(),ease:"easeOut",...o,delay:-a,onUpdate:p=>{e.set(p),o.onUpdate&&o.onUpdate(p)},onComplete:()=>{i(),o.onComplete&&o.onComplete()}};if(lve(o)||(h={...h,...rve(t,h)}),h.duration&&(h.duration=Yl(h.duration)),h.repeatDelay&&(h.repeatDelay=Yl(h.repeatDelay)),!d||!f||sge.current||o.type===!1)return Qge(h);if(e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const p=Yge(e,t,h);if(p)return p}return Ow(h)};function Fw(t){return!!(fo(t)&&t.add)}const LG=t=>/^\-?\d*\.?\d+$/.test(t);function mP(t,e){t.indexOf(e)===-1&&t.push(e)}function gP(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class vP{constructor(){this.subscriptions=[]}add(e){return mP(this.subscriptions,e),()=>gP(this.subscriptions,e)}notify(e,n,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,n,r);else for(let o=0;o<i;o++){const s=this.subscriptions[o];s&&s(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const dve=t=>!isNaN(parseFloat(t));class fve{constructor(e,n={}){this.version="10.16.1",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(r,i=!0)=>{this.prev=this.current,this.current=r;const{delta:o,timestamp:s}=Yr;this.lastUpdated!==s&&(this.timeDelta=o,this.lastUpdated=s,pn.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>pn.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=dve(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new vP);const r=this.events[e].add(n);return e==="change"?()=>{r(),pn.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,r){this.set(n),this.prev=e,this.timeDelta=r}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?PG(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Sm(t,e){return new fve(t,e)}const MG=t=>e=>e.test(t),hve={test:t=>t==="auto",parse:t=>t},BG=[uh,at,iu,yl,bme,yme,hve],Gg=t=>BG.find(MG(t)),pve=[...BG,Ci,ud],mve=t=>pve.find(MG(t));function gve(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Sm(n))}function vve(t,e){const n=PC(t,e);let{transitionEnd:r={},transition:i={},...o}=n?t.makeTargetAnimatable(n,!1):{};o={...o,...r};for(const s in o){const a=$me(o[s]);gve(t,s,a)}}function yve(t,e,n){var r,i;const o=Object.keys(e).filter(a=>!t.hasValue(a)),s=o.length;if(s)for(let a=0;a<s;a++){const u=o[a],c=e[u];let l=null;Array.isArray(c)&&(l=c[0]),l===null&&(l=(i=(r=n[u])!==null&&r!==void 0?r:t.readValue(u))!==null&&i!==void 0?i:e[u]),l!=null&&(typeof l=="string"&&(LG(l)||OG(l))?l=parseFloat(l):!mve(l)&&ud.test(c)&&(l=DG(u,c)),t.addValue(u,Sm(l,{owner:t})),n[u]===void 0&&(n[u]=l),l!==null&&t.setBaseTarget(u,l))}}function bve(t,e){return e?(e[t]||e.default||e).from:void 0}function xve(t,e,n){const r={};for(const i in t){const o=bve(i,e);if(o!==void 0)r[i]=o;else{const s=n.getValue(i);s&&(r[i]=s.get())}}return r}function wve({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function UG(t,e,{delay:n=0,transitionOverride:r,type:i}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:s,...a}=t.makeTargetAnimatable(e);const u=t.getValue("willChange");r&&(o=r);const c=[],l=i&&t.animationState&&t.animationState.getState()[i];for(const d in a){const f=t.getValue(d),h=a[d];if(!f||h===void 0||l&&wve(l,d))continue;const p={delay:n,elapsed:0,...o};if(window.HandoffAppearAnimations&&!f.hasAnimated){const v=t.getProps()[ige];v&&(p.elapsed=window.HandoffAppearAnimations(v,d,f,pn))}f.start(pP(d,f,h,t.shouldReduceMotion&&ah.has(d)?{type:!1}:p));const m=f.animation;Fw(u)&&(u.add(d),m.then(()=>u.remove(d))),c.push(m)}return s&&Promise.all(c).then(()=>{s&&vve(t,s)}),c}function O_(t,e,n={}){const r=PC(t,e,n.custom);let{transition:i=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const o=r?()=>Promise.all(UG(t,r,n)):()=>Promise.resolve(),s=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:c=0,staggerChildren:l,staggerDirection:d}=i;return Sve(t,e,c+u,l,d,n)}:()=>Promise.resolve(),{when:a}=i;if(a){const[u,c]=a==="beforeChildren"?[o,s]:[s,o];return u().then(()=>c())}else return Promise.all([o(),s(n.delay)])}function Sve(t,e,n=0,r=0,i=1,o){const s=[],a=(t.variantChildren.size-1)*r,u=i===1?(c=0)=>c*r:(c=0)=>a-c*r;return Array.from(t.variantChildren).sort(Cve).forEach((c,l)=>{c.notify("AnimationStart",e),s.push(O_(c,e,{...o,delay:n+u(l)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(s)}function Cve(t,e){return t.sortNodePosition(e)}function kve(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(o=>O_(t,o,n));r=Promise.all(i)}else if(typeof e=="string")r=O_(t,e,n);else{const i=typeof e=="function"?PC(t,e,n.custom):e;r=Promise.all(UG(t,i,n))}return r.then(()=>t.notify("AnimationComplete",e))}const Tve=[...QN].reverse(),Eve=QN.length;function _ve(t){return e=>Promise.all(e.map(({animation:n,options:r})=>kve(t,n,r)))}function Ive(t){let e=_ve(t);const n=Nve();let r=!0;const i=(u,c)=>{const l=PC(t,c);if(l){const{transition:d,transitionEnd:f,...h}=l;u={...u,...h,...f}}return u};function o(u){e=u(t)}function s(u,c){const l=t.getProps(),d=t.getVariantContext(!0)||{},f=[],h=new Set;let p={},m=1/0;for(let g=0;g<Eve;g++){const y=Tve[g],b=n[y],x=l[y]!==void 0?l[y]:d[y],S=Ry(x),C=y===c?b.isActive:null;C===!1&&(m=g);let T=x===d[y]&&x!==l[y]&&S;if(T&&r&&t.manuallyAnimateOnMount&&(T=!1),b.protectedKeys={...p},!b.isActive&&C===null||!x&&!b.prevProp||_C(x)||typeof x=="boolean")continue;const E=Rve(b.prevProp,x);let I=E||y===c&&b.isActive&&!T&&S||g>m&&S;const N=Array.isArray(x)?x:[x];let $=N.reduce(i,{});C===!1&&($={});const{prevResolvedValues:F={}}=b,H={...F,...$},G=J=>{I=!0,h.delete(J),b.needsAnimating[J]=!0};for(const J in H){const ne=$[J],oe=F[J];p.hasOwnProperty(J)||(ne!==oe?Aw(ne)&&Aw(oe)?!uG(ne,oe)||E?G(J):b.protectedKeys[J]=!0:ne!==void 0?G(J):h.add(J):ne!==void 0&&h.has(J)?G(J):b.protectedKeys[J]=!0)}b.prevProp=x,b.prevResolvedValues=$,b.isActive&&(p={...p,...$}),r&&t.blockInitialAnimation&&(I=!1),I&&!T&&f.push(...N.map(J=>({animation:J,options:{type:y,...u}})))}if(h.size){const g={};h.forEach(y=>{const b=t.getBaseTarget(y);b!==void 0&&(g[y]=b)}),f.push({animation:g})}let v=!!f.length;return r&&l.initial===!1&&!t.manuallyAnimateOnMount&&(v=!1),r=!1,v?e(f):Promise.resolve()}function a(u,c,l){var d;if(n[u].isActive===c)return Promise.resolve();(d=t.variantChildren)===null||d===void 0||d.forEach(h=>{var p;return(p=h.animationState)===null||p===void 0?void 0:p.setActive(u,c)}),n[u].isActive=c;const f=s(l,u);for(const h in n)n[h].protectedKeys={};return f}return{animateChanges:s,setActive:a,setAnimateFunction:o,getState:()=>n}}function Rve(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!uG(e,t):!1}function zd(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Nve(){return{animate:zd(!0),whileInView:zd(),whileHover:zd(),whileTap:zd(),whileDrag:zd(),whileFocus:zd(),exit:zd()}}class Pve extends Cd{constructor(e){super(e),e.animationState||(e.animationState=Ive(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),_C(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let Ave=0;class $ve extends Cd{constructor(){super(...arguments),this.id=Ave++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n,custom:r}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const o=this.node.animationState.setActive("exit",!e,{custom:r??this.node.getProps().custom});n&&!e&&o.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Dve={animation:{Feature:Pve},exit:{Feature:$ve}},g4=(t,e)=>Math.abs(t-e);function Ove(t,e){const n=g4(t.x,e.x),r=g4(t.y,e.y);return Math.sqrt(n**2+r**2)}class VG{constructor(e,n,{transformPagePoint:r}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const c=nT(this.lastMoveEventInfo,this.history),l=this.startEvent!==null,d=Ove(c.offset,{x:0,y:0})>=3;if(!l&&!d)return;const{point:f}=c,{timestamp:h}=Yr;this.history.push({...f,timestamp:h});const{onStart:p,onMove:m}=this.handlers;l||(p&&p(this.lastMoveEvent,c),this.startEvent=this.lastMoveEvent),m&&m(this.lastMoveEvent,c)},this.handlePointerMove=(c,l)=>{this.lastMoveEvent=c,this.lastMoveEventInfo=tT(l,this.transformPagePoint),pn.update(this.updatePoint,!0)},this.handlePointerUp=(c,l)=>{if(this.end(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const{onEnd:d,onSessionEnd:f}=this.handlers,h=nT(c.type==="pointercancel"?this.lastMoveEventInfo:tT(l,this.transformPagePoint),this.history);this.startEvent&&d&&d(c,h),f&&f(c,h)},!rG(e))return;this.handlers=n,this.transformPagePoint=r;const i=NC(e),o=tT(i,this.transformPagePoint),{point:s}=o,{timestamp:a}=Yr;this.history=[{...s,timestamp:a}];const{onSessionStart:u}=n;u&&u(e,nT(o,this.history)),this.removeListeners=Jl(Cc(window,"pointermove",this.handlePointerMove),Cc(window,"pointerup",this.handlePointerUp),Cc(window,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Oc(this.updatePoint)}}function tT(t,e){return e?{point:e(t.point)}:t}function v4(t,e){return{x:t.x-e.x,y:t.y-e.y}}function nT({point:t},e){return{point:t,delta:v4(t,zG(e)),offset:v4(t,Fve(e)),velocity:Lve(e,.1)}}function Fve(t){return t[0]}function zG(t){return t[t.length-1]}function Lve(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const i=zG(t);for(;n>=0&&(r=t[n],!(i.timestamp-r.timestamp>Yl(e)));)n--;if(!r)return{x:0,y:0};const o=kc(i.timestamp-r.timestamp);if(o===0)return{x:0,y:0};const s={x:(i.x-r.x)/o,y:(i.y-r.y)/o};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function Uo(t){return t.max-t.min}function F_(t,e=0,n=.01){return Math.abs(t-e)<=n}function y4(t,e,n,r=.5){t.origin=r,t.originPoint=Pn(e.min,e.max,t.origin),t.scale=Uo(n)/Uo(e),(F_(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Pn(n.min,n.max,t.origin)-t.originPoint,(F_(t.translate)||isNaN(t.translate))&&(t.translate=0)}function Wv(t,e,n,r){y4(t.x,e.x,n.x,r?r.originX:void 0),y4(t.y,e.y,n.y,r?r.originY:void 0)}function b4(t,e,n){t.min=n.min+e.min,t.max=t.min+Uo(e)}function Mve(t,e,n){b4(t.x,e.x,n.x),b4(t.y,e.y,n.y)}function x4(t,e,n){t.min=e.min-n.min,t.max=t.min+Uo(e)}function jv(t,e,n){x4(t.x,e.x,n.x),x4(t.y,e.y,n.y)}function Bve(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?Pn(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?Pn(n,t,r.max):Math.min(t,n)),t}function w4(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function Uve(t,{top:e,left:n,bottom:r,right:i}){return{x:w4(t.x,n,i),y:w4(t.y,e,r)}}function S4(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function Vve(t,e){return{x:S4(t.x,e.x),y:S4(t.y,e.y)}}function zve(t,e){let n=.5;const r=Uo(t),i=Uo(e);return i>r?n=Py(e.min,e.max-r,t.min):r>i&&(n=Py(t.min,t.max-i,e.min)),ad(0,1,n)}function Wve(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const L_=.35;function jve(t=L_){return t===!1?t=0:t===!0&&(t=L_),{x:C4(t,"left","right"),y:C4(t,"top","bottom")}}function C4(t,e,n){return{min:k4(t,e),max:k4(t,n)}}function k4(t,e){return typeof t=="number"?t:t[e]||0}const T4=()=>({translate:0,scale:1,origin:0,originPoint:0}),Rp=()=>({x:T4(),y:T4()}),E4=()=>({min:0,max:0}),Kn=()=>({x:E4(),y:E4()});function Ta(t){return[t("x"),t("y")]}function WG({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function Gve({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function Hve(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function rT(t){return t===void 0||t===1}function M_({scale:t,scaleX:e,scaleY:n}){return!rT(t)||!rT(e)||!rT(n)}function Xd(t){return M_(t)||jG(t)||t.z||t.rotate||t.rotateX||t.rotateY}function jG(t){return _4(t.x)||_4(t.y)}function _4(t){return t&&t!=="0%"}function Lw(t,e,n){const r=t-n,i=e*r;return n+i}function I4(t,e,n,r,i){return i!==void 0&&(t=Lw(t,i,r)),Lw(t,n,r)+e}function B_(t,e=0,n=1,r,i){t.min=I4(t.min,e,n,r,i),t.max=I4(t.max,e,n,r,i)}function GG(t,{x:e,y:n}){B_(t.x,e.translate,e.scale,e.originPoint),B_(t.y,n.translate,n.scale,n.originPoint)}function qve(t,e,n,r=!1){const i=n.length;if(!i)return;e.x=e.y=1;let o,s;for(let a=0;a<i;a++){o=n[a],s=o.projectionDelta;const u=o.instance;u&&u.style&&u.style.display==="contents"||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Np(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(e.x*=s.x.scale,e.y*=s.y.scale,GG(t,s)),r&&Xd(o.latestValues)&&Np(t,o.latestValues))}e.x=R4(e.x),e.y=R4(e.y)}function R4(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function wl(t,e){t.min=t.min+e,t.max=t.max+e}function N4(t,e,[n,r,i]){const o=e[i]!==void 0?e[i]:.5,s=Pn(t.min,t.max,o);B_(t,e[n],e[r],s,e.scale)}const Kve=["x","scaleX","originX"],Xve=["y","scaleY","originY"];function Np(t,e){N4(t.x,e,Kve),N4(t.y,e,Xve)}function HG(t,e){return WG(Hve(t.getBoundingClientRect(),e))}function Jve(t,e,n){const r=HG(t,n),{scroll:i}=e;return i&&(wl(r.x,i.offset.x),wl(r.y,i.offset.y)),r}const Yve=new WeakMap;class Qve{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Kn(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const i=u=>{this.stopAnimation(),n&&this.snapToCursor(NC(u,"page").point)},o=(u,c)=>{const{drag:l,dragPropagation:d,onDragStart:f}=this.getProps();if(l&&!d&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=oG(l),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ta(p=>{let m=this.getAxisMotionValue(p).get()||0;if(iu.test(m)){const{projection:v}=this.visualElement;if(v&&v.layout){const g=v.layout.layoutBox[p];g&&(m=Uo(g)*(parseFloat(m)/100))}}this.originPoint[p]=m}),f&&pn.update(()=>f(u,c),!1,!0);const{animationState:h}=this.visualElement;h&&h.setActive("whileDrag",!0)},s=(u,c)=>{const{dragPropagation:l,dragDirectionLock:d,onDirectionLock:f,onDrag:h}=this.getProps();if(!l&&!this.openGlobalLock)return;const{offset:p}=c;if(d&&this.currentDirection===null){this.currentDirection=Zve(p),this.currentDirection!==null&&f&&f(this.currentDirection);return}this.updateAxis("x",c.point,p),this.updateAxis("y",c.point,p),this.visualElement.render(),h&&h(u,c)},a=(u,c)=>this.stop(u,c);this.panSession=new VG(e,{onSessionStart:i,onStart:o,onMove:s,onSessionEnd:a},{transformPagePoint:this.visualElement.getTransformPagePoint()})}stop(e,n){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&pn.update(()=>o(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:i}=this.getProps();if(!r||!h1(e,i,this.currentDirection))return;const o=this.getAxisMotionValue(e);let s=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(s=Bve(s,this.constraints[e],this.elastic[e])),o.set(s)}resolveConstraints(){const{dragConstraints:e,dragElastic:n}=this.getProps(),{layout:r}=this.visualElement.projection||{},i=this.constraints;e&&_p(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=Uve(r.layoutBox,e):this.constraints=!1,this.elastic=jve(n),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ta(o=>{this.getAxisMotionValue(o)&&(this.constraints[o]=Wve(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!_p(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=Jve(r,i.root,this.visualElement.getTransformPagePoint());let s=Vve(i.layout.layoutBox,o);if(n){const a=n(Gve(s));this.hasMutatedConstraints=!!a,a&&(s=WG(a))}return s}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:i,dragTransition:o,dragSnapToOrigin:s,onDragTransitionEnd:a}=this.getProps(),u=this.constraints||{},c=Ta(l=>{if(!h1(l,n,this.currentDirection))return;let d=u&&u[l]||{};s&&(d={min:0,max:0});const f=i?200:1e6,h=i?40:1e7,p={type:"inertia",velocity:r?e[l]:0,bounceStiffness:f,bounceDamping:h,timeConstant:750,restDelta:1,restSpeed:10,...o,...d};return this.startAxisValueAnimation(l,p)});return Promise.all(c).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return r.start(pP(e,r,0,n))}stopAnimation(){Ta(e=>this.getAxisMotionValue(e).stop())}getAxisMotionValue(e){const n="_drag"+e.toUpperCase(),r=this.visualElement.getProps(),i=r[n];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Ta(n=>{const{drag:r}=this.getProps();if(!h1(n,r,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:s,max:a}=i.layout.layoutBox[n];o.set(e[n]-Pn(s,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!_p(n)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Ta(s=>{const a=this.getAxisMotionValue(s);if(a){const u=a.get();i[s]=zve({min:u,max:u},this.constraints[s])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Ta(s=>{if(!h1(s,e,null))return;const a=this.getAxisMotionValue(s),{min:u,max:c}=this.constraints[s];a.set(Pn(u,c,i[s]))})}addListeners(){if(!this.visualElement.current)return;Yve.set(this.visualElement,this);const e=this.visualElement.current,n=Cc(e,"pointerdown",u=>{const{drag:c,dragListener:l=!0}=this.getProps();c&&l&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();_p(u)&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),r();const s=Ku(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",({delta:u,hasLayoutChanged:c})=>{this.isDragging&&c&&(Ta(l=>{const d=this.getAxisMotionValue(l);d&&(this.originPoint[l]+=u[l].translate,d.set(d.get()+u[l].translate))}),this.visualElement.render())});return()=>{s(),n(),o(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:s=L_,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:i,dragConstraints:o,dragElastic:s,dragMomentum:a}}}function h1(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function Zve(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class eye extends Cd{constructor(e){super(e),this.removeGroupControls=Un,this.removeListeners=Un,this.controls=new Qve(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Un}unmount(){this.removeGroupControls(),this.removeListeners()}}const P4=t=>(e,n)=>{t&&pn.update(()=>t(e,n))};class tye extends Cd{constructor(){super(...arguments),this.removePointerDownListener=Un}onPointerDown(e){this.session=new VG(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint()})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:P4(e),onStart:P4(n),onMove:r,onEnd:(o,s)=>{delete this.session,i&&pn.update(()=>i(o,s))}}}mount(){this.removePointerDownListener=Cc(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function qG(){const t=A.useContext(I0);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:r}=t,i=A.useId();return A.useEffect(()=>r(i),[]),!e&&n?[!1,()=>n&&n(i)]:[!0]}function nye(){return rye(A.useContext(I0))}function rye(t){return t===null?!0:t.isPresent}const Nx={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function A4(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Hg={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(at.test(t))t=parseFloat(t);else return t;const n=A4(t,e.target.x),r=A4(t,e.target.y);return`${n}% ${r}%`}},iye={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,i=ud.parse(t);if(i.length>5)return r;const o=ud.createTransformer(t),s=typeof i[0]!="number"?1:0,a=n.x.scale*e.x,u=n.y.scale*e.y;i[0+s]/=a,i[1+s]/=u;const c=Pn(a,u,.5);return typeof i[2+s]=="number"&&(i[2+s]/=c),typeof i[3+s]=="number"&&(i[3+s]/=c),o(i)}};class oye extends Do.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:i}=this.props,{projection:o}=e;dme(sye),o&&(n.group&&n.group.add(o),r&&r.register&&i&&r.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),Nx.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:i,isPresent:o}=this.props,s=r.projection;return s&&(s.isPresent=o,i||e.layoutDependency!==n||n===void 0?s.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?s.promote():s.relegate()||pn.postRender(()=>{const a=s.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function KG(t){const[e,n]=qG(),r=A.useContext(eP);return Do.createElement(oye,{...t,layoutGroup:r,switchLayoutGroup:A.useContext(z6),isPresent:e,safeToRemove:n})}const sye={borderRadius:{...Hg,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Hg,borderTopRightRadius:Hg,borderBottomLeftRadius:Hg,borderBottomRightRadius:Hg,boxShadow:iye},XG=["TopLeft","TopRight","BottomLeft","BottomRight"],aye=XG.length,$4=t=>typeof t=="string"?parseFloat(t):t,D4=t=>typeof t=="number"||at.test(t);function uye(t,e,n,r,i,o){i?(t.opacity=Pn(0,n.opacity!==void 0?n.opacity:1,cye(r)),t.opacityExit=Pn(e.opacity!==void 0?e.opacity:1,0,lye(r))):o&&(t.opacity=Pn(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,r));for(let s=0;s<aye;s++){const a=`border${XG[s]}Radius`;let u=O4(e,a),c=O4(n,a);if(u===void 0&&c===void 0)continue;u||(u=0),c||(c=0),u===0||c===0||D4(u)===D4(c)?(t[a]=Math.max(Pn($4(u),$4(c),r),0),(iu.test(c)||iu.test(u))&&(t[a]+="%")):t[a]=c}(e.rotate||n.rotate)&&(t.rotate=Pn(e.rotate||0,n.rotate||0,r))}function O4(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const cye=JG(0,.5,lP),lye=JG(.5,.95,Un);function JG(t,e,n){return r=>r<t?0:r>e?1:n(Py(t,e,r))}function F4(t,e){t.min=e.min,t.max=e.max}function Zo(t,e){F4(t.x,e.x),F4(t.y,e.y)}function L4(t,e,n,r,i){return t-=e,t=Lw(t,1/n,r),i!==void 0&&(t=Lw(t,1/i,r)),t}function dye(t,e=0,n=1,r=.5,i,o=t,s=t){if(iu.test(e)&&(e=parseFloat(e),e=Pn(s.min,s.max,e/100)-s.min),typeof e!="number")return;let a=Pn(o.min,o.max,r);t===o&&(a-=e),t.min=L4(t.min,e,n,a,i),t.max=L4(t.max,e,n,a,i)}function M4(t,e,[n,r,i],o,s){dye(t,e[n],e[r],e[i],e.scale,o,s)}const fye=["x","scaleX","originX"],hye=["y","scaleY","originY"];function B4(t,e,n,r){M4(t.x,e,fye,n?n.x:void 0,r?r.x:void 0),M4(t.y,e,hye,n?n.y:void 0,r?r.y:void 0)}function U4(t){return t.translate===0&&t.scale===1}function YG(t){return U4(t.x)&&U4(t.y)}function pye(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function QG(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function V4(t){return Uo(t.x)/Uo(t.y)}class mye{constructor(){this.members=[]}add(e){mP(this.members,e),e.scheduleRender()}remove(e){if(gP(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(i=>e===i);if(n===0)return!1;let r;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){r=o;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function z4(t,e,n){let r="";const i=t.x.translate/e.x,o=t.y.translate/e.y;if((i||o)&&(r=`translate3d(${i}px, ${o}px, 0) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{rotate:u,rotateX:c,rotateY:l}=n;u&&(r+=`rotate(${u}deg) `),c&&(r+=`rotateX(${c}deg) `),l&&(r+=`rotateY(${l}deg) `)}const s=t.x.scale*e.x,a=t.y.scale*e.y;return(s!==1||a!==1)&&(r+=`scale(${s}, ${a})`),r||"none"}const gye=(t,e)=>t.depth-e.depth;class vye{constructor(){this.children=[],this.isDirty=!1}add(e){mP(this.children,e),this.isDirty=!0}remove(e){gP(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(gye),this.isDirty=!1,this.children.forEach(e)}}function yye(t,e){const n=performance.now(),r=({timestamp:i})=>{const o=i-n;o>=e&&(Oc(r),t(o-e))};return pn.read(r,!0),()=>Oc(r)}function bye(t){window.MotionDebug&&window.MotionDebug.record(t)}function xye(t){return t instanceof SVGElement&&t.tagName!=="svg"}function wye(t,e,n){const r=fo(t)?t:Sm(t);return r.start(pP("",r,e,n)),r.animation}const W4=["","X","Y","Z"],j4=1e3;let Sye=0;const Jd={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function ZG({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(s={},a=e==null?void 0:e()){this.id=Sye++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{Jd.totalNodes=Jd.resolvedTargetDeltas=Jd.recalculatedProjection=0,this.nodes.forEach(Tye),this.nodes.forEach(Nye),this.nodes.forEach(Pye),this.nodes.forEach(Eye),bye(Jd)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=s,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new vye)}addEventListener(s,a){return this.eventHandlers.has(s)||this.eventHandlers.set(s,new vP),this.eventHandlers.get(s).add(a)}notifyListeners(s,...a){const u=this.eventHandlers.get(s);u&&u.notify(...a)}hasListeners(s){return this.eventHandlers.has(s)}mount(s,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=xye(s),this.instance=s;const{layoutId:u,layout:c,visualElement:l}=this.options;if(l&&!l.current&&l.mount(s),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||u)&&(this.isLayoutDirty=!0),t){let d;const f=()=>this.root.updateBlockedByResize=!1;t(s,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=yye(f,250),Nx.hasAnimatedSinceResize&&(Nx.hasAnimatedSinceResize=!1,this.nodes.forEach(H4))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&l&&(u||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:f,hasRelativeTargetChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||l.getDefaultTransition()||Fye,{onLayoutAnimationStart:v,onLayoutAnimationComplete:g}=l.getProps(),y=!this.targetLayout||!QG(this.targetLayout,p)||h,b=!f&&h;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||b||f&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,b);const x={...FG(m,"layout"),onPlay:v,onComplete:g};(l.shouldReduceMotion||this.options.layoutRoot)&&(x.delay=0,x.type=!1),this.startAnimation(x)}else f||H4(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const s=this.getStack();s&&s.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Oc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Aye),this.animationId++)}getTransformTemplate(){const{visualElement:s}=this.options;return s&&s.getProps().transformTemplate}willUpdate(s=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let l=0;l<this.path.length;l++){const d=this.path[l];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:u}=this.options;if(a===void 0&&!u)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),s&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(G4);return}this.isUpdating||this.nodes.forEach(Iye),this.isUpdating=!1,this.nodes.forEach(Rye),this.nodes.forEach(Cye),this.nodes.forEach(kye),this.clearAllSnapshots();const a=performance.now();Yr.delta=ad(0,1e3/60,a-Yr.timestamp),Yr.timestamp=a,Yr.isProcessing=!0,qk.update.process(Yr),qk.preRender.process(Yr),qk.render.process(Yr),Yr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(_ye),this.sharedNodes.forEach($ye)}scheduleUpdateProjection(){pn.preRender(this.updateProjection,!1,!0)}scheduleCheckAfterUnmount(){pn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const s=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Kn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,s?s.layoutBox:void 0)}updateScroll(s="measure"){let a=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===s&&(a=!1),a&&(this.scroll={animationId:this.root.animationId,phase:s,isRoot:r(this.instance),offset:n(this.instance)})}resetTransform(){if(!i)return;const s=this.isLayoutDirty||this.shouldResetTransform,a=this.projectionDelta&&!YG(this.projectionDelta),u=this.getTransformTemplate(),c=u?u(this.latestValues,""):void 0,l=c!==this.prevTransformTemplateValue;s&&(a||Xd(this.latestValues)||l)&&(i(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(s=!0){const a=this.measurePageBox();let u=this.removeElementScroll(a);return s&&(u=this.removeTransform(u)),Lye(u),{animationId:this.root.animationId,measuredBox:a,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:s}=this.options;if(!s)return Kn();const a=s.measureViewportBox(),{scroll:u}=this.root;return u&&(wl(a.x,u.offset.x),wl(a.y,u.offset.y)),a}removeElementScroll(s){const a=Kn();Zo(a,s);for(let u=0;u<this.path.length;u++){const c=this.path[u],{scroll:l,options:d}=c;if(c!==this.root&&l&&d.layoutScroll){if(l.isRoot){Zo(a,s);const{scroll:f}=this.root;f&&(wl(a.x,-f.offset.x),wl(a.y,-f.offset.y))}wl(a.x,l.offset.x),wl(a.y,l.offset.y)}}return a}applyTransform(s,a=!1){const u=Kn();Zo(u,s);for(let c=0;c<this.path.length;c++){const l=this.path[c];!a&&l.options.layoutScroll&&l.scroll&&l!==l.root&&Np(u,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),Xd(l.latestValues)&&Np(u,l.latestValues)}return Xd(this.latestValues)&&Np(u,this.latestValues),u}removeTransform(s){const a=Kn();Zo(a,s);for(let u=0;u<this.path.length;u++){const c=this.path[u];if(!c.instance||!Xd(c.latestValues))continue;M_(c.latestValues)&&c.updateSnapshot();const l=Kn(),d=c.measurePageBox();Zo(l,d),B4(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,l)}return Xd(this.latestValues)&&B4(a,this.latestValues),a}setTargetDelta(s){this.targetDelta=s,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(s){this.options={...this.options,...s,crossfade:s.crossfade!==void 0?s.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Yr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(s=!1){var a;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==u;if(!(s||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:d,layoutId:f}=this.options;if(!(!this.layout||!(d||f))){if(this.resolvedRelativeTargetAt=Yr.timestamp,!this.targetDelta&&!this.relativeTarget){const h=this.getClosestProjectingParent();h&&h.layout&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Kn(),this.relativeTargetOrigin=Kn(),jv(this.relativeTargetOrigin,this.layout.layoutBox,h.layout.layoutBox),Zo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Kn(),this.targetWithTransforms=Kn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Mve(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Zo(this.target,this.layout.layoutBox),GG(this.target,this.targetDelta)):Zo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const h=this.getClosestProjectingParent();h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Kn(),this.relativeTargetOrigin=Kn(),jv(this.relativeTargetOrigin,this.target,h.target),Zo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Jd.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||M_(this.parent.latestValues)||jG(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var s;const a=this.getLead(),u=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((s=this.parent)===null||s===void 0)&&s.isProjectionDirty)&&(c=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Yr.timestamp&&(c=!1),c)return;const{layout:l,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(l||d))return;Zo(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,h=this.treeScale.y;qve(this.layoutCorrected,this.treeScale,this.path,u),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox);const{target:p}=a;if(!p){this.projectionTransform&&(this.projectionDelta=Rp(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Rp(),this.projectionDeltaWithTransform=Rp());const m=this.projectionTransform;Wv(this.projectionDelta,this.layoutCorrected,p,this.latestValues),this.projectionTransform=z4(this.projectionDelta,this.treeScale),(this.projectionTransform!==m||this.treeScale.x!==f||this.treeScale.y!==h)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p)),Jd.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(s=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),s){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(s,a=!1){const u=this.snapshot,c=u?u.latestValues:{},l={...this.latestValues},d=Rp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const f=Kn(),h=u?u.source:void 0,p=this.layout?this.layout.source:void 0,m=h!==p,v=this.getStack(),g=!v||v.members.length<=1,y=!!(m&&!g&&this.options.crossfade===!0&&!this.path.some(Oye));this.animationProgress=0;let b;this.mixTargetDelta=x=>{const S=x/1e3;q4(d.x,s.x,S),q4(d.y,s.y,S),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(jv(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Dye(this.relativeTarget,this.relativeTargetOrigin,f,S),b&&pye(this.relativeTarget,b)&&(this.isProjectionDirty=!1),b||(b=Kn()),Zo(b,this.relativeTarget)),m&&(this.animationValues=l,uye(l,c,this.latestValues,S,y,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(s){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Oc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=pn.update(()=>{Nx.hasAnimatedSinceResize=!0,this.currentAnimation=wye(0,j4,{...s,onUpdate:a=>{this.mixTargetDelta(a),s.onUpdate&&s.onUpdate(a)},onComplete:()=>{s.onComplete&&s.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const s=this.getStack();s&&s.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(j4),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const s=this.getLead();let{targetWithTransforms:a,target:u,layout:c,latestValues:l}=s;if(!(!a||!u||!c)){if(this!==s&&this.layout&&c&&eH(this.options.animationType,this.layout.layoutBox,c.layoutBox)){u=this.target||Kn();const d=Uo(this.layout.layoutBox.x);u.x.min=s.target.x.min,u.x.max=u.x.min+d;const f=Uo(this.layout.layoutBox.y);u.y.min=s.target.y.min,u.y.max=u.y.min+f}Zo(a,u),Np(a,l),Wv(this.projectionDeltaWithTransform,this.layoutCorrected,a,l)}}registerSharedNode(s,a){this.sharedNodes.has(s)||this.sharedNodes.set(s,new mye),this.sharedNodes.get(s).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const s=this.getStack();return s?s.lead===this:!0}getLead(){var s;const{layoutId:a}=this.options;return a?((s=this.getStack())===null||s===void 0?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:a}=this.options;return a?(s=this.getStack())===null||s===void 0?void 0:s.prevLead:void 0}getStack(){const{layoutId:s}=this.options;if(s)return this.root.sharedNodes.get(s)}promote({needsReset:s,transition:a,preserveFollowOpacity:u}={}){const c=this.getStack();c&&c.promote(this,u),s&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const s=this.getStack();return s?s.relegate(this):!1}resetRotation(){const{visualElement:s}=this.options;if(!s)return;let a=!1;const{latestValues:u}=s;if((u.rotate||u.rotateX||u.rotateY||u.rotateZ)&&(a=!0),!a)return;const c={};for(let l=0;l<W4.length;l++){const d="rotate"+W4[l];u[d]&&(c[d]=u[d],s.setStaticValue(d,0))}s.render();for(const l in c)s.setStaticValue(l,c[l]);s.scheduleRender()}getProjectionStyles(s={}){var a,u;const c={};if(!this.instance||this.isSVG)return c;if(this.isVisible)c.visibility="";else return{visibility:"hidden"};const l=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=Rx(s.pointerEvents)||"",c.transform=l?l(this.latestValues,""):"none",c;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const m={};return this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=Rx(s.pointerEvents)||""),this.hasProjected&&!Xd(this.latestValues)&&(m.transform=l?l({},""):"none",this.hasProjected=!1),m}const f=d.animationValues||d.latestValues;this.applyTransformsToTarget(),c.transform=z4(this.projectionDeltaWithTransform,this.treeScale,f),l&&(c.transform=l(f,c.transform));const{x:h,y:p}=this.projectionDelta;c.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,d.animationValues?c.opacity=d===this?(u=(a=f.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&u!==void 0?u:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:c.opacity=d===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const m in Nw){if(f[m]===void 0)continue;const{correct:v,applyTo:g}=Nw[m],y=c.transform==="none"?f[m]:v(f[m],d);if(g){const b=g.length;for(let x=0;x<b;x++)c[g[x]]=y}else c[m]=y}return this.options.layoutId&&(c.pointerEvents=d===this?Rx(s.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(s=>{var a;return(a=s.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(G4),this.root.sharedNodes.clear()}}}function Cye(t){t.updateLayout()}function kye(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=t.layout,{animationType:o}=t.options,s=n.source!==t.layout.source;o==="size"?Ta(d=>{const f=s?n.measuredBox[d]:n.layoutBox[d],h=Uo(f);f.min=r[d].min,f.max=f.min+h}):eH(o,n.layoutBox,r)&&Ta(d=>{const f=s?n.measuredBox[d]:n.layoutBox[d],h=Uo(r[d]);f.max=f.min+h,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+h)});const a=Rp();Wv(a,r,n.layoutBox);const u=Rp();s?Wv(u,t.applyTransform(i,!0),n.measuredBox):Wv(u,r,n.layoutBox);const c=!YG(a);let l=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:f,layout:h}=d;if(f&&h){const p=Kn();jv(p,n.layoutBox,f.layoutBox);const m=Kn();jv(m,r,h.layoutBox),QG(p,m)||(l=!0),d.options.layoutRoot&&(t.relativeTarget=m,t.relativeTargetOrigin=p,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:n,delta:u,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:l})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function Tye(t){Jd.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Eye(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function _ye(t){t.clearSnapshot()}function G4(t){t.clearMeasurements()}function Iye(t){t.isLayoutDirty=!1}function Rye(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function H4(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function Nye(t){t.resolveTargetDelta()}function Pye(t){t.calcProjection()}function Aye(t){t.resetRotation()}function $ye(t){t.removeLeadSnapshot()}function q4(t,e,n){t.translate=Pn(e.translate,0,n),t.scale=Pn(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function K4(t,e,n,r){t.min=Pn(e.min,n.min,r),t.max=Pn(e.max,n.max,r)}function Dye(t,e,n,r){K4(t.x,e.x,n.x,r),K4(t.y,e.y,n.y,r)}function Oye(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const Fye={duration:.45,ease:[.4,0,.1,1]},X4=t=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(t),J4=X4("applewebkit/")&&!X4("chrome/")?Math.round:Un;function Y4(t){t.min=J4(t.min),t.max=J4(t.max)}function Lye(t){Y4(t.x),Y4(t.y)}function eH(t,e,n){return t==="position"||t==="preserve-aspect"&&!F_(V4(e),V4(n),.2)}const Mye=ZG({attachResizeListener:(t,e)=>Ku(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),iT={current:void 0},tH=ZG({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!iT.current){const t=new Mye({});t.mount(window),t.setOptions({layoutScroll:!0}),iT.current=t}return iT.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),Bye={pan:{Feature:tye},drag:{Feature:eye,ProjectionNode:tH,MeasureLayout:KG}},Uye=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Vye(t){const e=Uye.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]}function U_(t,e,n=1){const[r,i]=Vye(t);if(!r)return;const o=window.getComputedStyle(e).getPropertyValue(r);if(o){const s=o.trim();return LG(s)?parseFloat(s):s}else return R_(i)?U_(i,e,n+1):i}function zye(t,{...e},n){const r=t.current;if(!(r instanceof Element))return{target:e,transitionEnd:n};n&&(n={...n}),t.values.forEach(i=>{const o=i.get();if(!R_(o))return;const s=U_(o,r);s&&i.set(s)});for(const i in e){const o=e[i];if(!R_(o))continue;const s=U_(o,r);s&&(e[i]=s,n||(n={}),n[i]===void 0&&(n[i]=o))}return{target:e,transitionEnd:n}}const Wye=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),nH=t=>Wye.has(t),jye=t=>Object.keys(t).some(nH),Q4=t=>t===uh||t===at,Z4=(t,e)=>parseFloat(t.split(", ")[e]),eB=(t,e)=>(n,{transform:r})=>{if(r==="none"||!r)return 0;const i=r.match(/^matrix3d\((.+)\)$/);if(i)return Z4(i[1],e);{const o=r.match(/^matrix\((.+)\)$/);return o?Z4(o[1],t):0}},Gye=new Set(["x","y","z"]),Hye=R0.filter(t=>!Gye.has(t));function qye(t){const e=[];return Hye.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}const Cm={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:eB(4,13),y:eB(5,14)};Cm.translateX=Cm.x;Cm.translateY=Cm.y;const Kye=(t,e,n)=>{const r=e.measureViewportBox(),i=e.current,o=getComputedStyle(i),{display:s}=o,a={};s==="none"&&e.setStaticValue("display",t.display||"block"),n.forEach(c=>{a[c]=Cm[c](r,o)}),e.render();const u=e.measureViewportBox();return n.forEach(c=>{const l=e.getValue(c);l&&l.jump(a[c]),t[c]=Cm[c](u,o)}),t},Xye=(t,e,n={},r={})=>{e={...e},r={...r};const i=Object.keys(e).filter(nH);let o=[],s=!1;const a=[];if(i.forEach(u=>{const c=t.getValue(u);if(!t.hasValue(u))return;let l=n[u],d=Gg(l);const f=e[u];let h;if(Aw(f)){const p=f.length,m=f[0]===null?1:0;l=f[m],d=Gg(l);for(let v=m;v<p&&f[v]!==null;v++)h?cP(Gg(f[v])===h):h=Gg(f[v])}else h=Gg(f);if(d!==h)if(Q4(d)&&Q4(h)){const p=c.get();typeof p=="string"&&c.set(parseFloat(p)),typeof f=="string"?e[u]=parseFloat(f):Array.isArray(f)&&h===at&&(e[u]=f.map(parseFloat))}else d!=null&&d.transform&&(h!=null&&h.transform)&&(l===0||f===0)?l===0?c.set(h.transform(l)):e[u]=d.transform(f):(s||(o=qye(t),s=!0),a.push(u),r[u]=r[u]!==void 0?r[u]:e[u],c.jump(f))}),a.length){const u=a.indexOf("height")>=0?window.pageYOffset:null,c=Kye(e,t,a);return o.length&&o.forEach(([l,d])=>{t.getValue(l).set(d)}),t.render(),EC&&u!==null&&window.scrollTo({top:u}),{target:c,transitionEnd:r}}else return{target:e,transitionEnd:r}};function Jye(t,e,n,r){return jye(e)?Xye(t,e,n,r):{target:e,transitionEnd:r}}const Yye=(t,e,n,r)=>{const i=zye(t,e,r);return e=i.target,r=i.transitionEnd,Jye(t,e,n,r)},V_={current:null},rH={current:!1};function Qye(){if(rH.current=!0,!!EC)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>V_.current=t.matches;t.addListener(e),e()}else V_.current=!1}function Zye(t,e,n){const{willChange:r}=e;for(const i in e){const o=e[i],s=n[i];if(fo(o))t.addValue(i,o),Fw(r)&&r.add(i);else if(fo(s))t.addValue(i,Sm(o,{owner:t})),Fw(r)&&r.remove(i);else if(s!==o)if(t.hasValue(i)){const a=t.getValue(i);!a.hasAnimated&&a.set(o)}else{const a=t.getStaticValue(i);t.addValue(i,Sm(a!==void 0?a:o,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const tB=new WeakMap,iH=Object.keys(Ny),e0e=iH.length,nB=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],t0e=ZN.length;class n0e{constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:i,visualState:o},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>pn.render(this.render,!1,!0);const{latestValues:a,renderState:u}=o;this.latestValues=a,this.baseTarget={...a},this.initialValues=n.initial?{...a}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=s,this.isControllingVariants=IC(n),this.isVariantNode=V6(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...l}=this.scrapeMotionValuesFromProps(n,{});for(const d in l){const f=l[d];a[d]!==void 0&&fo(f)&&(f.set(a[d],!1),Fw(c)&&c.add(d))}}scrapeMotionValuesFromProps(e,n){return{}}mount(e){this.current=e,tB.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,r)=>this.bindToMotionValue(r,n)),rH.current||Qye(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:V_.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){tB.delete(this.current),this.projection&&this.projection.unmount(),Oc(this.notifyUpdate),Oc(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,n){const r=ah.has(e),i=n.on("change",s=>{this.latestValues[e]=s,this.props.onUpdate&&pn.update(this.notifyUpdate,!1,!0),r&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{i(),o()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},r,i,o){let s,a;for(let u=0;u<e0e;u++){const c=iH[u],{isEnabled:l,Feature:d,ProjectionNode:f,MeasureLayout:h}=Ny[c];f&&(s=f),l(n)&&(!this.features[c]&&d&&(this.features[c]=new d(this)),h&&(a=h))}if(!this.projection&&s){this.projection=new s(this.latestValues,this.parent&&this.parent.projection);const{layoutId:u,layout:c,drag:l,dragConstraints:d,layoutScroll:f,layoutRoot:h}=n;this.projection.setOptions({layoutId:u,layout:c,alwaysMeasureLayout:!!l||d&&_p(d),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof c=="string"?c:"both",initialPromotionConfig:o,layoutScroll:f,layoutRoot:h})}return a}updateFeatures(){for(const e in this.features){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Kn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}makeTargetAnimatable(e,n=!0){return this.makeTargetAnimatableFromInstance(e,this.props,n)}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<nB.length;r++){const i=nB[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o=e["on"+i];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=Zye(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const r=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(r.initial=this.props.initial),r}const n={};for(let r=0;r<t0e;r++){const i=ZN[r],o=this.props[i];(Ry(o)||o===!1)&&(n[i]=o)}return n}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){n!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,n)),this.values.set(e,n),this.latestValues[e]=n.get()}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=Sm(n,{owner:this}),this.addValue(e,r)),r}readValue(e){var n;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(n=this.getBaseTargetFromProps(this.props,e))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:r}=this.props,i=typeof r=="string"||typeof r=="object"?(n=uP(this.props,r))===null||n===void 0?void 0:n[e]:void 0;if(r&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!fo(o)?o:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new vP),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class oH extends n0e{sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:n,...r},{transformValues:i},o){let s=xve(r,e||{},this);if(i&&(n&&(n=i(n)),r&&(r=i(r)),s&&(s=i(s))),o){yve(this,r,s);const a=Yye(this,r,s,n);n=a.transitionEnd,r=a.target}return{transition:e,transitionEnd:n,...r}}}function r0e(t){return window.getComputedStyle(t)}class i0e extends oH{readValueFromInstance(e,n){if(ah.has(n)){const r=hP(n);return r&&r.default||0}else{const r=r0e(e),i=(G6(n)?r.getPropertyValue(n):r[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return HG(e,n)}build(e,n,r,i){nP(e,n,r,i.transformTemplate)}scrapeMotionValuesFromProps(e,n){return aP(e,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;fo(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,r,i){Y6(e,n,r,i)}}class o0e extends oH{constructor(){super(...arguments),this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(ah.has(n)){const r=hP(n);return r&&r.default||0}return n=Q6.has(n)?n:sP(n),e.getAttribute(n)}measureInstanceViewportBox(){return Kn()}scrapeMotionValuesFromProps(e,n){return eG(e,n)}build(e,n,r,i){iP(e,n,r,this.isSVGTag,i.transformTemplate)}renderInstance(e,n,r,i){Z6(e,n,r,i)}mount(e){this.isSVGTag=oP(e.tagName),super.mount(e)}}const s0e=(t,e)=>tP(t)?new o0e(e,{enableHardwareAcceleration:!1}):new i0e(e,{enableHardwareAcceleration:!0}),a0e={layout:{ProjectionNode:tH,MeasureLayout:KG}},u0e={...Dve,...ege,...Bye,...a0e},Km=cme((t,e)=>Vme(t,e,u0e,s0e));function sH(){const t=A.useRef(!1);return YN(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function c0e(){const t=sH(),[e,n]=A.useState(0),r=A.useCallback(()=>{t.current&&n(e+1)},[e]);return[A.useCallback(()=>pn.postRender(r),[r]),e]}class l0e extends A.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d0e({children:t,isPresent:e}){const n=A.useId(),r=A.useRef(null),i=A.useRef({width:0,height:0,top:0,left:0});return A.useInsertionEffect(()=>{const{width:o,height:s,top:a,left:u}=i.current;if(e||!r.current||!o||!s)return;r.current.dataset.motionPopId=n;const c=document.createElement("style");return document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${s}px !important;
            top: ${a}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[e]),A.createElement(l0e,{isPresent:e,childRef:r,sizeRef:i},A.cloneElement(t,{ref:r}))}const oT=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:s})=>{const a=tG(f0e),u=A.useId(),c=A.useMemo(()=>({id:u,initial:e,isPresent:n,custom:i,onExitComplete:l=>{a.set(l,!0);for(const d of a.values())if(!d)return;r&&r()},register:l=>(a.set(l,!1),()=>a.delete(l))}),o?void 0:[n]);return A.useMemo(()=>{a.forEach((l,d)=>a.set(d,!1))},[n]),A.useEffect(()=>{!n&&!a.size&&r&&r()},[n]),s==="popLayout"&&(t=A.createElement(d0e,{isPresent:n},t)),A.createElement(I0.Provider,{value:c},t)};function f0e(){return new Map}function h0e(t){return A.useEffect(()=>()=>t(),[])}const tp=t=>t.key||"";function p0e(t,e){t.forEach(n=>{const r=tp(n);e.set(r,n)})}function m0e(t){const e=[];return A.Children.forEach(t,n=>{A.isValidElement(n)&&e.push(n)}),e}const $0=({children:t,custom:e,initial:n=!0,onExitComplete:r,exitBeforeEnter:i,presenceAffectsLayout:o=!0,mode:s="sync"})=>{const a=A.useContext(eP).forceRender||c0e()[0],u=sH(),c=m0e(t);let l=c;const d=A.useRef(new Map).current,f=A.useRef(l),h=A.useRef(new Map).current,p=A.useRef(!0);if(YN(()=>{p.current=!1,p0e(c,h),f.current=l}),h0e(()=>{p.current=!0,h.clear(),d.clear()}),p.current)return A.createElement(A.Fragment,null,l.map(y=>A.createElement(oT,{key:tp(y),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:o,mode:s},y)));l=[...l];const m=f.current.map(tp),v=c.map(tp),g=m.length;for(let y=0;y<g;y++){const b=m[y];v.indexOf(b)===-1&&!d.has(b)&&d.set(b,void 0)}return s==="wait"&&d.size&&(l=[]),d.forEach((y,b)=>{if(v.indexOf(b)!==-1)return;const x=h.get(b);if(!x)return;const S=m.indexOf(b);let C=y;if(!C){const T=()=>{h.delete(b),d.delete(b);const E=f.current.findIndex(I=>I.key===b);if(f.current.splice(E,1),!d.size){if(f.current=c,u.current===!1)return;a(),r&&r()}};C=A.createElement(oT,{key:tp(x),isPresent:!1,onExitComplete:T,custom:e,presenceAffectsLayout:o,mode:s},x),d.set(b,C)}l.splice(S,0,C)}),l=l.map(y=>{const b=y.key;return d.has(b)?y:A.createElement(oT,{key:tp(y),isPresent:!0,presenceAffectsLayout:o,mode:s},y)}),A.createElement(A.Fragment,null,d.size?l:l.map(y=>A.cloneElement(y)))};var g0e={initial:t=>{const{position:e}=t,n=["top","bottom"].includes(e)?"y":"x";let r=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(r=1),{opacity:0,[n]:r*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},aH=A.memo(t=>{const{id:e,message:n,onCloseComplete:r,onRequestRemove:i,requestClose:o=!1,position:s="bottom",duration:a=5e3,containerStyle:u,motionVariants:c=g0e,toastSpacing:l="0.5rem"}=t,[d,f]=A.useState(a),h=nye();ZM(()=>{h||r==null||r()},[h]),ZM(()=>{f(a)},[a]);const p=()=>f(null),m=()=>f(a),v=()=>{h&&i()};A.useEffect(()=>{h&&o&&i()},[h,o,i]),eme(v,d);const g=A.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:l,...u}),[u,l]),y=A.useMemo(()=>Ype(s),[s]);return P.jsx(Km.div,{layout:!0,className:"chakra-toast",variants:c,initial:"initial",animate:"animate",exit:"exit",onHoverStart:p,onHoverEnd:m,custom:{position:s},style:y,children:P.jsx(ft.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:g,children:Nl(n,{id:e,onClose:v})})})});aH.displayName="ToastComponent";var rB={path:P.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[P.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),P.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),P.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},D0=wt((t,e)=>{const{as:n,viewBox:r,color:i="currentColor",focusable:o=!1,children:s,className:a,__css:u,...c}=t,l=zt("chakra-icon",a),d=wd("Icon",t),f={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:i,...u,...d},h={ref:e,focusable:o,className:l,__css:f},p=r??rB.viewBox;if(n&&typeof n!="string")return P.jsx(ft.svg,{as:n,...h,...c});const m=s??rB.path;return P.jsx(ft.svg,{verticalAlign:"middle",viewBox:p,...h,...c,children:m})});D0.displayName="Icon";function v0e(t){return P.jsx(D0,{viewBox:"0 0 24 24",...t,children:P.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function y0e(t){return P.jsx(D0,{viewBox:"0 0 24 24",...t,children:P.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function iB(t){return P.jsx(D0,{viewBox:"0 0 24 24",...t,children:P.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}var b0e=sh({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),ch=wt((t,e)=>{const n=wd("Spinner",t),{label:r="Loading...",thickness:i="2px",speed:o="0.45s",emptyColor:s="transparent",className:a,...u}=go(t),c=zt("chakra-spinner",a),l={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:i,borderBottomColor:s,borderLeftColor:s,animation:`${b0e} ${o} linear infinite`,...n};return P.jsx(ft.div,{ref:e,__css:l,className:c,...u,children:r&&P.jsx(ft.span,{srOnly:!0,children:r})})});ch.displayName="Spinner";var[x0e,yP]=jo({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[w0e,bP]=jo({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),uH={info:{icon:y0e,colorScheme:"blue"},warning:{icon:iB,colorScheme:"orange"},success:{icon:v0e,colorScheme:"green"},error:{icon:iB,colorScheme:"red"},loading:{icon:ch,colorScheme:"blue"}};function S0e(t){return uH[t].colorScheme}function C0e(t){return uH[t].icon}var Fc=wt(function(e,n){const r=bP(),{status:i}=yP(),o={display:"inline",...r.description};return P.jsx(ft.div,{ref:n,"data-status":i,...e,className:zt("chakra-alert__desc",e.className),__css:o})});Fc.displayName="AlertDescription";function Lc(t){const{status:e}=yP(),n=C0e(e),r=bP(),i=e==="loading"?r.spinner:r.icon;return P.jsx(ft.span,{display:"inherit","data-status":e,...t,className:zt("chakra-alert__icon",t.className),__css:i,children:t.children||P.jsx(n,{h:"100%",w:"100%"})})}Lc.displayName="AlertIcon";var Mc=wt(function(e,n){const r=bP(),{status:i}=yP();return P.jsx(ft.div,{ref:n,"data-status":i,...e,className:zt("chakra-alert__title",e.className),__css:r.title})});Mc.displayName="AlertTitle";var Bc=wt(function(e,n){var r;const{status:i="info",addRole:o=!0,...s}=go(e),a=(r=e.colorScheme)!=null?r:S0e(i),u=Sd("Alert",{...e,colorScheme:a}),c={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...u.container};return P.jsx(x0e,{value:{status:i},children:P.jsx(w0e,{value:u,children:P.jsx(ft.div,{"data-status":i,role:o?"alert":void 0,ref:n,...s,className:zt("chakra-alert",e.className),__css:c})})})});Bc.displayName="Alert";function k0e(t){return P.jsx(D0,{focusable:"false","aria-hidden":!0,...t,children:P.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}var cH=wt(function(e,n){const r=wd("CloseButton",e),{children:i,isDisabled:o,__css:s,...a}=go(e),u={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return P.jsx(ft.button,{type:"button","aria-label":"Close",ref:n,disabled:o,__css:{...u,...r,...s},...a,children:i||P.jsx(k0e,{width:"1em",height:"1em"})})});cH.displayName="CloseButton";var T0e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Gv=E0e(T0e);function E0e(t){let e=t;const n=new Set,r=i=>{e=i(e),n.forEach(o=>o())};return{getState:()=>e,subscribe:i=>(n.add(i),()=>{r(()=>t),n.delete(i)}),removeToast:(i,o)=>{r(s=>({...s,[o]:s[o].filter(a=>a.id!=i)}))},notify:(i,o)=>{const s=_0e(i,o),{position:a,id:u}=s;return r(c=>{var l,d;const h=a.includes("top")?[s,...(l=c[a])!=null?l:[]]:[...(d=c[a])!=null?d:[],s];return{...c,[a]:h}}),u},update:(i,o)=>{i&&r(s=>{const a={...s},{position:u,index:c}=QM(a,i);return u&&c!==-1&&(a[u][c]={...a[u][c],...o,message:R0e(o)}),a})},closeAll:({positions:i}={})=>{r(o=>(i??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((u,c)=>(u[c]=o[c].map(l=>({...l,requestClose:!0})),u),{...o}))},close:i=>{r(o=>{const s=M6(o,i);return s?{...o,[s]:o[s].map(a=>a.id==i?{...a,requestClose:!0}:a)}:o})},isActive:i=>!!QM(Gv.getState(),i).position}}var oB=0;function _0e(t,e={}){var n,r;oB+=1;const i=(n=e.id)!=null?n:oB,o=(r=e.position)!=null?r:"bottom";return{id:i,message:t,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>Gv.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var I0e=t=>{const{status:e,variant:n="solid",id:r,title:i,isClosable:o,onClose:s,description:a,colorScheme:u,icon:c}=t,l=r?{root:`toast-${r}`,title:`toast-${r}-title`,description:`toast-${r}-description`}:void 0;return P.jsxs(Bc,{addRole:!1,status:e,variant:n,id:l==null?void 0:l.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:u,children:[P.jsx(Lc,{children:c}),P.jsxs(ft.div,{flex:"1",maxWidth:"100%",children:[i&&P.jsx(Mc,{id:l==null?void 0:l.title,children:i}),a&&P.jsx(Fc,{id:l==null?void 0:l.description,display:"block",children:a})]}),o&&P.jsx(cH,{size:"sm",onClick:s,position:"absolute",insetEnd:1,top:1})]})};function R0e(t={}){const{render:e,toastComponent:n=I0e}=t;return i=>typeof e=="function"?e({...i,...t}):P.jsx(n,{...i,...t})}var[N0e,z9e]=jo({name:"ToastOptionsContext",strict:!1}),P0e=t=>{const e=A.useSyncExternalStore(Gv.subscribe,Gv.getState,Gv.getState),{motionVariants:n,component:r=aH,portalProps:i}=t,s=Object.keys(e).map(a=>{const u=e[a];return P.jsx("div",{role:"region","aria-live":"polite","aria-label":"Notifications",id:`chakra-toast-manager-${a}`,style:Qpe(a),children:P.jsx($0,{initial:!1,children:u.map(c=>P.jsx(r,{motionVariants:n,...c},c.id))})},a)});return P.jsx(E0,{...i,children:s})},A0e=t=>function({children:n,theme:r=t,toastOptions:i,...o}){return P.jsxs(Xpe,{theme:r,...o,children:[P.jsx(N0e,{value:i==null?void 0:i.defaultOptions,children:n}),P.jsx(P0e,{...i})]})},$0e=A0e(I6);function D0e(t,e){if(t!=null){if(typeof t=="function"){t(e);return}try{t.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${t}'`)}}}function km(...t){return e=>{t.forEach(n=>{D0e(n,e)})}}function O0e(...t){return A.useMemo(()=>km(...t),t)}var sB={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1]},Cf={enter:{duration:.2,ease:sB.easeOut},exit:{duration:.1,ease:sB.easeIn}},kf={enter:(t,e)=>({...t,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(t,e)=>({...t,delay:typeof e=="number"?e:e==null?void 0:e.exit})},F0e={enter:({transition:t,transitionEnd:e,delay:n}={})=>{var r;return{opacity:1,transition:(r=t==null?void 0:t.enter)!=null?r:kf.enter(Cf.enter,n),transitionEnd:e==null?void 0:e.enter}},exit:({transition:t,transitionEnd:e,delay:n}={})=>{var r;return{opacity:0,transition:(r=t==null?void 0:t.exit)!=null?r:kf.exit(Cf.exit,n),transitionEnd:e==null?void 0:e.exit}}},lH={initial:"exit",animate:"enter",exit:"exit",variants:F0e},L0e=A.forwardRef(function(e,n){const{unmountOnExit:r,in:i,className:o,transition:s,transitionEnd:a,delay:u,...c}=e,l=i||r?"enter":"exit",d=r?i&&r:!0,f={transition:s,transitionEnd:a,delay:u};return P.jsx($0,{custom:f,children:d&&P.jsx(Km.div,{ref:n,className:zt("chakra-fade",o),custom:f,...lH,animate:l,...c})})});L0e.displayName="Fade";var M0e={exit:({reverse:t,initialScale:e,transition:n,transitionEnd:r,delay:i})=>{var o;return{opacity:0,...t?{scale:e,transitionEnd:r==null?void 0:r.exit}:{transitionEnd:{scale:e,...r==null?void 0:r.exit}},transition:(o=n==null?void 0:n.exit)!=null?o:kf.exit(Cf.exit,i)}},enter:({transitionEnd:t,transition:e,delay:n})=>{var r;return{opacity:1,scale:1,transition:(r=e==null?void 0:e.enter)!=null?r:kf.enter(Cf.enter,n),transitionEnd:t==null?void 0:t.enter}}},dH={initial:"exit",animate:"enter",exit:"exit",variants:M0e},B0e=A.forwardRef(function(e,n){const{unmountOnExit:r,in:i,reverse:o=!0,initialScale:s=.95,className:a,transition:u,transitionEnd:c,delay:l,...d}=e,f=r?i&&r:!0,h=i||r?"enter":"exit",p={initialScale:s,reverse:o,transition:u,transitionEnd:c,delay:l};return P.jsx($0,{custom:p,children:f&&P.jsx(Km.div,{ref:n,className:zt("chakra-offset-slide",a),...dH,animate:h,custom:p,...d})})});B0e.displayName="ScaleFade";var U0e={initial:({offsetX:t,offsetY:e,transition:n,transitionEnd:r,delay:i})=>{var o;return{opacity:0,x:t,y:e,transition:(o=n==null?void 0:n.exit)!=null?o:kf.exit(Cf.exit,i),transitionEnd:r==null?void 0:r.exit}},enter:({transition:t,transitionEnd:e,delay:n})=>{var r;return{opacity:1,x:0,y:0,transition:(r=t==null?void 0:t.enter)!=null?r:kf.enter(Cf.enter,n),transitionEnd:e==null?void 0:e.enter}},exit:({offsetY:t,offsetX:e,transition:n,transitionEnd:r,reverse:i,delay:o})=>{var s;const a={x:e,y:t};return{opacity:0,transition:(s=n==null?void 0:n.exit)!=null?s:kf.exit(Cf.exit,o),...i?{...a,transitionEnd:r==null?void 0:r.exit}:{transitionEnd:{...a,...r==null?void 0:r.exit}}}}},z_={initial:"initial",animate:"enter",exit:"exit",variants:U0e},V0e=A.forwardRef(function(e,n){const{unmountOnExit:r,in:i,reverse:o=!0,className:s,offsetX:a=0,offsetY:u=8,transition:c,transitionEnd:l,delay:d,...f}=e,h=r?i&&r:!0,p=i||r?"enter":"exit",m={offsetX:a,offsetY:u,reverse:o,transition:c,transitionEnd:l,delay:d};return P.jsx($0,{custom:m,children:h&&P.jsx(Km.div,{ref:n,className:zt("chakra-offset-slide",s),custom:m,...z_,animate:p,...f})})});V0e.displayName="SlideFade";function fH(t){return A.Children.toArray(t).filter(e=>A.isValidElement(e))}var[W9e,z0e]=jo({strict:!1,name:"ButtonGroupContext"});function W0e(t){const[e,n]=A.useState(!t);return{ref:A.useCallback(o=>{o&&n(o.tagName==="BUTTON")},[]),type:e?"button":void 0}}function W_(t){const{children:e,className:n,...r}=t,i=A.isValidElement(e)?A.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,o=zt("chakra-button__icon",n);return P.jsx(ft.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...r,className:o,children:i})}W_.displayName="ButtonIcon";function j_(t){const{label:e,placement:n,spacing:r="0.5rem",children:i=P.jsx(ch,{color:"currentColor",width:"1em",height:"1em"}),className:o,__css:s,...a}=t,u=zt("chakra-button__spinner",o),c=n==="start"?"marginEnd":"marginStart",l=A.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[c]:e?r:0,fontSize:"1em",lineHeight:"normal",...s}),[s,e,c,r]);return P.jsx(ft.div,{className:u,...a,__css:l,children:i})}j_.displayName="ButtonSpinner";var qn=wt((t,e)=>{const n=z0e(),r=wd("Button",{...n,...t}),{isDisabled:i=n==null?void 0:n.isDisabled,isLoading:o,isActive:s,children:a,leftIcon:u,rightIcon:c,loadingText:l,iconSpacing:d="0.5rem",type:f,spinner:h,spinnerPlacement:p="start",className:m,as:v,...g}=go(t),y=A.useMemo(()=>{const C={...r==null?void 0:r._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...r,...!!n&&{_focus:C}}},[r,n]),{ref:b,type:x}=W0e(v),S={rightIcon:c,leftIcon:u,iconSpacing:d,children:a};return P.jsxs(ft.button,{ref:O0e(e,b),as:v,type:f??x,"data-active":zn(s),"data-loading":zn(o),__css:y,className:zt("chakra-button",m),...g,disabled:i||o,children:[o&&p==="start"&&P.jsx(j_,{className:"chakra-button__spinner--start",label:l,placement:"start",spacing:d,children:h}),o?l||P.jsx(ft.span,{opacity:0,children:P.jsx(aB,{...S})}):P.jsx(aB,{...S}),o&&p==="end"&&P.jsx(j_,{className:"chakra-button__spinner--end",label:l,placement:"end",spacing:d,children:h})]})});qn.displayName="Button";function aB(t){const{leftIcon:e,rightIcon:n,children:r,iconSpacing:i}=t;return P.jsxs(P.Fragment,{children:[e&&P.jsx(W_,{marginEnd:i,children:e}),r,n&&P.jsx(W_,{marginStart:i,children:n})]})}var[j0e,G0e]=qpe("Card"),uB=wt(function(e,n){const{className:r,...i}=e,o=G0e();return P.jsx(ft.div,{ref:n,className:zt("chakra-card__body",r),__css:o.body,...i})}),cB=wt(function(e,n){const{className:r,children:i,direction:o="column",justify:s,align:a,...u}=go(e),c=Sd("Card",e);return P.jsx(ft.div,{ref:n,className:zt("chakra-card",r),__css:{display:"flex",flexDirection:o,justifyContent:s,alignItems:a,position:"relative",minWidth:0,wordWrap:"break-word",...c.container},...u,children:P.jsx(j0e,{value:c,children:i})})}),[H0e,hH]=jo({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[q0e,O0]=jo({strict:!1,name:"FormControlContext"});function K0e(t){const{id:e,isRequired:n,isInvalid:r,isDisabled:i,isReadOnly:o,...s}=t,a=A.useId(),u=e||`field-${a}`,c=`${u}-label`,l=`${u}-feedback`,d=`${u}-helptext`,[f,h]=A.useState(!1),[p,m]=A.useState(!1),[v,g]=A.useState(!1),y=A.useCallback((T={},E=null)=>({id:d,...T,ref:km(E,I=>{I&&m(!0)})}),[d]),b=A.useCallback((T={},E=null)=>({...T,ref:E,"data-focus":zn(v),"data-disabled":zn(i),"data-invalid":zn(r),"data-readonly":zn(o),id:T.id!==void 0?T.id:c,htmlFor:T.htmlFor!==void 0?T.htmlFor:u}),[u,i,v,r,o,c]),x=A.useCallback((T={},E=null)=>({id:l,...T,ref:km(E,I=>{I&&h(!0)}),"aria-live":"polite"}),[l]),S=A.useCallback((T={},E=null)=>({...T,...s,ref:E,role:"group"}),[s]),C=A.useCallback((T={},E=null)=>({...T,ref:E,role:"presentation","aria-hidden":!0,children:T.children||"*"}),[]);return{isRequired:!!n,isInvalid:!!r,isReadOnly:!!o,isDisabled:!!i,isFocused:!!v,onFocus:()=>g(!0),onBlur:()=>g(!1),hasFeedbackText:f,setHasFeedbackText:h,hasHelpText:p,setHasHelpText:m,id:u,labelId:c,feedbackId:l,helpTextId:d,htmlProps:s,getHelpTextProps:y,getErrorMessageProps:x,getRootProps:S,getLabelProps:b,getRequiredIndicatorProps:C}}var G_=wt(function(e,n){const r=Sd("Form",e),i=go(e),{getRootProps:o,htmlProps:s,...a}=K0e(i),u=zt("chakra-form-control",e.className);return P.jsx(q0e,{value:a,children:P.jsx(H0e,{value:r,children:P.jsx(ft.div,{...o({},n),className:u,__css:r.container})})})});G_.displayName="FormControl";var X0e=wt(function(e,n){const r=O0(),i=hH(),o=zt("chakra-form__helper-text",e.className);return P.jsx(ft.div,{...r==null?void 0:r.getHelpTextProps(e,n),__css:i.helperText,className:o})});X0e.displayName="FormHelperText";var H_=wt(function(e,n){var r;const i=wd("FormLabel",e),o=go(e),{className:s,children:a,requiredIndicator:u=P.jsx(pH,{}),optionalIndicator:c=null,...l}=o,d=O0(),f=(r=d==null?void 0:d.getLabelProps(l,n))!=null?r:{ref:n,...l};return P.jsxs(ft.label,{...f,className:zt("chakra-form__label",o.className),__css:{display:"block",textAlign:"start",...i},children:[a,d!=null&&d.isRequired?u:c]})});H_.displayName="FormLabel";var pH=wt(function(e,n){const r=O0(),i=hH();if(!(r!=null&&r.isRequired))return null;const o=zt("chakra-form__required-indicator",e.className);return P.jsx(ft.span,{...r==null?void 0:r.getRequiredIndicatorProps(e,n),__css:i.requiredIndicator,className:o})});pH.displayName="RequiredIndicator";function J0e(t){const{isDisabled:e,isInvalid:n,isReadOnly:r,isRequired:i,...o}=Y0e(t);return{...o,disabled:e,readOnly:r,required:i,"aria-invalid":Vp(n),"aria-required":Vp(i),"aria-readonly":Vp(r)}}function Y0e(t){var e,n,r;const i=O0(),{id:o,disabled:s,readOnly:a,required:u,isRequired:c,isInvalid:l,isReadOnly:d,isDisabled:f,onFocus:h,onBlur:p,...m}=t,v=t["aria-describedby"]?[t["aria-describedby"]]:[];return i!=null&&i.hasFeedbackText&&(i!=null&&i.isInvalid)&&v.push(i.feedbackId),i!=null&&i.hasHelpText&&v.push(i.helpTextId),{...m,"aria-describedby":v.join(" ")||void 0,id:o??(i==null?void 0:i.id),isDisabled:(e=s??f)!=null?e:i==null?void 0:i.isDisabled,isReadOnly:(n=a??d)!=null?n:i==null?void 0:i.isReadOnly,isRequired:(r=u??c)!=null?r:i==null?void 0:i.isRequired,isInvalid:l??(i==null?void 0:i.isInvalid),onFocus:Qr(i==null?void 0:i.onFocus,h),onBlur:Qr(i==null?void 0:i.onBlur,p)}}const Q0e=()=>typeof document<"u";let lB=!1,F0=null,Bf=!1,q_=!1;const K_=new Set;function xP(t,e){K_.forEach(n=>n(t,e))}const Z0e=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function ebe(t){return!(t.metaKey||!Z0e&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function dB(t){Bf=!0,ebe(t)&&(F0="keyboard",xP("keyboard",t))}function jh(t){if(F0="pointer",t.type==="mousedown"||t.type==="pointerdown"){Bf=!0;const e=t.composedPath?t.composedPath()[0]:t.target;let n=!1;try{n=e.matches(":focus-visible")}catch{}if(n)return;xP("pointer",t)}}function tbe(t){return t.mozInputSource===0&&t.isTrusted?!0:t.detail===0&&!t.pointerType}function nbe(t){tbe(t)&&(Bf=!0,F0="virtual")}function rbe(t){t.target===window||t.target===document||(!Bf&&!q_&&(F0="virtual",xP("virtual",t)),Bf=!1,q_=!1)}function ibe(){Bf=!1,q_=!0}function fB(){return F0!=="pointer"}function obe(){if(!Q0e()||lB)return;const{focus:t}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...n){Bf=!0,t.apply(this,n)},document.addEventListener("keydown",dB,!0),document.addEventListener("keyup",dB,!0),document.addEventListener("click",nbe,!0),window.addEventListener("focus",rbe,!0),window.addEventListener("blur",ibe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",jh,!0),document.addEventListener("pointermove",jh,!0),document.addEventListener("pointerup",jh,!0)):(document.addEventListener("mousedown",jh,!0),document.addEventListener("mousemove",jh,!0),document.addEventListener("mouseup",jh,!0)),lB=!0}function sbe(t){obe(),t(fB());const e=()=>t(fB());return K_.add(e),()=>{K_.delete(e)}}function abe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var X_="data-focus-lock",mH="data-focus-lock-disabled",ube="data-no-focus-lock",cbe="data-autofocus-inside",lbe="data-no-autofocus";function dbe(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function fbe(t,e){var n=A.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}function gH(t,e){return fbe(e||null,function(n){return t.forEach(function(r){return dbe(r,n)})})}var sT={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},$a=function(){return $a=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},$a.apply(this,arguments)};function vH(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function hbe(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function yH(t){return t}function bH(t,e){e===void 0&&(e=yH);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var s=e(o,r);return n.push(s),function(){n=n.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(r=!0;n.length;){var s=n;n=[],s.forEach(o)}n={push:function(a){return o(a)},filter:function(){return n}}},assignMedium:function(o){r=!0;var s=[];if(n.length){var a=n;n=[],a.forEach(o),s=n}var u=function(){var l=s;s=[],l.forEach(o)},c=function(){return Promise.resolve().then(u)};c(),n={push:function(l){s.push(l),c()},filter:function(l){return s=s.filter(l),n}}}};return i}function wP(t,e){return e===void 0&&(e=yH),bH(t,e)}function xH(t){t===void 0&&(t={});var e=bH(null);return e.options=$a({async:!0,ssr:!1},t),e}var wH=function(t){var e=t.sideCar,n=vH(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return A.createElement(r,$a({},n))};wH.isSideCarExport=!0;function pbe(t,e){return t.useMedium(e),wH}var SH=wP({},function(t){var e=t.target,n=t.currentTarget;return{target:e,currentTarget:n}}),CH=wP(),mbe=wP(),gbe=xH({async:!0}),vbe=[],SP=A.forwardRef(function(e,n){var r,i=A.useState(),o=i[0],s=i[1],a=A.useRef(),u=A.useRef(!1),c=A.useRef(null),l=e.children,d=e.disabled,f=e.noFocusGuards,h=e.persistentFocus,p=e.crossFrame,m=e.autoFocus;e.allowTextSelection;var v=e.group,g=e.className,y=e.whiteList,b=e.hasPositiveIndices,x=e.shards,S=x===void 0?vbe:x,C=e.as,T=C===void 0?"div":C,E=e.lockProps,I=E===void 0?{}:E,N=e.sideCar,$=e.returnFocus,F=e.focusOptions,H=e.onActivation,G=e.onDeactivation,J=A.useState({}),ne=J[0],oe=A.useCallback(function(){c.current=c.current||document&&document.activeElement,a.current&&H&&H(a.current),u.current=!0},[H]),q=A.useCallback(function(){u.current=!1,G&&G(a.current)},[G]);A.useEffect(function(){d||(c.current=null)},[]);var Z=A.useCallback(function($e){var Ge=c.current;if(Ge&&Ge.focus){var tt=typeof $=="function"?$(Ge):$;if(tt){var mt=typeof tt=="object"?tt:void 0;c.current=null,$e?Promise.resolve().then(function(){return Ge.focus(mt)}):Ge.focus(mt)}}},[$]),se=A.useCallback(function($e){u.current&&SH.useMedium($e)},[]),fe=CH.useMedium,xe=A.useCallback(function($e){a.current!==$e&&(a.current=$e,s($e))},[]),be=Mf((r={},r[mH]=d&&"disabled",r[X_]=v,r),I),pe=f!==!0,ge=pe&&f!=="tail",Ce=gH([n,xe]);return A.createElement(A.Fragment,null,pe&&[A.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:d?-1:0,style:sT}),b?A.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:d?-1:1,style:sT}):null],!d&&A.createElement(N,{id:ne,sideCar:gbe,observed:o,disabled:d,persistentFocus:h,crossFrame:p,autoFocus:m,whiteList:y,shards:S,onActivation:oe,onDeactivation:q,returnFocus:Z,focusOptions:F}),A.createElement(T,Mf({ref:Ce},be,{className:g,onBlur:fe,onFocus:se}),l),ge&&A.createElement("div",{"data-focus-guard":!0,tabIndex:d?-1:0,style:sT}))});SP.propTypes={};SP.defaultProps={children:void 0,disabled:!1,returnFocus:!1,focusOptions:void 0,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,hasPositiveIndices:void 0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};const kH=SP;function J_(t,e){return J_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},J_(t,e)}function ybe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,J_(t,e)}function Ay(t){"@babel/helpers - typeof";return Ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ay(t)}function bbe(t,e){if(Ay(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Ay(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function xbe(t){var e=bbe(t,"string");return Ay(e)==="symbol"?e:String(e)}function wbe(t,e,n){return e=xbe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Sbe(t,e){function n(r){return r.displayName||r.name||"Component"}return function(i){var o=[],s;function a(){s=t(o.map(function(c){return c.props})),e(s)}var u=function(c){ybe(l,c);function l(){return c.apply(this,arguments)||this}l.peek=function(){return s};var d=l.prototype;return d.componentDidMount=function(){o.push(this),a()},d.componentDidUpdate=function(){a()},d.componentWillUnmount=function(){var h=o.indexOf(this);o.splice(h,1),a()},d.render=function(){return Do.createElement(i,this.props)},l}(A.PureComponent);return wbe(u,"displayName","SideEffect("+n(i)+")"),u}}var vu=function(t){for(var e=Array(t.length),n=0;n<t.length;++n)e[n]=t[n];return e},Mw=function(t){return Array.isArray(t)?t:[t]},TH=function(t){return Array.isArray(t)?t[0]:t},Cbe=function(t){if(t.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(t,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},EH=function(t){return t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t.parentNode.host:t.parentNode},_H=function(t){return t===document||t&&t.nodeType===Node.DOCUMENT_NODE},kbe=function(t,e){return!t||_H(t)||!Cbe(t)&&e(EH(t))},IH=function(t,e){var n=t.get(e);if(n!==void 0)return n;var r=kbe(e,IH.bind(void 0,t));return t.set(e,r),r},Tbe=function(t,e){return t&&!_H(t)?Ibe(t)?e(EH(t)):!1:!0},RH=function(t,e){var n=t.get(e);if(n!==void 0)return n;var r=Tbe(e,RH.bind(void 0,t));return t.set(e,r),r},NH=function(t){return t.dataset},Ebe=function(t){return t.tagName==="BUTTON"},PH=function(t){return t.tagName==="INPUT"},AH=function(t){return PH(t)&&t.type==="radio"},_be=function(t){return!((PH(t)||Ebe(t))&&(t.type==="hidden"||t.disabled))},Ibe=function(t){var e=t.getAttribute(lbe);return![!0,"true",""].includes(e)},CP=function(t){var e;return!!(t&&(!((e=NH(t))===null||e===void 0)&&e.focusGuard))},Bw=function(t){return!CP(t)},Rbe=function(t){return!!t},Nbe=function(t,e){var n=t.tabIndex-e.tabIndex,r=t.index-e.index;if(n){if(!t.tabIndex)return 1;if(!e.tabIndex)return-1}return n||r},$H=function(t,e,n){return vu(t).map(function(r,i){return{node:r,index:i,tabIndex:n&&r.tabIndex===-1?(r.dataset||{}).focusGuard?0:-1:r.tabIndex}}).filter(function(r){return!e||r.tabIndex>=0}).sort(Nbe)},Pbe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],kP=Pbe.join(","),Abe="".concat(kP,", [data-focus-guard]"),DH=function(t,e){return vu((t.shadowRoot||t).children).reduce(function(n,r){return n.concat(r.matches(e?Abe:kP)?[r]:[],DH(r))},[])},$be=function(t,e){var n;return t instanceof HTMLIFrameElement&&(!((n=t.contentDocument)===null||n===void 0)&&n.body)?AC([t.contentDocument.body],e):[t]},AC=function(t,e){return t.reduce(function(n,r){var i,o=DH(r,e),s=(i=[]).concat.apply(i,o.map(function(a){return $be(a,e)}));return n.concat(s,r.parentNode?vu(r.parentNode.querySelectorAll(kP)).filter(function(a){return a===r}):[])},[])},Dbe=function(t){var e=t.querySelectorAll("[".concat(cbe,"]"));return vu(e).map(function(n){return AC([n])}).reduce(function(n,r){return n.concat(r)},[])},TP=function(t,e){return vu(t).filter(function(n){return IH(e,n)}).filter(function(n){return _be(n)})},hB=function(t,e){return e===void 0&&(e=new Map),vu(t).filter(function(n){return RH(e,n)})},Y_=function(t,e,n){return $H(TP(AC(t,n),e),!0,n)},pB=function(t,e){return $H(TP(AC(t),e),!1)},Obe=function(t,e){return TP(Dbe(t),e)},Hp=function(t,e){return t.shadowRoot?Hp(t.shadowRoot,e):Object.getPrototypeOf(t).contains!==void 0&&Object.getPrototypeOf(t).contains.call(t,e)?!0:vu(t.children).some(function(n){var r;if(n instanceof HTMLIFrameElement){var i=(r=n.contentDocument)===null||r===void 0?void 0:r.body;return i?Hp(i,e):!1}return Hp(n,e)})},Fbe=function(t){for(var e=new Set,n=t.length,r=0;r<n;r+=1)for(var i=r+1;i<n;i+=1){var o=t[r].compareDocumentPosition(t[i]);(o&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(i),(o&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(r)}return t.filter(function(s,a){return!e.has(a)})},OH=function(t){return t.parentNode?OH(t.parentNode):t},EP=function(t){var e=Mw(t);return e.filter(Boolean).reduce(function(n,r){var i=r.getAttribute(X_);return n.push.apply(n,i?Fbe(vu(OH(r).querySelectorAll("[".concat(X_,'="').concat(i,'"]:not([').concat(mH,'="disabled"])')))):[r]),n},[])},Lbe=function(t){try{return t()}catch{return}},$y=function(t){if(t===void 0&&(t=document),!(!t||!t.activeElement)){var e=t.activeElement;return e.shadowRoot?$y(e.shadowRoot):e instanceof HTMLIFrameElement&&Lbe(function(){return e.contentWindow.document})?$y(e.contentWindow.document):e}},Mbe=function(t,e){return t===e},Bbe=function(t,e){return!!vu(t.querySelectorAll("iframe")).some(function(n){return Mbe(n,e)})},FH=function(t,e){return e===void 0&&(e=$y(TH(t).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:EP(t).some(function(n){return Hp(n,e)||Bbe(n,e)})},Ube=function(t){t===void 0&&(t=document);var e=$y(t);return e?vu(t.querySelectorAll("[".concat(ube,"]"))).some(function(n){return Hp(n,e)}):!1},Vbe=function(t,e){return e.filter(AH).filter(function(n){return n.name===t.name}).filter(function(n){return n.checked})[0]||t},_P=function(t,e){return AH(t)&&t.name?Vbe(t,e):t},zbe=function(t){var e=new Set;return t.forEach(function(n){return e.add(_P(n,t))}),t.filter(function(n){return e.has(n)})},mB=function(t){return t[0]&&t.length>1?_P(t[0],t):t[0]},gB=function(t,e){return t.length>1?t.indexOf(_P(t[e],t)):e},LH="NEW_FOCUS",Wbe=function(t,e,n,r){var i=t.length,o=t[0],s=t[i-1],a=CP(n);if(!(n&&t.indexOf(n)>=0)){var u=n!==void 0?e.indexOf(n):-1,c=r?e.indexOf(r):u,l=r?t.indexOf(r):-1,d=u-c,f=e.indexOf(o),h=e.indexOf(s),p=zbe(e),m=n!==void 0?p.indexOf(n):-1,v=m-(r?p.indexOf(r):u),g=gB(t,0),y=gB(t,i-1);if(u===-1||l===-1)return LH;if(!d&&l>=0)return l;if(u<=f&&a&&Math.abs(d)>1)return y;if(u>=h&&a&&Math.abs(d)>1)return g;if(d&&Math.abs(v)>1)return l;if(u<=f)return y;if(u>h)return g;if(d)return Math.abs(d)>1?l:(i+l+d)%i}},jbe=function(t){return function(e){var n,r=(n=NH(e))===null||n===void 0?void 0:n.autofocus;return e.autofocus||r!==void 0&&r!=="false"||t.indexOf(e)>=0}},Gbe=function(t,e,n){var r=t.map(function(o){var s=o.node;return s}),i=hB(r.filter(jbe(n)));return i&&i.length?mB(i):mB(hB(e))},Q_=function(t,e){return e===void 0&&(e=[]),e.push(t),t.parentNode&&Q_(t.parentNode.host||t.parentNode,e),e},aT=function(t,e){for(var n=Q_(t),r=Q_(e),i=0;i<n.length;i+=1){var o=n[i];if(r.indexOf(o)>=0)return o}return!1},MH=function(t,e,n){var r=Mw(t),i=Mw(e),o=r[0],s=!1;return i.filter(Boolean).forEach(function(a){s=aT(s||a,a)||s,n.filter(Boolean).forEach(function(u){var c=aT(o,u);c&&(!s||Hp(c,s)?s=c:s=aT(c,s))})}),s},Hbe=function(t,e){return t.reduce(function(n,r){return n.concat(Obe(r,e))},[])},qbe=function(t,e){var n=new Map;return e.forEach(function(r){return n.set(r.node,r)}),t.map(function(r){return n.get(r)}).filter(Rbe)},Kbe=function(t,e){var n=$y(Mw(t).length>0?document:TH(t).ownerDocument),r=EP(t).filter(Bw),i=MH(n||t,t,r),o=new Map,s=pB(r,o),a=Y_(r,o).filter(function(h){var p=h.node;return Bw(p)});if(!(!a[0]&&(a=s,!a[0]))){var u=pB([i],o).map(function(h){var p=h.node;return p}),c=qbe(u,a),l=c.map(function(h){var p=h.node;return p}),d=Wbe(l,u,n,e);if(d===LH){var f=Gbe(s,l,Hbe(r,o));if(f)return{node:f};console.warn("focus-lock: cannot find any node to move focus into");return}return d===void 0?d:c[d]}},Xbe=function(t){var e=EP(t).filter(Bw),n=MH(t,t,e),r=new Map,i=Y_([n],r,!0),o=Y_(e,r).filter(function(s){var a=s.node;return Bw(a)}).map(function(s){var a=s.node;return a});return i.map(function(s){var a=s.node,u=s.index;return{node:a,index:u,lockItem:o.indexOf(a)>=0,guard:CP(a)}})},Jbe=function(t,e){"focus"in t&&t.focus(e),"contentWindow"in t&&t.contentWindow&&t.contentWindow.focus()},uT=0,cT=!1,BH=function(t,e,n){n===void 0&&(n={});var r=Kbe(t,e);if(!cT&&r){if(uT>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),cT=!0,setTimeout(function(){cT=!1},1);return}uT++,Jbe(r.node,n.focusOptions),uT--}};function IP(t){setTimeout(t,1)}var Ybe=function(){return document&&document.activeElement===document.body},Qbe=function(){return Ybe()||Ube()},qp=null,Pp=null,Kp=null,Dy=!1,Zbe=function(){return!0},e1e=function(e){return(qp.whiteList||Zbe)(e)},t1e=function(e,n){Kp={observerNode:e,portaledElement:n}},n1e=function(e){return Kp&&Kp.portaledElement===e};function vB(t,e,n,r){var i=null,o=t;do{var s=r[o];if(s.guard)s.node.dataset.focusAutoGuard&&(i=s);else if(s.lockItem){if(o!==t)return;i=null}else break}while((o+=n)!==e);i&&(i.node.tabIndex=0)}var r1e=function(e){return e&&"current"in e?e.current:e},i1e=function(e){return e?!!Dy:Dy==="meanwhile"},o1e=function t(e,n,r){return n&&(n.host===e&&(!n.activeElement||r.contains(n.activeElement))||n.parentNode&&t(e,n.parentNode,r))},s1e=function(e,n){return n.some(function(r){return o1e(e,r,r)})},Uw=function(){var e=!1;if(qp){var n=qp,r=n.observed,i=n.persistentFocus,o=n.autoFocus,s=n.shards,a=n.crossFrame,u=n.focusOptions,c=r||Kp&&Kp.portaledElement,l=document&&document.activeElement;if(c){var d=[c].concat(s.map(r1e).filter(Boolean));if((!l||e1e(l))&&(i||i1e(a)||!Qbe()||!Pp&&o)&&(c&&!(FH(d)||l&&s1e(l,d)||n1e(l))&&(document&&!Pp&&l&&!o?(l.blur&&l.blur(),document.body.focus()):(e=BH(d,Pp,{focusOptions:u}),Kp={})),Dy=!1,Pp=document&&document.activeElement),document){var f=document&&document.activeElement,h=Xbe(d),p=h.map(function(m){var v=m.node;return v}).indexOf(f);p>-1&&(h.filter(function(m){var v=m.guard,g=m.node;return v&&g.dataset.focusAutoGuard}).forEach(function(m){var v=m.node;return v.removeAttribute("tabIndex")}),vB(p,h.length,1,h),vB(p,-1,-1,h))}}}return e},UH=function(e){Uw()&&e&&(e.stopPropagation(),e.preventDefault())},RP=function(){return IP(Uw)},a1e=function(e){var n=e.target,r=e.currentTarget;r.contains(n)||t1e(r,n)},u1e=function(){return null},VH=function(){Dy="just",IP(function(){Dy="meanwhile"})},c1e=function(){document.addEventListener("focusin",UH),document.addEventListener("focusout",RP),window.addEventListener("blur",VH)},l1e=function(){document.removeEventListener("focusin",UH),document.removeEventListener("focusout",RP),window.removeEventListener("blur",VH)};function d1e(t){return t.filter(function(e){var n=e.disabled;return!n})}function f1e(t){var e=t.slice(-1)[0];e&&!qp&&c1e();var n=qp,r=n&&e&&e.id===n.id;qp=e,n&&!r&&(n.onDeactivation(),t.filter(function(i){var o=i.id;return o===n.id}).length||n.returnFocus(!e)),e?(Pp=null,(!r||n.observed!==e.observed)&&e.onActivation(),Uw(),IP(Uw)):(l1e(),Pp=null)}SH.assignSyncMedium(a1e);CH.assignMedium(RP);mbe.assignMedium(function(t){return t({moveFocusInside:BH,focusInside:FH})});const h1e=Sbe(d1e,f1e)(u1e);var zH=A.forwardRef(function(e,n){return A.createElement(kH,Mf({sideCar:h1e,ref:n},e))}),WH=kH.propTypes||{};WH.sideCar;abe(WH,["sideCar"]);zH.propTypes={};const yB=zH;function p1e(t){return t!=null&&typeof t=="object"&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE}function m1e(t){var e;if(!p1e(t))return!1;const n=(e=t.ownerDocument.defaultView)!=null?e:window;return t instanceof n.HTMLElement}var g1e=t=>t.hasAttribute("tabindex");function v1e(t){return!!t.getAttribute("disabled")||!!t.getAttribute("aria-disabled")}function jH(t){return t.parentElement&&jH(t.parentElement)?!0:t.hidden}function y1e(t){const e=t.getAttribute("contenteditable");return e!=="false"&&e!=null}function b1e(t){if(!m1e(t)||jH(t)||v1e(t))return!1;const{localName:e}=t;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const r={a:()=>t.hasAttribute("href"),audio:()=>t.hasAttribute("controls"),video:()=>t.hasAttribute("controls")};return e in r?r[e]():y1e(t)?!0:g1e(t)}var x1e=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],w1e=x1e.join(),S1e=t=>t.offsetWidth>0&&t.offsetHeight>0;function C1e(t){const e=Array.from(t.querySelectorAll(w1e));return e.unshift(t),e.filter(n=>b1e(n)&&S1e(n))}var bB,k1e=(bB=yB.default)!=null?bB:yB,GH=t=>{const{initialFocusRef:e,finalFocusRef:n,contentRef:r,restoreFocus:i,children:o,isDisabled:s,autoFocus:a,persistentFocus:u,lockFocusAcrossFrames:c}=t,l=A.useCallback(()=>{e!=null&&e.current?e.current.focus():r!=null&&r.current&&C1e(r.current).length===0&&requestAnimationFrame(()=>{var p;(p=r.current)==null||p.focus()})},[e,r]),d=A.useCallback(()=>{var h;(h=n==null?void 0:n.current)==null||h.focus()},[n]),f=i&&!n;return P.jsx(k1e,{crossFrame:c,persistentFocus:u,autoFocus:a,disabled:s,onActivation:l,onDeactivation:d,returnFocus:f,children:o})};GH.displayName="FocusLock";var T1e=bpe?A.useLayoutEffect:A.useEffect;function xB(t,e=[]){const n=A.useRef(t);return T1e(()=>{n.current=t}),A.useCallback((...r)=>{var i;return(i=n.current)==null?void 0:i.call(n,...r)},e)}function E1e(t,e){const n=A.useId();return A.useMemo(()=>t||[e,n].filter(Boolean).join("-"),[t,e,n])}function _1e(t,e){const n=t!==void 0;return[n,n&&typeof t<"u"?t:e]}function Xm(t={}){const{onClose:e,onOpen:n,isOpen:r,id:i}=t,o=xB(n),s=xB(e),[a,u]=A.useState(t.defaultIsOpen||!1),[c,l]=_1e(r,a),d=E1e(i,"disclosure"),f=A.useCallback(()=>{c||u(!1),s==null||s()},[c,s]),h=A.useCallback(()=>{c||u(!0),o==null||o()},[c,o]),p=A.useCallback(()=>{(l?f:h)()},[l,h,f]);return{isOpen:!!l,onOpen:h,onClose:f,onToggle:p,isControlled:c,getButtonProps:(m={})=>({...m,"aria-expanded":l,"aria-controls":d,onClick:kpe(m.onClick,p)}),getDisclosureProps:(m={})=>({...m,hidden:!l,id:d})}}var[I1e,R1e]=jo({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),HH=wt(function(e,n){const r=Sd("Input",e),{children:i,className:o,...s}=go(e),a=zt("chakra-input__group",o),u={},c=fH(i),l=r.field;c.forEach(f=>{var h,p;r&&(l&&f.type.id==="InputLeftElement"&&(u.paddingStart=(h=l.height)!=null?h:l.h),l&&f.type.id==="InputRightElement"&&(u.paddingEnd=(p=l.height)!=null?p:l.h),f.type.id==="InputRightAddon"&&(u.borderEndRadius=0),f.type.id==="InputLeftAddon"&&(u.borderStartRadius=0))});const d=c.map(f=>{var h,p;const m=JN({size:((h=f.props)==null?void 0:h.size)||e.size,variant:((p=f.props)==null?void 0:p.variant)||e.variant});return f.type.id!=="Input"?A.cloneElement(f,m):A.cloneElement(f,Object.assign(m,u,f.props))});return P.jsx(ft.div,{className:a,ref:n,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...r.group},"data-group":!0,...s,children:P.jsx(I1e,{value:r,children:d})})});HH.displayName="InputGroup";var N1e=ft("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),$C=wt(function(e,n){var r,i;const{placement:o="left",...s}=e,a=R1e(),u=a.field,l={[o==="left"?"insetStart":"insetEnd"]:"0",width:(r=u==null?void 0:u.height)!=null?r:u==null?void 0:u.h,height:(i=u==null?void 0:u.height)!=null?i:u==null?void 0:u.h,fontSize:u==null?void 0:u.fontSize,...a.element};return P.jsx(N1e,{ref:n,__css:l,...s})});$C.id="InputElement";$C.displayName="InputElement";var qH=wt(function(e,n){const{className:r,...i}=e,o=zt("chakra-input__left-element",r);return P.jsx($C,{ref:n,placement:"left",className:o,...i})});qH.id="InputLeftElement";qH.displayName="InputLeftElement";var NP=wt(function(e,n){const{className:r,...i}=e,o=zt("chakra-input__right-element",r);return P.jsx($C,{ref:n,placement:"right",className:o,...i})});NP.id="InputRightElement";NP.displayName="InputRightElement";var Oy=wt(function(e,n){const{htmlSize:r,...i}=e,o=Sd("Input",i),s=go(i),a=J0e(s),u=zt("chakra-input",e.className);return P.jsx(ft.input,{size:r,...a,__css:o.field,ref:n,className:u})});Oy.displayName="Input";Oy.id="Input";var KH=wt(function(e,n){const{templateAreas:r,gap:i,rowGap:o,columnGap:s,column:a,row:u,autoFlow:c,autoRows:l,templateRows:d,autoColumns:f,templateColumns:h,...p}=e,m={display:"grid",gridTemplateAreas:r,gridGap:i,gridRowGap:o,gridColumnGap:s,gridAutoColumns:f,gridColumn:a,gridRow:u,gridAutoFlow:c,gridAutoRows:l,gridTemplateRows:d,gridTemplateColumns:h};return P.jsx(ft.div,{ref:n,__css:m,...p})});KH.displayName="Grid";function XH(t,e){return Array.isArray(t)?t.map(n=>n===null?null:e(n)):so(t)?Object.keys(t).reduce((n,r)=>(n[r]=e(t[r]),n),{}):t!=null?e(t):null}var DC=ft("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});DC.displayName="Spacer";var Zr=wt(function(e,n){const r=wd("Text",e),{className:i,align:o,decoration:s,casing:a,...u}=go(e),c=JN({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return P.jsx(ft.p,{ref:n,className:zt("chakra-text",e.className),...c,...u,__css:r})});Zr.displayName="Text";var JH=t=>P.jsx(ft.div,{className:"chakra-stack__item",...t,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...t.__css}});JH.displayName="StackItem";function P1e(t){const{spacing:e,direction:n}=t,r={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":XH(n,i=>r[i])}}var OC=wt((t,e)=>{const{isInline:n,direction:r,align:i,justify:o,spacing:s="0.5rem",wrap:a,children:u,divider:c,className:l,shouldWrapChildren:d,...f}=t,h=n?"row":r??"column",p=A.useMemo(()=>P1e({spacing:s,direction:h}),[s,h]),m=!!c,v=!d&&!m,g=A.useMemo(()=>{const b=fH(u);return v?b:b.map((x,S)=>{const C=typeof x.key<"u"?x.key:S,T=S+1===b.length,I=d?P.jsx(JH,{children:x},C):x;if(!m)return I;const N=A.cloneElement(c,{__css:p}),$=T?null:N;return P.jsxs(A.Fragment,{children:[I,$]},C)})},[c,p,m,v,d,u]),y=zt("chakra-stack",l);return P.jsx(ft.div,{ref:e,display:"flex",alignItems:i,justifyContent:o,flexDirection:h,flexWrap:a,gap:m?void 0:s,className:y,...f,children:g})});OC.displayName="Stack";var cu=wt((t,e)=>P.jsx(OC,{align:"center",...t,direction:"column",ref:e}));cu.displayName="VStack";var Uc=wt((t,e)=>P.jsx(OC,{align:"center",...t,direction:"row",ref:e}));Uc.displayName="HStack";function wB(t){return XH(t,e=>e==="auto"?"auto":`span ${e}/span ${e}`)}var YH=wt(function(e,n){const{area:r,colSpan:i,colStart:o,colEnd:s,rowEnd:a,rowSpan:u,rowStart:c,...l}=e,d=JN({gridArea:r,gridColumn:wB(i),gridRow:wB(u),gridColumnStart:o,gridColumnEnd:s,gridRowStart:c,gridRowEnd:a});return P.jsx(ft.div,{ref:n,__css:d,...l})});YH.displayName="GridItem";var ua=wt(function(e,n){const r=wd("Heading",e),{className:i,...o}=go(e);return P.jsx(ft.h2,{ref:n,className:zt("chakra-heading",e.className),...o,__css:r})});ua.displayName="Heading";var Et=ft("div");Et.displayName="Box";var QH=wt(function(e,n){const{size:r,centerContent:i=!0,...o}=e,s=i?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return P.jsx(Et,{ref:n,boxSize:r,__css:{...s,flexShrink:0,flexGrow:0},...o})});QH.displayName="Square";var A1e=wt(function(e,n){const{size:r,...i}=e;return P.jsx(QH,{size:r,ref:n,borderRadius:"9999px",...i})});A1e.displayName="Circle";var ZH=wt(function(e,n){const{direction:r,align:i,justify:o,wrap:s,basis:a,grow:u,shrink:c,...l}=e,d={display:"flex",flexDirection:r,alignItems:i,justifyContent:o,flexWrap:s,flexBasis:a,flexGrow:u,flexShrink:c};return P.jsx(ft.div,{ref:n,__css:d,...l})});ZH.displayName="Flex";var $1e={slideInBottom:{...z_,custom:{offsetY:16,reverse:!0}},slideInRight:{...z_,custom:{offsetX:16,reverse:!0}},scale:{...dH,custom:{initialScale:.95,reverse:!0}},none:{}},D1e=ft(Km.section),O1e=t=>$1e[t||"none"],e8=A.forwardRef((t,e)=>{const{preset:n,motionProps:r=O1e(n),...i}=t;return P.jsx(D1e,{ref:e,...r,...i})});e8.displayName="ModalTransition";var F1e=Object.defineProperty,L1e=(t,e,n)=>e in t?F1e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M1e=(t,e,n)=>(L1e(t,typeof e!="symbol"?e+"":e,n),n),B1e=class{constructor(){M1e(this,"modals"),this.modals=new Map}add(t){return this.modals.set(t,this.modals.size+1),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){return t?this.modals.get(t)===this.modals.size:!1}},Z_=new B1e;function t8(t,e){const[n,r]=A.useState(0);return A.useEffect(()=>{const i=t.current;if(i){if(e){const o=Z_.add(i);r(o)}return()=>{Z_.remove(i),r(0)}}},[e,t]),n}var U1e=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Gh=new WeakMap,p1=new WeakMap,m1={},lT=0,n8=function(t){return t&&(t.host||n8(t.parentNode))},V1e=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=n8(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},z1e=function(t,e,n,r){var i=V1e(e,Array.isArray(t)?t:[t]);m1[n]||(m1[n]=new WeakMap);var o=m1[n],s=[],a=new Set,u=new Set(i),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};i.forEach(c);var l=function(d){!d||u.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))l(f);else{var h=f.getAttribute(r),p=h!==null&&h!=="false",m=(Gh.get(f)||0)+1,v=(o.get(f)||0)+1;Gh.set(f,m),o.set(f,v),s.push(f),m===1&&p&&p1.set(f,!0),v===1&&f.setAttribute(n,"true"),p||f.setAttribute(r,"true")}})};return l(e),a.clear(),lT++,function(){s.forEach(function(d){var f=Gh.get(d)-1,h=o.get(d)-1;Gh.set(d,f),o.set(d,h),f||(p1.has(d)||d.removeAttribute(r),p1.delete(d)),h||d.removeAttribute(n)}),lT--,lT||(Gh=new WeakMap,Gh=new WeakMap,p1=new WeakMap,m1={})}},W1e=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=e||U1e(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),z1e(r,i,n,"aria-hidden")):function(){return null}};function j1e(t){const{isOpen:e,onClose:n,id:r,closeOnOverlayClick:i=!0,closeOnEsc:o=!0,useInert:s=!0,onOverlayClick:a,onEsc:u}=t,c=A.useRef(null),l=A.useRef(null),[d,f,h]=H1e(r,"chakra-modal","chakra-modal--header","chakra-modal--body");G1e(c,e&&s);const p=t8(c,e),m=A.useRef(null),v=A.useCallback(I=>{m.current=I.target},[]),g=A.useCallback(I=>{I.key==="Escape"&&(I.stopPropagation(),o&&(n==null||n()),u==null||u())},[o,n,u]),[y,b]=A.useState(!1),[x,S]=A.useState(!1),C=A.useCallback((I={},N=null)=>({role:"dialog",...I,ref:km(N,c),id:d,tabIndex:-1,"aria-modal":!0,"aria-labelledby":y?f:void 0,"aria-describedby":x?h:void 0,onClick:Qr(I.onClick,$=>$.stopPropagation())}),[h,x,d,f,y]),T=A.useCallback(I=>{I.stopPropagation(),m.current===I.target&&Z_.isTopModal(c.current)&&(i&&(n==null||n()),a==null||a())},[n,i,a]),E=A.useCallback((I={},N=null)=>({...I,ref:km(N,l),onClick:Qr(I.onClick,T),onKeyDown:Qr(I.onKeyDown,g),onMouseDown:Qr(I.onMouseDown,v)}),[g,v,T]);return{isOpen:e,onClose:n,headerId:f,bodyId:h,setBodyMounted:S,setHeaderMounted:b,dialogRef:c,overlayRef:l,getDialogProps:C,getDialogContainerProps:E,index:p}}function G1e(t,e){const n=t.current;A.useEffect(()=>{if(!(!t.current||!e))return W1e(t.current)},[e,t,n])}function H1e(t,...e){const n=A.useId(),r=t||n;return A.useMemo(()=>e.map(i=>`${i}-${r}`),[r,e])}var[q1e,L0]=jo({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[K1e,Tm]=jo({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),r8=t=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale",lockFocusAcrossFrames:!0,...t},{portalProps:n,children:r,autoFocus:i,trapFocus:o,initialFocusRef:s,finalFocusRef:a,returnFocusOnClose:u,blockScrollOnMount:c,allowPinchZoom:l,preserveScrollBarGap:d,motionPreset:f,lockFocusAcrossFrames:h,onCloseComplete:p}=e,m=Sd("Modal",e),g={...j1e(e),autoFocus:i,trapFocus:o,initialFocusRef:s,finalFocusRef:a,returnFocusOnClose:u,blockScrollOnMount:c,allowPinchZoom:l,preserveScrollBarGap:d,motionPreset:f,lockFocusAcrossFrames:h};return P.jsx(K1e,{value:g,children:P.jsx(q1e,{value:m,children:P.jsx($0,{onExitComplete:p,children:g.isOpen&&P.jsx(E0,{...n,children:r})})})})};r8.displayName="Modal";var Px="right-scroll-bar-position",Ax="width-before-scroll-bar",X1e="with-scroll-bars-hidden",J1e="--removed-body-scroll-bar-size",i8=xH(),dT=function(){},FC=A.forwardRef(function(t,e){var n=A.useRef(null),r=A.useState({onScrollCapture:dT,onWheelCapture:dT,onTouchMoveCapture:dT}),i=r[0],o=r[1],s=t.forwardProps,a=t.children,u=t.className,c=t.removeScrollBar,l=t.enabled,d=t.shards,f=t.sideCar,h=t.noIsolation,p=t.inert,m=t.allowPinchZoom,v=t.as,g=v===void 0?"div":v,y=t.gapMode,b=vH(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=f,S=gH([n,e]),C=$a($a({},b),i);return A.createElement(A.Fragment,null,l&&A.createElement(x,{sideCar:i8,removeScrollBar:c,shards:d,noIsolation:h,inert:p,setCallbacks:o,allowPinchZoom:!!m,lockRef:n,gapMode:y}),s?A.cloneElement(A.Children.only(a),$a($a({},C),{ref:S})):A.createElement(g,$a({},C,{className:u,ref:S}),a))});FC.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};FC.classNames={fullWidth:Ax,zeroRight:Px};var SB,Y1e=function(){if(SB)return SB;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Q1e(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Y1e();return e&&t.setAttribute("nonce",e),t}function Z1e(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function exe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var txe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Q1e())&&(Z1e(e,n),exe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},nxe=function(){var t=txe();return function(e,n){A.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},o8=function(){var t=nxe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},rxe={left:0,top:0,right:0,gap:0},fT=function(t){return parseInt(t||"",10)||0},ixe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[fT(n),fT(r),fT(i)]},oxe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return rxe;var e=ixe(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},sxe=o8(),axe=function(t,e,n,r){var i=t.left,o=t.top,s=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(X1e,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Px,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Ax,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Px," .").concat(Px,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Ax," .").concat(Ax,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body {
    `).concat(J1e,": ").concat(a,`px;
  }
`)},uxe=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r,o=A.useMemo(function(){return oxe(i)},[i]);return A.createElement(sxe,{styles:axe(o,!e,i,n?"":"!important")})},eI=!1;if(typeof window<"u")try{var g1=Object.defineProperty({},"passive",{get:function(){return eI=!0,!0}});window.addEventListener("test",g1,g1),window.removeEventListener("test",g1,g1)}catch{eI=!1}var Hh=eI?{passive:!1}:!1,cxe=function(t){return t.tagName==="TEXTAREA"},s8=function(t,e){var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!cxe(t)&&n[e]==="visible")},lxe=function(t){return s8(t,"overflowY")},dxe=function(t){return s8(t,"overflowX")},CB=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=a8(t,r);if(i){var o=u8(t,r),s=o[1],a=o[2];if(s>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},fxe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},hxe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},a8=function(t,e){return t==="v"?lxe(e):dxe(e)},u8=function(t,e){return t==="v"?fxe(e):hxe(e)},pxe=function(t,e){return t==="h"&&e==="rtl"?-1:1},mxe=function(t,e,n,r,i){var o=pxe(t,window.getComputedStyle(e).direction),s=o*r,a=n.target,u=e.contains(a),c=!1,l=s>0,d=0,f=0;do{var h=u8(t,a),p=h[0],m=h[1],v=h[2],g=m-v-o*p;(p||g)&&a8(t,a)&&(d+=g,f+=p),a=a.parentNode}while(!u&&a!==document.body||u&&(e.contains(a)||e===a));return(l&&(i&&d===0||!i&&s>d)||!l&&(i&&f===0||!i&&-s>f))&&(c=!0),c},v1=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},kB=function(t){return[t.deltaX,t.deltaY]},TB=function(t){return t&&"current"in t?t.current:t},gxe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},vxe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},yxe=0,qh=[];function bxe(t){var e=A.useRef([]),n=A.useRef([0,0]),r=A.useRef(),i=A.useState(yxe++)[0],o=A.useState(o8)[0],s=A.useRef(t);A.useEffect(function(){s.current=t},[t]),A.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var m=hbe([t.lockRef.current],(t.shards||[]).map(TB),!0).filter(Boolean);return m.forEach(function(v){return v.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),m.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=A.useCallback(function(m,v){if("touches"in m&&m.touches.length===2)return!s.current.allowPinchZoom;var g=v1(m),y=n.current,b="deltaX"in m?m.deltaX:y[0]-g[0],x="deltaY"in m?m.deltaY:y[1]-g[1],S,C=m.target,T=Math.abs(b)>Math.abs(x)?"h":"v";if("touches"in m&&T==="h"&&C.type==="range")return!1;var E=CB(T,C);if(!E)return!0;if(E?S=T:(S=T==="v"?"h":"v",E=CB(T,C)),!E)return!1;if(!r.current&&"changedTouches"in m&&(b||x)&&(r.current=S),!S)return!0;var I=r.current||S;return mxe(I,v,m,I==="h"?b:x,!0)},[]),u=A.useCallback(function(m){var v=m;if(!(!qh.length||qh[qh.length-1]!==o)){var g="deltaY"in v?kB(v):v1(v),y=e.current.filter(function(S){return S.name===v.type&&S.target===v.target&&gxe(S.delta,g)})[0];if(y&&y.should){v.cancelable&&v.preventDefault();return}if(!y){var b=(s.current.shards||[]).map(TB).filter(Boolean).filter(function(S){return S.contains(v.target)}),x=b.length>0?a(v,b[0]):!s.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=A.useCallback(function(m,v,g,y){var b={name:m,delta:v,target:g,should:y};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(x){return x!==b})},1)},[]),l=A.useCallback(function(m){n.current=v1(m),r.current=void 0},[]),d=A.useCallback(function(m){c(m.type,kB(m),m.target,a(m,t.lockRef.current))},[]),f=A.useCallback(function(m){c(m.type,v1(m),m.target,a(m,t.lockRef.current))},[]);A.useEffect(function(){return qh.push(o),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",u,Hh),document.addEventListener("touchmove",u,Hh),document.addEventListener("touchstart",l,Hh),function(){qh=qh.filter(function(m){return m!==o}),document.removeEventListener("wheel",u,Hh),document.removeEventListener("touchmove",u,Hh),document.removeEventListener("touchstart",l,Hh)}},[]);var h=t.removeScrollBar,p=t.inert;return A.createElement(A.Fragment,null,p?A.createElement(o,{styles:vxe(i)}):null,h?A.createElement(uxe,{gapMode:t.gapMode}):null)}const xxe=pbe(i8,bxe);var c8=A.forwardRef(function(t,e){return A.createElement(FC,$a({},t,{ref:e,sideCar:xxe}))});c8.classNames=FC.classNames;const wxe=c8;function Sxe(t){const{autoFocus:e,trapFocus:n,dialogRef:r,initialFocusRef:i,blockScrollOnMount:o,allowPinchZoom:s,finalFocusRef:a,returnFocusOnClose:u,preserveScrollBarGap:c,lockFocusAcrossFrames:l,isOpen:d}=Tm(),[f,h]=qG();A.useEffect(()=>{!f&&h&&setTimeout(h)},[f,h]);const p=t8(r,d);return P.jsx(GH,{autoFocus:e,isDisabled:!n,initialFocusRef:i,finalFocusRef:a,restoreFocus:u,contentRef:r,lockFocusAcrossFrames:l,children:P.jsx(wxe,{removeScrollBar:!c,allowPinchZoom:s,enabled:p===1&&o,forwardProps:!0,children:t.children})})}var l8=wt((t,e)=>{const{className:n,children:r,containerProps:i,motionProps:o,...s}=t,{getDialogProps:a,getDialogContainerProps:u}=Tm(),c=a(s,e),l=u(i),d=zt("chakra-modal__content",n),f=L0(),h={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...f.dialog},p={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...f.dialogContainer},{motionPreset:m}=Tm();return P.jsx(Sxe,{children:P.jsx(ft.div,{...l,className:"chakra-modal__content-container",tabIndex:-1,__css:p,children:P.jsx(e8,{preset:m,motionProps:o,className:d,...c,__css:h,children:r})})})});l8.displayName="ModalContent";function Jm(t){const{leastDestructiveRef:e,...n}=t;return P.jsx(r8,{...n,initialFocusRef:e})}var Ym=wt((t,e)=>P.jsx(l8,{ref:e,role:"alertdialog",...t})),lh=wt((t,e)=>{const{className:n,...r}=t,i=zt("chakra-modal__footer",n),s={display:"flex",alignItems:"center",justifyContent:"flex-end",...L0().footer};return P.jsx(ft.footer,{ref:e,...r,__css:s,className:i})});lh.displayName="ModalFooter";var dh=wt((t,e)=>{const{className:n,...r}=t,{headerId:i,setHeaderMounted:o}=Tm();A.useEffect(()=>(o(!0),()=>o(!1)),[o]);const s=zt("chakra-modal__header",n),u={flex:0,...L0().header};return P.jsx(ft.header,{ref:e,className:s,id:i,...r,__css:u})});dh.displayName="ModalHeader";var Cxe=ft(Km.div),fh=wt((t,e)=>{const{className:n,transition:r,motionProps:i,...o}=t,s=zt("chakra-modal__overlay",n),u={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...L0().overlay},{motionPreset:c}=Tm(),d=i||(c==="none"?{}:lH);return P.jsx(Cxe,{...d,__css:u,ref:e,className:s,...o})});fh.displayName="ModalOverlay";var hh=wt((t,e)=>{const{className:n,...r}=t,{bodyId:i,setBodyMounted:o}=Tm();A.useEffect(()=>(o(!0),()=>o(!1)),[o]);const s=zt("chakra-modal__body",n),a=L0();return P.jsx(ft.div,{ref:e,className:s,id:i,...r,__css:a.body})});hh.displayName="ModalBody";function kxe(t,e,n){return(t-e)*100/(n-e)}sh({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});sh({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var Txe=sh({"0%":{left:"-40%"},"100%":{left:"100%"}}),Exe=sh({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function _xe(t){const{value:e=0,min:n,max:r,valueText:i,getValueText:o,isIndeterminate:s,role:a="progressbar"}=t,u=kxe(e,n,r);return{bind:{"data-indeterminate":s?"":void 0,"aria-valuemax":r,"aria-valuemin":n,"aria-valuenow":s?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof o=="function"?o(e,u):i})(),role:a},percent:u,value:e}}var[Ixe,Rxe]=jo({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),Nxe=wt((t,e)=>{const{min:n,max:r,value:i,isIndeterminate:o,role:s,...a}=t,u=_xe({value:i,min:n,max:r,isIndeterminate:o,role:s}),l={height:"100%",...Rxe().filledTrack};return P.jsx(ft.div,{ref:e,style:{width:`${u.percent}%`,...a.style},...u.bind,...a,__css:l})}),Vc=wt((t,e)=>{var n;const{value:r,min:i=0,max:o=100,hasStripe:s,isAnimated:a,children:u,borderRadius:c,isIndeterminate:l,"aria-label":d,"aria-labelledby":f,"aria-valuetext":h,title:p,role:m,...v}=go(t),g=Sd("Progress",t),y=c??((n=g.track)==null?void 0:n.borderRadius),b={animation:`${Exe} 1s linear infinite`},C={...!l&&s&&a&&b,...l&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${Txe} 1s ease infinite normal none running`}},T={overflow:"hidden",position:"relative",...g.track};return P.jsx(ft.div,{ref:e,borderRadius:y,__css:T,...v,children:P.jsxs(Ixe,{value:g,children:[P.jsx(Nxe,{"aria-label":d,"aria-labelledby":f,"aria-valuetext":h,min:i,max:o,value:r,isIndeterminate:l,css:C,borderRadius:y,title:p,role:m}),u]})})});Vc.displayName="Progress";function Pxe(t){return t&&so(t)&&so(t.target)}function Axe(t={}){const{onChange:e,value:n,defaultValue:r,name:i,isDisabled:o,isFocusable:s,isNative:a,...u}=t,[c,l]=A.useState(r||""),d=typeof n<"u",f=d?n:c,h=A.useRef(null),p=A.useCallback(()=>{const S=h.current;if(!S)return;let C="input:not(:disabled):checked";const T=S.querySelector(C);if(T){T.focus();return}C="input:not(:disabled)";const E=S.querySelector(C);E==null||E.focus()},[]),v=`radio-${A.useId()}`,g=i||v,y=A.useCallback(S=>{const C=Pxe(S)?S.target.value:S;d||l(C),e==null||e(String(C))},[e,d]),b=A.useCallback((S={},C=null)=>({...S,ref:km(C,h),role:"radiogroup"}),[]),x=A.useCallback((S={},C=null)=>({...S,ref:C,name:g,[a?"checked":"isChecked"]:f!=null?S.value===f:void 0,onChange(E){y(E)},"data-radiogroup":!0}),[a,g,y,f]);return{getRootProps:b,getRadioProps:x,name:g,ref:h,focus:p,setValue:l,value:f,onChange:y,isDisabled:o,isFocusable:s,htmlProps:u}}var[$xe,d8]=jo({name:"RadioGroupContext",strict:!1}),f8=wt((t,e)=>{const{colorScheme:n,size:r,variant:i,children:o,className:s,isDisabled:a,isFocusable:u,...c}=t,{value:l,onChange:d,getRootProps:f,name:h,htmlProps:p}=Axe(c),m=A.useMemo(()=>({name:h,size:r,onChange:d,colorScheme:n,value:l,variant:i,isDisabled:a,isFocusable:u}),[h,r,d,n,l,i,a,u]);return P.jsx($xe,{value:m,children:P.jsx(ft.div,{...f(p,e),className:zt("chakra-radio-group",s),children:o})})});f8.displayName="RadioGroup";var Dxe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Oxe(t={}){const{defaultChecked:e,isChecked:n,isFocusable:r,isDisabled:i,isReadOnly:o,isRequired:s,onChange:a,isInvalid:u,name:c,value:l,id:d,"data-radiogroup":f,"aria-describedby":h,...p}=t,m=`radio-${A.useId()}`,v=O0(),y=!!d8()||!!f;let x=!!v&&!y?v.id:m;x=d??x;const S=i??(v==null?void 0:v.isDisabled),C=o??(v==null?void 0:v.isReadOnly),T=s??(v==null?void 0:v.isRequired),E=u??(v==null?void 0:v.isInvalid),[I,N]=A.useState(!1),[$,F]=A.useState(!1),[H,G]=A.useState(!1),[J,ne]=A.useState(!1),[oe,q]=A.useState(!!e),Z=typeof n<"u",se=Z?n:oe;A.useEffect(()=>sbe(N),[]);const fe=A.useCallback(Ie=>{if(C||S){Ie.preventDefault();return}Z||q(Ie.target.checked),a==null||a(Ie)},[Z,S,C,a]),xe=A.useCallback(Ie=>{Ie.key===" "&&ne(!0)},[ne]),be=A.useCallback(Ie=>{Ie.key===" "&&ne(!1)},[ne]),pe=A.useCallback((Ie={},lt=null)=>({...Ie,ref:lt,"data-active":zn(J),"data-hover":zn(H),"data-disabled":zn(S),"data-invalid":zn(E),"data-checked":zn(se),"data-focus":zn($),"data-focus-visible":zn($&&I),"data-readonly":zn(C),"aria-hidden":!0,onMouseDown:Qr(Ie.onMouseDown,()=>ne(!0)),onMouseUp:Qr(Ie.onMouseUp,()=>ne(!1)),onMouseEnter:Qr(Ie.onMouseEnter,()=>G(!0)),onMouseLeave:Qr(Ie.onMouseLeave,()=>G(!1))}),[J,H,S,E,se,$,C,I]),{onFocus:ge,onBlur:Ce}=v??{},$e=A.useCallback((Ie={},lt=null)=>{const He=S&&!r;return{...Ie,id:x,ref:lt,type:"radio",name:c,value:l,onChange:Qr(Ie.onChange,fe),onBlur:Qr(Ce,Ie.onBlur,()=>F(!1)),onFocus:Qr(ge,Ie.onFocus,()=>F(!0)),onKeyDown:Qr(Ie.onKeyDown,xe),onKeyUp:Qr(Ie.onKeyUp,be),checked:se,disabled:He,readOnly:C,required:T,"aria-invalid":Vp(E),"aria-disabled":Vp(He),"aria-required":Vp(T),"data-readonly":zn(C),"aria-describedby":h,style:Dxe}},[S,r,x,c,l,fe,Ce,ge,xe,be,se,C,T,E,h]);return{state:{isInvalid:E,isFocused:$,isChecked:se,isActive:J,isHovered:H,isDisabled:S,isReadOnly:C,isRequired:T},getCheckboxProps:pe,getRadioProps:pe,getInputProps:$e,getLabelProps:(Ie={},lt=null)=>({...Ie,ref:lt,onMouseDown:Qr(Ie.onMouseDown,Fxe),"data-disabled":zn(S),"data-checked":zn(se),"data-invalid":zn(E)}),getRootProps:(Ie,lt=null)=>({...Ie,ref:lt,"data-disabled":zn(S),"data-checked":zn(se),"data-invalid":zn(E)}),htmlProps:p}}function Fxe(t){t.preventDefault(),t.stopPropagation()}function Lxe(t,e){const n={},r={};for(const[i,o]of Object.entries(t))e.includes(i)?n[i]=o:r[i]=o;return[n,r]}var vv=wt((t,e)=>{var n;const r=d8(),{onChange:i,value:o}=t,s=Sd("Radio",{...r,...t}),a=go(t),{spacing:u="0.5rem",children:c,isDisabled:l=r==null?void 0:r.isDisabled,isFocusable:d=r==null?void 0:r.isFocusable,inputProps:f,...h}=a;let p=t.isChecked;(r==null?void 0:r.value)!=null&&o!=null&&(p=r.value===o);let m=i;r!=null&&r.onChange&&o!=null&&(m=Ise(r.onChange,i));const v=(n=t==null?void 0:t.name)!=null?n:r==null?void 0:r.name,{getInputProps:g,getCheckboxProps:y,getLabelProps:b,getRootProps:x,htmlProps:S}=Oxe({...h,isChecked:p,isFocusable:d,isDisabled:l,onChange:m,name:v}),[C,T]=Lxe(S,Aae),E=y(T),I=g(f,e),N=b(),$=Object.assign({},C,x()),F={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...s.container},H={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...s.control},G={userSelect:"none",marginStart:u,...s.label};return P.jsxs(ft.label,{className:"chakra-radio",...$,__css:F,children:[P.jsx("input",{className:"chakra-radio__input",...I}),P.jsx(ft.span,{className:"chakra-radio__control",...E,__css:H}),c&&P.jsx(ft.span,{className:"chakra-radio__label",...N,__css:G,children:c})]})});vv.displayName="Radio";function Mxe(){const t=A.useRef(!0);return A.useEffect(()=>{t.current=!1},[]),t.current}function Bxe(t){const e=A.useRef();return A.useEffect(()=>{e.current=t},[t]),e.current}var Uxe=ft("div",{baseStyle:{boxShadow:"none",backgroundClip:"padding-box",cursor:"default",color:"transparent",pointerEvents:"none",userSelect:"none","&::before, &::after, *":{visibility:"hidden"}}}),tI=rt("skeleton-start-color"),nI=rt("skeleton-end-color"),Vxe=sh({from:{opacity:0},to:{opacity:1}}),zxe=sh({from:{borderColor:tI.reference,background:tI.reference},to:{borderColor:nI.reference,background:nI.reference}}),Tf=wt((t,e)=>{const n={...t,fadeDuration:typeof t.fadeDuration=="number"?t.fadeDuration:.4,speed:typeof t.speed=="number"?t.speed:.8},r=wd("Skeleton",n),i=Mxe(),{startColor:o="",endColor:s="",isLoaded:a,fadeDuration:u,speed:c,className:l,fitContent:d,...f}=go(n),[h,p]=Tse("colors",[o,s]),m=Bxe(a),v=zt("chakra-skeleton",l),g={...h&&{[tI.variable]:h},...p&&{[nI.variable]:p}};if(a){const y=i||m?"none":`${Vxe} ${u}s`;return P.jsx(ft.div,{ref:e,className:v,__css:{animation:y},...f})}return P.jsx(Uxe,{ref:e,className:v,...f,__css:{width:d?"fit-content":void 0,...r,...g,_dark:{...r._dark,...g},animation:`${c}s linear infinite alternate ${zxe}`}})});Tf.displayName="Skeleton";var h8={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},EB=Do.createContext&&Do.createContext(h8),Ql=globalThis&&globalThis.__assign||function(){return Ql=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ql.apply(this,arguments)},Wxe=globalThis&&globalThis.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n};function p8(t){return t&&t.map(function(e,n){return Do.createElement(e.tag,Ql({key:n},e.attr),p8(e.child))})}function M0(t){return function(e){return Do.createElement(jxe,Ql({attr:Ql({},t.attr)},e),p8(t.child))}}function jxe(t){var e=function(n){var r=t.attr,i=t.size,o=t.title,s=Wxe(t,["attr","size","title"]),a=i||n.size||"1em",u;return n.className&&(u=n.className),t.className&&(u=(u?u+" ":"")+t.className),Do.createElement("svg",Ql({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,s,{className:u,style:Ql(Ql({color:t.color||n.color},n.style),t.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),o&&Do.createElement("title",null,o),t.children)};return EB!==void 0?Do.createElement(EB.Consumer,null,function(n){return e(n)}):e(h8)}function LC(t){return M0({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}},{tag:"path",attr:{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"}}]})(t)}function Gxe(t){return M0({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}},{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}}]})(t)}const Hxe=()=>{const[t,e]=A.useState(!0),[n,r]=A.useState(0);return A.useEffect(()=>{r(3e3);const s=setInterval(()=>{r(a=>{const u=a-10;return u<=0?(clearInterval(s),e(!1),0):u})},10);return()=>clearInterval(s)},[]),P.jsx(P.Fragment,{children:t&&P.jsxs(Et,{width:"50%",height:"300px",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"error",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Login Failed"}),P.jsxs(Fc,{flex:"1",children:["Invalid email or password.",P.jsx("br",{}),"Contact the University for assistance if the problem persists."]})]}),P.jsx(Vc,{size:"xs",value:n/3e3*100,position:"relative",width:"100%",bottom:"0",colorScheme:"red"})]})})},qxe=()=>{const[t,e]=A.useState(!0),[n,r]=A.useState(0);return A.useEffect(()=>{r(3e3);const s=setInterval(()=>{r(a=>{const u=a-10;return u<=0?(clearInterval(s),e(!1),0):u})},10);return()=>clearInterval(s)},[]),P.jsx(P.Fragment,{children:t&&P.jsxs(Et,{width:"50%",height:"300px",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"error",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Login Failed"}),P.jsxs(Fc,{flex:"1",children:["Your exam has been terminated.",P.jsx("br",{}),"Please contact the University for assistance."]})]}),P.jsx(Vc,{size:"xs",value:n/3e3*100,position:"relative",width:"100%",bottom:"0",colorScheme:"red"})]})})},Kxe=()=>{const[t,e]=A.useState(!0),[n,r]=A.useState(0);return A.useEffect(()=>{r(3e3);const s=setInterval(()=>{r(a=>{const u=a-10;return u<=0?(clearInterval(s),e(!1),0):u})},10);return()=>clearInterval(s)},[]),P.jsx(P.Fragment,{children:t&&P.jsxs(Et,{width:"50%",height:"300px",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"error",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Login Failed"}),P.jsxs(Fc,{flex:"1",children:["You are already logged in.",P.jsx("br",{}),"Contact the University for assistance."]})]}),P.jsx(Vc,{size:"xs",value:n/3e3*100,position:"relative",width:"100%",bottom:"0",colorScheme:"red"})]})})},ir=async(t,e,n)=>{try{const r=`${e}/${n}`;return(await _5.patch(r,t)).data}catch(r){throw console.error("There was an error updating the database!",r),r}},Xxe="1.0.0",B0=({bottomVal:t})=>P.jsx(P.Fragment,{children:P.jsxs(Et,{position:"fixed",bottom:t,width:"100%",zIndex:"1000",display:"flex",justifyContent:"center",alignItems:"center",paddingTop:2.5,paddingBottom:2.5,backgroundColor:"#111",children:[P.jsx(Zr,{children:" 2023 Copyright eyedentify"}),P.jsxs(Zr,{hidden:!!/Android|iPhone/i.test(navigator.userAgent),position:"fixed",bottom:t,right:"6",zIndex:"1000",display:"flex",justifyContent:"flex-end",alignItems:"center",paddingTop:2.5,paddingBottom:2.5,children:["Version ",Xxe]})]})});var nt={id:0,name:"",loggedIn:!1,userType:"",email:"",password:"",warnings:0,imageURL:"",encodeIP:0,terminated:!1,ready:!1,warningOne:"",warningTwo:"",isSuspicious:!1};const Jxe=()=>{const t=oh(),[e,n]=A.useState(!1),{data:r,loading:i,error:o}=iC(),[s,a]=A.useState(""),[u,c]=A.useState(!1),[l,d]=A.useState(""),[f,h]=A.useState(!1),[p,m]=A.useState(!1),[v,g]=A.useState(!1);A.useState(!1),A.useEffect(()=>{s.trim()!==""&&l.trim()!==""?c(!1):c(!0)},[s,l]);const y=(b,x,S)=>{if(b.preventDefault(),r.some(C=>C.email===x&&C.password===S&&x.includes("@student.uts.edu.au")&&C.loggedIn===!1&&C.terminated===!1))nt=r.find(C=>C.email===x&&C.password===S),nt!==void 0&&(nt.loggedIn=!0),t("/privacy");else if(r.some(C=>C.email===x&&C.password===S&&x.includes("@staff.uts.edu.au")))nt=r.find(C=>C.email===x&&C.password===S),nt!==void 0&&(ir({loggedIn:!0},"update_login",nt.id),nt.loggedIn=!0),t("/teacher");else if(r.some(C=>C.email===x&&C.password===S&&x.includes("@student.uts.edu.au")&&C.loggedIn===!0&&C.terminated===!1))n(!1),g(!1),m(!1),setTimeout(()=>{g(!0)},0);else if(r.some(C=>C.email===x&&C.password===S&&x.includes("@student.uts.edu.au")&&C.terminated===!0))n(!1),m(!1),g(!1),setTimeout(()=>{m(!0)},0);else{if(x.trim()===""||S.trim()==="")return;n(!1),m(!1),g(!1),setTimeout(()=>{n(!0)},0)}};return P.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[P.jsx(Et,{position:"absolute",top:"10",width:"100%",zIndex:"1000",children:e&&P.jsx(Hxe,{})}),P.jsx(Et,{position:"absolute",top:"10",width:"100%",zIndex:"1000",children:p&&P.jsx(qxe,{})}),P.jsx(Et,{position:"absolute",top:"10",width:"100%",zIndex:"1000",children:v&&P.jsx(Kxe,{})}),P.jsxs(cu,{justifyContent:"center",alignItems:"center",spacing:5,marginBottom:16,children:[P.jsxs(Uc,{paddingTop:10,children:[P.jsx(LC,{color:"#81E6D9",size:/Android|iPhone/i.test(navigator.userAgent)?"4em":"6em"}),P.jsx(ua,{marginTop:/Android|iPhone/i.test(navigator.userAgent)?2:"",fontSize:/Android|iPhone/i.test(navigator.userAgent)?"4xl":"7xl",fontStyle:"italic",paddingBottom:4,children:"eyedentify"})]}),P.jsxs("form",{children:[P.jsxs(G_,{isRequired:!0,children:[P.jsx(H_,{fontSize:"xl",marginLeft:/Android|iPhone/i.test(navigator.userAgent)?"":"-15%",children:"Enter your UTS Email Address"}),P.jsx(Oy,{width:/Android|iPhone/i.test(navigator.userAgent)?"100%":"130%",marginLeft:/Android|iPhone/i.test(navigator.userAgent)?"":"-15%",placeholder:"Email Address",value:s,onChange:b=>a(b.target.value)})]}),P.jsxs(G_,{isRequired:!0,paddingTop:5,paddingBottom:5,children:[P.jsx(H_,{fontSize:"xl",marginLeft:/Android|iPhone/i.test(navigator.userAgent)?"":"-15%",children:"Password"}),P.jsxs(HH,{width:/Android|iPhone/i.test(navigator.userAgent)?"100%":"130%",marginLeft:/Android|iPhone/i.test(navigator.userAgent)?"":"-15%",children:[P.jsx(Oy,{pr:"4.5rem",onChange:b=>d(b.target.value),type:f?"text":"password",placeholder:"Enter Password",value:l}),P.jsx(NP,{cursor:"pointer",marginRight:2,children:P.jsx(Gxe,{size:"1.5em",color:f?"gray":"white",onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1)})})]})]}),P.jsx(Uc,{paddingTop:"8px",justifyContent:"center",alignItems:"center",spacing:5,children:P.jsx(qn,{onClick:b=>y(b,s,l),type:"submit",fontSize:"lg",width:"50%",colorScheme:u?"gray":"teal",variant:"solid",disabled:u,children:"Login"})})]})]}),P.jsx(B0,{bottomVal:2})]})},Yxe=({handleLogout:t})=>{const{isOpen:e,onOpen:n,onClose:r}=Xm(),i=A.useRef(null),o=()=>{t(),r(),ir({loggedIn:!1},"update_login",nt.id)};return P.jsxs(P.Fragment,{children:[P.jsx(qn,{colorScheme:"teal",variant:"outline",borderColor:"teal.500",onClick:n,size:/Android|iPhone/i.test(navigator.userAgent)?"sm":"md",children:"Log Out"}),P.jsx(Jm,{motionPreset:"scale",size:/Android|iPhone/i.test(navigator.userAgent)?"xs":"lg",isOpen:e,leastDestructiveRef:i,onClose:r,children:P.jsx(fh,{children:P.jsxs(Ym,{children:[P.jsx(dh,{fontSize:"lg",fontWeight:"bold",children:"Log Out"}),P.jsx(hh,{children:"Are you sure you want to log out?"}),P.jsxs(lh,{children:[P.jsx(qn,{ref:i,onClick:r,children:"No"}),P.jsx(qn,{colorScheme:"red",onClick:o,ml:3,children:"Yes"})]})]})})})]})},m8=t=>{switch(t){case 0:return"green";case 1:return"#D69E2E";case 2:return"red";default:return"gray"}},MC=A.createContext({});function g8(t){return M0({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16.972 6.251c-.967-.538-2.185-.188-2.72.777l-3.713 6.682-2.125-2.125c-.781-.781-2.047-.781-2.828 0-.781.781-.781 2.047 0 2.828l4 4c.378.379.888.587 1.414.587l.277-.02c.621-.087 1.166-.46 1.471-1.009l5-9c.537-.966.189-2.183-.776-2.72z"}}]})(t)}function v8(t){return M0({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M17.414 6.586c-.78-.781-2.048-.781-2.828 0l-2.586 2.586-2.586-2.586c-.78-.781-2.048-.781-2.828 0-.781.781-.781 2.047 0 2.828l2.585 2.586-2.585 2.586c-.781.781-.781 2.047 0 2.828.39.391.902.586 1.414.586s1.024-.195 1.414-.586l2.586-2.586 2.586 2.586c.39.391.902.586 1.414.586s1.024-.195 1.414-.586c.781-.781.781-2.047 0-2.828l-2.585-2.586 2.585-2.586c.781-.781.781-2.047 0-2.828z"}}]})(t)}const Qxe=({name:t,warnings:e,id:n,loading:r,ready:i,disconnected:o})=>{const s=A.useRef(null);A.useRef(null);const u=A.useContext(MC)[n];return A.useEffect(()=>{u&&s.current&&(s.current.srcObject=u)},[u]),r?P.jsxs(cB,{overflow:"hidden",borderColor:"RGBA(0, 0, 0, 0.80)",borderWidth:"1px",borderRadius:"10px",children:[P.jsx(Tf,{height:"200px",overflow:"hidden"}),P.jsx(uB,{children:P.jsxs(cu,{children:[P.jsx(Tf,{height:"20px",width:"60%"}),P.jsx(Tf,{height:"20px",width:"40%"})]})})]}):P.jsx(cB,{overflow:"hidden",borderColor:m8(e),borderWidth:"1px",borderRadius:"10px",children:P.jsxs(uB,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[o?P.jsx(ch,{thickness:"4px",size:"xl",color:"teal"}):P.jsx("div",{style:{position:"relative"},children:P.jsx("video",{ref:s,playsInline:!0,autoPlay:!0,muted:!0,style:{borderRadius:"10px",overflow:"hidden",width:"100%",height:"auto"}})}),P.jsxs(cu,{children:[P.jsx(ua,{marginTop:"8px",children:P.jsxs(Uc,{children:[P.jsx("div",{children:t}),P.jsx(Et,{marginTop:i?"0":"1.5",children:i?P.jsx(g8,{}):P.jsx(v8,{})})]})}),P.jsxs(Zr,{children:["Warnings: ",e]})]})]})})},Zxe=({name:t,id:e,warnings:n,loading:r,ready:i,disconnected:o})=>{const s=A.useRef(null),u=A.useContext(MC)[e];return A.useEffect(()=>{u&&s.current&&(s.current.srcObject=u)},[u]),r?P.jsx(P.Fragment,{children:P.jsxs(Et,{overflow:"hidden",borderColor:"RGBA(0, 0, 0, 0.80)",borderWidth:"1px",borderRadius:"lg",children:[P.jsx(Tf,{height:"80px",overflow:"hidden"}),P.jsx(Tf,{marginTop:"2px",marginLeft:"2px",height:"20px",width:"60%"}),P.jsx(Tf,{marginLeft:"2px",marginBottom:"2px",height:"15px",width:"50%"})]})}):P.jsx(P.Fragment,{children:P.jsx(Et,{overflow:"hidden",borderColor:m8(n),borderWidth:"1px",borderRadius:"lg",children:P.jsxs(cu,{spacing:.5,align:"start",children:[o?P.jsx(Et,{display:"flex",alignItems:"center",justifyContent:"center",height:"80px",width:"100%",children:P.jsx(ch,{thickness:"3px",size:"md",color:"teal"})}):P.jsx("video",{ref:s,playsInline:!0,autoPlay:!0,muted:!0,style:{borderRadius:"2px",overflow:"hidden",width:"100%",height:"auto"}}),P.jsx(ua,{paddingLeft:"2px",fontSize:"1xl",children:P.jsxs(Uc,{children:[P.jsx("div",{children:t}),P.jsx(DC,{}),P.jsx(Et,{marginTop:i?"0":"0.5",marginLeft:"-3",children:i?P.jsx(g8,{}):P.jsx(v8,{})})]})}),P.jsxs(Zr,{paddingLeft:"2px",paddingBottom:"2px",fontSize:"x-small",children:["Warnings: ",n]})]})})})},y8=()=>{const[t,e]=A.useState(!0),[n,r]=A.useState(0);return A.useEffect(()=>{const o=Date.now();function s(){const a=Date.now()-o;a>=3e3?(r(0),e(!1)):(r(3e3-a),requestAnimationFrame(s))}return requestAnimationFrame(s),()=>{}},[]),P.jsxs(P.Fragment,{children:[t&&nt.userType==="student"&&P.jsxs(Et,{width:"50%",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"success",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Login Successful"}),P.jsxs(Fc,{flex:"1",children:["Welcome ",nt.name,"! Good Luck On Your Exam!"]})]}),P.jsx(Vc,{size:"xs",value:n/3e3*100,position:"absolute",width:"100%",bottom:"0",colorScheme:"green"})]}),t&&nt.userType==="staff"&&P.jsxs(Et,{width:"50%",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"success",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Login Successful"}),P.jsxs(Fc,{flex:"1",children:["Welcome ",nt.name,"! Happy Supervising!"]})]}),P.jsx(Vc,{size:"xs",value:n/3e3*100,position:"absolute",width:"100%",bottom:"0",colorScheme:"green"})]})]})},PP=(t,e=!0)=>{A.useEffect(()=>{let n,r;return t&&(n=i=>{i.preventDefault(),window.history.pushState({},"",window.location.pathname)},window.addEventListener("popstate",n),window.history.pushState({},"",window.location.pathname)),e&&(r=i=>(i.preventDefault(),i.returnValue="",""),window.addEventListener("beforeunload",r)),()=>{n&&window.removeEventListener("popstate",n),r&&window.removeEventListener("beforeunload",r)}},[t,e])},BC=t=>{const e=oh();(nt==null?void 0:nt.loggedIn)===!1?A.useEffect(()=>{e("/")},[]):(nt==null?void 0:nt.userType)===t?A.useEffect(()=>{e("/*")},[]):(nt==null?void 0:nt.userType)==="student"&&/Android|iPhone/i.test(navigator.userAgent)&&A.useEffect(()=>{e("/*")},[])};function ewe(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var twe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nwe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var b8={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(twe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function o(m,v){var g=m[v];if(typeof g.bind=="function")return g.bind(m);try{return Function.prototype.bind.call(g,m)}catch{return function(){return Function.prototype.apply.apply(g,[m,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&r?s:console[m]!==void 0?o(console,m):console.log!==void 0?o(console,"log"):e}function u(m,v){for(var g=0;g<i.length;g++){var y=i[g];this[y]=g<m?e:this.methodFactory(y,m,v)}this.log=this.debug}function c(m,v,g){return function(){typeof console!==n&&(u.call(this,v,g),this[m].apply(this,arguments))}}function l(m,v,g){return a(m)||c.apply(this,arguments)}function d(m,v,g){var y=this,b;v=v??"WARN";var x="loglevel";typeof m=="string"?x+=":"+m:typeof m=="symbol"&&(x=void 0);function S(I){var N=(i[I]||"silent").toUpperCase();if(!(typeof window===n||!x)){try{window.localStorage[x]=N;return}catch{}try{window.document.cookie=encodeURIComponent(x)+"="+N+";"}catch{}}}function C(){var I;if(!(typeof window===n||!x)){try{I=window.localStorage[x]}catch{}if(typeof I===n)try{var N=window.document.cookie,$=N.indexOf(encodeURIComponent(x)+"=");$!==-1&&(I=/^([^;]+)/.exec(N.slice($))[1])}catch{}return y.levels[I]===void 0&&(I=void 0),I}}function T(){if(!(typeof window===n||!x)){try{window.localStorage.removeItem(x);return}catch{}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}y.name=m,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=g||l,y.getLevel=function(){return b},y.setLevel=function(I,N){if(typeof I=="string"&&y.levels[I.toUpperCase()]!==void 0&&(I=y.levels[I.toUpperCase()]),typeof I=="number"&&I>=0&&I<=y.levels.SILENT){if(b=I,N!==!1&&S(I),u.call(y,I,m),typeof console===n&&I<y.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+I},y.setDefaultLevel=function(I){v=I,C()||y.setLevel(I,!1)},y.resetLevel=function(){y.setLevel(v,!1),T()},y.enableAll=function(I){y.setLevel(y.levels.TRACE,I)},y.disableAll=function(I){y.setLevel(y.levels.SILENT,I)};var E=C();E==null&&(E=v),y.setLevel(E,!1)}var f=new d,h={};f.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var g=h[v];return g||(g=h[v]=new d(v,f.getLevel(),f.methodFactory)),g};var p=typeof window!==n?window.log:void 0;return f.noConflict=function(){return typeof window!==n&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return h},f.default=f,f})})(b8);var x8=b8.exports,rI;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(rI||(rI={}));const ie=x8.getLogger("livekit");ie.setDefaultLevel(rI.info);x8.getLogger("lk-e2ee");function Xi(t,e){if(!t)throw new Error(e)}const rwe=34028234663852886e22,iwe=-34028234663852886e22,owe=4294967295,swe=2147483647,awe=-2147483648;function $x(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>swe||t<awe)throw new Error("invalid int 32: "+t)}function iI(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>owe||t<0)throw new Error("invalid uint 32: "+t)}function w8(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>rwe||t<iwe))throw new Error("invalid float 32: "+t)}const S8=Symbol("@bufbuild/protobuf/enum-type");function uwe(t){const e=t[S8];return Xi(e,"missing enum type on enum object"),e}function C8(t,e,n,r){t[S8]=k8(e,n.map(i=>({no:i.no,name:i.name,localName:t[i.no]})))}function k8(t,e,n){const r=Object.create(null),i=Object.create(null),o=[];for(const s of e){const a=T8(s);o.push(a),r[s.name]=a,i[s.no]=a}return{typeName:t,values:o,findName(s){return r[s]},findNumber(s){return i[s]}}}function cwe(t,e,n){const r={};for(const i of e){const o=T8(i);r[o.localName]=o.no,r[o.no]=o.localName}return C8(r,t,e),r}function T8(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class ze{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),i=r.runtime.bin,o=i.makeReadOptions(n);return i.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const r=this.getType(),i=r.runtime.json,o=i.makeReadOptions(n);return i.readMessage(r,e,o,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,i=r.makeWriteOptions(e),o=i.writerFactory();return r.writeMessage(this,o,i),o.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function lwe(t,e,n,r){var i;const o=(i=r==null?void 0:r.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),s={[o]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[o];return Object.setPrototypeOf(s.prototype,new ze),Object.assign(s,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,u){return new s().fromBinary(a,u)},fromJson(a,u){return new s().fromJson(a,u)},fromJsonString(a,u){return new s().fromJsonString(a,u)},equals(a,u){return t.util.equals(s,a,u)}}),s}function dwe(t,e,n,r){return{syntax:t,json:e,bin:n,util:r,makeMessageType(i,o,s){return lwe(this,i,o,s)},makeEnum:cwe,makeEnumType:k8,getEnumType:uwe}}var we;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(we||(we={}));function fwe(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,!(i&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,!(i&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function hT(t,e,n){for(let o=0;o<28;o=o+7){const s=t>>>o,a=!(!(s>>>7)&&e==0),u=(a?s|128:s)&255;if(n.push(u),!a)return}const r=t>>>28&15|(e&7)<<4,i=!!(e>>3);if(n.push((i?r|128:r)&255),!!i){for(let o=3;o<31;o=o+7){const s=e>>>o,a=!!(s>>>7),u=(a?s|128:s)&255;if(n.push(u),!a)return}n.push(e>>>31&1)}}const Dx=4294967296;function _B(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let r=0,i=0;function o(s,a){const u=Number(t.slice(s,a));i*=n,r=r*n+u,r>=Dx&&(i=i+(r/Dx|0),r=r%Dx)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?_8(r,i):AP(r,i)}function hwe(t,e){let n=AP(t,e);const r=n.hi&2147483648;r&&(n=_8(n.lo,n.hi));const i=E8(n.lo,n.hi);return r?"-"+i:i}function E8(t,e){if({lo:t,hi:e}=pwe(t,e),e<=2097151)return String(Dx*e+t);const n=t&16777215,r=(t>>>24|e<<8)&16777215,i=e>>16&65535;let o=n+r*6777216+i*6710656,s=r+i*8147497,a=i*2;const u=1e7;return o>=u&&(s+=Math.floor(o/u),o%=u),s>=u&&(a+=Math.floor(s/u),s%=u),a.toString()+IB(s)+IB(o)}function pwe(t,e){return{lo:t>>>0,hi:e>>>0}}function AP(t,e){return{lo:t|0,hi:e|0}}function _8(t,e){return e=~e,t?t=~t+1:e+=1,AP(t,e)}const IB=t=>{const e=String(t);return"0000000".slice(e.length)+e};function RB(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function mwe(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function gwe(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),s=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(u){const c=typeof u=="bigint"?u:BigInt(u);if(c>o||c<i)throw new Error("int64 invalid: ".concat(u));return c},uParse(u){const c=typeof u=="bigint"?u:BigInt(u);if(c>a||c<s)throw new Error("uint64 invalid: ".concat(u));return c},enc(u){return t.setBigInt64(0,this.parse(u),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(u){return t.setBigInt64(0,this.uParse(u),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(u,c){return t.setInt32(0,u,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(u,c){return t.setInt32(0,u,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=i=>Xi(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>Xi(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),n(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),n(i),_B(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),_B(i)},dec(i,o){return hwe(i,o)},uDec(i,o){return E8(i,o)}}}const _t=gwe();var Wn;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Wn||(Wn={}));class vwe{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(iI(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return $x(e),RB(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){w8(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){iI(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){$x(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return $x(e),e=(e<<1^e>>31)>>>0,RB(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=_t.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=_t.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=_t.enc(e);return hT(n.lo,n.hi,this.buf),this}sint64(e){let n=_t.enc(e),r=n.hi>>31,i=n.lo<<1^r,o=(n.hi<<1|n.lo>>>31)^r;return hT(i,o,this.buf),this}uint64(e){let n=_t.uEnc(e);return hT(n.lo,n.hi,this.buf),this}}class ywe{constructor(e,n){this.varint64=fwe,this.uint32=mwe,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e){let n=this.pos;switch(e){case Wn.Varint:for(;this.buf[this.pos++]&128;);break;case Wn.Bit64:this.pos+=4;case Wn.Bit32:this.pos+=4;break;case Wn.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Wn.StartGroup:let i;for(;(i=this.tag()[1])!==Wn.EndGroup;)this.skip(i);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return _t.dec(...this.varint64())}uint64(){return _t.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,_t.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return _t.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return _t.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function oI(t,e){return e instanceof ze||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}we.DOUBLE,we.FLOAT,we.INT64,we.UINT64,we.INT32,we.UINT32,we.BOOL,we.STRING,we.BYTES;function ml(t,e,n){if(e===n)return!0;if(t==we.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(t){case we.UINT64:case we.FIXED64:case we.INT64:case we.SFIXED64:case we.SINT64:return e==n}return!1}function sI(t){switch(t){case we.BOOL:return!1;case we.UINT64:case we.FIXED64:case we.INT64:case we.SFIXED64:case we.SINT64:return _t.zero;case we.DOUBLE:case we.FLOAT:return 0;case we.BYTES:return new Uint8Array(0);case we.STRING:return"";default:return 0}}function I8(t,e){const n=e===void 0;let r=Wn.Varint,i=e===0;switch(t){case we.STRING:i=n||!e.length,r=Wn.LengthDelimited;break;case we.BOOL:i=e===!1;break;case we.DOUBLE:r=Wn.Bit64;break;case we.FLOAT:r=Wn.Bit32;break;case we.INT64:i=n||e==0;break;case we.UINT64:i=n||e==0;break;case we.FIXED64:i=n||e==0,r=Wn.Bit64;break;case we.BYTES:i=n||!e.byteLength,r=Wn.LengthDelimited;break;case we.FIXED32:r=Wn.Bit32;break;case we.SFIXED32:r=Wn.Bit32;break;case we.SFIXED64:i=n||e==0,r=Wn.Bit64;break;case we.SINT64:i=n||e==0;break}const o=we[t].toLowerCase();return[r,o,n||i]}const Kh=Symbol("@bufbuild/protobuf/unknown-fields"),NB={readUnknownFields:!0,readerFactory:t=>new ywe(t)},PB={writeUnknownFields:!0,writerFactory:()=>new vwe};function bwe(t){return t?Object.assign(Object.assign({},NB),t):NB}function xwe(t){return t?Object.assign(Object.assign({},PB),t):PB}function wwe(){return{makeReadOptions:bwe,makeWriteOptions:xwe,listUnknownFields(t){var e;return(e=t[Kh])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Kh]},writeUnknownFields(t,e){const r=t[Kh];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(t,e,n,r){const i=t;Array.isArray(i[Kh])||(i[Kh]=[]),i[Kh].push({no:e,wireType:n,data:r})},readMessage(t,e,n,r){const i=t.getType(),o=n===void 0?e.len:e.pos+n;for(;e.pos<o;){const[s,a]=e.tag(),u=i.fields.find(s);if(!u){const f=e.skip(a);r.readUnknownFields&&this.onUnknownField(t,s,a,f);continue}let c=t,l=u.repeated,d=u.localName;switch(u.oneof&&(c=c[u.oneof.localName],c.case!=d&&delete c.value,c.case=d,d="value"),u.kind){case"scalar":case"enum":const f=u.kind=="enum"?we.INT32:u.T;if(l){let v=c[d];if(a==Wn.LengthDelimited&&f!=we.STRING&&f!=we.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)v.push(Hv(e,f))}else v.push(Hv(e,f))}else c[d]=Hv(e,f);break;case"message":const h=u.T;l?c[d].push(Ox(e,new h,r)):c[d]instanceof ze?Ox(e,c[d],r):(c[d]=Ox(e,new h,r),h.fieldWrapper&&!u.oneof&&!u.repeated&&(c[d]=h.fieldWrapper.unwrapField(c[d])));break;case"map":let[p,m]=Swe(u,e,r);c[d][p]=m;break}}}}}function Ox(t,e,n){return e.getType().runtime.bin.readMessage(e,t,t.uint32(),n),e}function Swe(t,e,n){const r=e.uint32(),i=e.pos+r;let o,s;for(;e.pos<i;){let[a]=e.tag();switch(a){case 1:o=Hv(e,t.K);break;case 2:switch(t.V.kind){case"scalar":s=Hv(e,t.V.T);break;case"enum":s=e.int32();break;case"message":s=Ox(e,new t.V.T,n);break}break}}if(o===void 0){let a=sI(t.K);o=t.K==we.BOOL?a.toString():a}if(typeof o!="string"&&typeof o!="number"&&(o=o.toString()),s===void 0)switch(t.V.kind){case"scalar":s=sI(t.V.T);break;case"enum":s=0;break;case"message":s=new t.V.T;break}return[o,s]}function Hv(t,e){switch(e){case we.STRING:return t.string();case we.BOOL:return t.bool();case we.DOUBLE:return t.double();case we.FLOAT:return t.float();case we.INT32:return t.int32();case we.INT64:return t.int64();case we.UINT64:return t.uint64();case we.FIXED64:return t.fixed64();case we.BYTES:return t.bytes();case we.FIXED32:return t.fixed32();case we.SFIXED32:return t.sfixed32();case we.SFIXED64:return t.sfixed64();case we.SINT64:return t.sint64();case we.UINT32:return t.uint32();case we.SINT32:return t.sint32()}}function Cwe(t,e,n,r,i){t.tag(n.no,Wn.LengthDelimited),t.fork();let o=r;switch(n.K){case we.INT32:case we.FIXED32:case we.UINT32:case we.SFIXED32:case we.SINT32:o=Number.parseInt(r);break;case we.BOOL:Xi(r=="true"||r=="false"),o=r=="true";break}switch(qv(t,n.K,1,o,!0),n.V.kind){case"scalar":qv(t,n.V.T,2,i,!0);break;case"enum":qv(t,we.INT32,2,i,!0);break;case"message":aI(t,e,n.V.T,2,i);break}t.join()}function aI(t,e,n,r,i){if(i!==void 0){const o=oI(n,i);t.tag(r,Wn.LengthDelimited).bytes(o.toBinary(e))}}function qv(t,e,n,r,i){let[o,s,a]=I8(e,r);(!a||i)&&t.tag(n,o)[s](r)}function kwe(t,e,n,r){if(!r.length)return;t.tag(n,Wn.LengthDelimited).fork();let[,i]=I8(e);for(let o=0;o<r.length;o++)t[i](r[o]);t.join()}function Twe(){return Object.assign(Object.assign({},wwe()),{writeMessage(t,e,n){const r=t.getType();for(const i of r.fields.byNumber()){let o,s=i.repeated,a=i.localName;if(i.oneof){const u=t[i.oneof.localName];if(u.case!==a)continue;o=u.value}else o=t[a];switch(i.kind){case"scalar":case"enum":let u=i.kind=="enum"?we.INT32:i.T;if(s)if(i.packed)kwe(e,u,i.no,o);else for(const c of o)qv(e,u,i.no,c,!0);else o!==void 0&&qv(e,u,i.no,o,!!i.oneof||i.opt);break;case"message":if(s)for(const c of o)aI(e,n,i.T,i.no,c);else aI(e,n,i.T,i.no,o);break;case"map":for(const[c,l]of Object.entries(o))Cwe(e,n,i,c,l);break}}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e}})}let Vu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),UC=[];for(let t=0;t<Vu.length;t++)UC[Vu[t].charCodeAt(0)]=t;UC["-".charCodeAt(0)]=Vu.indexOf("+");UC["_".charCodeAt(0)]=Vu.indexOf("/");const R8={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,i=0,o,s=0;for(let a=0;a<t.length;a++){if(o=UC[t.charCodeAt(a)],o===void 0)switch(t[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:s=o,i=1;break;case 1:n[r++]=s<<2|(o&48)>>4,s=o,i=2;break;case 2:n[r++]=(s&15)<<4|(o&60)>>2,s=o,i=3;break;case 3:n[r++]=(s&3)<<6|o,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(t){let e="",n=0,r,i=0;for(let o=0;o<t.length;o++)switch(r=t[o],n){case 0:e+=Vu[r>>2],i=(r&3)<<4,n=1;break;case 1:e+=Vu[i|r>>4],i=(r&15)<<2,n=2;break;case 2:e+=Vu[i|r>>6],e+=Vu[r&63],n=0;break}return n&&(e+=Vu[i],e+="=",n==1&&(e+="=")),e}},AB={ignoreUnknownFields:!1},$B={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Ewe(t){return t?Object.assign(Object.assign({},AB),t):AB}function _we(t){return t?Object.assign(Object.assign({},$B),t):$B}function Iwe(t){const e=t(Rwe,DB);return{makeReadOptions:Ewe,makeWriteOptions:_we,readMessage(n,r,i,o){if(r==null||Array.isArray(r)||typeof r!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(this.debug(r)));o=o??new n;const s={};for(const[a,u]of Object.entries(r)){const c=n.fields.findJsonName(a);if(!c){if(!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(a,'" is unknown'));continue}let l=c.localName,d=o;if(c.oneof){if(u===null&&c.kind=="scalar")continue;const f=s[c.oneof.localName];if(f)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(f,'", "').concat(a,'"'));s[c.oneof.localName]=a,d=d[c.oneof.localName]={case:l},l="value"}if(c.repeated){if(u===null)continue;if(!Array.isArray(u))throw new Error("cannot decode field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(u)));const f=d[l];for(const h of u){if(h===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(h)));let p;switch(c.kind){case"message":p=c.T.fromJson(h,i);break;case"enum":if(p=pT(c.T,h,i.ignoreUnknownFields),p===void 0)continue;break;case"scalar":try{p=qg(c.T,h)}catch(m){let v="cannot decode field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(h));throw m instanceof Error&&m.message.length>0&&(v+=": ".concat(m.message)),new Error(v)}break}f.push(p)}}else if(c.kind=="map"){if(u===null)continue;if(Array.isArray(u)||typeof u!="object")throw new Error("cannot decode field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(u)));const f=d[l];for(const[h,p]of Object.entries(u)){if(p===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(c.name," from JSON: map value null"));let m;switch(c.V.kind){case"message":m=c.V.T.fromJson(p,i);break;case"enum":if(m=pT(c.V.T,p,i.ignoreUnknownFields),m===void 0)continue;break;case"scalar":try{m=qg(c.V.T,p)}catch(v){let g="cannot decode map value for field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(u));throw v instanceof Error&&v.message.length>0&&(g+=": ".concat(v.message)),new Error(g)}break}try{f[qg(c.K,c.K==we.BOOL?h=="true"?!0:h=="false"?!1:h:h).toString()]=m}catch(v){let g="cannot decode map key for field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(u));throw v instanceof Error&&v.message.length>0&&(g+=": ".concat(v.message)),new Error(g)}}}else switch(c.kind){case"message":const f=c.T;if(u===null&&f.typeName!="google.protobuf.Value"){if(c.oneof)throw new Error("cannot decode field ".concat(n.typeName,".").concat(c.name,' from JSON: null is invalid for oneof field "').concat(a,'"'));continue}d[l]instanceof ze?d[l].fromJson(u,i):(d[l]=f.fromJson(u,i),f.fieldWrapper&&!c.oneof&&(d[l]=f.fieldWrapper.unwrapField(d[l])));break;case"enum":const h=pT(c.T,u,i.ignoreUnknownFields);h!==void 0&&(d[l]=h);break;case"scalar":try{d[l]=qg(c.T,u)}catch(p){let m="cannot decode field ".concat(n.typeName,".").concat(c.name," from JSON: ").concat(this.debug(u));throw p instanceof Error&&p.message.length>0&&(m+=": ".concat(p.message)),new Error(m)}break}}return o},writeMessage(n,r){const i=n.getType(),o={};let s;try{for(const a of i.fields.byMember()){let u;if(a.kind=="oneof"){const c=n[a.localName];if(c.value===void 0)continue;if(s=a.findField(c.case),!s)throw"oneof case not found: "+c.case;u=e(s,c.value,r)}else s=a,u=e(s,n[s.localName],r);u!==void 0&&(o[r.useProtoFieldName?s.name:s.jsonName]=u)}}catch(a){const u=s?"cannot encode field ".concat(i.typeName,".").concat(s.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),c=a instanceof Error?a.message:String(a);throw new Error(u+(c.length>0?": ".concat(c):""))}return o},readScalar:qg,writeScalar:DB,debug:N8}}function N8(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function qg(t,e){switch(t){case we.DOUBLE:case we.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const n=Number(e);if(Number.isNaN(n)||!Number.isFinite(n))break;return t==we.FLOAT&&w8(n),n;case we.INT32:case we.FIXED32:case we.SFIXED32:case we.SINT32:case we.UINT32:if(e===null)return 0;let r;if(typeof e=="number"?r=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(r=Number(e)),r===void 0)break;return t==we.UINT32?iI(r):$x(r),r;case we.INT64:case we.SFIXED64:case we.SINT64:if(e===null)return _t.zero;if(typeof e!="number"&&typeof e!="string")break;return _t.parse(e);case we.FIXED64:case we.UINT64:if(e===null)return _t.zero;if(typeof e!="number"&&typeof e!="string")break;return _t.uParse(e);case we.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case we.STRING:if(e===null)return"";if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case we.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return R8.dec(e)}throw new Error}function pT(t,e,n){if(e===null)return 0;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r||n)return r==null?void 0:r.no;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(N8(e)))}function Rwe(t,e,n,r){var i;if(e===void 0)return e;if(e===0&&!n)return;if(r)return e;if(t.typeName=="google.protobuf.NullValue")return null;const o=t.findNumber(e);return(i=o==null?void 0:o.name)!==null&&i!==void 0?i:e}function DB(t,e,n){if(e!==void 0)switch(t){case we.INT32:case we.SFIXED32:case we.SINT32:case we.FIXED32:case we.UINT32:return Xi(typeof e=="number"),e!=0||n?e:void 0;case we.FLOAT:case we.DOUBLE:return Xi(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e!==0||n?e:void 0;case we.STRING:return Xi(typeof e=="string"),e.length>0||n?e:void 0;case we.BOOL:return Xi(typeof e=="boolean"),e||n?e:void 0;case we.UINT64:case we.FIXED64:case we.INT64:case we.SFIXED64:case we.SINT64:return Xi(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),n||e!=0?e.toString(10):void 0;case we.BYTES:return Xi(e instanceof Uint8Array),n||e.byteLength>0?R8.enc(e):void 0}}function Nwe(){return Iwe((t,e)=>function(r,i,o){if(r.kind=="map"){const s={};switch(r.V.kind){case"scalar":for(const[u,c]of Object.entries(i)){const l=e(r.V.T,c,!0);Xi(l!==void 0),s[u.toString()]=l}break;case"message":for(const[u,c]of Object.entries(i))s[u.toString()]=c.toJson(o);break;case"enum":const a=r.V.T;for(const[u,c]of Object.entries(i)){Xi(c===void 0||typeof c=="number");const l=t(a,c,!0,o.enumAsInteger);Xi(l!==void 0),s[u.toString()]=l}break}return o.emitDefaultValues||Object.keys(s).length>0?s:void 0}else if(r.repeated){const s=[];switch(r.kind){case"scalar":for(let a=0;a<i.length;a++)s.push(e(r.T,i[a],!0));break;case"enum":for(let a=0;a<i.length;a++)s.push(t(r.T,i[a],!0,o.enumAsInteger));break;case"message":for(let a=0;a<i.length;a++)s.push(oI(r.T,i[a]).toJson(o));break}return o.emitDefaultValues||s.length>0?s:void 0}else switch(r.kind){case"scalar":return e(r.T,i,!!r.oneof||r.opt||o.emitDefaultValues);case"enum":return t(r.T,i,!!r.oneof||r.opt||o.emitDefaultValues,o.enumAsInteger);case"message":return i!==void 0?oI(r.T,i).toJson(o):void 0}})}function Pwe(){return{setEnumType:C8,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const i=r.localName,o=e,s=t;if(s[i]!==void 0)switch(r.kind){case"oneof":const a=s[i].case;if(a===void 0)continue;const u=r.findField(a);let c=s[i].value;u&&u.kind=="message"&&!(c instanceof u.T)?c=new u.T(c):u&&u.kind==="scalar"&&u.T===we.BYTES&&(c=Kg(c)),o[i]={case:a,value:c};break;case"scalar":case"enum":let l=s[i];r.T===we.BYTES&&(l=r.repeated?l.map(Kg):Kg(l)),o[i]=l;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===we.BYTES)for(const[h,p]of Object.entries(s[i]))o[i][h]=Kg(p);else Object.assign(o[i],s[i]);break;case"message":const f=r.V.T;for(const h of Object.keys(s[i])){let p=s[i][h];f.fieldWrapper||(p=new f(p)),o[i][h]=p}break}break;case"message":const d=r.T;if(r.repeated)o[i]=s[i].map(f=>f instanceof d?f:new d(f));else if(s[i]!==void 0){const f=s[i];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?o[i]=Kg(f):o[i]=f:o[i]=f instanceof d?f:new d(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(r=>{const i=e[r.localName],o=n[r.localName];if(r.repeated){if(i.length!==o.length)return!1;switch(r.kind){case"message":return i.every((s,a)=>r.T.equals(s,o[a]));case"scalar":return i.every((s,a)=>ml(r.T,s,o[a]));case"enum":return i.every((s,a)=>ml(we.INT32,s,o[a]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(i,o);case"enum":return ml(we.INT32,i,o);case"scalar":return ml(r.T,i,o);case"oneof":if(i.case!==o.case)return!1;const s=r.findField(i.case);if(s===void 0)return!0;switch(s.kind){case"message":return s.T.equals(i.value,o.value);case"enum":return ml(we.INT32,i.value,o.value);case"scalar":return ml(s.T,i.value,o.value)}throw new Error("oneof cannot contain ".concat(s.kind));case"map":const a=Object.keys(i).concat(Object.keys(o));switch(r.V.kind){case"message":const u=r.V.T;return a.every(l=>u.equals(i[l],o[l]));case"enum":return a.every(l=>ml(we.INT32,i[l],o[l]));case"scalar":const c=r.V.T;return a.every(l=>ml(c,i[l],o[l]))}break}})},clone(t){const e=t.getType(),n=new e,r=n;for(const i of e.fields.byMember()){const o=t[i.localName];let s;if(i.repeated)s=o.map(y1);else if(i.kind=="map"){s=r[i.localName];for(const[a,u]of Object.entries(o))s[a]=y1(u)}else i.kind=="oneof"?s=i.findField(o.case)?{case:o.case,value:y1(o.value)}:{case:void 0}:s=y1(o);r[i.localName]=s}return n}}}function y1(t){if(t===void 0)return t;if(t instanceof ze)return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Kg(t){return t instanceof Uint8Array?t:new Uint8Array(t)}class Awe{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function P8(t,e){const n=A8(t);return e?n:Mwe(Lwe(n))}function $we(t){return P8(t,!1)}const Dwe=A8;function A8(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let i=t.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),n.push(i);break}}return n.join("")}const Owe=new Set(["constructor","toString","toJSON","valueOf"]),Fwe=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),$8=t=>"".concat(t,"$"),Lwe=t=>Fwe.has(t)?$8(t):t,Mwe=t=>Owe.has(t)?$8(t):t;class Bwe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=$we(e)}addField(e){Xi(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}const B=dwe("proto3",Nwe(),Twe(),Object.assign(Object.assign({},Pwe()),{newFieldList(t){return new Awe(t,Uwe)},initFields(t){for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=t;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=sI(e.T);break}}}}));function Uwe(t){var e,n,r;const i=[];let o;for(const s of typeof t=="function"?t():t){const a=s;if(a.localName=P8(s.name,s.oneof!==void 0),a.jsonName=(e=s.jsonName)!==null&&e!==void 0?e:Dwe(s.name),a.repeated=(n=s.repeated)!==null&&n!==void 0?n:!1,a.packed=(r=s.packed)!==null&&r!==void 0?r:s.kind=="enum"||s.kind=="scalar"&&s.T!=we.BYTES&&s.T!=we.STRING,s.oneof!==void 0){const u=typeof s.oneof=="string"?s.oneof:s.oneof.name;(!o||o.name!=u)&&(o=new Bwe(u)),a.oneof=o,o.addField(a)}i.push(a)}return i}class ii extends ze{constructor(e){super(),this.seconds=_t.zero,this.nanos=0,B.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(B.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=_t.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ii.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new ii({seconds:_t.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new ii().fromBinary(e,n)}static fromJson(e,n){return new ii().fromJson(e,n)}static fromJsonString(e,n){return new ii().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ii,e,n)}}ii.runtime=B;ii.typeName="google.protobuf.Timestamp";ii.fields=B.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);var uI;(function(t){t[t.DEFAULT_AC=0]="DEFAULT_AC",t[t.OPUS=1]="OPUS",t[t.AAC=2]="AAC"})(uI||(uI={}));B.util.setEnumType(uI,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]);var cI;(function(t){t[t.DEFAULT_VC=0]="DEFAULT_VC",t[t.H264_BASELINE=1]="H264_BASELINE",t[t.H264_MAIN=2]="H264_MAIN",t[t.H264_HIGH=3]="H264_HIGH",t[t.VP8=4]="VP8"})(cI||(cI={}));B.util.setEnumType(cI,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]);var ai;(function(t){t[t.AUDIO=0]="AUDIO",t[t.VIDEO=1]="VIDEO",t[t.DATA=2]="DATA"})(ai||(ai={}));B.util.setEnumType(ai,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]);var jn;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.CAMERA=1]="CAMERA",t[t.MICROPHONE=2]="MICROPHONE",t[t.SCREEN_SHARE=3]="SCREEN_SHARE",t[t.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(jn||(jn={}));B.util.setEnumType(jn,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]);var ur;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH",t[t.OFF=3]="OFF"})(ur||(ur={}));B.util.setEnumType(ur,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]);var Zl;(function(t){t[t.POOR=0]="POOR",t[t.GOOD=1]="GOOD",t[t.EXCELLENT=2]="EXCELLENT"})(Zl||(Zl={}));B.util.setEnumType(Zl,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"}]);var ca;(function(t){t[t.UNSET=0]="UNSET",t[t.DISABLED=1]="DISABLED",t[t.ENABLED=2]="ENABLED"})(ca||(ca={}));B.util.setEnumType(ca,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]);var Tc;(function(t){t[t.UNKNOWN_REASON=0]="UNKNOWN_REASON",t[t.CLIENT_INITIATED=1]="CLIENT_INITIATED",t[t.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",t[t.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",t[t.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",t[t.ROOM_DELETED=5]="ROOM_DELETED",t[t.STATE_MISMATCH=6]="STATE_MISMATCH",t[t.JOIN_FAILURE=7]="JOIN_FAILURE"})(Tc||(Tc={}));B.util.setEnumType(Tc,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"}]);var rs;(function(t){t[t.RR_UNKNOWN=0]="RR_UNKNOWN",t[t.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",t[t.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",t[t.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",t[t.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"})(rs||(rs={}));B.util.setEnumType(rs,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]);var Fy;(function(t){t[t.SE_UNKNOWN=0]="SE_UNKNOWN",t[t.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",t[t.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"})(Fy||(Fy={}));B.util.setEnumType(Fy,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);let Qm=class yv extends ze{constructor(e){super(),this.sid="",this.name="",this.emptyTimeout=0,this.maxParticipants=0,this.creationTime=_t.zero,this.turnPassword="",this.enabledCodecs=[],this.metadata="",this.numParticipants=0,this.numPublishers=0,this.activeRecording=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new yv().fromBinary(e,n)}static fromJson(e,n){return new yv().fromJson(e,n)}static fromJsonString(e,n){return new yv().fromJsonString(e,n)}static equals(e,n){return B.util.equals(yv,e,n)}};Qm.runtime=B;Qm.typeName="livekit.Room";Qm.fields=B.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Xs,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:12,name:"playout_delay",kind:"message",T:Xu}]);class Xs extends ze{constructor(e){super(),this.mime="",this.fmtpLine="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Xs().fromBinary(e,n)}static fromJson(e,n){return new Xs().fromJson(e,n)}static fromJsonString(e,n){return new Xs().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Xs,e,n)}}Xs.runtime=B;Xs.typeName="livekit.Codec";Xs.fields=B.util.newFieldList(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]);class Xu extends ze{constructor(e){super(),this.enabled=!1,this.min=0,this.max=0,B.util.initPartial(e,this)}static fromBinary(e,n){return new Xu().fromBinary(e,n)}static fromJson(e,n){return new Xu().fromJson(e,n)}static fromJsonString(e,n){return new Xu().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Xu,e,n)}}Xu.runtime=B;Xu.typeName="livekit.PlayoutDelay";Xu.fields=B.util.newFieldList(()=>[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]);class Ju extends ze{constructor(e){super(),this.canSubscribe=!1,this.canPublish=!1,this.canPublishData=!1,this.canPublishSources=[],this.hidden=!1,this.recorder=!1,this.canUpdateMetadata=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new Ju().fromBinary(e,n)}static fromJson(e,n){return new Ju().fromJson(e,n)}static fromJsonString(e,n){return new Ju().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ju,e,n)}}Ju.runtime=B;Ju.typeName="livekit.ParticipantPermission";Ju.fields=B.util.newFieldList(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:B.getEnumType(jn),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8}]);class Io extends ze{constructor(e){super(),this.sid="",this.identity="",this.state=Uf.JOINING,this.tracks=[],this.metadata="",this.joinedAt=_t.zero,this.name="",this.version=0,this.region="",this.isPublisher=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new Io().fromBinary(e,n)}static fromJson(e,n){return new Io().fromJson(e,n)}static fromJsonString(e,n){return new Io().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Io,e,n)}}Io.runtime=B;Io.typeName="livekit.ParticipantInfo";Io.fields=B.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:B.getEnumType(Uf)},{no:4,name:"tracks",kind:"message",T:eo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Ju},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8}]);var Uf;(function(t){t[t.JOINING=0]="JOINING",t[t.JOINED=1]="JOINED",t[t.ACTIVE=2]="ACTIVE",t[t.DISCONNECTED=3]="DISCONNECTED"})(Uf||(Uf={}));B.util.setEnumType(Uf,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);class Pl extends ze{constructor(e){super(),B.util.initPartial(e,this)}static fromBinary(e,n){return new Pl().fromBinary(e,n)}static fromJson(e,n){return new Pl().fromJson(e,n)}static fromJsonString(e,n){return new Pl().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Pl,e,n)}}Pl.runtime=B;Pl.typeName="livekit.Encryption";Pl.fields=B.util.newFieldList(()=>[]);var Ni;(function(t){t[t.NONE=0]="NONE",t[t.GCM=1]="GCM",t[t.CUSTOM=2]="CUSTOM"})(Ni||(Ni={}));B.util.setEnumType(Ni,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);class Yu extends ze{constructor(e){super(),this.mimeType="",this.mid="",this.cid="",this.layers=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Yu().fromBinary(e,n)}static fromJson(e,n){return new Yu().fromJson(e,n)}static fromJsonString(e,n){return new Yu().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Yu,e,n)}}Yu.runtime=B;Yu.typeName="livekit.SimulcastCodecInfo";Yu.fields=B.util.newFieldList(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Pi,repeated:!0}]);class eo extends ze{constructor(e){super(),this.sid="",this.type=ai.AUDIO,this.name="",this.muted=!1,this.width=0,this.height=0,this.simulcast=!1,this.disableDtx=!1,this.source=jn.UNKNOWN,this.layers=[],this.mimeType="",this.mid="",this.codecs=[],this.stereo=!1,this.disableRed=!1,this.encryption=Ni.NONE,this.stream="",B.util.initPartial(e,this)}static fromBinary(e,n){return new eo().fromBinary(e,n)}static fromJson(e,n){return new eo().fromJson(e,n)}static fromJsonString(e,n){return new eo().fromJsonString(e,n)}static equals(e,n){return B.util.equals(eo,e,n)}}eo.runtime=B;eo.typeName="livekit.TrackInfo";eo.fields=B.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:B.getEnumType(ai)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:B.getEnumType(jn)},{no:10,name:"layers",kind:"message",T:Pi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Yu,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:B.getEnumType(Ni)},{no:17,name:"stream",kind:"scalar",T:9}]);class Pi extends ze{constructor(e){super(),this.quality=ur.LOW,this.width=0,this.height=0,this.bitrate=0,this.ssrc=0,B.util.initPartial(e,this)}static fromBinary(e,n){return new Pi().fromBinary(e,n)}static fromJson(e,n){return new Pi().fromJson(e,n)}static fromJsonString(e,n){return new Pi().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Pi,e,n)}}Pi.runtime=B;Pi.typeName="livekit.VideoLayer";Pi.fields=B.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:B.getEnumType(ur)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]);class Fa extends ze{constructor(e){super(),this.kind=Fr.RELIABLE,this.value={case:void 0},B.util.initPartial(e,this)}static fromBinary(e,n){return new Fa().fromBinary(e,n)}static fromJson(e,n){return new Fa().fromJson(e,n)}static fromJsonString(e,n){return new Fa().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Fa,e,n)}}Fa.runtime=B;Fa.typeName="livekit.DataPacket";Fa.fields=B.util.newFieldList(()=>[{no:1,name:"kind",kind:"enum",T:B.getEnumType(Fr)},{no:2,name:"user",kind:"message",T:Ma,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Qu,oneof:"value"}]);var Fr;(function(t){t[t.RELIABLE=0]="RELIABLE",t[t.LOSSY=1]="LOSSY"})(Fr||(Fr={}));B.util.setEnumType(Fr,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);class Qu extends ze{constructor(e){super(),this.speakers=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Qu().fromBinary(e,n)}static fromJson(e,n){return new Qu().fromJson(e,n)}static fromJsonString(e,n){return new Qu().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Qu,e,n)}}Qu.runtime=B;Qu.typeName="livekit.ActiveSpeakerUpdate";Qu.fields=B.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:La,repeated:!0}]);class La extends ze{constructor(e){super(),this.sid="",this.level=0,this.active=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new La().fromBinary(e,n)}static fromJson(e,n){return new La().fromJson(e,n)}static fromJsonString(e,n){return new La().fromJsonString(e,n)}static equals(e,n){return B.util.equals(La,e,n)}}La.runtime=B;La.typeName="livekit.SpeakerInfo";La.fields=B.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]);class Ma extends ze{constructor(e){super(),this.participantSid="",this.payload=new Uint8Array(0),this.destinationSids=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Ma().fromBinary(e,n)}static fromJson(e,n){return new Ma().fromJson(e,n)}static fromJsonString(e,n){return new Ma().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ma,e,n)}}Ma.runtime=B;Ma.typeName="livekit.UserPacket";Ma.fields=B.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0}]);class Ba extends ze{constructor(e){super(),this.participantSid="",this.trackSids=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Ba().fromBinary(e,n)}static fromJson(e,n){return new Ba().fromJson(e,n)}static fromJsonString(e,n){return new Ba().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ba,e,n)}}Ba.runtime=B;Ba.typeName="livekit.ParticipantTracks";Ba.fields=B.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]);class Zu extends ze{constructor(e){super(),this.edition=Em.Standard,this.version="",this.protocol=0,this.region="",this.nodeId="",this.debugInfo="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Zu().fromBinary(e,n)}static fromJson(e,n){return new Zu().fromJson(e,n)}static fromJsonString(e,n){return new Zu().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Zu,e,n)}}Zu.runtime=B;Zu.typeName="livekit.ServerInfo";Zu.fields=B.util.newFieldList(()=>[{no:1,name:"edition",kind:"enum",T:B.getEnumType(Em)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9}]);var Em;(function(t){t[t.Standard=0]="Standard",t[t.Cloud=1]="Cloud"})(Em||(Em={}));B.util.setEnumType(Em,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);class ec extends ze{constructor(e){super(),this.sdk=_m.UNKNOWN,this.version="",this.protocol=0,this.os="",this.osVersion="",this.deviceModel="",this.browser="",this.browserVersion="",this.address="",this.network="",B.util.initPartial(e,this)}static fromBinary(e,n){return new ec().fromBinary(e,n)}static fromJson(e,n){return new ec().fromJson(e,n)}static fromJsonString(e,n){return new ec().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ec,e,n)}}ec.runtime=B;ec.typeName="livekit.ClientInfo";ec.fields=B.util.newFieldList(()=>[{no:1,name:"sdk",kind:"enum",T:B.getEnumType(_m)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]);var _m;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.JS=1]="JS",t[t.SWIFT=2]="SWIFT",t[t.ANDROID=3]="ANDROID",t[t.FLUTTER=4]="FLUTTER",t[t.GO=5]="GO",t[t.UNITY=6]="UNITY",t[t.REACT_NATIVE=7]="REACT_NATIVE",t[t.RUST=8]="RUST"})(_m||(_m={}));B.util.setEnumType(_m,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"}]);class Ua extends ze{constructor(e){super(),this.resumeConnection=ca.UNSET,this.forceRelay=ca.UNSET,B.util.initPartial(e,this)}static fromBinary(e,n){return new Ua().fromBinary(e,n)}static fromJson(e,n){return new Ua().fromJson(e,n)}static fromJsonString(e,n){return new Ua().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ua,e,n)}}Ua.runtime=B;Ua.typeName="livekit.ClientConfiguration";Ua.fields=B.util.newFieldList(()=>[{no:1,name:"video",kind:"message",T:Va},{no:2,name:"screen",kind:"message",T:Va},{no:3,name:"resume_connection",kind:"enum",T:B.getEnumType(ca)},{no:4,name:"disabled_codecs",kind:"message",T:tc},{no:5,name:"force_relay",kind:"enum",T:B.getEnumType(ca)}]);class Va extends ze{constructor(e){super(),this.hardwareEncoder=ca.UNSET,B.util.initPartial(e,this)}static fromBinary(e,n){return new Va().fromBinary(e,n)}static fromJson(e,n){return new Va().fromJson(e,n)}static fromJsonString(e,n){return new Va().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Va,e,n)}}Va.runtime=B;Va.typeName="livekit.VideoConfiguration";Va.fields=B.util.newFieldList(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:B.getEnumType(ca)}]);class tc extends ze{constructor(e){super(),this.codecs=[],this.publish=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new tc().fromBinary(e,n)}static fromJson(e,n){return new tc().fromJson(e,n)}static fromJsonString(e,n){return new tc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(tc,e,n)}}tc.runtime=B;tc.typeName="livekit.DisabledCodecs";tc.fields=B.util.newFieldList(()=>[{no:1,name:"codecs",kind:"message",T:Xs,repeated:!0},{no:2,name:"publish",kind:"message",T:Xs,repeated:!0}]);class Al extends ze{constructor(e){super(),this.duration=0,this.packets=0,this.packetRate=0,this.bytes=_t.zero,this.headerBytes=_t.zero,this.bitrate=0,this.packetsLost=0,this.packetLossRate=0,this.packetLossPercentage=0,this.packetsDuplicate=0,this.packetDuplicateRate=0,this.bytesDuplicate=_t.zero,this.headerBytesDuplicate=_t.zero,this.bitrateDuplicate=0,this.packetsPadding=0,this.packetPaddingRate=0,this.bytesPadding=_t.zero,this.headerBytesPadding=_t.zero,this.bitratePadding=0,this.packetsOutOfOrder=0,this.frames=0,this.frameRate=0,this.jitterCurrent=0,this.jitterMax=0,this.gapHistogram={},this.nacks=0,this.nackAcks=0,this.nackMisses=0,this.nackRepeated=0,this.plis=0,this.firs=0,this.rttCurrent=0,this.rttMax=0,this.keyFrames=0,this.layerLockPlis=0,this.sampleRate=0,this.driftMs=0,B.util.initPartial(e,this)}static fromBinary(e,n){return new Al().fromBinary(e,n)}static fromJson(e,n){return new Al().fromJson(e,n)}static fromJsonString(e,n){return new Al().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Al,e,n)}}Al.runtime=B;Al.typeName="livekit.RTPStats";Al.fields=B.util.newFieldList(()=>[{no:1,name:"start_time",kind:"message",T:ii},{no:2,name:"end_time",kind:"message",T:ii},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:ii},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:ii},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:ii},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:ii},{no:42,name:"sample_rate",kind:"scalar",T:1},{no:43,name:"drift_ms",kind:"scalar",T:1}]);class $l extends ze{constructor(e){super(),this.unixMicro=_t.zero,this.ticks=0,B.util.initPartial(e,this)}static fromBinary(e,n){return new $l().fromBinary(e,n)}static fromJson(e,n){return new $l().fromJson(e,n)}static fromJsonString(e,n){return new $l().fromJsonString(e,n)}static equals(e,n){return B.util.equals($l,e,n)}}$l.runtime=B;$l.typeName="livekit.TimedVersion";$l.fields=B.util.newFieldList(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]);const Xg=7e3,Vwe=[0,300,2*2*300,3*3*300,4*4*300,Xg,Xg,Xg,Xg,Xg];class zwe{constructor(e){this._retryDelays=e!==void 0?[...e]:Vwe}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function ue(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(l){try{c(r.next(l))}catch(d){s(d)}}function u(l){try{c(r.throw(l))}catch(d){s(d)}}function c(l){l.done?o(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})}function OB(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function np(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof OB=="function"?OB(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(s){return new Promise(function(a,u){s=t[o](s),i(a,u,s.done,s.value)})}}function i(o,s,a,u){Promise.resolve(u).then(function(c){o({value:c,done:a})},s)}}var $P={exports:{}},Xp=typeof Reflect=="object"?Reflect:null,FB=Xp&&typeof Xp.apply=="function"?Xp.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Fx;Xp&&typeof Xp.ownKeys=="function"?Fx=Xp.ownKeys:Object.getOwnPropertySymbols?Fx=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Fx=function(e){return Object.getOwnPropertyNames(e)};function Wwe(t){console&&console.warn&&console.warn(t)}var D8=Number.isNaN||function(e){return e!==e};function on(){on.init.call(this)}$P.exports=on;$P.exports.once=qwe;on.EventEmitter=on;on.prototype._events=void 0;on.prototype._eventsCount=0;on.prototype._maxListeners=void 0;var LB=10;function VC(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(on,"defaultMaxListeners",{enumerable:!0,get:function(){return LB},set:function(t){if(typeof t!="number"||t<0||D8(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");LB=t}});on.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};on.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||D8(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function O8(t){return t._maxListeners===void 0?on.defaultMaxListeners:t._maxListeners}on.prototype.getMaxListeners=function(){return O8(this)};on.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")FB(u,this,n);else for(var c=u.length,l=U8(u,c),r=0;r<c;++r)FB(l[r],this,n);return!0};function F8(t,e,n,r){var i,o,s;if(VC(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),s===void 0)s=o[e]=n,++t._eventsCount;else if(typeof s=="function"?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),i=O8(t),i>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,Wwe(a)}return t}on.prototype.addListener=function(e,n){return F8(this,e,n,!1)};on.prototype.on=on.prototype.addListener;on.prototype.prependListener=function(e,n){return F8(this,e,n,!0)};function jwe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function L8(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=jwe.bind(r);return i.listener=n,r.wrapFn=i,i}on.prototype.once=function(e,n){return VC(n),this.on(e,L8(this,e,n)),this};on.prototype.prependOnceListener=function(e,n){return VC(n),this.prependListener(e,L8(this,e,n)),this};on.prototype.removeListener=function(e,n){var r,i,o,s,a;if(VC(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():Gwe(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};on.prototype.off=on.prototype.removeListener;on.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function M8(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Hwe(i):U8(i,i.length)}on.prototype.listeners=function(e){return M8(this,e,!0)};on.prototype.rawListeners=function(e){return M8(this,e,!1)};on.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):B8.call(t,e)};on.prototype.listenerCount=B8;function B8(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}on.prototype.eventNames=function(){return this._eventsCount>0?Fx(this._events):[]};function U8(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Gwe(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Hwe(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function qwe(t,e){return new Promise(function(n,r){function i(s){t.removeListener(e,o),r(s)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}V8(t,e,o,{once:!0}),e!=="error"&&Kwe(t,i,{once:!0})})}function Kwe(t,e,n){typeof t.on=="function"&&V8(t,"error",e,n)}function V8(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(o){r.once&&t.removeEventListener(e,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var yu=$P.exports;let z8=!0,W8=!0;function Lx(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function ph(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(s,a){if(s!==e)return i.apply(this,arguments);const u=c=>{const l=n(c);l&&(a.handleEvent?a.handleEvent(l):a(l))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,u),i.apply(this,[s,u])};const o=r.removeEventListener;r.removeEventListener=function(s,a){if(s!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(a))return o.apply(this,arguments);const u=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,u])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function Xwe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(z8=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Jwe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(W8=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function j8(){if(typeof window=="object"){if(z8)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function DP(t,e){W8&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Ywe(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.mozGetUserMedia)e.browser="firefox",e.version=Lx(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=Lx(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Lx(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function MB(t){return Object.prototype.toString.call(t)==="[object Object]"}function G8(t){return MB(t)?Object.keys(t).reduce(function(e,n){const r=MB(t[n]),i=r?G8(t[n]):t[n],o=r&&!Object.keys(i).length;return i===void 0||o?e:Object.assign(e,{[n]:i})},{}):t}function lI(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?lI(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{lI(t,t.get(i),n)})}))}function BB(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const o=[];return t.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&o.push(s)}),o.forEach(s=>{t.forEach(a=>{a.type===r&&a.trackId===s.id&&lI(t,a,i)})}),i}const UB=j8;function H8(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const u={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const l=typeof a[c]=="object"?a[c]:{ideal:a[c]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const d=function(f,h){return f?f+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(l.ideal!==void 0){u.optional=u.optional||[];let f={};typeof l.ideal=="number"?(f[d("min",c)]=l.ideal,u.optional.push(f),f={},f[d("max",c)]=l.ideal,u.optional.push(f)):(f[d("",c)]=l.ideal,u.optional.push(f))}l.exact!==void 0&&typeof l.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[d("",c)]=l.exact):["min","max"].forEach(f=>{l[f]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[d(f,c)]=l[f])})}),a.advanced&&(u.optional=(u.optional||[]).concat(a.advanced)),u},i=function(a,u){if(e.version>=61)return u(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(l,d,f){d in l&&!(f in l)&&(l[f]=l[d],delete l[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const l=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(p=>p.kind==="videoinput");let h=f.find(p=>d.some(m=>p.label.toLowerCase().includes(m)));return!h&&f.length&&d.includes("back")&&(h=f[f.length-1]),h&&(a.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=r(a.video),UB("chrome: "+JSON.stringify(a)),u(a)})}a.video=r(a.video)}return UB("chrome: "+JSON.stringify(a)),u(a)},o=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(a,u,c){i(a,l=>{n.webkitGetUserMedia(l,u,d=>{c&&c(o(d))})})};if(n.getUserMedia=s.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return i(u,c=>a(c).then(l=>{if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(o(l))))}}}function Qwe(t,e){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&t.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(r){return e(r).then(i=>{const o=r.video&&r.video.width,s=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},o&&(r.video.mandatory.maxWidth=o),s&&(r.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(r)})}}}function q8(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function K8(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):o={track:i.track};const s=new Event("track");s.track=i.track,s.receiver=o,s.transceiver={receiver:o},s.streams=[r.stream],this.dispatchEvent(s)}),r.stream.getTracks().forEach(i=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===i.id):o={track:i};const s=new Event("track");s.track=i,s.receiver=o,s.transceiver={receiver:o},s.streams=[r.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ph(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function X8(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,u){let c=i.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const u=this._senders.indexOf(a);u!==-1&&this._senders.splice(u,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(s=>{const a=this._senders.find(u=>u.track===s);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function J8(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,i,o]=arguments;if(arguments.length>0&&typeof r=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof r!="function"))return e.apply(this,[]);const s=function(u){const c={};return u.result().forEach(d=>{const f={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(h=>{f[h]=d.stat(h)}),c[f.id]=f}),c},a=function(u){return new Map(Object.keys(u).map(c=>[c,u[c]]))};if(arguments.length>=2){const u=function(c){i(a(s(c)))};return e.apply(this,[u,r])}return new Promise((u,c)=>{e.apply(this,[function(l){u(a(s(l)))},c])}).then(i,o)}}function Y8(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(s=>s._pc=this),o});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>BB(s,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),ph(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>BB(o,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,o,s;return this.getSenders().forEach(a=>{a.track===r&&(i?s=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(o?s=!0:o=a),a.track===r)),s||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Q8(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(u)===-1&&this._shimmedLocalStreams[a.id].push(u):this._shimmedLocalStreams[a.id]=[a,u],u};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[s.id]=[s].concat(u)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const u=this._shimmedLocalStreams[a].indexOf(s);u!==-1&&this._shimmedLocalStreams[a].splice(u,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Z8(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Q8(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(d=>this._reverseStreams[d.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const d=new t.MediaStream(l.getTracks());this._streams[l.id]=d,this._reverseStreams[d.id]=l,l=d}r.apply(this,[l])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},t.RTCPeerConnection.prototype.addTrack=function(l,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(m=>m===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[d.id];if(p)p.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new t.MediaStream([l]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===l)};function o(c,l){let d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const h=c._reverseStreams[f],p=c._streams[h.id];d=d.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:l.type,sdp:d})}function s(c,l){let d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const h=c._reverseStreams[f],p=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const l=t.RTCPeerConnection.prototype[c],d={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[p=>{const m=o(this,p);f[0].apply(null,[m])},p=>{f[1]&&f[1].apply(null,p)},arguments[2]]):l.apply(this,arguments).then(p=>o(this,p))}};t.RTCPeerConnection.prototype[c]=d[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=s(this,arguments[0]),a.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=u.get.apply(this);return c.type===""?c:o(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(m=>l.track===m)&&(f=this._streams[h])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function dI(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function eq(t,e){ph(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var VB=Object.freeze({__proto__:null,fixNegotiationNeeded:eq,shimAddTrackRemoveTrack:Z8,shimAddTrackRemoveTrackWithNative:Q8,shimGetDisplayMedia:Qwe,shimGetSendersWithDtmf:X8,shimGetStats:J8,shimGetUserMedia:H8,shimMediaStream:q8,shimOnTrack:K8,shimPeerConnection:dI,shimSenderReceiverGetStats:Y8});function tq(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,o,s){DP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(o,s)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(s,a,u){a in s&&!(u in s)&&(s[u]=s[a],delete s[a])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},r&&r.prototype.getSettings){const s=r.prototype.getSettings;r.prototype.getSettings=function(){const a=s.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[a])}}}}function Zwe(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function nq(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fI(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=t.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=s[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,s,a]=arguments;return r.apply(this,[o||null]).then(u=>{if(e.version<53&&!s)try{u.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;u.forEach((l,d)=>{u.set(d,Object.assign({},l,{type:n[l.type]||l.type}))})}return u}).then(s,a)}}function rq(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function iq(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),ph(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function oq(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){DP("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function sq(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function aq(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(i){const{sender:s}=o,a=s.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,s.sendEncodings=r,this.setParametersPromises.push(s.setParameters(a).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return o})}function uq(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function cq(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function lq(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var zB=Object.freeze({__proto__:null,shimAddTransceiver:aq,shimCreateAnswer:lq,shimCreateOffer:cq,shimGetDisplayMedia:Zwe,shimGetParameters:uq,shimGetUserMedia:tq,shimOnTrack:nq,shimPeerConnection:fI,shimRTCDataChannel:sq,shimReceiverGetStats:iq,shimRemoveStream:oq,shimSenderGetStats:rq});function dq(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];return o&&o.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function fq(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,r.dispatchEvent(s)})}),e.apply(r,arguments)}}}function hq(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,o=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(c,l){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return l?(f.then(c,l),Promise.resolve()):f},e.createAnswer=function(c,l){const d=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[d]);return l?(f.then(c,l),Promise.resolve()):f};let a=function(u,c,l){const d=i.apply(this,[u]);return l?(d.then(c,l),Promise.resolve()):d};e.setLocalDescription=a,a=function(u,c,l){const d=o.apply(this,[u]);return l?(d.then(c,l),Promise.resolve()):d},e.setRemoteDescription=a,a=function(u,c,l){const d=s.apply(this,[u]);return l?(d.then(c,l),Promise.resolve()):d},e.addIceCandidate=a}function pq(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(mq(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,o){e.mediaDevices.getUserMedia(r).then(i,o)}).bind(e))}function mq(t){return t&&t.video!==void 0?Object.assign({},t,{video:G8(t.video)}):t}function gq(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const o=[];for(let s=0;s<r.iceServers.length;s++){let a=r.iceServers[s];a.urls===void 0&&a.url?(DP("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(r.iceServers[s])}r.iceServers=o}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function vq(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yq(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(s=>s.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function bq(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var WB=Object.freeze({__proto__:null,shimAudioContext:bq,shimCallbacksAPI:hq,shimConstraints:mq,shimCreateOfferLegacy:yq,shimGetUserMedia:pq,shimLocalStreamsAPI:dq,shimRTCIceServerUrls:gq,shimRemoteStreamsAPI:fq,shimTrackEventTransceiver:vq}),xq={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":i.relatedAddress=r[o+1];break;case"rport":i.relatedPort=parseInt(r[o+1],10);break;case"tcptype":i.tcpType=r[o+1];break;case"ufrag":i.ufrag=r[o+1],i.usernameFragment=r[o+1];break;default:i[r[o]]===void 0&&(i[r[o]]=r[o+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const o=n.type;return r.push("typ"),r.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const o=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)i=o[s].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(s=>{n.parameters[s]!==void 0?o.push(s+"="+n.parameters[s]):o.push(s)}),r+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},o=n.indexOf(":",r);return o>-1?(i.attribute=n.substring(r+1,o),i.value=n.substring(o+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(o=>{i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],o=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");r.profile=o[2];for(let a=3;a<o.length;a++){const u=o[a],c=e.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(c){const l=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+u+" ");switch(l.parameters=d.length?e.parseFmtp(d[0]):{},l.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(e.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{s.forEach(u=>{a.rtcpFeedback.find(l=>l.type===u.type&&l.parameter===u.parameter)||a.rtcpFeedback.push(u)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(s=>{i+=e.writeRtpMap(s),i+=e.writeFmtp(s),i+=e.writeRtcpFb(s)});let o=0;return r.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(s=>{i+=e.writeExtmap(s)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),u=a.length>0&&a[0].ssrc;let c;const l=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(p=>parseInt(p,10)));l.length>0&&l[0].length>1&&l[0][0]===u&&(c=l[0][1]),i.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let h={ssrc:u,codecPayloadType:parseInt(f.parameters.apt,10)};u&&c&&(h.rtx={ssrc:c}),r.push(h),o&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:u,mechanism:s?"red+ulpfec":"red"},r.push(h))}}),r.length===0&&u&&r.push({ssrc:u});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(f=>{f.maxBitrate=d})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;const s=e.matchPrefix(n,"a=rtcp-mux");return r.mux=s.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=e.matchPrefix(n,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);const s=e.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const u=a[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let o;const s=r!==void 0?r:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(xq);var wq=xq.exports,Jp=nwe(wq),eSe=ewe({__proto__:null,default:Jp},[wq]);function Mx(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),o=Jp.parseCandidate(r.candidate);for(const s in o)s in i||Object.defineProperty(i,s,{value:o[s]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,ph(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function hI(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ph(t,"icecandidate",e=>{if(e.candidate){const n=Jp.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Bx(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const u=Jp.splitSections(a.sdp);return u.shift(),u.some(c=>{const l=Jp.parseMLine(c);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},r=function(a){const u=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const c=parseInt(u[1],10);return c!==c?-1:c},i=function(a){let u=65536;return e.browser==="firefox"&&(e.version<57?a===-1?u=16384:u=2147483637:e.version<60?u=e.version===57?65535:65536:u=2147483637),u},o=function(a,u){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const l=Jp.matchPrefix(a.sdp,"a=max-message-size:");return l.length>0?c=parseInt(l[0].substring(19),10):e.browser==="firefox"&&u!==-1&&(c=2147483637),c},s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=r(arguments[0]),c=i(u),l=o(arguments[0],u);let d;c===0&&l===0?d=Number.POSITIVE_INFINITY:c===0||l===0?d=Math.max(c,l):d=Math.min(c,l);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return s.apply(this,arguments)}}function Ux(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const o=r.send;r.send=function(){const a=arguments[0],u=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},ph(t,"datachannel",r=>(e(r.channel,r.target),r))}function pI(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",i);o.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function mI(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function Vx(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function zx(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var tSe=Object.freeze({__proto__:null,removeExtmapAllowMixed:mI,shimAddIceCandidateNullOrEmpty:Vx,shimConnectionState:pI,shimMaxMessageSize:Bx,shimParameterlessSetLocalDescription:zx,shimRTCIceCandidate:Mx,shimRTCIceCandidateRelayProtocol:hI,shimSendThrowTypeError:Ux});function nSe(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=j8,r=Ywe(t),i={browserDetails:r,commonShim:tSe,extractVersion:Lx,disableLog:Xwe,disableWarnings:Jwe,sdp:eSe};switch(r.browser){case"chrome":if(!VB||!dI||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=VB,Vx(t,r),zx(t),H8(t,r),q8(t),dI(t,r),K8(t),Z8(t,r),X8(t),J8(t),Y8(t),eq(t,r),Mx(t),hI(t),pI(t),Bx(t,r),Ux(t),mI(t,r);break;case"firefox":if(!zB||!fI||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=zB,Vx(t,r),zx(t),tq(t,r),fI(t,r),nq(t),oq(t),rq(t),iq(t),sq(t),aq(t),uq(t),cq(t),lq(t),Mx(t),pI(t),Bx(t,r),Ux(t);break;case"safari":if(!WB||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=WB,Vx(t,r),zx(t),gq(t),yq(t),hq(t),dq(t),fq(t),vq(t),pq(t),bq(t),Mx(t),hI(t),Bx(t,r),Ux(t),mI(t,r);break;default:n("Unsupported browser!");break}return i}nSe({window:typeof window>"u"?void 0:window});var to;(function(t){t[t.PUBLISHER=0]="PUBLISHER",t[t.SUBSCRIBER=1]="SUBSCRIBER"})(to||(to={}));B.util.setEnumType(to,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]);var Vf;(function(t){t[t.ACTIVE=0]="ACTIVE",t[t.PAUSED=1]="PAUSED"})(Vf||(Vf={}));B.util.setEnumType(Vf,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]);var Vw;(function(t){t[t.UDP=0]="UDP",t[t.TCP=1]="TCP",t[t.TLS=2]="TLS"})(Vw||(Vw={}));B.util.setEnumType(Vw,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);class nc extends ze{constructor(e){super(),this.message={case:void 0},B.util.initPartial(e,this)}static fromBinary(e,n){return new nc().fromBinary(e,n)}static fromJson(e,n){return new nc().fromJson(e,n)}static fromJsonString(e,n){return new nc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(nc,e,n)}}nc.runtime=B;nc.typeName="livekit.SignalRequest";nc.fields=B.util.newFieldList(()=>[{no:1,name:"offer",kind:"message",T:Ai,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ai,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Ys,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Js,oneof:"message"},{no:5,name:"mute",kind:"message",T:Qs,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ps,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Wa,oneof:"message"},{no:8,name:"leave",kind:"message",T:ms,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:ja,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Ka,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Xa,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Ti,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Ga,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ya,oneof:"message"}]);class za extends ze{constructor(e){super(),this.message={case:void 0},B.util.initPartial(e,this)}static fromBinary(e,n){return new za().fromBinary(e,n)}static fromJson(e,n){return new za().fromJson(e,n)}static fromJsonString(e,n){return new za().fromJsonString(e,n)}static equals(e,n){return B.util.equals(za,e,n)}}za.runtime=B;za.typeName="livekit.SignalResponse";za.fields=B.util.newFieldList(()=>[{no:1,name:"join",kind:"message",T:rc,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ai,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ai,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Ys,oneof:"message"},{no:5,name:"update",kind:"message",T:sc,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Zs,oneof:"message"},{no:8,name:"leave",kind:"message",T:ms,oneof:"message"},{no:9,name:"mute",kind:"message",T:Qs,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:ac,oneof:"message"},{no:11,name:"room_update",kind:"message",T:uc,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:lc,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:fc,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:pc,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:mc,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:oc,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ic,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:gc,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:yc,oneof:"message"}]);class hs extends ze{constructor(e){super(),this.codec="",this.cid="",this.enableSimulcastLayers=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new hs().fromBinary(e,n)}static fromJson(e,n){return new hs().fromJson(e,n)}static fromJsonString(e,n){return new hs().fromJsonString(e,n)}static equals(e,n){return B.util.equals(hs,e,n)}}hs.runtime=B;hs.typeName="livekit.SimulcastCodec";hs.fields=B.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:3,name:"enable_simulcast_layers",kind:"scalar",T:8}]);class Js extends ze{constructor(e){super(),this.cid="",this.name="",this.type=ai.AUDIO,this.width=0,this.height=0,this.muted=!1,this.disableDtx=!1,this.source=jn.UNKNOWN,this.layers=[],this.simulcastCodecs=[],this.sid="",this.stereo=!1,this.disableRed=!1,this.encryption=Ni.NONE,this.stream="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Js().fromBinary(e,n)}static fromJson(e,n){return new Js().fromJson(e,n)}static fromJsonString(e,n){return new Js().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Js,e,n)}}Js.runtime=B;Js.typeName="livekit.AddTrackRequest";Js.fields=B.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:B.getEnumType(ai)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:B.getEnumType(jn)},{no:9,name:"layers",kind:"message",T:Pi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:hs,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:B.getEnumType(Ni)},{no:15,name:"stream",kind:"scalar",T:9}]);class Ys extends ze{constructor(e){super(),this.candidateInit="",this.target=to.PUBLISHER,B.util.initPartial(e,this)}static fromBinary(e,n){return new Ys().fromBinary(e,n)}static fromJson(e,n){return new Ys().fromJson(e,n)}static fromJsonString(e,n){return new Ys().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ys,e,n)}}Ys.runtime=B;Ys.typeName="livekit.TrickleRequest";Ys.fields=B.util.newFieldList(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:B.getEnumType(to)}]);class Qs extends ze{constructor(e){super(),this.sid="",this.muted=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new Qs().fromBinary(e,n)}static fromJson(e,n){return new Qs().fromJson(e,n)}static fromJsonString(e,n){return new Qs().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Qs,e,n)}}Qs.runtime=B;Qs.typeName="livekit.MuteTrackRequest";Qs.fields=B.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]);class rc extends ze{constructor(e){super(),this.otherParticipants=[],this.serverVersion="",this.iceServers=[],this.subscriberPrimary=!1,this.alternativeUrl="",this.serverRegion="",this.pingTimeout=0,this.pingInterval=0,this.sifTrailer=new Uint8Array(0),B.util.initPartial(e,this)}static fromBinary(e,n){return new rc().fromBinary(e,n)}static fromJson(e,n){return new rc().fromJson(e,n)}static fromJsonString(e,n){return new rc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(rc,e,n)}}rc.runtime=B;rc.typeName="livekit.JoinResponse";rc.fields=B.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:Qm},{no:2,name:"participant",kind:"message",T:Io},{no:3,name:"other_participants",kind:"message",T:Io,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Ha,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Ua},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Zu},{no:13,name:"sif_trailer",kind:"scalar",T:12}]);class ic extends ze{constructor(e){super(),this.iceServers=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new ic().fromBinary(e,n)}static fromJson(e,n){return new ic().fromJson(e,n)}static fromJsonString(e,n){return new ic().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ic,e,n)}}ic.runtime=B;ic.typeName="livekit.ReconnectResponse";ic.fields=B.util.newFieldList(()=>[{no:1,name:"ice_servers",kind:"message",T:Ha,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Ua}]);class Zs extends ze{constructor(e){super(),this.cid="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Zs().fromBinary(e,n)}static fromJson(e,n){return new Zs().fromJson(e,n)}static fromJsonString(e,n){return new Zs().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Zs,e,n)}}Zs.runtime=B;Zs.typeName="livekit.TrackPublishedResponse";Zs.fields=B.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:eo}]);class oc extends ze{constructor(e){super(),this.trackSid="",B.util.initPartial(e,this)}static fromBinary(e,n){return new oc().fromBinary(e,n)}static fromJson(e,n){return new oc().fromJson(e,n)}static fromJsonString(e,n){return new oc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(oc,e,n)}}oc.runtime=B;oc.typeName="livekit.TrackUnpublishedResponse";oc.fields=B.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);class Ai extends ze{constructor(e){super(),this.type="",this.sdp="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Ai().fromBinary(e,n)}static fromJson(e,n){return new Ai().fromJson(e,n)}static fromJsonString(e,n){return new Ai().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ai,e,n)}}Ai.runtime=B;Ai.typeName="livekit.SessionDescription";Ai.fields=B.util.newFieldList(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]);class sc extends ze{constructor(e){super(),this.participants=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new sc().fromBinary(e,n)}static fromJson(e,n){return new sc().fromJson(e,n)}static fromJsonString(e,n){return new sc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(sc,e,n)}}sc.runtime=B;sc.typeName="livekit.ParticipantUpdate";sc.fields=B.util.newFieldList(()=>[{no:1,name:"participants",kind:"message",T:Io,repeated:!0}]);class ps extends ze{constructor(e){super(),this.trackSids=[],this.subscribe=!1,this.participantTracks=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new ps().fromBinary(e,n)}static fromJson(e,n){return new ps().fromJson(e,n)}static fromJsonString(e,n){return new ps().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ps,e,n)}}ps.runtime=B;ps.typeName="livekit.UpdateSubscription";ps.fields=B.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Ba,repeated:!0}]);class Wa extends ze{constructor(e){super(),this.trackSids=[],this.disabled=!1,this.quality=ur.LOW,this.width=0,this.height=0,this.fps=0,this.priority=0,B.util.initPartial(e,this)}static fromBinary(e,n){return new Wa().fromBinary(e,n)}static fromJson(e,n){return new Wa().fromJson(e,n)}static fromJsonString(e,n){return new Wa().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Wa,e,n)}}Wa.runtime=B;Wa.typeName="livekit.UpdateTrackSettings";Wa.fields=B.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:B.getEnumType(ur)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]);class ms extends ze{constructor(e){super(),this.canReconnect=!1,this.reason=Tc.UNKNOWN_REASON,B.util.initPartial(e,this)}static fromBinary(e,n){return new ms().fromBinary(e,n)}static fromJson(e,n){return new ms().fromJson(e,n)}static fromJsonString(e,n){return new ms().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ms,e,n)}}ms.runtime=B;ms.typeName="livekit.LeaveRequest";ms.fields=B.util.newFieldList(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:B.getEnumType(Tc)}]);class ja extends ze{constructor(e){super(),this.trackSid="",this.layers=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new ja().fromBinary(e,n)}static fromJson(e,n){return new ja().fromJson(e,n)}static fromJsonString(e,n){return new ja().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ja,e,n)}}ja.runtime=B;ja.typeName="livekit.UpdateVideoLayers";ja.fields=B.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Pi,repeated:!0}]);class Ga extends ze{constructor(e){super(),this.metadata="",this.name="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Ga().fromBinary(e,n)}static fromJson(e,n){return new Ga().fromJson(e,n)}static fromJsonString(e,n){return new Ga().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ga,e,n)}}Ga.runtime=B;Ga.typeName="livekit.UpdateParticipantMetadata";Ga.fields=B.util.newFieldList(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]);class Ha extends ze{constructor(e){super(),this.urls=[],this.username="",this.credential="",B.util.initPartial(e,this)}static fromBinary(e,n){return new Ha().fromBinary(e,n)}static fromJson(e,n){return new Ha().fromJson(e,n)}static fromJsonString(e,n){return new Ha().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ha,e,n)}}Ha.runtime=B;Ha.typeName="livekit.ICEServer";Ha.fields=B.util.newFieldList(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]);class ac extends ze{constructor(e){super(),this.speakers=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new ac().fromBinary(e,n)}static fromJson(e,n){return new ac().fromJson(e,n)}static fromJsonString(e,n){return new ac().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ac,e,n)}}ac.runtime=B;ac.typeName="livekit.SpeakersChanged";ac.fields=B.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:La,repeated:!0}]);class uc extends ze{constructor(e){super(),B.util.initPartial(e,this)}static fromBinary(e,n){return new uc().fromBinary(e,n)}static fromJson(e,n){return new uc().fromJson(e,n)}static fromJsonString(e,n){return new uc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(uc,e,n)}}uc.runtime=B;uc.typeName="livekit.RoomUpdate";uc.fields=B.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:Qm}]);class cc extends ze{constructor(e){super(),this.participantSid="",this.quality=Zl.POOR,this.score=0,B.util.initPartial(e,this)}static fromBinary(e,n){return new cc().fromBinary(e,n)}static fromJson(e,n){return new cc().fromJson(e,n)}static fromJsonString(e,n){return new cc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(cc,e,n)}}cc.runtime=B;cc.typeName="livekit.ConnectionQualityInfo";cc.fields=B.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:B.getEnumType(Zl)},{no:3,name:"score",kind:"scalar",T:2}]);class lc extends ze{constructor(e){super(),this.updates=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new lc().fromBinary(e,n)}static fromJson(e,n){return new lc().fromJson(e,n)}static fromJsonString(e,n){return new lc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(lc,e,n)}}lc.runtime=B;lc.typeName="livekit.ConnectionQualityUpdate";lc.fields=B.util.newFieldList(()=>[{no:1,name:"updates",kind:"message",T:cc,repeated:!0}]);class dc extends ze{constructor(e){super(),this.participantSid="",this.trackSid="",this.state=Vf.ACTIVE,B.util.initPartial(e,this)}static fromBinary(e,n){return new dc().fromBinary(e,n)}static fromJson(e,n){return new dc().fromJson(e,n)}static fromJsonString(e,n){return new dc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(dc,e,n)}}dc.runtime=B;dc.typeName="livekit.StreamStateInfo";dc.fields=B.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:B.getEnumType(Vf)}]);class fc extends ze{constructor(e){super(),this.streamStates=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new fc().fromBinary(e,n)}static fromJson(e,n){return new fc().fromJson(e,n)}static fromJsonString(e,n){return new fc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(fc,e,n)}}fc.runtime=B;fc.typeName="livekit.StreamStateUpdate";fc.fields=B.util.newFieldList(()=>[{no:1,name:"stream_states",kind:"message",T:dc,repeated:!0}]);class ea extends ze{constructor(e){super(),this.quality=ur.LOW,this.enabled=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new ea().fromBinary(e,n)}static fromJson(e,n){return new ea().fromJson(e,n)}static fromJsonString(e,n){return new ea().fromJsonString(e,n)}static equals(e,n){return B.util.equals(ea,e,n)}}ea.runtime=B;ea.typeName="livekit.SubscribedQuality";ea.fields=B.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:B.getEnumType(ur)},{no:2,name:"enabled",kind:"scalar",T:8}]);class hc extends ze{constructor(e){super(),this.codec="",this.qualities=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new hc().fromBinary(e,n)}static fromJson(e,n){return new hc().fromJson(e,n)}static fromJsonString(e,n){return new hc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(hc,e,n)}}hc.runtime=B;hc.typeName="livekit.SubscribedCodec";hc.fields=B.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:ea,repeated:!0}]);class pc extends ze{constructor(e){super(),this.trackSid="",this.subscribedQualities=[],this.subscribedCodecs=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new pc().fromBinary(e,n)}static fromJson(e,n){return new pc().fromJson(e,n)}static fromJsonString(e,n){return new pc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(pc,e,n)}}pc.runtime=B;pc.typeName="livekit.SubscribedQualityUpdate";pc.fields=B.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:ea,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:hc,repeated:!0}]);class qa extends ze{constructor(e){super(),this.participantSid="",this.allTracks=!1,this.trackSids=[],this.participantIdentity="",B.util.initPartial(e,this)}static fromBinary(e,n){return new qa().fromBinary(e,n)}static fromJson(e,n){return new qa().fromJson(e,n)}static fromJsonString(e,n){return new qa().fromJsonString(e,n)}static equals(e,n){return B.util.equals(qa,e,n)}}qa.runtime=B;qa.typeName="livekit.TrackPermission";qa.fields=B.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]);class Ka extends ze{constructor(e){super(),this.allParticipants=!1,this.trackPermissions=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Ka().fromBinary(e,n)}static fromJson(e,n){return new Ka().fromJson(e,n)}static fromJsonString(e,n){return new Ka().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ka,e,n)}}Ka.runtime=B;Ka.typeName="livekit.SubscriptionPermission";Ka.fields=B.util.newFieldList(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:qa,repeated:!0}]);class mc extends ze{constructor(e){super(),this.participantSid="",this.trackSid="",this.allowed=!1,B.util.initPartial(e,this)}static fromBinary(e,n){return new mc().fromBinary(e,n)}static fromJson(e,n){return new mc().fromJson(e,n)}static fromJsonString(e,n){return new mc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(mc,e,n)}}mc.runtime=B;mc.typeName="livekit.SubscriptionPermissionUpdate";mc.fields=B.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]);class Xa extends ze{constructor(e){super(),this.publishTracks=[],this.dataChannels=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Xa().fromBinary(e,n)}static fromJson(e,n){return new Xa().fromJson(e,n)}static fromJsonString(e,n){return new Xa().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Xa,e,n)}}Xa.runtime=B;Xa.typeName="livekit.SyncState";Xa.fields=B.util.newFieldList(()=>[{no:1,name:"answer",kind:"message",T:Ai},{no:2,name:"subscription",kind:"message",T:ps},{no:3,name:"publish_tracks",kind:"message",T:Zs,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Ja,repeated:!0},{no:5,name:"offer",kind:"message",T:Ai}]);class Ja extends ze{constructor(e){super(),this.label="",this.id=0,this.target=to.PUBLISHER,B.util.initPartial(e,this)}static fromBinary(e,n){return new Ja().fromBinary(e,n)}static fromJson(e,n){return new Ja().fromJson(e,n)}static fromJsonString(e,n){return new Ja().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ja,e,n)}}Ja.runtime=B;Ja.typeName="livekit.DataChannelInfo";Ja.fields=B.util.newFieldList(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:B.getEnumType(to)}]);class Ti extends ze{constructor(e){super(),this.scenario={case:void 0},B.util.initPartial(e,this)}static fromBinary(e,n){return new Ti().fromBinary(e,n)}static fromJson(e,n){return new Ti().fromJson(e,n)}static fromJsonString(e,n){return new Ti().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ti,e,n)}}Ti.runtime=B;Ti.typeName="livekit.SimulateScenario";Ti.fields=B.util.newFieldList(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:B.getEnumType(Vw),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"}]);class Ya extends ze{constructor(e){super(),this.timestamp=_t.zero,this.rtt=_t.zero,B.util.initPartial(e,this)}static fromBinary(e,n){return new Ya().fromBinary(e,n)}static fromJson(e,n){return new Ya().fromJson(e,n)}static fromJsonString(e,n){return new Ya().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Ya,e,n)}}Ya.runtime=B;Ya.typeName="livekit.Ping";Ya.fields=B.util.newFieldList(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]);class gc extends ze{constructor(e){super(),this.lastPingTimestamp=_t.zero,this.timestamp=_t.zero,B.util.initPartial(e,this)}static fromBinary(e,n){return new gc().fromBinary(e,n)}static fromJson(e,n){return new gc().fromJson(e,n)}static fromJsonString(e,n){return new gc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(gc,e,n)}}gc.runtime=B;gc.typeName="livekit.Pong";gc.fields=B.util.newFieldList(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]);class Dl extends ze{constructor(e){super(),this.regions=[],B.util.initPartial(e,this)}static fromBinary(e,n){return new Dl().fromBinary(e,n)}static fromJson(e,n){return new Dl().fromJson(e,n)}static fromJsonString(e,n){return new Dl().fromJsonString(e,n)}static equals(e,n){return B.util.equals(Dl,e,n)}}Dl.runtime=B;Dl.typeName="livekit.RegionSettings";Dl.fields=B.util.newFieldList(()=>[{no:1,name:"regions",kind:"message",T:vc,repeated:!0}]);class vc extends ze{constructor(e){super(),this.region="",this.url="",this.distance=_t.zero,B.util.initPartial(e,this)}static fromBinary(e,n){return new vc().fromBinary(e,n)}static fromJson(e,n){return new vc().fromJson(e,n)}static fromJsonString(e,n){return new vc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(vc,e,n)}}vc.runtime=B;vc.typeName="livekit.RegionInfo";vc.fields=B.util.newFieldList(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]);class yc extends ze{constructor(e){super(),this.trackSid="",this.err=Fy.SE_UNKNOWN,B.util.initPartial(e,this)}static fromBinary(e,n){return new yc().fromBinary(e,n)}static fromJson(e,n){return new yc().fromJson(e,n)}static fromJsonString(e,n){return new yc().fromJsonString(e,n)}static equals(e,n){return B.util.equals(yc,e,n)}}yc.runtime=B;yc.typeName="livekit.SubscriptionResponse";yc.fields=B.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:B.getEnumType(Fy)}]);class Zm extends Error{constructor(e,n){super(n||"an error has occured"),this.code=e}}class Bn extends Zm{constructor(e,n,r){super(1,e),this.status=r,this.reason=n}}class OP extends Zm{constructor(e){super(21,e??"device is unsupported")}}class Na extends Zm{constructor(e){super(20,e??"track is invalid")}}class rSe extends Zm{constructor(e){super(10,e??"unsupported server")}}class Jr extends Zm{constructor(e){super(12,e??"unexpected connection state")}}class gI extends Zm{constructor(e){super(13,e??"unable to negotiate")}}var zw;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(zw||(zw={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(zw||(zw={}));class ui{}ui.setTimeout=function(){return setTimeout(...arguments)};ui.setInterval=function(){return setInterval(...arguments)};ui.clearTimeout=function(){return clearTimeout(...arguments)};ui.clearInterval=function(){return clearInterval(...arguments)};const iSe=/version\/(\d+(\.?_?\d+)+)/i;let mT;function eg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof t>"u"&&typeof navigator>"u")return;const n=(t??navigator.userAgent).toLowerCase();if(mT===void 0||e){const r=oSe.find(i=>{let{test:o}=i;return o.test(n)});mT=r==null?void 0:r.describe(n)}return mT}const oSe=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:gT(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:gT(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:gT(iSe,t),os:t.includes("mobile/")?"iOS":"macOS"}}}];function gT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(t);return r&&r.length>=n&&r[n]||""}var sSe="1.13.3";const aSe=sSe,uSe=9;class fn{constructor(e,n,r,i,o){this.width=e,this.height=n,this.encoding={maxBitrate:r,maxFramerate:i,priority:o}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const cSe=["vp8","h264"],Sq=["vp8","h264","vp9","av1"];function lSe(t){return!!cSe.find(e=>e===t)}function jB(t,e){return(t==null?void 0:t.toLowerCase().replace(/audio\/|video\//y,""))===(e==null?void 0:e.toLowerCase().replace(/audio\/|video\//y,""))}var Ww;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:2e4},t.music={maxBitrate:32e3},t.musicStereo={maxBitrate:48e3},t.musicHighQuality={maxBitrate:64e3},t.musicHighQualityStereo={maxBitrate:96e3}})(Ww||(Ww={}));const Ly={h90:new fn(160,90,9e4,20),h180:new fn(320,180,16e4,20),h216:new fn(384,216,18e4,20),h360:new fn(640,360,45e4,20),h540:new fn(960,540,8e5,25),h720:new fn(1280,720,17e5,30),h1080:new fn(1920,1080,3e6,30),h1440:new fn(2560,1440,5e6,30),h2160:new fn(3840,2160,8e6,30)},vI={h120:new fn(160,120,7e4,20),h180:new fn(240,180,125e3,20),h240:new fn(320,240,14e4,20),h360:new fn(480,360,33e4,20),h480:new fn(640,480,5e5,20),h540:new fn(720,540,6e5,25),h720:new fn(960,720,13e5,30),h1080:new fn(1440,1080,23e5,30),h1440:new fn(1920,1440,38e5,30)},FP={h360fps3:new fn(640,360,2e5,3,"medium"),h720fps5:new fn(1280,720,4e5,5,"medium"),h720fps15:new fn(1280,720,15e5,15,"medium"),h720fps30:new fn(1280,720,2e6,30,"medium"),h1080fps15:new fn(1920,1080,25e5,15,"medium"),h1080fps30:new fn(1920,1080,4e6,30,"medium")};var De;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.StateChanged="connectionStateChanged",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged"})(De||(De={}));var Qe;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded"})(Qe||(Qe={}));var Ze;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate"})(Ze||(Ze={}));var Ue;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed"})(Ue||(Ue={}));const dSe=5e3,Jg=[];class Ee extends yu.EventEmitter{constructor(e,n){super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Ee.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),dSe):this.handleAppVisibilityChanged()},this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Ee.Source.Unknown}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===Ee.Kind.Video&&(n="video"),this.attachedElements.length===0&&Ee.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Jg.forEach(i=>{i.parentElement===null&&!e&&(e=i)}),e&&Jg.splice(Jg.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ap(this.mediaStreamTrack,e);const r=e.srcObject.getTracks();return r.some(i=>i.kind==="audio")&&e.play().then(()=>{this.emit(Ue.AudioPlaybackStarted)}).catch(i=>{i.name==="NotAllowedError"?this.emit(Ue.AudioPlaybackFailed,i):ie.warn("could not playback audio",i),e&&r.some(o=>o.kind==="video")&&i.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Ue.ElementAttached,e),e}detach(e){try{if(e){Yp(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Ue.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{Yp(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(Ue.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Jg.forEach(r=>{r.parentElement||(n=!1)}),n&&Jg.push(e)}}handleAppVisibilityChanged(){return ue(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden"})}addAppVisibilityListener(){ao()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ao()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ap(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;t.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(t)||(r.forEach(i=>{n.removeTrack(i)}),n.addTrack(t)),e.autoplay=!0,e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(WC()||My())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Yp(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let r;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(r=t.StreamState||(t.StreamState={}));function i(c){switch(c){case e.Audio:return ai.AUDIO;case e.Video:return ai.VIDEO;default:return ai.DATA}}t.kindToProto=i;function o(c){switch(c){case ai.AUDIO:return e.Audio;case ai.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function s(c){switch(c){case n.Camera:return jn.CAMERA;case n.Microphone:return jn.MICROPHONE;case n.ScreenShare:return jn.SCREEN_SHARE;case n.ScreenShareAudio:return jn.SCREEN_SHARE_AUDIO;default:return jn.UNKNOWN}}t.sourceToProto=s;function a(c){switch(c){case jn.CAMERA:return n.Camera;case jn.MICROPHONE:return n.Microphone;case jn.SCREEN_SHARE:return n.ScreenShare;case jn.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function u(c){switch(c){case Vf.ACTIVE:return r.Active;case Vf.PAUSED:return r.Paused;default:return r.Unknown}}t.streamStateFromProto=u})(Ee||(Ee={}));function Cq(t,e,n){const r=Object.assign({},t);return r.audio===!0&&(r.audio={}),r.video===!0&&(r.video={}),r.audio&&yI(r.audio,e),r.video&&yI(r.video,n),r}function yI(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function zC(t){const e={};if(t.video)if(typeof t.video=="object"){const n={},r=n,i=t.video;Object.keys(i).forEach(o=>{switch(o){case"resolution":yI(r,i.resolution);break;default:r[o]=i[o]}}),e.video=n}else e.video=t.video;else e.video=!1;return t.audio?typeof t.audio=="object"?e.audio=t.audio:e.audio=!0:e.audio=!1,e}function fSe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return ue(this,void 0,void 0,function*(){const n=kq();if(n){const r=n.createAnalyser();r.fftSize=2048;const i=r.frequencyBinCount,o=new Uint8Array(i);n.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(r),yield Ef(e),r.getByteTimeDomainData(o);const a=o.some(u=>u!==128&&u!==0);return n.close(),!a}return!1})}function kq(){const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t)return new t({latencyHint:"interactive"})}function hSe(t){return t===Ee.Source.Microphone?"audioinput":t===Ee.Source.Camera?"videoinput":void 0}function pSe(t){var e,n;let r=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&(r=typeof r=="boolean"?{}:r,WC()?r=Object.assign(Object.assign({},r),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:r,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio}}const mSe="|",GB="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function gSe(t){const e=t.split(mSe);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ef(t){return ue(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}function HB(){return"addTransceiver"in RTCPeerConnection.prototype}function qB(){return"addTrack"in RTCPeerConnection.prototype}function vSe(){if(!("getCapabilities"in RTCRtpSender))return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function ySe(){if(!("getCapabilities"in RTCRtpSender))return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function Kv(t){return t==="av1"||t==="vp9"}function bI(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}const bSe={Chrome:"100",Safari:"15",Firefox:"100"};function xSe(t){if(!ao()||!("setCodecPreferences"in t))return!1;const e=eg();if(!(e!=null&&e.name)||!e.version)return!1;const n=bSe[e.name];return n?Iq(e.version,n)>=0:!1}function My(){var t;return((t=eg())===null||t===void 0?void 0:t.name)==="Firefox"}function wSe(){var t;return((t=eg())===null||t===void 0?void 0:t.name)==="Chrome"}function WC(){var t;return((t=eg())===null||t===void 0?void 0:t.name)==="Safari"}function Tq(){return ao()?/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function ao(){return typeof document<"u"}function zf(){return navigator.product=="ReactNative"}function xI(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Eq(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function _q(){if(!zf())return;let t=Eq();if(t)return t.platform}function KB(){if(ao())return window.devicePixelRatio;if(zf()){let t=Eq();if(t)return t.devicePixelRatio}return 1}function Iq(t,e){const n=t.split("."),r=e.split("."),i=Math.min(n.length,r.length);for(let o=0;o<i;++o){const s=parseInt(n[o],10),a=parseInt(r[o],10);if(s>a)return 1;if(s<a)return-1;if(o===i-1&&s===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function SSe(t){for(const e of t)e.target.handleResize(e)}function CSe(t){for(const e of t)e.target.handleVisibilityChanged(e)}let vT=null;const XB=()=>(vT||(vT=new ResizeObserver(SSe)),vT);let yT=null;const JB=()=>(yT||(yT=new IntersectionObserver(CSe,{root:null,rootMargin:"0px"})),yT);function kSe(){var t;const e=new ec({sdk:_m.JS,protocol:uSe,version:aSe});return zf()&&(e.os=(t=_q())!==null&&t!==void 0?t:""),e}function YB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");o==null||o.fillRect(0,0,i.width,i.height),r&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const s=i.captureStream(),[a]=s.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Yg;function bT(){if(!Yg){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const r=t.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[Yg]=r.stream.getAudioTracks(),!Yg)throw Error("Could not get empty media stream audio track");Yg.enabled=!1}return Yg.clone()}class Rq{constructor(e,n){this.onFinally=n,this.promise=new Promise((r,i)=>ue(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}class Ec{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}}function TSe(t){return Sq.includes(t)}function _f(t){if(typeof t=="string")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function ESe(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function QB(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}var Xv;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Xv||(Xv={}));class _Se{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ec,this.nextTaskIndex=0}run(e){return ue(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Xv.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Xv.RUNNING,yield e()}finally{n.status=Xv.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return ue(this,void 0,void 0,function*(){return this.run(()=>ue(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const ISe=["syncState","trickle","offer","answer","simulate","leave"];function RSe(t){const e=ISe.indexOf(t.case)>=0;return ie.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}class LP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.rtt=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.isConnected=!1,this.isReconnecting=!1,this.useJSON=e,this.requestQueue=new _Se,this.queuedRequests=[],this.closingLock=new Ec}join(e,n,r,i){return ue(this,void 0,void 0,function*(){return this.isConnected=!1,this.options=r,yield this.connect(e,n,r,i)})}reconnect(e,n,r,i){return ue(this,void 0,void 0,function*(){if(!this.options){ie.warn("attempted to reconnect without signal options being set, ignoring");return}return this.isReconnecting=!0,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,n,r,i){this.connectOptions=r,e=ESe(e),e=e.replace(/\/$/,""),e+="/rtc";const o=kSe(),s=NSe(n,o,r);return new Promise((a,u)=>ue(this,void 0,void 0,function*(){const c=()=>ue(this,void 0,void 0,function*(){this.close(),clearTimeout(l),u(new Bn("room connection has been cancelled (signal)"))}),l=setTimeout(()=>{this.close(),u(new Bn("room connection has timed out (signal)"))},r.websocketTimeout);i!=null&&i.aborted&&c(),i==null||i.addEventListener("abort",c),ie.debug("connecting to ".concat(e+s)),this.ws&&(yield this.close()),this.ws=new WebSocket(e+s),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(l)},this.ws.onerror=d=>ue(this,void 0,void 0,function*(){if(!this.isConnected){clearTimeout(l);try{const f=yield fetch("http".concat(e.substring(2),"/validate").concat(s));if(f.status.toFixed(0).startsWith("4")){const h=yield f.text();u(new Bn(h,0,f.status))}else u(new Bn("Internal error",2,f.status))}catch{u(new Bn("server was not reachable",1))}return}this.handleWSError(d)}),this.ws.onmessage=d=>ue(this,void 0,void 0,function*(){var f,h,p,m;let v;if(typeof d.data=="string"){const g=JSON.parse(d.data);v=za.fromJson(g)}else if(d.data instanceof ArrayBuffer)v=za.fromBinary(new Uint8Array(d.data));else{ie.error("could not decode websocket message: ".concat(typeof d.data));return}if(!this.isConnected){let g=!1;if(((f=v.message)===null||f===void 0?void 0:f.case)==="join"?(this.isConnected=!0,i==null||i.removeEventListener("abort",c),this.pingTimeoutDuration=v.message.value.pingTimeout,this.pingIntervalDuration=v.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(ie.debug("ping config",{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration}),this.startPingInterval()),a(v.message.value)):r.reconnect?(this.isConnected=!0,i==null||i.removeEventListener("abort",c),this.startPingInterval(),((h=v.message)===null||h===void 0?void 0:h.case)==="reconnect"?a((p=v.message)===null||p===void 0?void 0:p.value):(a(),g=!0)):r.reconnect||u(new Bn("did not receive join response, got ".concat((m=v.message)===null||m===void 0?void 0:m.case," instead"))),!g)return}this.signalLatency&&(yield Ef(this.signalLatency)),this.handleSignalResponse(v)}),this.ws.onclose=d=>{ie.warn("websocket closed",{ev:d}),this.handleOnClose(d.reason)}}))}close(){return ue(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();try{if(this.isConnected=!1,this.ws){this.ws.onmessage=null,this.ws.onopen=null,this.ws.onclose=null;const n=new Promise(r=>{this.ws?this.ws.onclose=()=>{r()}:r()});this.ws.readyState<this.ws.CLOSING&&(this.ws.close(),yield Promise.race([n,Ef(250)])),this.ws=void 0}}finally{this.clearPingInterval(),e()}})}sendOffer(e){ie.debug("sending offer",e),this.sendRequest({case:"offer",value:jw(e)})}sendAnswer(e){return ie.debug("sending answer"),this.sendRequest({case:"answer",value:jw(e)})}sendIceCandidate(e,n){return ie.trace("sending ice candidate",e),this.sendRequest({case:"trickle",value:new Ys({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Qs({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return this.sendRequest({case:"updateMetadata",value:new Ga({metadata:e,name:n})})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new ja({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Ka({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:_t.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ya({timestamp:_t.parse(Date.now()),rtt:_t.parse(this.rtt)})})])}sendLeave(){return this.sendRequest({case:"leave",value:new ms({canReconnect:!1,reason:Tc.CLIENT_INITIATED})})}sendRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return ue(this,void 0,void 0,function*(){if(!n&&!RSe(e)&&this.isReconnecting){this.queuedRequests.push(()=>ue(this,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));return}if(n||(yield this.requestQueue.flush()),this.signalLatency&&(yield Ef(this.signalLatency)),!this.ws||this.ws.readyState!==this.ws.OPEN){ie.error("cannot send signal request before connected, type: ".concat(e==null?void 0:e.case));return}const i=new nc({message:e});try{this.useJSON?this.ws.send(i.toJsonString()):this.ws.send(i.toBinary())}catch(o){ie.error("error sending signal message",{error:o})}})}handleSignalResponse(e){var n,r;const i=e.message;if(i==null){ie.debug("received unsupported message");return}if(i.case==="answer"){const o=ZB(i.value);this.onAnswer&&this.onAnswer(o)}else if(i.case==="offer"){const o=ZB(i.value);this.onOffer&&this.onOffer(o)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=i.value.participants)!==null&&n!==void 0?n:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"?this.resetPingTimeout():i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout()):ie.debug("unsupported message",i)}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}this.isReconnecting=!1}handleOnClose(e){return ue(this,void 0,void 0,function*(){if(!this.isConnected)return;const n=this.onClose;yield this.close(),ie.debug("websocket connection closed: ".concat(e)),n&&n(e)})}handleWSError(e){ie.error("websocket error",e)}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){ie.warn("ping timeout duration not set");return}this.pingTimeout=ui.setTimeout(()=>{ie.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString())),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&ui.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){ie.warn("ping interval duration not set");return}ie.debug("start ping interval"),this.pingInterval=ui.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){ie.debug("clearing ping interval"),this.clearPingTimeout(),this.pingInterval&&ui.clearInterval(this.pingInterval)}}function ZB(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function jw(t){return new Ai({sdp:t.sdp,type:t.type})}function NSe(t,e,n){var r;const i=new URLSearchParams;return i.set("access_token",t),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",zf()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),n.publishOnly!==void 0&&i.set("publish",n.publishOnly),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),"?".concat(i.toString())}const PSe=10,b1="lk_e2ee",ASe="LKFrameEncryptionKey",$Se={sharedKey:!1,ratchetSalt:ASe,ratchetWindowSize:8,failureTolerance:PSe};var ed;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(ed||(ed={}));var eU;(function(t){t.KeyRatcheted="keyRatcheted"})(eU||(eU={}));var Ol;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Ol||(Ol={}));var tU;(function(t){t.Error="cryptorError"})(tU||(tU={}));function DSe(){return OSe()||wI()}function wI(){return typeof window.RTCRtpScriptTransform<"u"}function OSe(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function FSe(t){const e=t.split("/")[1].toLowerCase();if(!Sq.includes(e))throw Error("Video codec not supported: ".concat(e));return e}class j9e extends yu.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r)=>{ie.debug("key ratcheted event received",{material:n,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},$Se),e),this.on(ed.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const i={key:e,participantIdentity:n,keyIndex:r};this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),i),this.emit(ed.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(ed.RatchetRequest,e,n)}}function MP(t,e,n){var r,i,o;e===void 0&&(e=50),n===void 0&&(n={});var s=(r=n.isImmediate)!=null&&r,a=(i=n.callback)!=null&&i,u=n.maxWait,c=Date.now(),l=[];function d(){if(u!==void 0){var h=Date.now()-c;if(h+e>=u)return u-h}return e}var f=function(){var h=[].slice.call(arguments),p=this;return new Promise(function(m,v){var g=s&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,c=Date.now(),!s){var b=t.apply(p,h);a&&a(b),l.forEach(function(x){return(0,x.resolve)(b)}),l=[]}},d()),g){var y=t.apply(p,h);return a&&a(y),m(y)}l.push({resolve:m,reject:v})})};return f.cancel=function(h){o!==void 0&&clearTimeout(o),l.forEach(function(p){return(0,p.reject)(h)}),l=[]},f}const nU="default";class Ei{static getInstance(){return this.instance===void 0&&(this.instance=new Ei),this.instance}getDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var r;return ue(this,void 0,void 0,function*(){if(((r=Ei.userMediaPromiseMap)===null||r===void 0?void 0:r.size)>0){ie.debug("awaiting getUserMedia promise");try{e?yield Ei.userMediaPromiseMap.get(e):yield Promise.all(Ei.userMediaPromiseMap.values())}catch{ie.warn("error waiting for media permissons")}}let i=yield navigator.mediaDevices.enumerateDevices();if(n&&!(WC()&&this.hasDeviceInUse(e))&&(i.length===0||i.some(s=>{const a=s.label==="",u=e?s.kind===e:!0;return a&&u}))){const s={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"},a=yield navigator.mediaDevices.getUserMedia(s);i=yield navigator.mediaDevices.enumerateDevices(),a.getTracks().forEach(u=>{u.stop()})}return e&&(i=i.filter(o=>o.kind===e)),i})}normalizeDeviceId(e,n,r){return ue(this,void 0,void 0,function*(){if(n!==nU)return n;const o=(yield this.getDevices(e)).find(s=>s.groupId===r&&s.deviceId!==nU);return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ei.userMediaPromiseMap.has(e):Ei.userMediaPromiseMap.size>0}}Ei.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ei.userMediaPromiseMap=new Map;const LSe=1e3;class By extends Ee{get constraints(){return this._constraints}constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;super(e,n),this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>ie.debug("track mute bounce got cancelled by an unmute event")),this.debouncedTrackMuteHandler=MP(()=>ue(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>ue(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Ue.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new Ec,this.pauseUpstreamLock=new Ec,this.processorLock=new Ec,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Ee.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}setMediaStreamTrack(e,n){return ue(this,void 0,void 0,function*(){if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(i=>{Yp(this._mediaStreamTrack,i)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop()),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e&&this.processorElement){if(ie.debug("restarting processor"),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");Ap(e,this.processorElement),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&(yield this.sender.replaceTrack(r??e)),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(i=>{Ap(r??e,i)}))})}waitForDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:LSe;return ue(this,void 0,void 0,function*(){if(this.kind===Ee.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");const n=Date.now();for(;Date.now()-n<e;){const r=this.dimensions;if(r)return r;yield Ef(50)}throw new Na("unable to get track dimensions after timeout")})}getDeviceId(){return ue(this,void 0,void 0,function*(){if(this.source===Ee.Source.ScreenShare)return;const{deviceId:e,groupId:n}=this._mediaStreamTrack.getSettings(),r=this.kind===Ee.Kind.Audio?"audioinput":"videoinput";return Ei.getInstance().normalizeDeviceId(r,e,n)})}mute(){return ue(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return ue(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return ue(this,void 0,void 0,function*(){if(!this.sender)throw new Na("unable to replace an unpublished track");return ie.debug("replace MediaStreamTrack"),yield this.setMediaStreamTrack(e),this.providedByUser=n,this.processor&&(yield this.stopProcessor()),this})}restart(e){return ue(this,void 0,void 0,function*(){e||(e=this._constraints),ie.debug("restarting track with constraints",e);const n={audio:!1,video:!1};this.kind===Ee.Kind.Video?n.video=e:n.audio=e,this.attachedElements.forEach(o=>{Yp(this.mediaStreamTrack,o)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const i=(yield navigator.mediaDevices.getUserMedia(n)).getTracks()[0];return i.addEventListener("ended",this.handleEnded),ie.debug("re-acquired MediaStreamTrack"),yield this.setMediaStreamTrack(i),this._constraints=e,this.emit(Ue.Restarted,this),this})}setTrackMuted(e){ie.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted")),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ue.Muted:Ue.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ue(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Tq()&&(ie.debug("visibility changed, is in Background: ".concat(this.isInBackground)),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(ie.debug("track needs to be reacquired, restarting ".concat(this.source)),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return ue(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){ie.warn("unable to pause upstream for an unpublished track");return}this._isUpstreamPaused=!0,this.emit(Ue.UpstreamPaused,this);const n=eg();if((n==null?void 0:n.name)==="Safari"&&Iq(n.version,"12.0")<0)throw new OP("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}})}resumeUpstream(){return ue(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){ie.warn("unable to resume upstream for an unpublished track");return}this._isUpstreamPaused=!1,this.emit(Ue.UpstreamResumed,this),yield this.sender.replaceTrack(this._mediaStreamTrack)}finally{e()}})}setProcessor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var r,i;return ue(this,void 0,void 0,function*(){const o=yield this.processorLock.lock();try{if(ie.debug("setting up processor"),this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement=(r=this.processorElement)!==null&&r!==void 0?r:document.createElement(this.kind),this.processorElement.muted=!0,Ap(this._mediaStreamTrack,this.processorElement),this.processorElement.play().catch(a=>ie.error("failed to play processor element",{error:a}));const s={kind:this.kind,track:this._mediaStreamTrack,element:this.processorElement};if(yield e.init(s),this.processor=e,this.processor.processedTrack){for(const a of this.attachedElements)a!==this.processorElement&&n&&(Yp(this._mediaStreamTrack,a),Ap(this.processor.processedTrack,a));yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack)}}finally{o()}})}getProcessor(){return this.processor}stopProcessor(){var e,n;return ue(this,void 0,void 0,function*(){this.processor&&(ie.debug("stopping processor"),(e=this.processor.processedTrack)===null||e===void 0||e.stop(),yield this.processor.destroy(),this.processor=void 0,(n=this.processorElement)===null||n===void 0||n.remove(),this.processorElement=void 0,yield this.restart())})}}class MSe extends yu.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var r,i;const{kind:o,data:s}=n.data;switch(o){case"error":ie.error(s.error.message),this.emit(Ol.EncryptionError,s.error);break;case"initAck":s.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(this.encryptionEnabled!==s.enabled&&s.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Ol.ParticipantEncryptionStatusChanged,s.enabled,this.room.localParticipant),this.encryptionEnabled=s.enabled;else if(s.participantIdentity){const a=(i=this.room)===null||i===void 0?void 0:i.getParticipantByIdentity(s.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(s.participantIdentity));this.emit(Ol.ParticipantEncryptionStatusChanged,s.enabled,a)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"ratchetKey":this.keyProvider.emit(ed.KeyRatcheted,s.material,s.keyIndex);break}},this.onWorkerError=n=>{ie.error("e2ee worker encountered an error:",{error:n.error}),this.emit(Ol.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!DSe())throw new OP("tried to setup end-to-end encryption on an unsupported browser");if(ie.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(ie.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ie.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ie.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(Ze.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(De.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==Ni.NONE,i.identity)),e.on(De.ConnectionStateChanged,r=>{r===nn.Connected&&e.participants.forEach(i=>{i.tracks.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==Ni.NONE,i.identity)})})}).on(De.TrackUnsubscribed,(r,i,o)=>{var s;const a={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:r.mediaStreamID}};(s=this.worker)===null||s===void 0||s.postMessage(a)}).on(De.TrackSubscribed,(r,i,o)=>{this.setupE2EEReceiver(r,o.identity,i.trackInfo)}).on(De.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),n.getKeys().forEach(r=>{this.postKey(r)})}),e.localParticipant.on(Qe.LocalTrackPublished,r=>ue(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),n.on(ed.SetKey,r=>this.postKey(r)).on(ed.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:i}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const s={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:i}};this.worker.postMessage(s)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?FSe(r.mimeType):void 0)}}setupE2EESender(e,n){if(!(e instanceof By)||!n){n||ie.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,i){return ue(this,void 0,void 0,function*(){if(this.worker){if(wI()){const o={kind:"decode",participantIdentity:r,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(b1 in e&&i){const u={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(u);return}let o=e.writableStream,s=e.readableStream;if(!o||!s){const u=e.createEncodedStreams();e.writableStream=u.writable,o=u.writable,e.readableStream=u.readable,s=u.readable}const a={kind:"decode",data:{readableStream:s,writableStream:o,trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(a,[s,o])}e[b1]=!0}})}handleSender(e,n,r){var i;if(!(b1 in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(wI()){ie.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{ie.info("initialize encoded streams");const o=e.createEncodedStreams(),s={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(s,[o.readable,o.writable])}e[b1]=!0}}}var Nq={},Pq={exports:{}},rU=Pq.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var e="candidate:%s %d %s %d %s %d typ %s";return e+=t.raddr!=null?" raddr %s rport %d":"%v%v",e+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(e+=" generation %d"),e+=t["network-id"]!=null?" network-id %d":"%v",e+=t["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var e="ssrc:%d";return t.attribute!=null&&(e+=" %s",t.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var e="mediaclk:";return e+=t.id!=null?"id=%s %s":"%v%s",e+=t.mediaClockValue!=null?"=%s":"",e+=t.rateNumerator!=null?" rate=%s":"",e+=t.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(rU).forEach(function(t){var e=rU[t];e.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var Aq=Pq.exports;(function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,u,c,l){if(l&&!c)u[l]=e(a[1]);else for(var d=0;d<c.length;d+=1)a[d+1]!=null&&(u[c[d]]=e(a[d+1]))},r=function(a,u,c){var l=a.name&&a.names;a.push&&!u[a.push]?u[a.push]=[]:l&&!u[a.name]&&(u[a.name]={});var d=a.push?{}:l?u[a.name]:u;n(c.match(a.reg),d,a.names,a.name),a.push&&u[a.push].push(d)},i=Aq,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var u={},c=[],l=u;return a.split(/(\r\n|\r|\n)/).filter(o).forEach(function(d){var f=d[0],h=d.slice(2);f==="m"&&(c.push({rtp:[],fmtp:[]}),l=c[c.length-1]);for(var p=0;p<(i[f]||[]).length;p+=1){var m=i[f][p];if(m.reg.test(h))return r(m,l,h)}}),u.media=c,u};var s=function(a,u){var c=u.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&u.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var u=[],c=a.split(" ").map(e),l=0;l<c.length;l+=3)u.push({component:c[l],ip:c[l+1],port:c[l+2]});return u},t.parseImageAttributes=function(a){return a.split(" ").map(function(u){return u.substring(1,u.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(u){return u.split(",").map(function(c){var l,d=!1;return c[0]!=="~"?l=e(c):(l=e(c.substring(1,c.length)),d=!0),{scid:l,paused:d}})})}})(Nq);var xT=Aq,BSe=/%[sdv%]/g,USe=function(t){var e=1,n=arguments,r=n.length;return t.replace(BSe,function(i){if(e>=r)return i;var o=n[e];switch(e+=1,i){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},Qg=function(t,e,n){var r=e.format instanceof Function?e.format(e.push?n:n[e.name]):e.format,i=[t+"="+r];if(e.names)for(var o=0;o<e.names.length;o+=1){var s=e.names[o];e.name?i.push(n[e.name][s]):i.push(n[e.names[o]])}else i.push(n[e.name]);return USe.apply(null,i)},VSe=["v","o","s","i","u","e","p","c","b","t","r","z","a"],zSe=["i","c","b","a"],WSe=function(t,e){e=e||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(o){o.payloads==null&&(o.payloads="")});var n=e.outerOrder||VSe,r=e.innerOrder||zSe,i=[];return n.forEach(function(o){xT[o].forEach(function(s){s.name in t&&t[s.name]!=null?i.push(Qg(o,s,t)):s.push in t&&t[s.push]!=null&&t[s.push].forEach(function(a){i.push(Qg(o,s,a))})})}),t.media.forEach(function(o){i.push(Qg("m",xT.m[0],o)),r.forEach(function(s){xT[s].forEach(function(a){a.name in o&&o[a.name]!=null?i.push(Qg(s,a,o)):a.push in o&&o[a.push]!=null&&o[a.push].forEach(function(u){i.push(Qg(s,a,u))})})})}),i.join(`\r
`)+`\r
`},jSe=Nq,GSe=WSe,wT=GSe,bv=jSe.parse;const iU=.7,Qp={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class oU extends yu.EventEmitter{get pc(){if(this._pc)return this._pc;throw new Jr("Expected peer connection to be available")}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=MP(r=>{this.emit(Qp.NegotiationStarted);try{this.createAndSendOffer()}catch(i){if(r)r(i);else throw i}},100),this._pc=wSe()?new RTCPeerConnection(e,n):new RTCPeerConnection(e)}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return ue(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){var n;return ue(this,void 0,void 0,function*(){let r;if(e.type==="offer"){let{stereoMids:i,nackMids:o}=qSe(e);this.remoteStereoMids=i,this.remoteNackMids=o}else if(e.type==="answer"){const i=bv((n=e.sdp)!==null&&n!==void 0?n:"");i.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(s=>{if(!s.transceiver||o.mid!=s.transceiver.mid)return!1;let a=0;if(o.rtp.some(c=>c.codec.toUpperCase()===s.codec.toUpperCase()?(a=c.payload,!0):!1),a===0)return!0;let u=!1;for(const c of o.fmtp)if(c.payload===a){c.config=c.config.split(";").filter(l=>!l.includes("maxaveragebitrate")).join(";"),s.maxbr>0&&(c.config+=";maxaveragebitrate=".concat(s.maxbr*1e3)),u=!0;break}return u||s.maxbr>0&&o.fmtp.push({payload:a,config:"maxaveragebitrate=".concat(s.maxbr*1e3)}),!0})}),r=wT(i)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(i=>{this.pc.addIceCandidate(i)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,this.createAndSendOffer()):e.type==="answer"&&(this.emit(Qp.NegotiationComplete),e.sdp&&bv(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Qp.RTPVideoPayloadTypes,o.rtp)}))})}createAndSendOffer(e){var n;return ue(this,void 0,void 0,function*(){if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(ie.debug("restarting ICE"),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const o=this.pc.remoteDescription;if(e!=null&&e.iceRestart&&o)yield this.pc.setRemoteDescription(o);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){ie.warn("could not createOffer with closed peer connection");return}ie.debug("starting to negotiate");const r=yield this.pc.createOffer(e),i=bv((n=r.sdp)!==null&&n!==void 0?n:"");i.media.forEach(o=>{o.type==="audio"?sU(o,[],[]):o.type==="video"&&(HSe(o),this.trackBitrates.some(s=>{if(!o.msid||!s.cid||!o.msid.includes(s.cid))return!1;let a=0;if(o.rtp.some(c=>c.codec.toUpperCase()===s.codec.toUpperCase()?(a=c.payload,!0):!1),a===0)return!0;let u=!1;for(const c of o.fmtp)if(c.payload===a){c.config.includes("x-google-start-bitrate")||(c.config+=";x-google-start-bitrate=".concat(s.maxbr*iU)),c.config.includes("x-google-max-bitrate")||(c.config+=";x-google-max-bitrate=".concat(s.maxbr)),u=!0;break}return u||o.fmtp.push({payload:a,config:"x-google-start-bitrate=".concat(s.maxbr*iU,";x-google-max-bitrate=").concat(s.maxbr)}),!0}))}),yield this.setMungedSDP(r,wT(i)),this.onOffer(r)})}createAndSetAnswer(){var e;return ue(this,void 0,void 0,function*(){const n=yield this.pc.createAnswer(),r=bv((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{i.type==="audio"&&sU(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,wT(r)),n})}setTrackCodecBitrate(e){this.trackBitrates.push(e)}close(){this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)}setMungedSDP(e,n,r){return ue(this,void 0,void 0,function*(){if(n){const i=e.sdp;e.sdp=n;try{ie.debug("setting munged ".concat(r?"remote":"local"," description")),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){ie.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),{error:o,sdp:n}),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let o="unknown error";i instanceof Error?o=i.message:typeof i=="string"&&(o=i);const s={error:o,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(s.remoteSdp=this.pc.remoteDescription),ie.error("unable to set ".concat(e.type),s),new gI(o)}})}}function sU(t,e,n){let r=0;t.rtp.some(i=>i.codec==="opus"?(r=i.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(i=>i.payload===r&&i.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(i=>i.payload===r?(i.config.includes("stereo=1")||(i.config+=";stereo=1"),!0):!1))}function HSe(t){var e,n,r,i;const o=(n=(e=t.rtp[0])===null||e===void 0?void 0:e.codec)===null||n===void 0?void 0:n.toLowerCase();if(!Kv(o))return;let s=0;((r=t.ext)===null||r===void 0?void 0:r.some(u=>u.uri===GB?!0:(u.value>s&&(s=u.value),!1)))||(i=t.ext)===null||i===void 0||i.push({value:s+1,uri:GB})}function qSe(t){var e;const n=[],r=[],i=bv((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return i.media.forEach(s=>{var a;s.type==="audio"&&(s.rtp.some(u=>u.codec==="opus"?(o=u.payload,!0):!1),!((a=s.rtcpFb)===null||a===void 0)&&a.some(u=>u.payload===o&&u.type==="nack")&&r.push(s.mid),s.fmtp.some(u=>u.payload===o?(u.config.includes("sprop-stereo=1")&&n.push(s.mid),!0):!1))}),{stereoMids:n,nackMids:r}}const KSe={audioBitrate:Ww.music.maxBitrate,audioPreset:Ww.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:FP.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",backupCodec:!1},$q={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},Dq={resolution:Ly.h720.resolution},XSe={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new zwe,disconnectOnPageLeave:!0,expWebAudioMix:!1},Oq={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3},aU="_lossy",uU="_reliable",JSe=2*1e3,cU="leave-reconnect";var So;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(So||(So={}));class YSe extends yu.EventEmitter{get isClosed(){return this._isClosed}constructor(e){super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Oq.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=So.New,this._isClosed=!0,this.pendingTrackResolvers={},this.hasPublished=!1,this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.handleDataChannel=n=>{let{channel:r}=n;return ue(this,void 0,void 0,function*(){if(r){if(r.label===uU)this.reliableDCSub=r;else if(r.label===aU)this.lossyDCSub=r;else return;ie.debug("on data channel ".concat(r.id,", ").concat(r.label)),r.onmessage=this.handleDataMessage}})},this.handleDataMessage=n=>ue(this,void 0,void 0,function*(){var r,i;const o=yield this.dataProcessLock.lock();try{let s;if(n.data instanceof ArrayBuffer)s=n.data;else if(n.data instanceof Blob)s=yield n.data.arrayBuffer();else{ie.error("unsupported data type",n.data);return}const a=Fa.fromBinary(new Uint8Array(s));((r=a.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(Ze.ActiveSpeakersUpdate,a.value.value.speakers):((i=a.value)===null||i===void 0?void 0:i.case)==="user"&&this.emit(Ze.DataPacketReceived,a.value.value,a.kind)}finally{o()}}),this.handleDataError=n=>{const i=n.currentTarget.maxRetransmits===0?"lossy":"reliable";if(n instanceof ErrorEvent&&n.error){const{error:o}=n.error;ie.error("DataChannel error on ".concat(i,": ").concat(n.message),o)}else ie.error("Unknown DataChannel error on ".concat(i),n)},this.handleBufferedAmountLow=n=>{const i=n.currentTarget.maxRetransmits===0?Fr.LOSSY:Fr.RELIABLE;this.updateAndEmitDCBufferStatus(i)},this.handleDisconnect=(n,r)=>{if(this._isClosed)return;ie.warn("".concat(n," disconnected")),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const i=a=>{ie.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(a,"ms. giving up")),this.emit(Ze.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let s=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(s===null){i(o);return}n===cU&&(s=0),ie.debug("reconnecting in ".concat(s,"ms")),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=ui.setTimeout(()=>this.attemptReconnect(r),s)},this.waitForRestarted=()=>new Promise((n,r)=>{this.pcState===So.Connected&&n();const i=()=>{this.off(Ze.Disconnected,o),n()},o=()=>{this.off(Ze.Restarted,i),r()};this.once(Ze.Restarted,i),this.once(Ze.Disconnected,o)}),this.updateAndEmitDCBufferStatus=n=>{const r=this.isBufferStatusLow(n);typeof r<"u"&&r!==this.dcBufferStatus.get(n)&&(this.dcBufferStatus.set(n,r),this.emit(Ze.DCBufferStatusChanged,r,n))},this.isBufferStatusLow=n=>{const r=this.dataChannelForKind(n);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.isReconnecting&&(this.clearReconnectTimeout(),this.attemptReconnect(rs.RR_SIGNAL_DISCONNECTED))},this.client=new LP,this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ec,this.dataProcessLock=new Ec,this.dcBufferStatus=new Map([[Fr.LOSSY,!0],[Fr.RELIABLE,!0]]),this.client.onParticipantUpdate=n=>this.emit(Ze.ParticipantUpdate,n),this.client.onConnectionQuality=n=>this.emit(Ze.ConnectionQualityUpdate,n),this.client.onRoomUpdate=n=>this.emit(Ze.RoomUpdate,n),this.client.onSubscriptionError=n=>this.emit(Ze.SubscriptionError,n),this.client.onSubscriptionPermissionUpdate=n=>this.emit(Ze.SubscriptionPermissionUpdate,n),this.client.onSpeakersChanged=n=>this.emit(Ze.SpeakersChanged,n),this.client.onStreamStateUpdate=n=>this.emit(Ze.StreamStateChanged,n)}join(e,n,r,i){return ue(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,r,i);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.publisher||this.configure(o),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=o.clientConfiguration,o}catch(o){if(o instanceof Bn&&o.reason===1&&(ie.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts)),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,i);throw o}})}close(){return ue(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.emit(Ze.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return ue(this,void 0,void 0,function*(){this.publisher&&this.publisher.pc.signalingState!=="closed"&&this.publisher.pc.getSenders().forEach(n=>{var r,i;try{!((r=this.publisher)===null||r===void 0)&&r.pc.removeTrack&&((i=this.publisher)===null||i===void 0||i.pc.removeTrack(n))}catch(o){ie.warn("could not removeTrack",{error:o})}}),this.publisher&&(this.publisher.close(),this.publisher=void 0),this.subscriber&&(this.subscriber.close(),this.subscriber=void 0),this.primaryPC=void 0;const e=n=>{n&&(n.close(),n.onbufferedamountlow=null,n.onclose=null,n.onclosing=null,n.onerror=null,n.onmessage=null,n.onopen=null)};e(this.lossyDC),e(this.lossyDCSub),e(this.reliableDC),e(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return ue(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Na("a track with the same ID has already been published");return new Promise((n,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new Bn("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(i),n(o)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){var n;if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:r}=this.pendingTrackResolvers[e.track.id];r&&r(),delete this.pendingTrackResolvers[e.track.id]}try{return(n=this.publisher)===null||n===void 0||n.pc.removeTrack(e),!0}catch(r){ie.warn("failed to remove track",{error:r,method:"removeTrack"})}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return ue(this,void 0,void 0,function*(){if(this.primaryPC!==void 0)return QSe(this.primaryPC)})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){var n,r;if(this.publisher||this.subscriber)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(e);!((r=this.signalOpts)===null||r===void 0)&&r.e2eeEnabled&&(ie.debug("E2EE - setting up transports with insertable streams"),i.encodedInsertableStreams=!0);const o={optional:[{googDscp:!0}]};this.publisher=new oU(i,o),this.subscriber=new oU(i),this.emit(Ze.TransportsCreated,this.publisher,this.subscriber),this.publisher.pc.onicecandidate=c=>{c.candidate&&(ie.trace("adding ICE candidate for peer",c.candidate),this.client.sendIceCandidate(c.candidate,to.PUBLISHER))},this.subscriber.pc.onicecandidate=c=>{c.candidate&&this.client.sendIceCandidate(c.candidate,to.SUBSCRIBER)},this.publisher.onOffer=c=>{this.client.sendOffer(c)};let s=this.publisher.pc,a=this.subscriber.pc,u=e.subscriberPrimary;u&&(s=this.subscriber.pc,a=this.publisher.pc,this.subscriber.pc.ondatachannel=this.handleDataChannel),this.primaryPC=s,s.onconnectionstatechange=()=>ue(this,void 0,void 0,function*(){if(ie.debug("primary PC state changed ".concat(s.connectionState)),s.connectionState==="connected"){const c=this.pcState===So.New;this.pcState=So.Connected,c&&this.emit(Ze.Connected,e)}else s.connectionState==="failed"&&this.pcState===So.Connected&&(this.pcState=So.Disconnected,this.handleDisconnect("primary peerconnection",u?rs.RR_SUBSCRIBER_FAILED:rs.RR_PUBLISHER_FAILED))}),a.onconnectionstatechange=()=>ue(this,void 0,void 0,function*(){ie.debug("secondary PC state changed ".concat(a.connectionState)),a.connectionState==="failed"&&this.handleDisconnect("secondary peerconnection",u?rs.RR_PUBLISHER_FAILED:rs.RR_SUBSCRIBER_FAILED)}),this.subscriber.pc.ontrack=c=>{this.emit(Ze.MediaTrackAdded,c.track,c.streams[0],c.receiver)},this.createDataChannels()}setupSignalClientCallbacks(){this.client.onAnswer=e=>ue(this,void 0,void 0,function*(){this.publisher&&(ie.debug("received server answer",{RTCSdpType:e.type,signalingState:this.publisher.pc.signalingState.toString()}),yield this.publisher.setRemoteDescription(e))}),this.client.onTrickle=(e,n)=>{!this.publisher||!this.subscriber||(ie.trace("got ICE candidate from peer",{candidate:e,target:n}),n===to.PUBLISHER?this.publisher.addIceCandidate(e):this.subscriber.addIceCandidate(e))},this.client.onOffer=e=>ue(this,void 0,void 0,function*(){if(!this.subscriber)return;ie.debug("received server offer",{RTCSdpType:e.type,signalingState:this.subscriber.pc.signalingState.toString()}),yield this.subscriber.setRemoteDescription(e);const n=yield this.subscriber.createAndSetAnswer();this.client.sendAnswer(n)}),this.client.onLocalTrackPublished=e=>{if(ie.debug("received trackPublishedResponse",e),!this.pendingTrackResolvers[e.cid]){ie.error("missing track resolver for ".concat(e.cid));return}const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onClose=()=>{this.handleDisconnect("signal",rs.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{e!=null&&e.canReconnect?(this.fullReconnectOnNext=!0,this.primaryPC=void 0,this.handleDisconnect(cU)):(this.emit(Ze.Disconnected,e==null?void 0:e.reason),this.close()),ie.trace("leave request",{leave:e})}}makeRTCConfiguration(e){const n=Object.assign({},this.rtcConfig);if(e.iceServers&&!n.iceServers){const r=[];e.iceServers.forEach(i=>{const o={urls:i.urls};i.username&&(o.username=i.username),i.credential&&(o.credential=i.credential),r.push(o)}),n.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ca.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.publisher&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.publisher.pc.createDataChannel(aU,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.publisher.pc.createDataChannel(uU,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}setPreferredCodec(e,n,r){if(!("getCapabilities"in RTCRtpSender))return;const i=RTCRtpSender.getCapabilities(n);if(!i)return;ie.debug("get capabilities",i);const o=[],s=[],a=[];i.codecs.forEach(u=>{const c=u.mimeType.toLowerCase();if(c==="audio/opus"){o.push(u);return}if(!(c==="video/".concat(r))){a.push(u);return}if(r==="h264"){u.sdpFmtpLine&&u.sdpFmtpLine.includes("profile-level-id=42e01f")?o.push(u):s.push(u);return}o.push(u)}),xSe(e)&&e.setCodecPreferences(o.concat(s,a))}createSender(e,n,r){return ue(this,void 0,void 0,function*(){if(HB())return yield this.createTransceiverRTCRtpSender(e,n,r);if(qB())return ie.warn("using add-track fallback"),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Jr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,i){return ue(this,void 0,void 0,function*(){if(HB())return this.createSimulcastTransceiverSender(e,n,r,i);if(qB())return ie.debug("using add-track fallback"),this.createRTCRtpSender(e.mediaStreamTrack);throw new Jr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return ue(this,void 0,void 0,function*(){if(!this.publisher)throw new Jr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream);const o={direction:"sendonly",streams:i};r&&(o.sendEncodings=r);const s=yield this.publisher.pc.addTransceiver(e.mediaStreamTrack,o);return e.kind===Ee.Kind.Video&&n.videoCodec&&(this.setPreferredCodec(s,e.kind,n.videoCodec),e.codec=n.videoCodec),s.sender})}createSimulcastTransceiverSender(e,n,r,i){return ue(this,void 0,void 0,function*(){if(!this.publisher)throw new Jr("publisher is closed");const o={direction:"sendonly"};i&&(o.sendEncodings=i);const s=yield this.publisher.pc.addTransceiver(n.mediaStreamTrack,o);if(r.videoCodec)return this.setPreferredCodec(s,e.kind,r.videoCodec),e.setSimulcastTrackSender(r.videoCodec,s.sender),s.sender})}createRTCRtpSender(e){return ue(this,void 0,void 0,function*(){if(!this.publisher)throw new Jr("publisher is closed");return this.publisher.pc.addTrack(e)})}attemptReconnect(e){var n,r,i;return ue(this,void 0,void 0,function*(){if(!this._isClosed&&!this.attemptingReconnect){(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===ca.DISABLED||((i=(r=this.primaryPC)===null||r===void 0?void 0:r.signalingState)!==null&&i!==void 0?i:"closed")==="closed")&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let s=!0;o instanceof Jr?(ie.debug("received unrecoverable error",{error:o}),s=!1):o instanceof x1||(this.fullReconnectOnNext=!0),s?this.handleDisconnect("reconnect",rs.RR_UNKNOWN):(ie.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up")),this.emit(Ze.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){ie.warn("encountered error in reconnect policy",{error:n})}return null}restartConnection(e){var n,r,i;return ue(this,void 0,void 0,function*(){try{if(!this.url||!this.token)throw new Jr("could not reconnect, url or token not saved");ie.info("reconnecting, attempt: ".concat(this.reconnectAttempts)),this.emit(Ze.Restarting),this.client.isConnected&&(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw ie.warn("attempted connection restart, without signal options present"),new x1;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(s){throw s instanceof Bn&&s.reason===0?new Jr("could not reconnect, token might be expired"):new x1}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");this.client.setReconnected(),this.emit(Ze.SignalRestarted,o),yield this.waitForPCReconnected(),(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(Ze.Restarted)}catch(o){const s=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(s){yield this.restartConnection(s);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),o}})}resumeConnection(e){var n;return ue(this,void 0,void 0,function*(){if(!this.url||!this.token)throw new Jr("could not reconnect, url or token not saved");if(!this.publisher||!this.subscriber)throw new Jr("publisher and subscriber connections unset");ie.info("resuming signal connection, attempt ".concat(this.reconnectAttempts)),this.emit(Ze.Resuming);try{this.setupSignalClientCallbacks();const r=yield this.client.reconnect(this.url,this.token,this.participantSid,e);if(r){const i=this.makeRTCConfiguration(r);this.publisher.pc.setConfiguration(i),this.subscriber.pc.setConfiguration(i)}}catch(r){let i="";throw r instanceof Error&&(i=r.message),r instanceof Bn&&r.reason===0?new Jr("could not reconnect, token might be expired"):new x1(i)}if(this.emit(Ze.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");this.subscriber.restartingIce=!0,this.hasPublished&&(yield this.publisher.createAndSendOffer({iceRestart:!0})),yield this.waitForPCReconnected(),this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(Ze.Resumed)})}waitForPCInitialConnection(e,n){return ue(this,void 0,void 0,function*(){if(this.pcState!==So.Connected){if(this.pcState!==So.New)throw new Jr("Expected peer connection to be new on initial connection");return new Promise((r,i)=>{const o=()=>{ie.warn("closing engine"),ui.clearTimeout(a),i(new Bn("room connection has been cancelled",3))};n!=null&&n.signal.aborted&&o(),n==null||n.signal.addEventListener("abort",o);const s=()=>{ui.clearTimeout(a),n==null||n.signal.removeEventListener("abort",o),r()},a=ui.setTimeout(()=>{this.off(Ze.Connected,s),i(new Bn("could not establish pc connection"))},e??this.peerConnectionTimeout);this.once(Ze.Connected,s)})}})}waitForPCReconnected(){var e;return ue(this,void 0,void 0,function*(){const n=Date.now();let r=n;for(this.pcState=So.Reconnecting,ie.debug("waiting for peer connection to reconnect");r-n<this.peerConnectionTimeout&&this.primaryPC!==void 0;){if(r-n>JSe&&((e=this.primaryPC)===null||e===void 0?void 0:e.connectionState)==="connected"&&(this.pcState=So.Connected),this.pcState===So.Connected)return;yield Ef(100),r=Date.now()}throw new Bn("could not establish PC connection")})}sendDataPacket(e,n){return ue(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(n);const i=this.dataChannelForKind(n);i&&i.send(r),this.updateAndEmitDCBufferStatus(n)})}ensureDataTransportConnected(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;var r,i,o;return ue(this,void 0,void 0,function*(){const s=n?this.subscriber:this.publisher,a=n?"Subscriber":"Publisher";if(!s)throw new Bn("".concat(a," connection not set"));!n&&!(!((r=this.publisher)===null||r===void 0)&&r.isICEConnected)&&((i=this.publisher)===null||i===void 0?void 0:i.pc.iceConnectionState)!=="checking"&&this.negotiate();const u=this.dataChannelForKind(e,n);if((u==null?void 0:u.readyState)==="open")return;const c=new Date().getTime()+this.peerConnectionTimeout;for(;new Date().getTime()<c;){if(s.isICEConnected&&((o=this.dataChannelForKind(e,n))===null||o===void 0?void 0:o.readyState)==="open")return;yield Ef(50)}throw new Bn("could not establish ".concat(a," connection, state: ").concat(s.pc.iceConnectionState))})}ensurePublisherConnected(e){return ue(this,void 0,void 0,function*(){yield this.ensureDataTransportConnected(e,!1)})}verifyTransport(){return!(!this.primaryPC||this.primaryPC.connectionState==="closed"||this.primaryPC.connectionState==="failed"||this.hasPublished&&this.subscriberPrimary&&(!this.publisher||this.publisher.pc.connectionState==="closed"||this.publisher.pc.connectionState==="failed")||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return new Promise((e,n)=>{if(!this.publisher){n(new gI("publisher is not defined"));return}this.hasPublished=!0;const r=()=>{ie.debug("engine disconnected while negotiation was ongoing"),o(),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(Ze.Closing,r);const i=setTimeout(()=>{n("negotiation timed out"),this.handleDisconnect("negotiation",rs.RR_SIGNAL_DISCONNECTED)},this.peerConnectionTimeout),o=()=>{clearTimeout(i),this.off(Ze.Closing,r)};this.publisher.once(Qp.NegotiationStarted,()=>{var s;(s=this.publisher)===null||s===void 0||s.once(Qp.NegotiationComplete,()=>{o(),e()})}),this.publisher.once(Qp.RTPVideoPayloadTypes,s=>{const a=new Map;s.forEach(u=>{const c=u.codec.toLowerCase();TSe(c)&&a.set(u.payload,c)}),this.emit(Ze.RTPVideoMapUpdate,a)}),this.publisher.negotiate(s=>{o(),n(s),s instanceof gI&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",rs.RR_UNKNOWN)})})}dataChannelForKind(e,n){if(n){if(e===Fr.LOSSY)return this.lossyDCSub;if(e===Fr.RELIABLE)return this.reliableDCSub}else{if(e===Fr.LOSSY)return this.lossyDC;if(e===Fr.RELIABLE)return this.reliableDC}}failNext(){this.shouldFailNext=!0}clearReconnectTimeout(){this.reconnectTimeout&&ui.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ao()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){ao()&&window.removeEventListener("online",this.handleBrowserOnLine)}}function QSe(t){var e;return ue(this,void 0,void 0,function*(){let n="";const r=new Map,i=new Map;if((yield t.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),r.set(a.id,a);break;case"remote-candidate":i.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const s=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(s!==void 0)return i.get(s)})}class x1 extends Error{}class lU{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return xI(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return ue(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(i=>i.url===r.url));if(n.length>0){const r=n[0];return this.attemptedRegions.push(r),ie.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return ue(this,void 0,void 0,function*(){const n=yield fetch("".concat(ZSe(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const r=yield n.json();return this.lastUpdateAt=Date.now(),r}else throw new Bn("Could not fetch region settings: ".concat(n.statusText),n.status===401?0:void 0,n.status)})}}function ZSe(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}const BP=2e3;function jC(t,e){if(!e)return 0;let n,r;return"bytesReceived"in t?(n=t.bytesReceived,r=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,r=e.bytesSent),n===void 0||r===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(t.timestamp-e.timestamp)}class Hi extends By{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,Ee.Kind.Audio,n,r),this.stopOnMute=!1,this.monitorSender=()=>ue(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(s){ie.error("could not get audio sender stats",{error:s});return}o&&this.prevStats&&(this._currentBitrate=jC(o,this.prevStats)),this.prevStats=o}),this.audioContext=i,this.checkForSilence()}setDeviceId(e){return ue(this,void 0,void 0,function*(){return this._constraints.deviceId===e?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||_f(e)===this.mediaStreamTrack.getSettings().deviceId)})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return ue(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.source===Ee.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(ie.debug("stopping mic track"),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return ue(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==_f(this._constraints.deviceId);return this.source===Ee.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(ie.debug("reacquiring mic track"),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return ue(this,void 0,void 0,function*(){let n;if(e){const r=zC({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return ue(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){ao()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},BP)))}setProcessor(e){var n;return ue(this,void 0,void 0,function*(){const r=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");if(this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};ie.debug("setting up audio processor ".concat(e.name)),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack))}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){var e;return ue(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return ue(this,void 0,void 0,function*(){const e=yield fSe(this);return e&&(this.isMuted||ie.warn("silence detected on local audio track"),this.emit(Ue.AudioSilenceDetected)),e})}}function Fq(t,e){switch(t.kind){case"audio":return new Hi(t,e,!1);case"video":return new Co(t,e,!1);default:throw new Na("unsupported track type: ".concat(t.kind))}}const eCe=Object.values(Ly),tCe=Object.values(vI),nCe=Object.values(FP),rCe=[Ly.h180,Ly.h360],iCe=[vI.h180,vI.h360],oCe=t=>[{scaleResolutionDownBy:2,fps:3}].map(n=>{var r;return new fn(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=t.encoding.maxFramerate)!==null&&r!==void 0?r:30)/n.fps)))),n.fps,t.encoding.priority)}),SI=["q","h","f"];function Lq(t,e,n,r){var i,o;let s=r==null?void 0:r.videoEncoding;t&&(s=r==null?void 0:r.screenShareEncoding);const a=r==null?void 0:r.simulcast,u=r==null?void 0:r.scalabilityMode,c=r==null?void 0:r.videoCodec;if(!s&&!a&&!u||!e||!n)return[{}];s||(s=sCe(t,e,n,c),ie.debug("using video encoding",s));const l=new fn(e,n,s.maxBitrate,s.maxFramerate,s.priority);if(u&&Kv(c)){ie.debug("using svc with scalabilityMode ".concat(u));const h=new Mq(u),p=[];if(h.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(u));for(let m=0;m<h.spatial;m+=1)p.push({rid:SI[2-m],maxBitrate:s.maxBitrate/Math.pow(3,m),maxFramerate:l.encoding.maxFramerate});return p[0].scalabilityMode=u,ie.debug("encodings",p),p}if(!a)return[s];let d=[];t?d=(i=hU(r==null?void 0:r.screenShareSimulcastLayers))!==null&&i!==void 0?i:fU(t,l):d=(o=hU(r==null?void 0:r.videoSimulcastLayers))!==null&&o!==void 0?o:fU(t,l);let f;if(d.length>0){const h=d[0];d.length>1&&([,f]=d);const p=Math.max(e,n);if(p>=960&&f)return ST(e,n,[h,f,l]);if(p>=480)return ST(e,n,[h,l])}return ST(e,n,[l])}function dU(t,e,n){var r,i,o,s;if(!n.backupCodec||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ie.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),u=(r=a.width)!==null&&r!==void 0?r:(i=t.dimensions)===null||i===void 0?void 0:i.width,c=(o=a.height)!==null&&o!==void 0?o:(s=t.dimensions)===null||s===void 0?void 0:s.height;return Lq(t.source===Ee.Source.ScreenShare,u,c,n)}function sCe(t,e,n,r){const i=aCe(t,e,n);let{encoding:o}=i[0];const s=Math.max(e,n);for(let a=0;a<i.length;a+=1){const u=i[a];if(o=u.encoding,u.width>=s)break}if(r)switch(r){case"av1":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function aCe(t,e,n){if(t)return nCe;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?eCe:tCe}function fU(t,e){if(t)return oCe(e);const{width:n,height:r}=e,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?rCe:iCe}function ST(t,e,n){const r=[];if(n.forEach((i,o)=>{if(o>=SI.length)return;const s=Math.min(t,e),u={rid:SI[o],scaleResolutionDownBy:Math.max(1,s/Math.min(i.width,i.height)),maxBitrate:i.encoding.maxBitrate};i.encoding.maxFramerate&&(u.maxFramerate=i.encoding.maxFramerate);const c=My()||o===0;i.encoding.priority&&c&&(u.priority=i.encoding.priority,u.networkPriority=i.encoding.priority),r.push(u)}),zf()&&_q()==="ios"){let i;r.forEach(s=>{i?s.maxFramerate&&s.maxFramerate>i&&(i=s.maxFramerate):i=s.maxFramerate});let o=!0;r.forEach(s=>{var a;s.maxFramerate!=i&&(o&&(o=!1,ie.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ie.info('Setting framerate of encoding "'.concat((a=s.rid)!==null&&a!==void 0?a:"",'" to ').concat(i)),s.maxFramerate=i)})}return r}function hU(t){if(t)return t.sort((e,n)=>{const{encoding:r}=e,{encoding:i}=n;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class Mq{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}const uCe=5e3;class Co extends By{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;super(e,Ee.Kind.Video,n,r),this.simulcastCodecs=new Map,this.monitorSender=()=>ue(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let i;try{i=yield this.getSenderStats()}catch(s){ie.error("could not get audio sender stats",{error:s});return}const o=new Map(i.map(s=>[s.rid,s]));if(this.prevStats){let s=0;o.forEach((a,u)=>{var c;const l=(c=this.prevStats)===null||c===void 0?void 0:c.get(u);s+=jC(a,l)}),this._currentBitrate=s}this.prevStats=o}),this.senderLock=new Ec}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ao())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},BP))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});var n,r,i,o,s;return ue(this,void 0,void 0,function*(){yield e.pauseUpstream.call(this);try{for(var a=!0,u=np(this.simulcastCodecs.values()),c;c=yield u.next(),n=c.done,!n;a=!0)o=c.value,a=!1,yield(s=o.sender)===null||s===void 0?void 0:s.replaceTrack(null)}catch(l){r={error:l}}finally{try{!a&&!n&&(i=u.return)&&(yield i.call(u))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});var n,r,i,o,s;return ue(this,void 0,void 0,function*(){yield e.resumeUpstream.call(this);try{for(var a=!0,u=np(this.simulcastCodecs.values()),c;c=yield u.next(),n=c.done,!n;a=!0){o=c.value,a=!1;const l=o;yield(s=l.sender)===null||s===void 0?void 0:s.replaceTrack(l.mediaStreamTrack)}}catch(l){r={error:l}}finally{try{!a&&!n&&(i=u.return)&&(yield i.call(u))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return ue(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.source===Ee.Source.Camera&&!this.isUserProvided&&(ie.debug("stopping camera track"),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return ue(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.source===Ee.Source.Camera&&!this.isUserProvided&&(ie.debug("reacquiring camera track"),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){var e;return ue(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(i=>{var o;if(i.type==="outbound-rtp"){const s={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,framesSent:i.framesSent,timestamp:i.timestamp,rid:(o=i.rid)!==null&&o!==void 0?o:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges},a=r.get(i.remoteId);a&&(s.jitter=a.jitter,s.packetsLost=a.packetsLost,s.roundTripTime=a.roundTripTime),n.push(s)}}),n})}setPublishingQuality(e){const n=[];for(let r=ur.LOW;r<=ur.HIGH;r+=1)n.push(new ea({quality:r,enabled:r<=e}));ie.debug("setting publishing quality. max quality ".concat(e)),this.setPublishingLayers(n)}setDeviceId(e){return ue(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===_f(e)?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||_f(e)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(e){var n,r,i,o;return ue(this,void 0,void 0,function*(){let s;if(e){const l=zC({video:e});typeof l.video!="boolean"&&(s=l.video)}yield this.restart(s);try{for(var a=!0,u=np(this.simulcastCodecs.values()),c;c=yield u.next(),n=c.done,!n;a=!0){o=c.value,a=!1;const l=o;l.sender&&(l.mediaStreamTrack=this.mediaStreamTrack.clone(),yield l.sender.replaceTrack(l.mediaStreamTrack))}}catch(l){r={error:l}}finally{try{!a&&!n&&(i=u.return)&&(yield i.call(u))}finally{if(r)throw r.error}}})}setProcessor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const r=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});var i,o,s,a,u,c;return ue(this,void 0,void 0,function*(){if(yield r.setProcessor.call(this,e,n),!((u=this.processor)===null||u===void 0)&&u.processedTrack)try{for(var l=!0,d=np(this.simulcastCodecs.values()),f;f=yield d.next(),i=f.done,!i;l=!0)a=f.value,l=!1,yield(c=a.sender)===null||c===void 0?void 0:c.replaceTrack(this.processor.processedTrack)}catch(h){o={error:h}}finally{try{!l&&!i&&(s=d.return)&&(yield s.call(d))}finally{if(o)throw o.error}}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},uCe))}setPublishingCodecs(e){var n,r,i,o,s,a,u;return ue(this,void 0,void 0,function*(){if(ie.debug("setting publishing codecs",{codecs:e,currentCodec:this.codec}),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,r=np(e);i=yield r.next(),o=i.done,!o;n=!0){u=i.value,n=!1;const l=u;if(!this.codec||this.codec===l.codec)yield this.setPublishingLayers(l.qualities);else{const d=this.simulcastCodecs.get(l.codec);if(ie.debug("try setPublishingCodec for ".concat(l.codec),d),!d||!d.sender){for(const f of l.qualities)if(f.enabled){c.push(l.codec);break}}else d.encodings&&(ie.debug("try setPublishingLayersForSender ".concat(l.codec)),yield pU(d.sender,d.encodings,l.qualities,this.senderLock))}}}catch(l){s={error:l}}finally{try{!n&&!o&&(a=r.return)&&(yield a.call(r))}finally{if(s)throw s.error}}return c})}setPublishingLayers(e){return ue(this,void 0,void 0,function*(){ie.debug("setting publishing layers",e),!(!this.sender||!this.encodings)&&(yield pU(this.sender,this.encodings,e,this.senderLock))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ue(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Tq()&&this.isInBackground&&this.source===Ee.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function pU(t,e,n,r){return ue(this,void 0,void 0,function*(){const i=yield r.lock();ie.debug("setPublishingLayersForSender",{sender:t,qualities:n,senderEncodings:e});try{const o=t.getParameters(),{encodings:s}=o;if(!s)return;if(s.length!==e.length){ie.warn("cannot set publishing layers, encodings mismatch");return}let a=!1;!1&&s[0].scalabilityMode||s.forEach((c,l)=>{var d;let f=(d=c.rid)!==null&&d!==void 0?d:"";f===""&&(f="q");const h=Bq(f),p=n.find(m=>m.quality===h);p&&c.active!==p.enabled&&(a=!0,c.active=p.enabled,ie.debug("setting layer ".concat(p.quality," to ").concat(c.active?"enabled":"disabled")),My()&&(p.enabled?(c.scaleResolutionDownBy=e[l].scaleResolutionDownBy,c.maxBitrate=e[l].maxBitrate,c.maxFrameRate=e[l].maxFrameRate):(c.scaleResolutionDownBy=4,c.maxBitrate=10,c.maxFrameRate=2)))}),a&&(o.encodings=s,ie.debug("setting encodings",o.encodings),yield t.setParameters(o))}finally{i()}})}function Bq(t){switch(t){case"f":return ur.HIGH;case"h":return ur.MEDIUM;case"q":return ur.LOW;default:return ur.HIGH}}function mU(t,e,n,r){if(!n)return[new Pi({quality:ur.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(r){const i=n[0].scalabilityMode,o=new Mq(i),s=[];for(let a=0;a<o.spatial;a+=1)s.push(new Pi({quality:ur.HIGH-a,width:Math.ceil(t/Math.pow(2,a)),height:Math.ceil(e/Math.pow(2,a)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(3,a)):0,ssrc:0}));return s}return n.map(i=>{var o,s,a;const u=(o=i.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let c=Bq((s=i.rid)!==null&&s!==void 0?s:"");return new Pi({quality:c,width:Math.ceil(t/u),height:Math.ceil(e/u),bitrate:(a=i.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}class Uq extends Ee{constructor(e,n,r,i){super(e,r),this.sid=n,this.receiver=i}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ue.Muted:Ue.Unmuted,this))}setMediaStream(e){this.mediaStream=e,e.onremovetrack=()=>{this.receiver=void 0,this._currentBitrate=0,this.emit(Ue.Ended,this)}}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),BP))}}class Jv extends Uq{constructor(e,n,r,i,o){super(e,n,Ee.Kind.Audio,r),this.monitorReceiver=()=>ue(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=jC(s,this.prevStats)),this.prevStats=s}),this.audioContext=i,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;zf()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(zf())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return ue(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(bI(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.elementVolume&&(e.volume=this.elementVolume),this.sinkId&&bI(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(ie.debug("using audio context mapping"),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Ue.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(Ue.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return ue(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const CT=100;class Yv extends Uq{constructor(e,n,r,i){super(e,n,Ee.Kind.Video,r),this.elementInfos=[],this.monitorReceiver=()=>ue(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=jC(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=MP(()=>{this.updateDimensions()},CT),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Yp(this._mediaStreamTrack,n):Ap(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new cCe(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):ie.warn("visibility resize observer not triggered")}stopObservingElementInfo(e){if(!this.isAdaptiveStream){ie.warn("stopObservingElementInfo ignored");return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return ue(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"video",framesDecoded:r.framesDecoded,framesDropped:r.framesDropped,framesReceived:r.framesReceived,packetsReceived:r.packetsReceived,packetsLost:r.packetsLost,frameWidth:r.frameWidth,frameHeight:r.frameHeight,pliCount:r.pliCount,firCount:r.firCount,nackCount:r.nackCount,jitter:r.jitter,timestamp:r.timestamp,bytesReceived:r.bytesReceived,decoderImplementation:r.decoderImplementation})}),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ue(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const r=this.elementInfos.reduce((a,u)=>Math.max(a,u.visibilityChangedAt||0),0),i=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,o=this.elementInfos.some(a=>a.pictureInPicture),s=this.elementInfos.some(a=>a.visible)&&!i||o;if(this.lastVisible!==s){if(!s&&Date.now()-r<CT){ui.setTimeout(()=>{this.updateVisibility()},CT);return}this.lastVisible=s,this.emit(Ue.VisibilityChanged,s,this)}}updateDimensions(){var e,n;let r=0,i=0;const o=this.getPixelDensity();for(const s of this.elementInfos){const a=s.width()*o,u=s.height()*o;a+u>r+i&&(r=a,i=u)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===i||(this.lastDimensions={width:r,height:i},this.emit(Ue.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?KB():n||(KB()>2?2:1)}}class cCe{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var i;const{target:o,isIntersecting:s}=r;o===this.element&&(this.isIntersecting=s,this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r;this.isPiP=!0,(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=!1,(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??gU(e),this.isPiP=ao()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=gU(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;(e=this.handleResize)===null||e===void 0||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,JB().observe(this.element),XB().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,n;(e=JB())===null||e===void 0||e.unobserve(this.element),(n=XB())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function gU(t){let e=t.offsetTop,n=t.offsetLeft;const r=t.offsetWidth,i=t.offsetHeight,{hidden:o}=t,{opacity:s,display:a}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop,n+=t.offsetLeft;return e<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&e+i>window.pageYOffset&&n+r>window.pageXOffset&&!o&&(s!==""?parseFloat(s)>0:!0)&&a!=="none"}class Fu extends yu.EventEmitter{constructor(e,n,r){super(),this.metadataMuted=!1,this.encryption=Ni.NONE,this.handleMuted=()=>{this.emit(Ue.Muted)},this.handleUnmuted=()=>{this.emit(Ue.Unmuted)},this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=Ee.Source.Unknown}setTrack(e){this.track&&(this.track.off(Ue.Muted,this.handleMuted),this.track.off(Ue.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Ue.Muted,this.handleMuted),e.on(Ue.Unmuted,this.handleUnmuted))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ni.NONE}get audioTrack(){if(this.track instanceof Hi||this.track instanceof Jv)return this.track}get videoTrack(){if(this.track instanceof Co||this.track instanceof Yv)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Ee.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Ee.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,ie.debug("update publication info",{info:e})}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Fu||(Fu={}));class Gw extends Fu{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r){super(e,n.sid,n.name),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Ue.Ended)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&this.track.off(Ue.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Ue.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){var e;return ue(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){var e;return ue(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){var e;return ue(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){var e;return ue(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}}var hf;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Unknown="unknown"})(hf||(hf={}));function lCe(t){switch(t){case Zl.EXCELLENT:return hf.Excellent;case Zl.GOOD:return hf.Good;case Zl.POOR:return hf.Poor;default:return hf.Unknown}}class Vq extends yu.EventEmitter{get isEncrypted(){return this.tracks.size>0&&Array.from(this.tracks.values()).every(e=>e.isEncrypted)}constructor(e,n,r,i){super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=hf.Unknown,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=i,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(e){for(const[,n]of this.tracks)if(n.source===e)return n}getTrackByName(e){for(const[,n]of this.tracks)if(n.trackName===e)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrack(Ee.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrack(Ee.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrack(Ee.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,ie.trace("update participant info",{info:e}),!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(Qe.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(Qe.ParticipantNameChanged,e)}setPermissions(e){var n,r,i,o,s;const a=this.permissions,u=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((s=this.permissions)===null||s===void 0?void 0:s.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((c,l)=>{var d;return c!==((d=this.permissions)===null||d===void 0?void 0:d.canPublishSources[l])});return this.permissions=e,u&&this.emit(Qe.ParticipantPermissionsChanged,a),u}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Qe.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=lCe(e),n!==this._connectionQuality&&this.emit(Qe.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTracks.forEach(n=>(n.track instanceof Jv||n.track instanceof Hi)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(Ue.Muted,()=>{this.emit(Qe.TrackMuted,e)}),e.on(Ue.Unmuted,()=>{this.emit(Qe.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.tracks.set(e.trackSid,e),e.kind){case Ee.Kind.Audio:this.audioTracks.set(e.trackSid,e);break;case Ee.Kind.Video:this.videoTracks.set(e.trackSid,e);break}}}function dCe(t){var e,n,r;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new qa({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=t.allowAll)!==null&&r!==void 0?r:!1,trackSids:t.allowedTrackSids||[]})}class zq extends Fu{constructor(e,n,r){super(e,n.sid,n.name),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=ur.HIGH,this.handleEnded=i=>{this.setTrack(void 0),this.emit(Ue.Ended,i)},this.handleVisibilityChange=i=>{ie.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(i),{trackSid:this.trackSid}),this.disabled=!i,this.emitTrackUpdate()},this.handleVideoDimensionsChange=i=>{ie.debug("adaptivestream video dimensions ".concat(i.width,"x").concat(i.height),{trackSid:this.trackSid}),this.videoDimensions=i,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new ps({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Ba({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Ue.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Fu.SubscriptionStatus.Unsubscribed:super.isSubscribed?Fu.SubscriptionStatus.Subscribed:Fu.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Fu.PermissionStatus.Allowed:Fu.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(this.track instanceof Yv&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof Yv&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Ue.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Ue.VisibilityChanged,this.handleVisibilityChange),i.off(Ue.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Ue.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Ue.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Ue.VisibilityChanged,this.handleVisibilityChange),e.on(Ue.Ended,this.handleEnded),this.emit(Ue.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(Ue.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?Ue.Muted:Ue.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(Ue.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Ue.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===Ee.Kind.Video&&this.isAdaptiveStream?(ie.warn("adaptive stream is enabled, cannot change video track settings",{trackSid:this.trackSid}),!1):this.isDesired?!0:(ie.warn("cannot update track settings when not subscribed",{trackSid:this.trackSid}),!1)}get isAdaptiveStream(){return this.track instanceof Yv&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Wa({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=ur.HIGH,this.emit(Ue.UpdateSettings,e)}}class Uy extends Vq{static fromParticipantInfo(e,n){return new Uy(e,n.sid,n.identity,n.name,n.metadata)}constructor(e,n,r,i,o){super(n,r||"",i,o),this.signalClient=e,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Ue.UpdateSettings,n=>{ie.debug("send update settings",n),this.signalClient.sendUpdateTrackSettings(n)}),e.on(Ue.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(Ue.SubscriptionPermissionChanged,n=>{this.emit(Qe.TrackSubscriptionPermissionChanged,e,n)}),e.on(Ue.SubscriptionStatusChanged,n=>{this.emit(Qe.TrackSubscriptionStatusChanged,e,n)}),e.on(Ue.Subscribed,n=>{this.emit(Qe.TrackSubscribed,n,e)}),e.on(Ue.Unsubscribed,n=>{this.emit(Qe.TrackUnsubscribed,n,e)}),e.on(Ue.SubscriptionFailed,n=>{this.emit(Qe.TrackSubscriptionFailed,e.trackSid,n)})}getTrack(e){const n=super.getTrack(e);if(n)return n}getTrackByName(e){const n=super.getTrackByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ee.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrack(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ee.Source.Microphone;const n=this.getTrack(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,i,o,s){let a=this.getTrackPublication(n);if(a||n.startsWith("TR")||this.tracks.forEach(l=>{!a&&e.kind===l.kind.toString()&&(a=l)}),!a){if(s===0){ie.error("could not find published track",{participant:this.sid,trackSid:n}),this.emit(Qe.TrackSubscriptionFailed,n);return}s===void 0&&(s=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,i,o,s-1)},150);return}if(e.readyState==="ended"){ie.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",{participant:this.sid,trackSid:n}),this.emit(Qe.TrackSubscriptionFailed,n);return}const u=e.kind==="video";let c;return u?c=new Yv(e,n,i,o):c=new Jv(e,n,i,this.audioContext,this.audioOutput),c.source=a.source,c.isMuted=a.isMuted,c.setMediaStream(r),c.start(),a.setTrack(c),this.volumeMap.has(a.source)&&c instanceof Jv&&c.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublication(e){return this.tracks.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(i=>{var o;let s=this.getTrackPublication(i.sid);if(s)s.updateInfo(i);else{const a=Ee.kindFromProto(i.type);if(!a)return;s=new zq(a,i,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe),s.updateInfo(i),r.set(i.sid,s);const u=Array.from(this.tracks.values()).find(c=>c.source===(s==null?void 0:s.source));u&&s.source!==Ee.Source.Unknown&&ie.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(s.source),{oldTrack:u,newTrack:s,participant:this,participantInfo:e}),this.addTrackPublication(s)}n.set(i.sid,s)}),this.tracks.forEach(i=>{n.has(i.trackSid)||(ie.trace("detected removed track on remote participant, unpublishing",{publication:i,participantSid:this.sid}),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(Qe.TrackPublished,i)}),!0}unpublishTrack(e,n){const r=this.tracks.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.tracks.delete(e),r.kind){case Ee.Kind.Audio:this.audioTracks.delete(e);break;case Ee.Kind.Video:this.videoTracks.delete(e);break}n&&this.emit(Qe.TrackUnpublished,r)}setAudioOutput(e){return ue(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTracks.forEach(r=>{var i;r.track instanceof Jv&&n.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return ie.trace("participant event",{participant:this.sid,event:e,args:r}),super.emit(e,...r)}}class vU extends Vq{constructor(e,n,r,i){super(e,n),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ni.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Rq)},this.handleReconnected=()=>{var o,s;(s=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||s===void 0||s.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,s;this.reconnectFuture&&(this.reconnectFuture.promise.catch(a=>ie.warn(a)),(s=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||s===void 0||s.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.updateTrackSubscriptionPermissions=()=>{ie.debug("updating track subscription permissions",{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions}),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>dCe(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,s)=>{if(s===void 0&&(s=!0),!o.sid){ie.error("could not update mute status for unpublished track",o);return}this.engine.updateMuteStatus(o.sid,s)},this.onTrackUpstreamPaused=o=>{ie.debug("upstream paused"),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{ie.debug("upstream resumed"),this.onTrackMuted(o,o.isMuted)},this.handleSubscribedQualityUpdate=o=>ue(this,void 0,void 0,function*(){var s,a,u,c,l,d;if(!(!((l=this.roomOptions)===null||l===void 0)&&l.dynacast))return;const f=this.videoTracks.get(o.trackSid);if(!f){ie.warn("received subscribed quality update for unknown track",{method:"handleSubscribedQualityUpdate",sid:o.trackSid});return}if(o.subscribedCodecs.length>0){if(!f.videoTrack)return;const v=yield f.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var h=!0,p=np(v),m;m=yield p.next(),s=m.done,!s;h=!0){c=m.value,h=!1;const g=c;lSe(g)&&(ie.debug("publish ".concat(g," for ").concat(f.videoTrack.sid)),yield this.publishAdditionalCodecForTrack(f.videoTrack,g,f.options))}}catch(g){a={error:g}}finally{try{!h&&!s&&(u=p.return)&&(yield u.call(p))}finally{if(a)throw a.error}}}else o.subscribedQualities.length>0&&(yield(d=f.videoTrack)===null||d===void 0?void 0:d.setPublishingLayers(o.subscribedQualities))}),this.handleLocalTrackUnpublished=o=>{const s=this.tracks.get(o.trackSid);if(!s){ie.warn("received unpublished event for unknown track",{method:"handleLocalTrackUnpublished",trackSid:o.trackSid});return}this.unpublishTrack(s.track)},this.handleTrackEnded=o=>ue(this,void 0,void 0,function*(){if(o.source===Ee.Source.ScreenShare||o.source===Ee.Source.ScreenShareAudio)ie.debug("unpublishing local track due to TrackEnded",{track:o.sid}),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(o instanceof Hi||o instanceof Co)try{if(ao())try{const s=yield navigator==null?void 0:navigator.permissions.query({name:o.source===Ee.Source.Camera?"camera":"microphone"});if(s&&s.state==="denied")throw ie.warn("user has revoked access to ".concat(o.source)),s.onchange=()=>{s.state!=="denied"&&(o.isMuted||o.restartTrack(),s.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(ie.debug("track ended, attempting to use a different device"),yield o.restartTrack())}catch{ie.warn("could not restart track, muting instead"),yield o.mute()}}),this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ni.NONE}getTrack(e){const n=super.getTrack(e);if(n)return n}getTrackByName(e){const n=super.getTrackByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.client.onRemoteMuteChanged=(n,r)=>{const i=this.tracks.get(n);!i||!i.track||(r?i.mute():i.unmute())},this.engine.client.onSubscribedQualityUpdate=this.handleSubscribedQualityUpdate,this.engine.client.onLocalTrackUnpublished=this.handleLocalTrackUnpublished,this.engine.on(Ze.Connected,this.handleReconnected).on(Ze.Restarted,this.handleReconnected).on(Ze.Resumed,this.handleReconnected).on(Ze.Restarting,this.handleReconnecting).on(Ze.Resuming,this.handleReconnecting).on(Ze.Disconnected,this.handleDisconnected)}setMetadata(e){var n;this.engine.client.sendUpdateLocalMetadata(e,(n=this.name)!==null&&n!==void 0?n:"")}setName(e){var n;this.engine.client.sendUpdateLocalMetadata((n=this.metadata)!==null&&n!==void 0?n:"",e)}setCameraEnabled(e,n,r){return this.setTrackEnabled(Ee.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(Ee.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(Ee.Source.ScreenShare,e,n,r)}setPermissions(e){const n=this.permissions,r=super.setPermissions(e);return r&&n&&this.emit(Qe.ParticipantPermissionsChanged,n),r}setE2EEEnabled(e){return ue(this,void 0,void 0,function*(){this.encryptionType=e?Ni.GCM:Ni.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,i){var o,s;return ue(this,void 0,void 0,function*(){ie.debug("setTrackEnabled",{source:e,enabled:n});let a=this.getTrack(e);if(n)if(a)yield a.unmute();else{let u;if(this.pendingPublishing.has(e)){ie.info("skipping duplicate published source",{source:e});return}this.pendingPublishing.add(e);try{switch(e){case Ee.Source.Camera:u=yield this.createTracks({video:(o=r)!==null&&o!==void 0?o:!0});break;case Ee.Source.Microphone:u=yield this.createTracks({audio:(s=r)!==null&&s!==void 0?s:!0});break;case Ee.Source.ScreenShare:u=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Na(e)}const c=[];for(const d of u)ie.info("publishing track",{localTrack:d}),c.push(this.publishTrack(d,i));[a]=yield Promise.all(c)}catch(c){throw u==null||u.forEach(l=>{l.stop()}),c instanceof Error&&!(c instanceof Na)&&this.emit(Qe.MediaDevicesError,c),c}finally{this.pendingPublishing.delete(e)}}else if(a&&a.track)if(e===Ee.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const u=this.getTrack(Ee.Source.ScreenShareAudio);u&&u.track&&this.unpublishTrack(u.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return ue(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Ee.Source.Camera)||this.pendingPublishing.has(Ee.Source.Microphone))){this.pendingPublishing.add(Ee.Source.Camera),this.pendingPublishing.add(Ee.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(Ee.Source.Camera),this.pendingPublishing.delete(Ee.Source.Microphone)}}})}createTracks(e){var n,r;return ue(this,void 0,void 0,function*(){const i=Cq(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults),o=zC(i);let s;try{s=yield navigator.mediaDevices.getUserMedia(o)}catch(a){throw a instanceof Error&&(o.audio&&(this.microphoneError=a),o.video&&(this.cameraError=a)),a}return o.audio&&(this.microphoneError=void 0),o.video&&(this.cameraError=void 0),s.getTracks().map(a=>{const u=a.kind==="audio";u?e.audio:e.video;let c;const l=u?o.audio:o.video;typeof l!="boolean"&&(c=l);const d=Fq(a,c);return d.kind===Ee.Kind.Video?d.source=Ee.Source.Camera:d.kind===Ee.Kind.Audio&&(d.source=Ee.Source.Microphone),d.mediaStream=s,d})})}createScreenTracks(e){return ue(this,void 0,void 0,function*(){if(e===void 0&&(e={}),e.resolution===void 0&&(e.resolution=FP.h1080fps15.resolution),navigator.mediaDevices.getDisplayMedia===void 0)throw new OP("getDisplayMedia not supported");const n=pSe(e),r=yield navigator.mediaDevices.getDisplayMedia(n),i=r.getVideoTracks();if(i.length===0)throw new Na("no video track found");const o=new Co(i[0],void 0,!1);o.source=Ee.Source.ScreenShare;const s=[o];if(r.getAudioTracks().length>0){const a=new Hi(r.getAudioTracks()[0],void 0,!1,this.audioContext);a.source=Ee.Source.ScreenShareAudio,s.push(a)}return s})}publishTrack(e,n){var r,i,o,s;return ue(this,void 0,void 0,function*(){yield(r=this.reconnectFuture)===null||r===void 0?void 0:r.promise,e instanceof By&&this.pendingPublishPromises.has(e)&&(yield this.pendingPublishPromises.get(e));let a;if(e instanceof MediaStreamTrack)a=e.getConstraints();else{a=e.constraints;let h;switch(e.source){case Ee.Source.Microphone:h="audioinput";break;case Ee.Source.Camera:h="videoinput"}h&&this.activeDeviceMap.has(h)&&(a=Object.assign(Object.assign({},a),{deviceId:this.activeDeviceMap.get(h)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new Hi(e,a,!0,this.audioContext);break;case"video":e=new Co(e,a,!0);break;default:throw new Na("unsupported MediaStreamTrack kind ".concat(e.kind))}e instanceof Hi&&e.setAudioContext(this.audioContext);let u;if(this.tracks.forEach(h=>{h.track&&h.track===e&&(u=h)}),u)return ie.warn("track has already been published, skipping"),u;const c="channelCount"in e.mediaStreamTrack.getSettings()&&e.mediaStreamTrack.getSettings().channelCount===2||e.mediaStreamTrack.getConstraints().channelCount===2,l=(i=n==null?void 0:n.forceStereo)!==null&&i!==void 0?i:c;l&&(n||(n={}),n.dtx===void 0&&ie.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work."),n.red===void 0&&ie.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(o=n.dtx)!==null&&o!==void 0||(n.dtx=!1),(s=n.red)!==null&&s!==void 0||(n.red=!1));const d=Object.assign(Object.assign({},this.roomOptions.publishDefaults),n);WC()&&this.roomOptions.e2ee&&(ie.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari"),d.simulcast=!1),d.source&&(e.source=d.source);const f=this.publish(e,d,l);this.pendingPublishPromises.set(e,f);try{return yield f}catch(h){throw h}finally{this.pendingPublishPromises.delete(e)}})}publish(e,n,r){var i,o,s,a,u,c,l,d,f,h,p,m,v,g;return ue(this,void 0,void 0,function*(){const y=Array.from(this.tracks.values()).find(N=>e instanceof By&&N.source===e.source);if(y&&e.source!==Ee.Source.Unknown)try{throw Error("publishing a second track with the same source: ".concat(e.source))}catch(N){N instanceof Error&&ie.warn(N.message,{oldTrack:y,newTrack:e,trace:N.stack})}n.stopMicTrackOnMute&&e instanceof Hi&&(e.stopOnMute=!0),e.source===Ee.Source.ScreenShare&&My()&&(n.simulcast=!1),n.videoCodec==="av1"&&!vSe()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!ySe()&&(n.videoCodec=void 0),e.on(Ue.Muted,this.onTrackMuted),e.on(Ue.Unmuted,this.onTrackUnmuted),e.on(Ue.Ended,this.handleTrackEnded),e.on(Ue.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Ue.UpstreamResumed,this.onTrackUpstreamResumed);const b=new Js({cid:e.mediaStreamTrack.id,name:n.name,type:Ee.kindToProto(e.kind),muted:e.isMuted,source:Ee.sourceToProto(e.source),disableDtx:!(!((i=n.dtx)!==null&&i!==void 0)||i),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o)});let x,S;if(e.kind===Ee.Kind.Video){let N={width:0,height:0};try{N=yield e.waitForDimensions()}catch{const F=(a=(s=this.roomOptions.videoCaptureDefaults)===null||s===void 0?void 0:s.resolution)!==null&&a!==void 0?a:Ly.h720.resolution;N={width:F.width,height:F.height},ie.error("could not determine track dimensions, using defaults",N)}if(b.width=N.width,b.height=N.height,e instanceof Co)if(Kv(n.videoCodec)&&(n.scalabilityMode=(u=n.scalabilityMode)!==null&&u!==void 0?u:"L3T3_KEY"),n.videoCodec&&n.backupCodec&&n.videoCodec!==n.backupCodec.codec){this.roomOptions.dynacast||(this.roomOptions.dynacast=!0);const $=Object.assign({},n);$.simulcast=!0,S=dU(e,n.backupCodec.codec,$),b.simulcastCodecs=[new hs({codec:n.videoCodec,cid:e.mediaStreamTrack.id,enableSimulcastLayers:!0}),new hs({codec:n.backupCodec.codec,cid:"",enableSimulcastLayers:!0})]}else n.videoCodec&&(b.simulcastCodecs=[new hs({codec:n.videoCodec,cid:e.mediaStreamTrack.id,enableSimulcastLayers:(c=n.simulcast)!==null&&c!==void 0?c:!1})]);x=Lq(e.source===Ee.Source.ScreenShare,N.width,N.height,n),b.layers=mU(b.width,b.height,x,Kv(n.videoCodec))}else e.kind===Ee.Kind.Audio&&(x=[{maxBitrate:(d=(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate)!==null&&d!==void 0?d:n.audioBitrate,priority:(h=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&h!==void 0?h:"high",networkPriority:(m=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Jr("cannot publish track when not connected");const C=yield this.engine.addTrack(b);let T=!1,E=!1;if(C.codecs.forEach(N=>{jB(N.mimeType,n.videoCodec)?T=!0:n.backupCodec&&jB(N.mimeType,n.backupCodec.codec)&&(E=!0)}),b.simulcastCodecs.length>0){if(!T&&!E)throw Error("cannot publish track, codec not supported by server");if(!T&&n.backupCodec){const N=n.backupCodec;n=Object.assign({},n),ie.debug("primary codec ".concat(n.videoCodec," not supported, fallback to ").concat(N.codec)),n.videoCodec=N.codec,n.videoEncoding=N.encoding,x=S}}const I=new Gw(e.kind,C,e);if(I.options=n,e.sid=C.sid,!this.engine.publisher)throw new Jr("publisher is closed");if(ie.debug("publishing ".concat(e.kind," with encodings"),{encodings:x,trackInfo:C}),e.sender=yield this.engine.createSender(e,n,x),x)if(My()&&e.kind===Ee.Kind.Audio){let N;for(const $ of this.engine.publisher.pc.getTransceivers())if($.sender===e.sender){N=$;break}N&&this.engine.publisher.setTrackCodecBitrate({transceiver:N,codec:"opus",maxbr:!((v=x[0])===null||v===void 0)&&v.maxBitrate?x[0].maxBitrate/1e3:0})}else e.codec&&Kv(e.codec)&&(!((g=x[0])===null||g===void 0)&&g.maxBitrate)&&this.engine.publisher.setTrackCodecBitrate({cid:b.cid,codec:e.codec,maxbr:x[0].maxBitrate/1e3});return yield this.engine.negotiate(),e instanceof Co?e.startMonitor(this.engine.client):e instanceof Hi&&e.startMonitor(),this.addTrackPublication(I),this.emit(Qe.LocalTrackPublished,I),I})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){var i;return ue(this,void 0,void 0,function*(){let o;if(this.tracks.forEach(d=>{d.track&&d.track===e&&(o=d)}),!o)throw new Na("track is not published");if(!(e instanceof Co))throw new Na("track is not a video track");const s=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),a=dU(e,n,s);if(!a){ie.info("backup codec has been disabled, ignoring request to add additional codec for track");return}const u=e.addSimulcastTrack(n,a),c=new Js({cid:u.mediaStreamTrack.id,type:Ee.kindToProto(e.kind),muted:e.isMuted,source:Ee.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:u.mediaStreamTrack.id,enableSimulcastLayers:s.simulcast}]});if(c.layers=mU(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new Jr("cannot publish track when not connected");const l=yield this.engine.addTrack(c);yield this.engine.createSimulcastSender(e,u,s,a),yield this.engine.negotiate(),ie.debug("published ".concat(n," for track ").concat(e.sid),{encodings:a,trackInfo:l})})}unpublishTrack(e,n){var r,i;return ue(this,void 0,void 0,function*(){const o=this.getPublicationForTrack(e);if(ie.debug("unpublishing track",{track:e,method:"unpublishTrack"}),!o||!o.track){ie.warn("track was not unpublished because no publication was found",{track:e,method:"unpublishTrack"});return}e=o.track,e.off(Ue.Muted,this.onTrackMuted),e.off(Ue.Unmuted,this.onTrackUnmuted),e.off(Ue.Ended,this.handleTrackEnded),e.off(Ue.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Ue.UpstreamResumed,this.onTrackUpstreamResumed),n===void 0&&(n=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),n&&e.stop();let s=!1;const a=e.sender;if(e.sender=void 0,this.engine.publisher&&this.engine.publisher.pc.connectionState!=="closed"&&a)try{for(const u of this.engine.publisher.pc.getTransceivers())u.sender===a&&(u.direction="inactive",s=!0);if(this.engine.removeTrack(a)&&(s=!0),e instanceof Co){for(const[,u]of e.simulcastCodecs)u.sender&&(this.engine.removeTrack(u.sender)&&(s=!0),u.sender=void 0);e.simulcastCodecs.clear()}}catch(u){ie.warn("failed to unpublish track",{error:u,method:"unpublishTrack"})}switch(this.tracks.delete(o.trackSid),o.kind){case Ee.Kind.Audio:this.audioTracks.delete(o.trackSid);break;case Ee.Kind.Video:this.videoTracks.delete(o.trackSid);break}return this.emit(Qe.LocalTrackUnpublished,o),o.setTrack(void 0),s&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return ue(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>r instanceof Gw)})}republishAllTracks(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return ue(this,void 0,void 0,function*(){const r=[];this.tracks.forEach(i=>{i.track&&(e&&(i.options=Object.assign(Object.assign({},i.options),e)),r.push(i))}),yield Promise.all(r.map(i=>ue(this,void 0,void 0,function*(){const o=i.track;yield this.unpublishTrack(o,!1),n&&!o.isMuted&&(o instanceof Hi||o instanceof Co)&&!o.isUserProvided&&(ie.debug("restarting existing track",{track:i.trackSid}),yield o.restartTrack()),yield this.publishTrack(o,i.options)})))})}publishData(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ue(this,void 0,void 0,function*(){const i=Array.isArray(r)?r:r==null?void 0:r.destination,o=[],s=Array.isArray(r)?void 0:r.topic;i!==void 0&&i.forEach(u=>{u instanceof Uy?o.push(u.sid):o.push(u)});const a=new Fa({kind:n,value:{case:"user",value:new Ma({participantSid:this.sid,payload:e,destinationSids:o,topic:s})}});yield this.engine.sendDataPacket(a,n)})}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isConnected&&this.updateTrackSubscriptionPermissions()}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(n=>{var r,i;const o=this.tracks.get(n.sid);if(o){const s=o.isMuted||((i=(r=o.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);s!==n.muted&&(ie.debug("updating server mute state after reconcile",{sid:n.sid,muted:s}),this.engine.client.sendMuteTrack(n.sid,s))}}),!0)}getPublicationForTrack(e){let n;return this.tracks.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(i instanceof Hi||i instanceof Co)&&i.mediaStreamTrack===e&&(n=r):e===i&&(n=r))}),n}publishedTracksInfo(){const e=[];return this.tracks.forEach(n=>{n.track!==void 0&&e.push(new Zs({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}dataChannelsInfo(){const e=[],n=(r,i)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new Ja({label:r.label,id:r.id,target:i}))};return n(this.engine.dataChannelForKind(Fr.LOSSY),to.PUBLISHER),n(this.engine.dataChannelForKind(Fr.RELIABLE),to.PUBLISHER),n(this.engine.dataChannelForKind(Fr.LOSSY,!0),to.SUBSCRIBER),n(this.engine.dataChannelForKind(Fr.RELIABLE,!0),to.SUBSCRIBER),e}}var nn;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting"})(nn||(nn={}));const fCe=2*1e3;class UP extends yu.EventEmitter{constructor(e){var n,r;super(),n=this,this.state=nn.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.connect=(i,o,s)=>ue(this,void 0,void 0,function*(){var a;const u=yield this.disconnectLock.lock();if(this.state===nn.Connected)return ie.info("already connected to room ".concat(this.name)),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(nn.Connecting),((a=this.regionUrlProvider)===null||a===void 0?void 0:a.getServerUrl().toString())!==i&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),xI(new URL(i))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new lU(i,o):this.regionUrlProvider.updateToken(o),this.regionUrlProvider.fetchRegionSettings().catch(d=>{ie.warn("could not fetch region settings",{error:d})}));const c=(d,f,h)=>ue(this,void 0,void 0,function*(){var p;this.abortController&&this.abortController.abort();const m=new AbortController;this.abortController=m,u==null||u();try{yield this.attemptConnection(h??i,o,s,m),this.abortController=void 0,d()}catch(v){if(this.regionUrlProvider&&v instanceof Bn&&v.reason!==3&&v.reason!==0){let g=null;try{g=yield this.regionUrlProvider.getNextBestRegionUrl((p=this.abortController)===null||p===void 0?void 0:p.signal)}catch(y){if(y instanceof Bn&&(y.status===401||y.reason===3)){f(y);return}}g?(ie.info("initial connection failed, retrying with another region",{nextUrl:g}),yield c(d,f,g)):f(v)}else f(v)}}),l=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Rq((d,f)=>{c(d,f,l)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(i,o,s,a,u,c)=>ue(this,void 0,void 0,function*(){const l=yield s.join(i,o,{autoSubscribe:a.autoSubscribe,publishOnly:a.publishOnly,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:a.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:a.websocketTimeout},c.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),ie.debug("connected to Livekit Server ".concat(Object.entries(d).map(f=>{let[h,p]=f;return"".concat(h,": ").concat(p)}).join(", "))),!l.serverVersion)throw new rSe("unknown server version");return l.serverVersion==="0.15.1"&&this.options.dynacast&&(ie.debug("disabling dynacast due to server version"),u.dynacast=!1),l}),this.applyJoinResponse=i=>{const o=i.participant;this.localParticipant.sid=o.sid,this.localParticipant.identity=o.identity,this.handleParticipantUpdates([o,...i.otherParticipants]),i.room&&this.handleRoomUpdate(i.room),this.options.e2ee&&this.e2eeManager&&this.e2eeManager.setSifTrailer(i.sifTrailer)},this.attemptConnection=(i,o,s,a)=>ue(this,void 0,void 0,function*(){var u,c;this.state===nn.Reconnecting?(ie.info("Reconnection attempt replaced by new connection attempt"),this.recreateEngine()):this.maybeCreateEngine(),!((u=this.regionUrlProvider)===null||u===void 0)&&u.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Oq),s),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const l=yield this.connectSignal(i,o,this.engine,this.connOptions,this.options,a);this.applyJoinResponse(l),this.setupLocalParticipantEvents(),this.emit(De.SignalConnected)}catch(l){this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish);const d=new Bn("could not establish signal connection");throw l instanceof Error&&(d.message="".concat(d.message,": ").concat(l.message)),l instanceof Bn&&(d.reason=l.reason,d.status=l.status),ie.debug("error trying to establish signal connection",{error:l}),d}if(a.signal.aborted)throw this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),new Bn("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,a)}catch(l){throw this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),l}ao()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ao()&&(document.addEventListener("freeze",this.onPageLeave),(c=navigator.mediaDevices)===null||c===void 0||c.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(nn.Connected),this.emit(De.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return ue(n,void 0,void 0,function*(){var o,s,a,u;const c=yield this.disconnectLock.lock();try{if(this.state===nn.Disconnected){ie.debug("already disconnected");return}ie.info("disconnect from room",{identity:this.localParticipant.identity}),(this.state===nn.Connecting||this.state===nn.Reconnecting)&&(ie.warn("abort connection attempt"),(o=this.abortController)===null||o===void 0||o.abort(),(a=(s=this.connectFuture)===null||s===void 0?void 0:s.reject)===null||a===void 0||a.call(s,new Bn("Client initiated disconnect")),this.connectFuture=void 0),!((u=this.engine)===null||u===void 0)&&u.client.isConnected&&(yield this.engine.client.sendLeave()),this.engine&&(yield this.engine.close()),this.handleDisconnect(i,Tc.CLIENT_INITIATED),this.engine=void 0}finally{c()}})},this.onPageLeave=()=>ue(this,void 0,void 0,function*(){yield this.disconnect()}),this.handleRestarting=()=>{this.clearConnectionReconcile();for(const i of this.participants.values())this.handleParticipantDisconnected(i.sid,i);this.setAndEmitConnectionState(nn.Reconnecting)&&this.emit(De.Reconnecting)},this.handleSignalRestarted=i=>ue(this,void 0,void 0,function*(){ie.debug("signal reconnected to server",{region:i.serverRegion}),this.cachedParticipantSids=[],this.applyJoinResponse(i);try{const o=[];this.localParticipant.tracks.forEach(s=>{s.track&&o.push(s)}),yield Promise.all(o.map(s=>ue(this,void 0,void 0,function*(){const a=s.track;this.localParticipant.unpublishTrack(a,!1),a.isMuted||((a instanceof Hi||a instanceof Co)&&a.source!==Ee.Source.ScreenShare&&a.source!==Ee.Source.ScreenShareAudio&&!a.isUserProvided&&(ie.debug("restarting existing track",{track:s.trackSid}),yield a.restartTrack()),ie.debug("publishing new track",{track:s.trackSid}),yield this.localParticipant.publishTrack(a,s.options))})))}catch(o){ie.error("error trying to re-publish tracks after reconnection",{error:o})}try{yield this.engine.waitForRestarted(),ie.debug("fully reconnected to server",{region:i.serverRegion})}catch{return}this.setAndEmitConnectionState(nn.Connected),this.emit(De.Reconnected),this.registerConnectionReconcile(),this.participants.forEach(o=>{this.emit(De.ParticipantConnected,o)})}),this.handleParticipantUpdates=i=>{i.forEach(o=>{if(o.identity===this.localParticipant.identity){this.localParticipant.updateInfo(o);return}const s=this.identityToSid.get(o.identity);s&&s!==o.sid&&this.handleParticipantDisconnected(s,this.participants.get(s));let a=this.participants.get(o.sid);const u=!a;o.state===Uf.DISCONNECTED?this.handleParticipantDisconnected(o.sid,a):(a=this.getOrCreateParticipant(o.sid,o),u||a.updateInfo(o))})},this.handleActiveSpeakersUpdate=i=>{const o=[],s={};i.forEach(a=>{if(s[a.sid]=!0,a.sid===this.localParticipant.sid)this.localParticipant.audioLevel=a.level,this.localParticipant.setIsSpeaking(!0),o.push(this.localParticipant);else{const u=this.participants.get(a.sid);u&&(u.audioLevel=a.level,u.setIsSpeaking(!0),o.push(u))}}),s[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach(a=>{s[a.sid]||(a.audioLevel=0,a.setIsSpeaking(!1))}),this.activeSpeakers=o,this.emitWhenConnected(De.ActiveSpeakersChanged,o)},this.handleSpeakersChanged=i=>{const o=new Map;this.activeSpeakers.forEach(a=>{o.set(a.sid,a)}),i.forEach(a=>{let u=this.participants.get(a.sid);a.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=a.level,u.setIsSpeaking(a.active),a.active?o.set(a.sid,u):o.delete(a.sid))});const s=Array.from(o.values());s.sort((a,u)=>u.audioLevel-a.audioLevel),this.activeSpeakers=s,this.emitWhenConnected(De.ActiveSpeakersChanged,s)},this.handleStreamStateUpdate=i=>{i.streamStates.forEach(o=>{const s=this.participants.get(o.participantSid);if(!s)return;const a=s.getTrackPublication(o.trackSid);!a||!a.track||(a.track.streamState=Ee.streamStateFromProto(o.state),s.emit(Qe.TrackStreamStateChanged,a,a.track.streamState),this.emitWhenConnected(De.TrackStreamStateChanged,a,a.track.streamState,s))})},this.handleSubscriptionPermissionUpdate=i=>{const o=this.participants.get(i.participantSid);if(!o)return;const s=o.getTrackPublication(i.trackSid);s&&s.setAllowed(i.allowed)},this.handleSubscriptionError=i=>{const o=Array.from(this.participants.values()).find(a=>a.tracks.has(i.trackSid));if(!o)return;const s=o.getTrackPublication(i.trackSid);s&&s.setSubscriptionError(i.err)},this.handleDataPacket=(i,o)=>{const s=this.participants.get(i.participantSid);this.emit(De.DataReceived,i.payload,s,o,i.topic),s==null||s.emit(Qe.DataReceived,i.payload,o)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(De.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=i=>{ie.warn("could not playback audio",i),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(De.AudioPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>ue(this,void 0,void 0,function*(){this.emit(De.MediaDevicesChanged)}),this.handleRoomUpdate=i=>{const o=this.roomInfo;this.roomInfo=i,o&&o.metadata!==i.metadata&&this.emitWhenConnected(De.RoomMetadataChanged,i.metadata),(o==null?void 0:o.activeRecording)!==i.activeRecording&&this.emitWhenConnected(De.RecordingStatusChanged,i.activeRecording)},this.handleConnectionQualityUpdate=i=>{i.updates.forEach(o=>{if(o.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(o.quality);return}const s=this.participants.get(o.participantSid);s&&s.setConnectionQuality(o.quality)})},this.onLocalParticipantMetadataChanged=i=>{this.emit(De.ParticipantMetadataChanged,i,this.localParticipant)},this.onLocalParticipantNameChanged=i=>{this.emit(De.ParticipantNameChanged,i,this.localParticipant)},this.onLocalTrackMuted=i=>{this.emit(De.TrackMuted,i,this.localParticipant)},this.onLocalTrackUnmuted=i=>{this.emit(De.TrackUnmuted,i,this.localParticipant)},this.onLocalTrackPublished=i=>ue(this,void 0,void 0,function*(){var o;this.emit(De.LocalTrackPublished,i,this.localParticipant),i.track instanceof Hi&&(yield i.track.checkForSilence())&&this.emit(De.LocalAudioSilenceDetected,i);const s=yield(o=i.track)===null||o===void 0?void 0:o.getDeviceId(),a=hSe(i.source);a&&s&&s!==this.localParticipant.activeDeviceMap.get(a)&&(this.localParticipant.activeDeviceMap.set(a,s),this.emit(De.ActiveDeviceChanged,a,s))}),this.onLocalTrackUnpublished=i=>{this.emit(De.LocalTrackUnpublished,i,this.localParticipant)},this.onLocalConnectionQualityChanged=i=>{this.emit(De.ConnectionQualityChanged,i,this.localParticipant)},this.onMediaDevicesError=i=>{this.emit(De.MediaDevicesError,i)},this.onLocalParticipantPermissionsChanged=i=>{this.emit(De.ParticipantPermissionsChanged,i,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.cachedParticipantSids=[],this.identityToSid=new Map,this.options=Object.assign(Object.assign({},XSe),e),this.options.audioCaptureDefaults=Object.assign(Object.assign({},$q),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Dq),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},KSe),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ec,this.localParticipant=new vU("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",_f(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",_f(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",_f(this.options.audioOutput.deviceId)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return ue(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new MSe(this.options.e2ee),this.e2eeManager.on(Ol.ParticipantEncryptionStatusChanged,(n,r)=>{r instanceof vU&&(this.isE2EEEnabled=n),this.emit(De.ParticipantEncryptionStatusChanged,n,r)}),this.e2eeManager.on(Ol.EncryptionError,n=>this.emit(De.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}get sid(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.sid)!==null&&n!==void 0?n:""}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new YSe(this.options),this.engine.on(Ze.ParticipantUpdate,this.handleParticipantUpdates).on(Ze.RoomUpdate,this.handleRoomUpdate).on(Ze.SpeakersChanged,this.handleSpeakersChanged).on(Ze.StreamStateChanged,this.handleStreamStateUpdate).on(Ze.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Ze.SubscriptionError,this.handleSubscriptionError).on(Ze.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Ze.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on(Ze.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Ze.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Ze.DataPacketReceived,this.handleDataPacket).on(Ze.Resuming,()=>{this.clearConnectionReconcile(),this.setAndEmitConnectionState(nn.Reconnecting)&&this.emit(De.Reconnecting),this.cachedParticipantSids=Array.from(this.participants.keys())}).on(Ze.Resumed,()=>{this.setAndEmitConnectionState(nn.Connected),this.emit(De.Reconnected),this.registerConnectionReconcile(),this.updateSubscriptions(),Array.from(this.participants.values()).filter(n=>!this.cachedParticipantSids.includes(n.sid)).forEach(n=>this.emit(De.ParticipantConnected,n)),this.cachedParticipantSids=[]}).on(Ze.SignalResumed,()=>{this.state===nn.Reconnecting&&this.sendSyncState()}).on(Ze.Restarting,this.handleRestarting).on(Ze.SignalRestarted,this.handleSignalRestarted).on(Ze.DCBufferStatusChanged,(e,n)=>{this.emit(De.DCBufferStatusChanged,e,n)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ei.getInstance().getDevices(e,n)}prepareConnection(e,n){return ue(this,void 0,void 0,function*(){if(this.state===nn.Disconnected){ie.debug("prepareConnection to ".concat(e));try{if(xI(new URL(e))&&n){this.regionUrlProvider=new lU(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===nn.Disconnected&&(this.regionUrl=r,yield fetch(QB(r),{method:"HEAD"}),ie.debug("prepared connection to ".concat(r)))}else yield fetch(QB(e),{method:"HEAD"})}catch(r){ie.warn("could not prepare connection",{error:r})}}})}getParticipantByIdentity(e){if(this.localParticipant.identity===e)return this.localParticipant;const n=this.identityToSid.get(e);if(n)return this.participants.get(n)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return ue(this,void 0,void 0,function*(){let r=()=>{},i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new Ti({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new Ti({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new Ti({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new Ti({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new Ti({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>ue(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new ms({reason:Tc.CLIENT_INITIATED,canReconnect:!0}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new Ti({scenario:{case:"subscriberBandwidth",value:BigInt(n)}});break}i&&(this.engine.client.sendSimulateScenario(i),r())})}startAudio(){return ue(this,void 0,void 0,function*(){const e=[],n=eg();if(n&&n.os==="iOS"){const r="livekit-dummy-audio-el";let i=document.getElementById(r);if(!i){i=document.createElement("audio"),i.id=r,i.autoplay=!0,i.hidden=!0;const o=bT();o.enabled=!0;const s=new MediaStream([o]);i.srcObject=s,document.addEventListener("visibilitychange",()=>{i&&(i.srcObject=document.hidden?null:s)}),document.body.append(i),this.once(De.Disconnected,()=>{i==null||i.remove()})}e.push(i)}this.participants.forEach(r=>{r.audioTracks.forEach(i=>{i.track&&i.track.attachedElements.forEach(o=>{e.push(o)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(r=>(r.muted=!1,r.play()))]),this.handleAudioPlaybackStarted()}catch(r){throw this.handleAudioPlaybackFailed(r),r}})}get canPlaybackAudio(){return this.audioEnabled}getActiveAudioOutputDevice(){var e,n;return(n=(e=this.options.audioOutput)===null||e===void 0?void 0:e.deviceId)!==null&&n!==void 0?n:""}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var i,o,s;return ue(this,void 0,void 0,function*(){let a=!1,u=!0;const c=r?{exact:n}:n;if(e==="audioinput"){const l=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=c,a=l!==c;const d=Array.from(this.localParticipant.audioTracks.values()).filter(f=>f.source===Ee.Source.Microphone);try{u=(yield Promise.all(d.map(f=>{var h;return(h=f.audioTrack)===null||h===void 0?void 0:h.setDeviceId(c)}))).every(f=>f===!0)}catch(f){throw this.options.audioCaptureDefaults.deviceId=l,f}}else if(e==="videoinput"){const l=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=c,a=l!==c;const d=Array.from(this.localParticipant.videoTracks.values()).filter(f=>f.source===Ee.Source.Camera);try{u=(yield Promise.all(d.map(f=>{var h;return(h=f.videoTrack)===null||h===void 0?void 0:h.setDeviceId(c)}))).every(f=>f===!0)}catch(f){throw this.options.videoCaptureDefaults.deviceId=l,f}}else if(e==="audiooutput"){if(!bI()&&!this.options.expWebAudioMix||this.options.expWebAudioMix&&this.audioContext&&!("setSinkId"in this.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");(i=(s=this.options).audioOutput)!==null&&i!==void 0||(s.audioOutput={});const l=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=n,a=l!==c;try{this.options.expWebAudioMix?(o=this.audioContext)===null||o===void 0||o.setSinkId(n):yield Promise.all(Array.from(this.participants.values()).map(d=>d.setAudioOutput({deviceId:n})))}catch(d){throw this.options.audioOutput.deviceId=l,d}}return a&&u&&(this.localParticipant.activeDeviceMap.set(e,n),this.emit(De.ActiveDeviceChanged,e,n)),u})}setupLocalParticipantEvents(){this.localParticipant.on(Qe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Qe.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Qe.TrackMuted,this.onLocalTrackMuted).on(Qe.TrackUnmuted,this.onLocalTrackUnmuted).on(Qe.LocalTrackPublished,this.onLocalTrackPublished).on(Qe.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Qe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Qe.MediaDevicesError,this.onMediaDevicesError).on(Qe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.participants.clear(),this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===nn.Connecting||this.state===nn.Reconnecting){const c=()=>{this.onTrackAdded(e,n,r),l()},l=()=>{this.off(De.Reconnected,c),this.off(De.Connected,c),this.off(De.Disconnected,l)};this.once(De.Reconnected,c),this.once(De.Connected,c),this.once(De.Disconnected,l);return}if(this.state===nn.Disconnected){ie.warn("skipping incoming track after Room disconnected");return}const i=gSe(n.id),o=i[0];let s=i[1];if((!s||s==="")&&(s=e.id),o===this.localParticipant.sid){ie.warn("tried to create RemoteParticipant for local participant");return}const a=this.participants.get(o);if(!a){ie.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o));return}let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={}),a.addSubscribedMediaTrack(e,s,n,r,u)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.state!==nn.Disconnected){this.regionUrl=void 0;try{this.participants.forEach(i=>{i.tracks.forEach(o=>{i.unpublishTrack(o.trackSid)})}),this.localParticipant.tracks.forEach(i=>{var o,s;i.track&&this.localParticipant.unpublishTrack(i.track,e),e&&((o=i.track)===null||o===void 0||o.detach(),(s=i.track)===null||s===void 0||s.stop())}),this.localParticipant.off(Qe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Qe.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Qe.TrackMuted,this.onLocalTrackMuted).off(Qe.TrackUnmuted,this.onLocalTrackUnmuted).off(Qe.LocalTrackPublished,this.onLocalTrackPublished).off(Qe.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Qe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Qe.MediaDevicesError,this.onMediaDevicesError).off(Qe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.expWebAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ao()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(nn.Disconnected),this.emit(De.Disconnected,n)}}}handleParticipantDisconnected(e,n){this.participants.delete(e),n&&(this.identityToSid.delete(n.identity),n.tracks.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(De.ParticipantDisconnected,n))}acquireAudioContext(){var e,n;return ue(this,void 0,void 0,function*(){if(typeof this.options.expWebAudioMix!="boolean"&&this.options.expWebAudioMix.audioContext?this.audioContext=this.options.expWebAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=kq())!==null&&e!==void 0?e:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(i){ie.warn(i)}this.options.expWebAudioMix&&this.participants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(De.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){let r;return n?r=Uy.fromParticipantInfo(this.engine.client,n):r=new Uy(this.engine.client,e,"",void 0,void 0),this.options.expWebAudioMix&&r.setAudioContext(this.audioContext),r}getOrCreateParticipant(e,n){if(this.participants.has(e))return this.participants.get(e);const r=this.createParticipant(e,n);return this.participants.set(e,r),this.identityToSid.set(n.identity,n.sid),this.emitWhenConnected(De.ParticipantConnected,r),r.on(Qe.TrackPublished,i=>{this.emitWhenConnected(De.TrackPublished,i,r)}).on(Qe.TrackSubscribed,(i,o)=>{i.kind===Ee.Kind.Audio&&(i.on(Ue.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(Ue.AudioPlaybackFailed,this.handleAudioPlaybackFailed)),this.emit(De.TrackSubscribed,i,o,r)}).on(Qe.TrackUnpublished,i=>{this.emit(De.TrackUnpublished,i,r)}).on(Qe.TrackUnsubscribed,(i,o)=>{this.emit(De.TrackUnsubscribed,i,o,r)}).on(Qe.TrackSubscriptionFailed,i=>{this.emit(De.TrackSubscriptionFailed,i,r)}).on(Qe.TrackMuted,i=>{this.emitWhenConnected(De.TrackMuted,i,r)}).on(Qe.TrackUnmuted,i=>{this.emitWhenConnected(De.TrackUnmuted,i,r)}).on(Qe.ParticipantMetadataChanged,i=>{this.emitWhenConnected(De.ParticipantMetadataChanged,i,r)}).on(Qe.ParticipantNameChanged,i=>{this.emitWhenConnected(De.ParticipantNameChanged,i,r)}).on(Qe.ConnectionQualityChanged,i=>{this.emitWhenConnected(De.ConnectionQualityChanged,i,r)}).on(Qe.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(De.ParticipantPermissionsChanged,i,r)}).on(Qe.TrackSubscriptionStatusChanged,(i,o)=>{this.emitWhenConnected(De.TrackSubscriptionStatusChanged,i,o,r)}).on(Qe.TrackSubscriptionFailed,(i,o)=>{this.emit(De.TrackSubscriptionFailed,i,r,o)}).on(Qe.TrackSubscriptionPermissionChanged,(i,o)=>{this.emitWhenConnected(De.TrackSubscriptionPermissionChanged,i,o,r)}),n&&r.updateInfo(n),r}sendSyncState(){var e,n;if(this.engine.subscriber===void 0||this.engine.subscriber.pc.localDescription===null)return;const r=this.engine.subscriber.pc.localDescription,i=this.engine.subscriber.pc.remoteDescription,o=(n=(e=this.connOptions)===null||e===void 0?void 0:e.autoSubscribe)!==null&&n!==void 0?n:!0,s=new Array;this.participants.forEach(a=>{a.tracks.forEach(u=>{u.isDesired!==o&&s.push(u.trackSid)})}),this.engine.client.sendSyncState(new Xa({answer:jw({sdp:r.sdp,type:r.type}),offer:i?jw({sdp:i.sdp,type:i.type}):void 0,subscription:new ps({trackSids:s,subscribe:!o,participantTracks:[]}),publishTracks:this.localParticipant.publishedTracksInfo(),dataChannels:this.localParticipant.dataChannelsInfo()}))}updateSubscriptions(){for(const e of this.participants.values())for(const n of e.videoTracks.values())n.isSubscribed&&n instanceof zq&&n.emitTrackUpdate()}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=ui.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,ie.warn("detected connection state mismatch",{numFailures:e}),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Tc.STATE_MISMATCH))):e=0},fCe)}clearConnectionReconcile(){this.connectionReconcileInterval&&ui.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(De.ConnectionStateChanged,this.state),!0)}emitWhenConnected(e){if(this.state===nn.Connected){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.emit(e,...r)}return!1}simulateParticipants(e){var n,r;return ue(this,void 0,void 0,function*(){const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Qm({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:_t.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Io({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(De.SignalConnected),this.emit(De.Connected),this.setAndEmitConnectionState(nn.Connected),i.video){const s=new Gw(Ee.Kind.Video,new eo({source:jn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ai.AUDIO,name:"video-dummy"}),new Co(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:YB((n=160*o.aspectRatios[0])!==null&&n!==void 0?n:1,160,!0,!0)));this.localParticipant.addTrackPublication(s),this.localParticipant.emit(Qe.LocalTrackPublished,s)}if(i.audio){const s=new Gw(Ee.Kind.Audio,new eo({source:jn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ai.AUDIO}),new Hi(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:bT()));this.localParticipant.addTrackPublication(s),this.localParticipant.emit(Qe.LocalTrackPublished,s)}for(let s=0;s<o.count-1;s+=1){let a=new Io({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(s),state:Uf.ACTIVE,tracks:[],joinedAt:_t.parse(Date.now())});const u=this.getOrCreateParticipant(a.identity,a);if(o.video){const c=YB((r=160*o.aspectRatios[s%o.aspectRatios.length])!==null&&r!==void 0?r:1,160,!1,!0),l=new eo({source:jn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ai.AUDIO});u.addSubscribedMediaTrack(c,l.sid,new MediaStream([c])),a.tracks=[...a.tracks,l]}if(o.audio){const c=bT(),l=new eo({source:jn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ai.AUDIO});u.addSubscribedMediaTrack(c,l.sid,new MediaStream([c])),a.tracks=[...a.tracks,l]}u.updateInfo(a)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return e!==De.ActiveSpeakersChanged&&ie.debug("room event ".concat(e),{event:e,args:r}),super.emit(e,...r)}}var Vs;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Vs||(Vs={}));class tg extends yu.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Vs.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=e,this.token=n,this.name=this.constructor.name,this.room=new UP(r.roomOptions),this.connectOptions=r.connectOptions,r.errorsAsWarnings&&(this.errorsAsWarnings=r.errorsAsWarnings)}run(e){return ue(this,void 0,void 0,function*(){if(this.status!==Vs.IDLE)throw Error("check is running already");this.setStatus(Vs.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Vs.SKIPPED&&this.setStatus(this.isSuccess()?Vs.SUCCESS:Vs.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(){return ue(this,void 0,void 0,function*(){return this.room.state===nn.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return ue(this,void 0,void 0,function*(){this.room&&this.room.state!==nn.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Vs.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function Wq(t){var e,n;return ue(this,void 0,void 0,function*(){t??(t={}),(e=t.audio)!==null&&e!==void 0||(t.audio=!0),(n=t.video)!==null&&n!==void 0||(t.video=!0);const r=Cq(t,$q,Dq),i=zC(r),o=navigator.mediaDevices.getUserMedia(i);t.audio&&(Ei.userMediaPromiseMap.set("audioinput",o),o.catch(()=>Ei.userMediaPromiseMap.delete("audioinput"))),t.video&&(Ei.userMediaPromiseMap.set("videoinput",o),o.catch(()=>Ei.userMediaPromiseMap.delete("videoinput")));const s=yield o;return s.getTracks().map(a=>{const u=a.kind==="audio";u?t.audio:t.video;let c;const l=u?i.audio:i.video;typeof l!="boolean"&&(c=l),c?c.deviceId=a.getSettings().deviceId:c={deviceId:a.getSettings().deviceId};const d=Fq(a,c);return d.kind===Ee.Kind.Video?d.source=Ee.Source.Camera:d.kind===Ee.Kind.Audio&&(d.source=Ee.Source.Microphone),d.mediaStream=s,d})})}function jq(t){return ue(this,void 0,void 0,function*(){return(yield Wq({audio:!1,video:t}))[0]})}function hCe(t){return ue(this,void 0,void 0,function*(){return(yield Wq({audio:t,video:!1}))[0]})}class pCe extends tg{get description(){return"Can publish audio"}perform(){var e;return ue(this,void 0,void 0,function*(){const n=yield this.connect(),r=yield hCe();n.localParticipant.publishTrack(r),yield new Promise(s=>setTimeout(s,3e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let o=0;if(i.forEach(s=>{s.type==="outbound-rtp"&&s.mediaType==="audio"&&(o=s.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class mCe extends tg{get description(){return"Can publish video"}perform(){var e;return ue(this,void 0,void 0,function*(){const n=yield this.connect(),r=yield jq();n.localParticipant.publishTrack(r),yield new Promise(s=>setTimeout(s,3e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let o=0;if(i.forEach(s=>{s.type==="outbound-rtp"&&s.mediaType==="video"&&(o=s.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}}class gCe extends tg{get description(){return"Resuming connection after interruption"}perform(){var e;return ue(this,void 0,void 0,function*(){const n=yield this.connect();let r=!1,i=!1,o;const s=new Promise(u=>{setTimeout(u,5e3),o=u});n.on(De.Reconnecting,()=>{r=!0}).on(De.Reconnected,()=>{i=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const a=n.engine.client.onClose;if(a&&a(""),yield s,r){if(!i||n.state!==nn.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class vCe extends tg{get description(){return"Can connect via TURN"}perform(){var e,n;return ue(this,void 0,void 0,function*(){const r=new LP,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let o=!1,s=!1,a=!1;for(let u of i.iceServers)for(let c of u.urls)c.startsWith("turn:")?(s=!0,a=!0):c.startsWith("turns:")&&(s=!0,a=!0,o=!0),c.startsWith("stun:")&&(a=!0);a?s&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||s?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(u=>setTimeout(u,0)))})}}class yCe extends tg{get description(){return"Establishing WebRTC connection"}perform(){return ue(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(De.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,o)=>{if(i.candidate){const s=new RTCIceCandidate(i);let a="".concat(s.protocol," ").concat(s.address,":").concat(s.port," ").concat(s.type);s.address&&(bCe(s.address)?a+=" (private)":s.protocol==="tcp"&&s.tcpType==="passive"?(e=!0,a+=" (passive)"):s.protocol==="udp"&&(n=!0)),this.appendMessage(a)}r&&r(i,o)},this.room.engine.subscriber&&(this.room.engine.subscriber.pc.onicecandidateerror=i=>{i instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(i.errorCode," ").concat(i.errorText," ").concat(i.url))})});try{yield this.connect(),ie.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function bCe(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class xCe extends tg{get description(){return"Connecting to signal connection via WebSocket"}perform(){var e,n,r;return ue(this,void 0,void 0,function*(){(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new LP;const o=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Em.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=o.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class G9e extends yu.EventEmitter{constructor(e,n){super(),this.checkResults=new Map,this.url=e,this.token=n}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Vs.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Vs.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return ue(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token),i=s=>{this.updateCheck(n,s)};r.on("update",i);const o=yield r.run();return r.off("update",i),o})}checkWebsocket(){return ue(this,void 0,void 0,function*(){return this.createAndRunCheck(xCe)})}checkWebRTC(){return ue(this,void 0,void 0,function*(){return this.createAndRunCheck(yCe)})}checkTURN(){return ue(this,void 0,void 0,function*(){return this.createAndRunCheck(vCe)})}checkReconnect(){return ue(this,void 0,void 0,function*(){return this.createAndRunCheck(gCe)})}checkPublishAudio(){return ue(this,void 0,void 0,function*(){return this.createAndRunCheck(pCe)})}checkPublishVideo(){return ue(this,void 0,void 0,function*(){return this.createAndRunCheck(mCe)})}}const wCe=({handleCheatDetectedWarning:t,user:e})=>{const{isOpen:n,onOpen:r,onClose:i}=Xm(),o=A.useRef(null),[s,a]=A.useState(!0),[u,c]=A.useState(0),l=()=>{console.log("No button was clicked"),ir({isSuspicious:!1},"update_isSuspicious",e.id),i()};return A.useEffect(()=>{r();const d=10;c(5e3);const h=setInterval(()=>{c(p=>{const m=p-d;return m<=0?(clearInterval(h),a(!1),0):m})},d);return()=>clearInterval(h)},[]),P.jsx(P.Fragment,{children:s&&P.jsx(Jm,{motionPreset:"scale",size:/Android|iPhone/i.test(navigator.userAgent)?"xs":"lg",isOpen:n,leastDestructiveRef:o,onClose:i,children:P.jsx(fh,{children:P.jsxs(Ym,{children:[P.jsx(dh,{fontSize:"lg",fontWeight:"bold",children:"Misconduct Suspected!"}),P.jsxs(hh,{children:[`Misconduct suspected from student: ${e.name}`,P.jsx("br",{}),"View students camera?"]}),P.jsxs(lh,{children:[P.jsx(qn,{ref:o,onClick:l,children:"No"}),P.jsx(qn,{colorScheme:"red",onClick:()=>{t(),l()},ml:3,children:"Yes"})]}),P.jsx(Vc,{size:"xs",value:u/5e3*100,position:"relative",width:"100%",bottom:"0",colorScheme:"red"})]})})})})},SCe=()=>{const t=k0(),e=oh(),[n,r]=A.useState(null),[i,o]=A.useState(!0),[s,a]=A.useState(!1),[u,c]=A.useState(null),[l,d]=A.useState({}),[f,h]=A.useState(""),{data:p,loading:m,error:v}=iC(),[g,y]=A.useState(!1),[b,x]=A.useState(null),[S,C]=A.useState({});PP(!0,!0),BC("student");const[T,E]=A.useState(null),I=2e3;A.useEffect(()=>{setTimeout(()=>{o(!1)},1500)},[]),A.useEffect(()=>{(async()=>{try{const F=await fetch(`https://eyedentify-69d961d5a478.herokuapp.com/api/get_staff_token/${nt.id}`);if(!F.ok)throw new Error("Network response was not ok "+F.statusText);const H=await F.json();E(H.token)}catch(F){console.error("Error fetching the token:",F)}})()},[nt.id]),A.useEffect(()=>{(async()=>{try{let F=function(J){J.tracks.forEach(ne=>{ne.track&&H(ne.track,ne,J)})},H=function(J,ne,oe){if(J.kind===Ee.Kind.Video){const q=parseInt(oe.identity),Z=new MediaStream;Z.addTrack(J.mediaStreamTrack),C(se=>({...se,[q]:Z}))}};const G=new UP({adaptiveStream:!0,dynacast:!0,disconnectOnPageLeave:!1,videoCaptureDefaults:{facingMode:"user"}});x(G),G.prepareConnection("wss://eyedentify-90kai7lw.livekit.cloud",T),await G.connect("wss://eyedentify-90kai7lw.livekit.cloud",T),console.log("connected to room",G.name),G.on(De.Disconnected,CCe).on(De.TrackSubscribed,H),G.participants.forEach(F),G.on(De.ParticipantDisconnected,J=>{console.log(`${J.identity} has left the room`);const ne=parseInt(J.identity);e("/teacher"),C(oe=>({...oe,[ne]:"DISCONNECTED"}))})}catch{console.error("Error connecting to room:",b)}})()},[T!==null]),A.useEffect(()=>{g&&console.log("Current room instance:",b)},[g]),A.useEffect(()=>{t.pathname==="/teacher"&&a(!1)},[t]),A.useEffect(()=>{a(!1)},[]),A.useEffect(()=>{const $=Date.now();let F=u,H=l[F]||0;for(let J of p)if(S[J.id]&&J.id!==u){const ne=l[J.id]||$;d(oe=>({...oe,[J.id]:ne})),ne>H&&(H=ne,F=J.id)}const G=setTimeout(()=>{c(F)},I);return()=>clearTimeout(G)},[S,p,u,l]),A.useEffect(()=>{const $=()=>{if(p.find(H=>H.isSuspicious)){const H=p.find(G=>G.isSuspicious===!0);r(H),setTimeout(()=>{ir({isSuspicious:!1},"update_isSuspicious",n.id),r(null)},5e3)}},F=setInterval(()=>{$()},1e3);return()=>clearInterval(F)},[p]);const N=()=>{a(!0),e(`/teacher/${n.id}`),ir({isSuspicious:!1},"update_isSuspicious",n.id)};return P.jsx(MC.Provider,{value:S,children:P.jsxs(P.Fragment,{children:[P.jsxs(Uc,{w:"100%",justifyContent:"space-between",alignItems:"center",children:[P.jsx(Et,{paddingLeft:"20px",children:P.jsx(LC,{color:"#81E6D9",size:/Android|iPhone/i.test(navigator.userAgent)?"2.5em":"3em"})}),P.jsx(ua,{padding:"10px",marginLeft:/Android|iPhone/i.test(navigator.userAgent)?"-6px":"",marginBottom:/Android|iPhone/i.test(navigator.userAgent)?"":1,overflow:"hidden",size:/Android|iPhone/i.test(navigator.userAgent)?"lg":"xl",children:s?f:"Participants"}),P.jsx(DC,{}),P.jsx(qn,{marginRight:"10px",hidden:!s,fontSize:/Android|iPhone/i.test(navigator.userAgent)?"xs":"",onClick:()=>{a(!1),e("/teacher")},bgColor:"gray.600",size:/Android|iPhone/i.test(navigator.userAgent)?"sm":"md",children:/Android|iPhone/i.test(navigator.userAgent)?"Back ":"Go Back"}),P.jsx(Et,{marginRight:/Android|iPhone/i.test(navigator.userAgent)?"14px":"30px",children:P.jsx(Yxe,{handleLogout:()=>e("/")})})]}),P.jsx(Xie,{}),P.jsx(Et,{padding:"10px",paddingBottom:"0px",children:P.jsx("hr",{hidden:!s})}),/Android|iPhone/i.test(navigator.userAgent)?P.jsx(P.Fragment,{}):P.jsx(y8,{}),n!==null&&P.jsx(wCe,{handleCheatDetectedWarning:N,user:n}),i?P.jsx(Et,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:P.jsx(ch,{thickness:"4px",size:"xl",color:"teal"})}):P.jsx(KH,{paddingTop:s?"10px":"0px",paddingLeft:"10px",paddingRight:"10px",templateColumns:s?{lg:"repeat(10, 1fr)",md:"repeat(5, 1fr)",sm:"repeat(4, 1fr)"}:{lg:"repeat(5, 1fr)",md:"repeat(3, 1fr)",sm:"repeat(2, 1fr)"},gap:4,style:s?{width:"calc(100% - 10px)",margin:"0 auto"}:{},children:p.sort(($,F)=>$.id===u?-1:F.id===u||S[F.id]?1:S[$.id]?-1:0).map($=>$.userType!=="student"||$.terminated===!0||s&&f===$.name?null:P.jsx(YH,{_hover:{transform:"scale(1.03)",transition:"transform 0.1s"},borderRadius:"10px",cursor:S[$.id]&&S[$.id]!=="DISCONNECTED"?"pointer":"auto",onClick:()=>{S[$.id]&&S[$.id]!=="DISCONNECTED"&&(a(!0),h($.name),e(`/teacher/${$.id}`))},children:s?f===$.name?P.jsx(P.Fragment,{}):P.jsx(Zxe,{name:$.name,ready:$.ready,warnings:$.warnings,id:$.id,loading:!S[$.id],disconnected:S[$.id]==="DISCONNECTED"}):P.jsx(Qxe,{name:$.name,ready:$.ready,warnings:$.warnings,id:$.id,loading:!S[$.id],disconnected:S[$.id]==="DISCONNECTED"})},$.id))}),P.jsx(B0,{bottomVal:0})]})})};function CCe(){console.log("disconnected from room")}const kCe=({handleTerminate:t})=>{const{isOpen:e,onOpen:n,onClose:r}=Xm(),i=A.useRef(null),o=()=>{t(),r()};return P.jsxs(P.Fragment,{children:[P.jsx(qn,{colorScheme:"teal",variant:"outline",borderColor:"teal.500",onClick:n,children:"Finish Exam"}),P.jsx(Jm,{motionPreset:"scale",isOpen:e,leastDestructiveRef:i,onClose:r,children:P.jsx(fh,{children:P.jsxs(Ym,{children:[P.jsx(dh,{fontSize:"lg",fontWeight:"bold",children:"End Exam"}),P.jsx(hh,{children:"Are you sure? You can't join this exam session again and your results will be submitted."}),P.jsxs(lh,{children:[P.jsx(qn,{ref:i,onClick:r,children:"No"}),P.jsx(qn,{colorScheme:"red",onClick:o,ml:3,children:"Yes"})]})]})})})]})},Gq=(t,e)=>{A.useEffect(()=>{new Audio("/sounds/warning.mp3").play();const r=3e3,i=Date.now();function o(){const s=Date.now()-i;s>=r?(t(0),e(!1)):(t(r-s),requestAnimationFrame(o))}return requestAnimationFrame(o),()=>{}},[])},TCe=({user:t})=>{const[e,n]=A.useState(!0),[r,i]=A.useState(0);return Gq(i,n),P.jsx(P.Fragment,{children:e&&P.jsxs(Et,{width:"50%",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"warning",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Warning"}),P.jsxs(Fc,{flex:"1",children:["You have been warned for:",P.jsx("br",{}),t.warningOne,P.jsx("br",{}),"You may be terminated from your exam."]})]}),P.jsx(Vc,{size:"xs",value:r/3e3*100,position:"relative",width:"100%",bottom:"0",colorScheme:"red"})]})})},ECe=({user:t})=>{const[e,n]=A.useState(!0),[r,i]=A.useState(0);return Gq(i,n),P.jsx(P.Fragment,{children:e&&P.jsxs(Et,{width:"50%",position:"relative",margin:"auto",display:"block",marginBottom:"10px",children:[P.jsxs(Bc,{display:"flex",width:"100%",status:"error",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",children:[P.jsx(Lc,{}),P.jsx(Mc,{mr:2,children:"Final Warning"}),P.jsxs(Fc,{flex:"1",children:["You have been warned for:",P.jsx("br",{}),t.warningTwo,P.jsx("br",{}),"This is your last chance to complete your exam and avoid exam termination."]})]}),P.jsx(Vc,{size:"xs",value:r/3e3*100,position:"relative",width:"100%",bottom:"0",colorScheme:"red"})]})})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Hq=function(t,e){return(Hq=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])})(t,e)};function fa(t,e){function n(){this.constructor=t}Hq(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function We(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(c){try{u(r.next(c))}catch(l){o(l)}}function a(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?i(c.value):new n(function(l){l(c.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function je(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){s=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(l[0]===6&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(d){l=[6,d],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var _Ce=function(){function t(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(e,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=e,this.platform=n},t.prototype.registerFlag=function(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},t.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},t.prototype.getNumber=function(e){return this.get(e)},t.prototype.getBool=function(e){return this.get(e)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(e,n){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)},t.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},t.prototype.setFlags=function(e){this.flags=Object.assign({},e)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,i=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return ICe(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0],u=s[1];e.urlFlags[a]=function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(a,u)})}},t}();function ICe(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function me(){return qq}var qq=null,Hw=new Map,CI=new Map;function Kq(t,e){var n=Jq(t,e);return Hw.get(n)}function RCe(t){return CI.get(t)}function yU(t){for(var e=Hw.entries(),n=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var s=o[0],a=o[1];s.split("_")[0]===t&&n.push(a)}return n}function Xq(t){var e=t.kernelName,n=t.backendName,r=Jq(e,n);if(Hw.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");Hw.set(r,t)}function NCe(t){var e=t.kernelName;CI.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),CI.set(e,t)}function Jq(t,e){return e+"_"+t}function kI(t,e,n){return Math.max(t,Math.min(e,n))}function Yq(t){return t%2==0?t:t+1}function PCe(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function V(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Xt(t,e,n){n===void 0&&(n=""),V(Cr(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function ng(t){V(t!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Im(t,e,n){if(e===void 0&&(e=[]),n===void 0&&(n=!1),e==null&&(e=[]),Array.isArray(t)||ou(t)&&!n)for(var r=0;r<t.length;++r)Im(t[r],e,n);else e.push(t);return e}function Ke(t){if(t.length===0)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function Cr(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Vn(t){return t%1==0}function ACe(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function TI(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Zp(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function bU(t,e,n){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(t())r();else{o++;var a=e(o);n!=null&&o>=n?i():setTimeout(s,a)}};s()})}function $Ce(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(r===-1){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(n===0)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o}function mr(t,e){var n=e.length;return V((t=t==null?e.map(function(r,i){return i}):[].concat(t)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),V(t.every(function(r){return Vn(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?n+r:r})}function nf(t,e){for(var n=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:mr(e,t).sort(),s=0,a=0;a<t.length;++a){if(o!=null){if(o[s]===a&&t[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(o[s]==null||o[s]>a)&&t[a]===1&&(n.push(t[a]),r.push(a)),o[s]<=a&&s++}t[a]!==1&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function Vy(t,e){var n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else{if(t!=="bool")throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function qw(t,e){var n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else{if(t!=="string")throw new Error("Unknown data type "+t);n=new Array(e)}return n}function DCe(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function OCe(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function FCe(t,e){return e!=="complex64"&&(e!=="float32"||t==="complex64")&&(e!=="int32"||t==="float32"||t==="complex64")&&(e!=="bool"||t!=="bool")}function ou(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Qq(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error("Unknown dtype "+t)}function LCe(t){if(t==null)return 0;var e=0;return t.forEach(function(n){return e+=n.length}),e}function VP(t){return typeof t=="string"||t instanceof String}function MCe(t){return typeof t=="boolean"}function BCe(t){return typeof t=="number"}function U0(t){return Array.isArray(t)?U0(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":BCe(t)?"float32":VP(t)?"string":MCe(t)?"bool":"float32"}function EI(t){return!!(t&&t.constructor&&t.call&&t.apply)}function _I(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function su(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Zq(t,e,n){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Im(t)),n&&DCe(t,e),function(o,s){return o instanceof Float32Array&&s==="float32"||o instanceof Int32Array&&s==="int32"||o instanceof Uint8Array&&s==="bool"}(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)Math.round(t[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function xU(t,e){if(t.length===0)return e[0];var n=t.reduce(function(r,i){return r*i});if(n===0)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(o.length===1)for(var u=o[0],c=0;c<u;c++)a[c]=s[i+c];else{u=o[0];var l=o.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)a[c]=r(i+c*d,l,s)}return a}(0,t,e)}function e7(t,e){for(var n=V0(t,e),r=0;r<n.length;r++)n[r]=1;return n}function V0(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Pa(){return me().platform.now()}function t7(t){t.forEach(function(e){V(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function UCe(t,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",me().platform.encode(t,e)}function Kw(t,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",me().platform.decode(t,e)}function wU(t,e,n){if(e===0)return 0;if(e===1)return t[0];for(var r=t[t.length-1],i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function VCe(t,e,n){if(e===0)return[];if(e===1)return[t];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}var zCe=function(){function t(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new WCe)}return t.prototype.profileKernel=function(e,n,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(c,l,d){if(l!=="float32")return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,a.dtype,e),s.then(function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,u,c.kernelMs,n,l)})})}),i},t}(),WCe=function(){function t(){}return t.prototype.logKernelProfile=function(e,n,r,i,o,s){var a=typeof i=="number"?Zp(i+"ms",9):i.error,u=Zp(e,25),c=n.rank,l=n.size,d=Zp(n.shape.toString(),14),f="";for(var h in o){var p=o[h].shape||n.shape,m=p.length;f+=h+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"	%c"+a+"	%c"+c+"D "+d+"	%c"+l+"	%c"+f+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),SU=20,Zg=3,kT=7;function jCe(t,e,n,r){var i=su(e),o=function(c,l,d,f){var h=Ke(l),p=f[f.length-1],m=new Array(p).fill(0),v=l.length,g=d==="complex64"?tv(c):c;if(v>1)for(var y=0;y<h/p;y++)for(var b=y*p,x=0;x<p;x++)m[x]=Math.max(m[x],ev(g[b+x],0,d).length);return m}(t,e,n,i),s=e.length,a=function c(l,d,f,h,p,m){m===void 0&&(m=!0);var v=f==="complex64"?2:1,g=d[0],y=d.length;if(y===0)return f==="complex64"?[ev(tv(l)[0],0,f)]:f==="bool"?[n7(l[0])]:[l[0].toString()];if(y===1){if(g>SU){var b=Zg*v,x=Array.from(l.slice(0,b)),S=Array.from(l.slice((g-Zg)*v,g*v));return f==="complex64"&&(x=tv(x),S=tv(S)),["["+x.map(function(J,ne){return ev(J,p[ne],f)}).join(", ")+", ..., "+S.map(function(J,ne){return ev(J,p[g-Zg+ne],f)}).join(", ")+"]"]}return["["+(f==="complex64"?tv(l):Array.from(l)).map(function(J,ne){return ev(J,p[ne],f)}).join(", ")+"]"]}var C=d.slice(1),T=h.slice(1),E=h[0]*v,I=[];if(g>SU){for(var N=0;N<Zg;N++){var $=(F=N*E)+E;I.push.apply(I,c(l.slice(F,$),C,f,T,p,!1))}for(I.push("..."),N=g-Zg;N<g;N++)$=(F=N*E)+E,I.push.apply(I,c(l.slice(F,$),C,f,T,p,N===g-1))}else for(N=0;N<g;N++){var F;$=(F=N*E)+E,I.push.apply(I,c(l.slice(F,$),C,f,T,p,N===g-1))}var H=y===2?",":"";for(I[0]="["+I[0]+H,N=1;N<I.length-1;N++)I[N]=" "+I[N]+H;var G=`,
`;for(N=2;N<y;N++)G+=`
`;return I[I.length-1]=" "+I[I.length-1]+"]"+(m?"":G),I}(t,e,n,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+s),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(a.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function ev(t,e,n){return Zp(Array.isArray(t)?parseFloat(t[0].toFixed(kT))+" + "+parseFloat(t[1].toFixed(kT))+"j":VP(t)?"'"+t+"'":n==="bool"?n7(t):parseFloat(t.toFixed(kT)).toString(),e)}function n7(t){return t===0?"false":"true"}function tv(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var zy=function(){function t(e,n,r){var i=this;if(this.dtype=n,this.shape=e.slice(),this.size=Ke(e),r!=null){var o=r.length;V(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||qw(n,this.size),this.strides=su(e)}return t.prototype.set=function(e){for(var n=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),V(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var o=this.locToIndex(r);this.values[o]=e},t.prototype.get=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=e[e.length-1],c=0;c<e.length-1;++c)u+=this.strides[c]*e[c];return this.values[u]},t.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return n},t.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(e/this.strides[r]),e-=n[r]*this.strides[r];return n[n.length-1]=e,n},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Da().makeTensor(this.values,this.shape,this.dtype)},t}(),Da=null,he=null,r7=null,Nn=function(){function t(e,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=Ke(e),this.strides=su(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),V(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(e,n){return this.throwIfDisposed(),this.reshape([e,n])},t.prototype.as3D=function(e,n,r){return this.throwIfDisposed(),this.reshape([e,n,r])},t.prototype.as4D=function(e,n,r,i){return this.throwIfDisposed(),this.reshape([e,n,r,i])},t.prototype.as5D=function(e,n,r,i,o){return this.throwIfDisposed(),this.reshape([e,n,r,i,o])},t.prototype.asType=function(e){return this.throwIfDisposed(),he.cast(this,e)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return We(this,void 0,void 0,function(){var e;return je(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return e=n.sent(),[2,he.buffer(this.shape,this.dtype,e)]}})})},t.prototype.bufferSync=function(){return he.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return We(this,void 0,void 0,function(){var e;return je(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return e=n.sent(),[2,xU(this.shape,e)]}})})},t.prototype.arraySync=function(){return xU(this.shape,this.dataSync())},t.prototype.data=function(){return We(this,void 0,void 0,function(){var e,n;return je(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Da().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:n=r.sent();try{return[2,n.map(function(i){return Kw(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var e=Da().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(n){return Kw(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},t.prototype.bytes=function(){return We(this,void 0,void 0,function(){var e;return je(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,Da().read(this.dataId)];case 1:return e=n.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(Da().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(e){return e===void 0&&(e=!1),he.print(this,e)},t.prototype.reshape=function(e){return this.throwIfDisposed(),he.reshape(this,e)},t.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},t.prototype.expandDims=function(e){return e===void 0&&(e=0),he.expandDims(this,e)},t.prototype.cumsum=function(e,n,r){return e===void 0&&(e=0),n===void 0&&(n=!1),r===void 0&&(r=!1),he.cumsum(this,e,n,r)},t.prototype.squeeze=function(e){return this.throwIfDisposed(),he.squeeze(this,e)},t.prototype.clone=function(){return this.throwIfDisposed(),he.clone(this)},t.prototype.oneHot=function(e,n,r){return this.throwIfDisposed(),he.oneHot(this,e,n,r)},t.prototype.toString=function(e){return e===void 0&&(e=!1),jCe(this.dataSync(),this.shape,this.dtype,e)},t.prototype.tile=function(e){return this.throwIfDisposed(),he.tile(this,e)},t.prototype.gather=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),he.gather(this,e,n)},t.prototype.matMul=function(e,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),he.matMul(this,e,n,r)},t.prototype.dot=function(e){return this.throwIfDisposed(),he.dot(this,e)},t.prototype.norm=function(e,n,r){return e===void 0&&(e="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),he.norm(this,e,n,r)},t.prototype.slice=function(e,n){return this.throwIfDisposed(),he.slice(this,e,n)},t.prototype.reverse=function(e){return this.throwIfDisposed(),he.reverse(this,e)},t.prototype.concat=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),he.concat([this].concat(e),n)},t.prototype.split=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),he.split(this,e,n)},t.prototype.stack=function(e,n){return n===void 0&&(n=0),he.stack([this,e],n)},t.prototype.unstack=function(e){return e===void 0&&(e=0),he.unstack(this,e)},t.prototype.pad=function(e,n){return n===void 0&&(n=0),he.pad(this,e,n)},t.prototype.batchNormalization=function(e,n,r,i,o){return r===void 0&&(r=.001),r7("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,n,o,i,r)},t.prototype.batchNorm=function(e,n,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),he.batchNorm(this,e,n,r,i,o)},t.prototype.all=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.all(this,e,n)},t.prototype.any=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.any(this,e,n)},t.prototype.logSumExp=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.logSumExp(this,e,n)},t.prototype.sum=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.sum(this,e,n)},t.prototype.prod=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.prod(this,e,n)},t.prototype.mean=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.mean(this,e,n)},t.prototype.min=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.min(this,e,n)},t.prototype.max=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.max(this,e,n)},t.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),he.argMin(this,e)},t.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),he.argMax(this,e)},t.prototype.cast=function(e){return this.throwIfDisposed(),he.cast(this,e)},t.prototype.add=function(e){return this.throwIfDisposed(),he.add(this,e)},t.prototype.addStrict=function(e){return this.throwIfDisposed(),he.addStrict(this,e)},t.prototype.atan2=function(e){return this.throwIfDisposed(),he.atan2(this,e)},t.prototype.sub=function(e){return this.throwIfDisposed(),he.sub(this,e)},t.prototype.subStrict=function(e){return this.throwIfDisposed(),he.subStrict(this,e)},t.prototype.pow=function(e){return this.throwIfDisposed(),he.pow(this,e)},t.prototype.powStrict=function(e){return this.throwIfDisposed(),he.powStrict(this,e)},t.prototype.mul=function(e){return this.throwIfDisposed(),he.mul(this,e)},t.prototype.mulStrict=function(e){return this.throwIfDisposed(),he.mulStrict(this,e)},t.prototype.div=function(e){return this.throwIfDisposed(),he.div(this,e)},t.prototype.divNoNan=function(e){return this.throwIfDisposed(),he.divNoNan(this,e)},t.prototype.floorDiv=function(e){return this.throwIfDisposed(),he.floorDiv(this,e)},t.prototype.divStrict=function(e){return this.throwIfDisposed(),he.divStrict(this,e)},t.prototype.minimum=function(e){return this.throwIfDisposed(),he.minimum(this,e)},t.prototype.minimumStrict=function(e){return this.throwIfDisposed(),he.minimumStrict(this,e)},t.prototype.maximum=function(e){return this.throwIfDisposed(),he.maximum(this,e)},t.prototype.maximumStrict=function(e){return this.throwIfDisposed(),he.maximumStrict(this,e)},t.prototype.mod=function(e){return this.throwIfDisposed(),he.mod(this,e)},t.prototype.modStrict=function(e){return this.throwIfDisposed(),he.modStrict(this,e)},t.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),he.squaredDifferenceStrict(this,e)},t.prototype.transpose=function(e){return this.throwIfDisposed(),he.transpose(this,e)},t.prototype.notEqual=function(e){return this.throwIfDisposed(),he.notEqual(this,e)},t.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),he.notEqualStrict(this,e)},t.prototype.less=function(e){return this.throwIfDisposed(),he.less(this,e)},t.prototype.lessStrict=function(e){return this.throwIfDisposed(),he.lessStrict(this,e)},t.prototype.equal=function(e){return this.throwIfDisposed(),he.equal(this,e)},t.prototype.equalStrict=function(e){return this.throwIfDisposed(),he.equalStrict(this,e)},t.prototype.lessEqual=function(e){return this.throwIfDisposed(),he.lessEqual(this,e)},t.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),he.lessEqualStrict(this,e)},t.prototype.greater=function(e){return this.throwIfDisposed(),he.greater(this,e)},t.prototype.greaterStrict=function(e){return this.throwIfDisposed(),he.greaterStrict(this,e)},t.prototype.greaterEqual=function(e){return this.throwIfDisposed(),he.greaterEqual(this,e)},t.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),he.greaterEqualStrict(this,e)},t.prototype.logicalAnd=function(e){return this.throwIfDisposed(),he.logicalAnd(this,e)},t.prototype.logicalOr=function(e){return this.throwIfDisposed(),he.logicalOr(this,e)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),he.logicalNot(this)},t.prototype.logicalXor=function(e){return this.throwIfDisposed(),he.logicalXor(this,e)},t.prototype.where=function(e,n){return this.throwIfDisposed(),he.where(e,this,n)},t.prototype.neg=function(){return this.throwIfDisposed(),he.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),he.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),he.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),he.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),he.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),he.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),he.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),he.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),he.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),he.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),he.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),he.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),he.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),he.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),he.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),he.abs(this)},t.prototype.clipByValue=function(e,n){return this.throwIfDisposed(),he.clipByValue(this,e,n)},t.prototype.relu=function(){return this.throwIfDisposed(),he.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),he.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),he.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),he.selu(this)},t.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),he.leakyRelu(this,e)},t.prototype.prelu=function(e){return this.throwIfDisposed(),he.prelu(this,e)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),he.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),he.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),he.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),he.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),he.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),he.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),he.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),he.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),he.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),he.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),he.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),he.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),he.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),he.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),he.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),he.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),he.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),he.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),he.round(this)},t.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),he.step(this,e)},t.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),he.softmax(this,e)},t.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),he.logSoftmax(this,e)},t.prototype.resizeBilinear=function(e,n){return n===void 0&&(n=!1),this.throwIfDisposed(),he.image.resizeBilinear(this,e,n)},t.prototype.resizeNearestNeighbor=function(e,n){return n===void 0&&(n=!1),this.throwIfDisposed(),he.image.resizeNearestNeighbor(this,e,n)},t.prototype.conv1d=function(e,n,r,i,o,s){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),he.conv1d(this,e,n,r,i,o,s)},t.prototype.conv2d=function(e,n,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),he.conv2d(this,e,n,r,i,o,s)},t.prototype.conv2dTranspose=function(e,n,r,i,o){return this.throwIfDisposed(),he.conv2dTranspose(this,e,n,r,i,o)},t.prototype.depthwiseConv2D=function(e,n,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),he.depthwiseConv2d(this,e,n,r,i,o,s)},t.prototype.separableConv2d=function(e,n,r,i,o,s){return o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),he.separableConv2d(this,e,n,r,i,o,s)},t.prototype.avgPool=function(e,n,r,i){return this.throwIfDisposed(),he.avgPool(this,e,n,r,i)},t.prototype.maxPool=function(e,n,r,i){return this.throwIfDisposed(),he.maxPool(this,e,n,r,i)},t.prototype.localResponseNormalization=function(e,n,r,i){return e===void 0&&(e=5),n===void 0&&(n=1),r===void 0&&(r=1),i===void 0&&(i=.5),he.localResponseNormalization(this,e,n,r,i)},t.prototype.pool=function(e,n,r,i,o){return this.throwIfDisposed(),he.pool(this,e,n,r,i,o)},t.prototype.variable=function(e,n,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Da().makeVariable(this,e,n,r)},t.prototype.unsortedSegmentSum=function(e,n){return this.throwIfDisposed(),he.unsortedSegmentSum(this,e,n)},t.prototype.batchToSpaceND=function(e,n){return this.throwIfDisposed(),he.batchToSpaceND(this,e,n)},t.prototype.spaceToBatchND=function(e,n){return this.throwIfDisposed(),he.spaceToBatchND(this,e,n)},t.prototype.topk=function(e,n){return e===void 0&&(e=1),n===void 0&&(n=!0),this.throwIfDisposed(),he.topk(this,e,n)},t.prototype.stridedSlice=function(e,n,r,i,o,s,a,u){return i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),this.throwIfDisposed(),he.stridedSlice(this,e,n,r,i,o,s,a,u)},t.prototype.depthToSpace=function(e,n){return this.throwIfDisposed(),he.depthToSpace(this,e,n)},t.prototype.fft=function(){return this.throwIfDisposed(),he.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),he.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),he.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),he.spectral.irfft(this)},t}();Object.defineProperty(Nn,Symbol.hasInstance,{value:function(t){return!!t&&t.dataId!=null&&t.shape!=null&&t.dtype!=null}});var CU,II,RI,NI,PI,Rm=function(t){function e(n,r,i,o){var s=t.call(this,n.shape,n.dtype,n.dataId,o)||this;return s.trainable=r,s.name=i,s}return fa(e,t),e.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!Cr(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Da().disposeTensor(this),this.dataId=n.dataId,Da().incRef(this,null)},e.prototype.dispose=function(){Da().disposeVariable(this),this.isDisposedInternal=!0},e}(Nn);Object.defineProperty(Rm,Symbol.hasInstance,{value:function(t){return t instanceof Nn&&t.assign!=null&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(CU||(CU={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(II||(II={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(RI||(RI={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(NI||(NI={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(PI||(PI={}));var GCe={float32:NI,int32:II,bool:RI,complex64:PI};function Lr(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error("Can not upcast "+t+" with "+e)}return GCe[t][e]}function TT(t){return Lr(t,"int32")}function On(t,e){if(t.dtype===e.dtype)return[t,e];var n=Lr(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function HCe(t,e){V(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function i7(t){var e=[];return function n(r,i,o){if(r!=null){if(r instanceof Nn)return void i.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,a=r;for(var u in a){var c=a[u];o.has(c)||(o.add(c),n(c,i,o))}}}}(t,e,new Set),e}var ET,kU=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},t}(),qCe=function(){function t(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new kU}return t.prototype.ready=function(){return We(this,void 0,void 0,function(){var e,n,r;return je(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),n=0,i.label=1;case 1:return n<e.length?(r=e[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),n=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},t.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},t.prototype.registerBackend=function(e,n,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:n,priority:r},!0)},t.prototype.setBackend=function(e){return We(this,void 0,void 0,function(){var n,r,i;return je(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(e),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new zCe(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var e=this;yU(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},t.prototype.disposeRegisteredKernels=function(e){var n=this;yU(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[e])})},t.prototype.initializeBackend=function(e){var n=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<n.pendingBackendInitId)&&(n.registry[e]=a,n.pendingBackendInit=null,!0)}).catch(function(a){return!(o<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return e.registryFactory[r].priority-e.registryFactory[n].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),n=0;n<e.length;n++){var r=e[n],i=this.initializeBackend(r),o=i.success,s=i.asyncInit;if(s||o)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(e,n){var r=this.state.tensorInfo.get(n),i=r.backend,o=this.readSync(n);i.disposeData(n),r.backend=e,e.move(n,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(e,n){var r,i=this,o=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(e,n,r){e();try{var i=r();return n(),i}catch(o){throw n(),o}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(e){var n=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[n],function(i){return{x:function(){return i.toFloat()}}},[]),n},t.prototype.runKernel=function(e,n,r,i,o){return this.runKernelFunc(null,n,null,e,r,i,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(e,n,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-o-s;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},t.prototype.runKernelFunc=function(e,n,r,i,o,s,a){var u,c=this;s===void 0&&(s=[]),a===void 0&&(a=[]);var l=[],d=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var f,h=function(y){d&&(l=y.map(function(b){return c.keep(c.clone(b))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,g=Kq(i,this.backendName);return f=g!=null?function(){var y=c.backend.numDataIds();v=g.kernelFunc({inputs:n,attrs:o,backend:c.backend});var b=Array.isArray(v)?v:[v];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,y,b);var x=b.map(function(C){var T=C.dataId,E=C.shape,I=C.dtype;return c.makeTensorFromDataId(T,E,I)}),S=x.filter(function(C,T){return a[T]});return h((s||[]).slice().concat(S)),x}:function(){var y=c.backend.numDataIds();v=c.tidy(function(){return e(c.backend,h)});var b=Array.isArray(v)?v:[v];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,y,b),b},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(i,n,function(){return f()}):f()}),d&&this.addTapeNode(i,n,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(y){return n[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(v)?u:u[0]},t.prototype.makeTensor=function(e,n,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&VP(e[0])&&(o=e.map(function(l){return UCe(l)}));var s=i.write(o,n,r),a=new Nn(n,r,s,this.nextTensorId());if(this.incRef(a,i),r==="string"){var u=this.state.tensorInfo.get(s),c=LCe(o);this.state.numBytes+=c-u.bytes,u.bytes=c}return a},t.prototype.makeTensorFromDataId=function(e,n,r,i){var o=new Nn(n,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},t.prototype.makeVariable=function(e,n,r,i){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Rm(e,n,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(e,n){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*Qq(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Rm||this.track(e)},t.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(e.dataId);n.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var n=this.state.registeredVariables[e];this.disposeVariable(n)}},t.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},t.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},t.prototype.profile=function(e){return We(this,void 0,void 0,function(){var n,r;return je(this,function(i){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},t.prototype.addTapeNode=function(e,n,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:o},u=RCe(e);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=function(c){return c=c.map(function(l,d){if(l==null){var f=r[d],h=V0(f.size,f.dtype);return s.makeTensor(h,f.shape,f.dtype)}return l}),i(c.length>1?c:c[0],o)}),this.state.activeTape.push(a)},t.prototype.keep=function(e){return e.kept=!0,e},t.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(e){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n},t.prototype.endScope=function(e){for(var n=this,r=i7(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||n.track(u)})},t.prototype.gradients=function(e,n,r,i){var o=this;if(i===void 0&&(i=!1),V(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});V(s instanceof Nn,function(){return"The result y returned by f() must be a tensor."});var a=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(C=u[h]).inputs;for(var m in p){for(var v=p[m],g=!1,y=0;y<c.length;y++)if(d[v.id]){C.outputs.forEach(function(N){return d[N.id]=!0}),g=!0,f[C.id]=!0;break}if(g)break}}var b={};b[l.id]=!0;var x={};for(h=u.length-1;h>=0;h--)for(p=(C=u[h]).inputs,y=0;y<C.outputs.length;y++)if(b[C.outputs[y].id]){for(var m in p)b[p[m].id]=!0,x[C.id]=!0;break}var S=[];for(h=0;h<u.length;h++){var C;if(f[(C=u[h]).id]&&x[C.id]){var T={};for(var m in C.inputs){var E=C.inputs[m];d[E.id]&&(T[m]=E)}var I=Object.assign({},C);I.inputs=T,I.outputs=C.outputs,S.push(I)}}return S}(this.state.activeTape,n,s);if(!i&&a.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[s.id]=r??(u=s.shape,c=e7(Ke(u),"float32"),ee.makeTensor(c,u,"float32")),function(f,h,p){for(var m=function(g){var y=h[g],b=[];if(y.outputs.forEach(function(T){var E=f[T.id];E!=null?b.push(E):b.push(null)}),y.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var x=y.gradient(b),S=function(T){if(!(T in x))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(x)+".");var E=p(function(){return x[T]()});if(E.dtype!=="float32")throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+E.dtype+"'");var I=y.inputs[T];if(!Cr(E.shape,I.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+T+"' has shape '"+E.shape+"', which does not match the shape of the input '"+I.shape+"'");if(f[I.id]==null)f[I.id]=E;else{var N=f[I.id];f[I.id]=N.add(E),N.dispose()}};for(var C in y.inputs)S(C)},v=h.length-1;v>=0;v--)m(v)}(l,a,function(f){return o.tidy(f)});var d=n.map(function(f){return l[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),o.state.activeTape=null),{value:s,grads:d}})},t.prototype.customGrad=function(e){var n=this;return V(EI(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];V(i.every(function(a){return a instanceof Nn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),n.runKernelFunc(function(a,u){return V((r=e.apply(void 0,i.concat([u]))).value instanceof Nn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),V(EI(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var c=r.gradFunc(a,u),l=Array.isArray(c)?c:[c];V(l.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),V(l.every(function(f){return f instanceof Nn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},t.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},t.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},t.prototype.time=function(e){return We(this,void 0,void 0,function(){var n,r;return je(this,function(i){switch(i.label){case 0:return n=Pa(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Pa()-n,[2,r]}})})},t.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new kU,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),ee=function(){var t=function(){if(ET==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}ET=n}return ET}();if(t._tfengine==null){var e=new _Ce(t);t._tfengine=new qCe(e)}return function(n){qq=n}(t._tfengine.ENV),Da=function(){return t._tfengine},t._tfengine}();function o7(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Au=me();Au.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Au.registerFlag("IS_BROWSER",function(){return o7()}),Au.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Au.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Au.registerFlag("PROD",function(){return!1}),Au.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Au.getBool("DEBUG")}),Au.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Au.registerFlag("IS_TEST",function(){return!1});var Wy,Ro,Eo,Yd={},_T={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function KCe(t,e){Yd[t]=e}function bu(t){t in Yd||(Yd[t]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Yd[n]},!1),n===1?r.getContext("webgl",_T)||r.getContext("experimental-webgl",_T):r.getContext("webgl2",_T)}(t));var e=Yd[t];return e.isContextLost()?(delete Yd[t],bu(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Yd[t])}function GC(t,e){return[e,t]}function Qv(t){var e=Ke(t);return TI(Math.ceil(e/4))}function z0(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function zP(t,e){var n,r,i,o,s,a,u,c,l,d=t;return me().getNumber("WEBGL_VERSION")===2?(n=d.R32F,r=d.R16F,i=d.RGBA16F,o=d.RGBA32F,s=d.RED,a=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(n=t.RGBA,r=t.RGBA,i=t.RGBA,o=d.RGBA,s=t.RGBA,a=4,u=4,c=e!=null?e.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Xe(t,e,n){var r=n();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+QCe(i,o))}(t),r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Wy||(Wy={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Ro||(Ro={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Eo||(Eo={}));var XCe=596e-10,JCe=65504;function YCe(t){return!!(me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||XCe<Math.abs(t)&&Math.abs(t)<JCe)}function QCe(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function w1(t,e,n){return Hc(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function ZCe(t,e,n){var r=Hc(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Xe(t,e,function(){return t.shaderSource(r,n)}),Xe(t,e,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function e2e(t,e,n){var r=Hc(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Xe(t,e,function(){return t.shaderSource(r,n)}),Xe(t,e,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw function(i,o){var s=t2e.exec(o);if(s==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split(`
`),c=u.length.toString().length+2,l=u.map(function(v,g){return Zp((g+1).toString(),c)+v}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,a-1),p=l.slice(a-1,a),m=l.slice(a);console.log(h.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+Zp(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var IT,RT,t2e=/ERROR: [0-9]+:([0-9]+):/g;function n2e(t,e){return Hc(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function r2e(t,e,n){if(Xe(t,e,function(){return t.linkProgram(n)}),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function NT(t,e,n){if(Xe(t,e,function(){return t.validateProgram(n)}),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function i2e(t,e,n){var r=Hc(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Xe(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Xe(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function o2e(t,e,n){var r=Hc(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Xe(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),Xe(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function s2e(t,e){return Hc(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function a2e(t,e){var n=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function u2e(t,e){return Hc(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function TU(t,e,n,r,i,o,s,a){var u=t.getAttribLocation(n,r);return u!==-1&&(Xe(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),Xe(t,e,function(){return t.vertexAttribPointer(u,o,t.FLOAT,!1,s,a)}),Xe(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function c2e(t,e,n,r){p2e(t,r),Xe(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),Xe(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function l2e(t,e,n,r){return Hc(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function d2e(t,e,n){return t.getUniformLocation(e,n)}function f2e(t,e,n,r,i,o){Xe(t,e,function(){return c2e(t,e,r,o)}),Xe(t,e,function(){return t.uniform1i(i,o)})}function PT(t,e,n,r){Xe(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),Xe(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function EU(t,e,n){Xe(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),Xe(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function S1(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+h2e(t,e))}function h2e(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Hc(t,e,n,r){var i=Xe(t,e,function(){return n()});if(i==null)throw new Error(r);return i}function p2e(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function Xw(t,e){return e===void 0&&(e=2),Ke(t.slice(0,t.length-e))}function Jw(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function AT(t){var e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Xw(t)].concat(Jw(t))),e}function m2e(t,e){var n;e===void 0&&(e=!1);var r=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(t=t.map(function(c,l){return l>=t.length-2?Yq(t[l]):t[l]})).length===1&&(t=[2,t[0]])),t.length!==2){var i=nf(t);t=i.newShape}var o=Ke(t);if(t.length<=1&&o<=r)return[1,o];if(t.length===2&&t[0]<=r&&t[1]<=r)return t;if(t.length===3&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var s=Xw(t),a=2,u=2;return t.length&&(a=(n=Jw(t))[0],u=n[1]),TI(o=s*(a/2)*(u/2)).map(function(c){return 2*c})}return TI(o)}function C1(t){return t%2==0}function k1(t,e){if(Cr(t=t.slice(-2),e=e.slice(-2))||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r||C1(n)&&C1(r)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&C1(t[0])&&C1(e[0])}function g2e(t){if(IT==null){var e=bu(t);IT=e.getParameter(e.MAX_TEXTURE_SIZE)}return IT}function v2e(t){if(RT==null){var e=bu(t);RT=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,RT)}function y2e(t){if(t===0)return 0;var e=bu(t);return gs(e,"EXT_disjoint_timer_query_webgl2")&&t===2?2:gs(e,"EXT_disjoint_timer_query")?1:0}function gs(t,e){return t.getExtension(e)!=null}function _U(t){try{if(bu(t)!=null)return!0}catch{return!1}return!1}function b2e(t){if(t===0)return!1;var e=bu(t);if(t===1){if(!gs(e,"OES_texture_float"))return!1}else if(!gs(e,"EXT_color_buffer_float"))return!1;return AI(e)}function x2e(t){if(t===0)return!1;var e=bu(t);if(t!==1){if(gs(e,"EXT_color_buffer_float"))return AI(e);if(gs(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=zP(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),u}(e,n)}return!1}return!!gs(e,"OES_texture_float")&&!!gs(e,"WEBGL_color_buffer_float")&&AI(e)}function AI(t){var e=zP(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function w2e(t){return t===2&&bu(t).fenceSync!=null}var dt=me();function s7(t){me().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Be(t,e){return ee.tidy(t,e)}function uo(t){i7(t).forEach(function(e){return e.dispose()})}function S2e(t){return ee.keep(t)}function Yw(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];me().getBool("IS_TEST")||console.warn.apply(console,t)}function kd(t,e){var n=t;if(ou(t))return e==="string"?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||ou(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&me().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],!Array.isArray(o)&&!ou(o))return void V(s.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"});V(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),V(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var u=s.slice(1),c=0;c<o.length;++c)i(o[c],u,a.concat(c))}(t,r,[]),r}function IU(t,e,n,r){if(t!=null&&(t!=="numeric"&&t!==e||t==="numeric"&&e==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function M(t,e,n,r){if(r===void 0&&(r="numeric"),t instanceof Nn)return IU(r,t.dtype,e,n),t;var i=U0(t);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),IU(r,i,e,n),t==null||!ou(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){var o=t==null?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+o+"'")}var s=kd(t,i);ou(t)||Array.isArray(t)||(t=[t]);var a=i!=="string"?Zq(t,i,me().getBool("DEBUG")):Im(t,[],!0);return ee.makeTensor(a,s,i)}function Qw(t,e,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(i,o){return M(i,e+"["+o+"]",n)},r)}function a7(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function C2e(t,e,n){for(var r=t.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)n.indexOf(a)===-1?i.push(t[o++]):i.push(e[s++]);return i}function ei(t,e){for(var n=[],r=t.length,i=0;i<r;i++)e.indexOf(i)===-1&&n.push(t[i]);return[n,e.map(function(o){return t[o]})]}function ho(t,e){return C2e(t,e.map(function(n){return 1}),e)}function To(t,e,n){V(a7(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function xu(t,e){if(a7(t,e))return null;for(var n=[],r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);return t.forEach(function(i){return n.push(i)}),n}function WP(t){return t.map(function(e,n){return[n,e]}).sort(function(e,n){return e[1]-n[1]}).map(function(e){return e[0]})}function wu(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function k2e(t,e){var n=t[0].length;t.forEach(function(i,o){V(i.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+n+")"})}),V(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(i,o){for(var s=0;s<n;s++)V(s===e||i[s]===r[s],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Nm(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Y(t){var e=Object.keys(t);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];ee.startScope(n);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ee.endScope(a),a}catch(u){throw ee.endScope(null),u}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}dt.registerFlag("HAS_WEBGL",function(){return dt.getNumber("WEBGL_VERSION")>0}),dt.registerFlag("WEBGL_VERSION",function(){return _U(2)?2:_U(1)?1:0}),dt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return dt.get("WEBGL_VERSION")===2}),dt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),dt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),dt.registerFlag("WEBGL_PACK",function(){return dt.getBool("HAS_WEBGL")}),dt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_CLIP",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),dt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_REDUCE",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_CONV_IM2COL",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return g2e(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return v2e(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=dt.getNumber("WEBGL_VERSION");return t===0?0:y2e(t)}),dt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return dt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),dt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return b2e(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!dt.getBool("WEBGL_FORCE_F16_TEXTURES")&&dt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),dt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return x2e(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return w2e(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return dt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),r7=s7;var Or=Y({complex_:function(t,e){var n=M(t,"real","complex"),r=M(e,"imag","complex");return Xt(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),ee.runKernelFunc(function(i){return i.complex(n,r)},{$real:n,$imag:r})}}),cs=Y({real_:function(t){var e=M(t,"input","real");return ee.runKernelFunc(function(n){return n.real(e)},{$input:e})}}),Oa=Y({imag_:function(t){var e=M(t,"input","imag");return ee.runKernelFunc(function(n){return n.imag(e)},{$input:e})}});function Br(t,e,n){return Td(t,e,kd(t,n),n)}function Td(t,e,n,r){if(r==null&&(r=U0(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ou(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){t7(e);var i=Ke(e),o=Ke(n);V(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<n.length;++s){var a=n[s],u=s!==n.length-1||a!==Ke(e.slice(s));V(n[s]===e[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return ou(t)||Array.isArray(t)||(t=[t]),e=e||n,t=r!=="string"?Zq(t,r,me().getBool("DEBUG")):Im(t,[],!0),ee.makeTensor(t,e,r)}function Oe(t,e){if((ou(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ou(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Td(t,[],[],e)}function Yn(t,e){ng(t);var n=kd(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Td(t,null,n,e)}function td(t,e,n){if(ng(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=kd(t,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Td(t,e,r,n)}function jP(t,e,n){if(ng(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=kd(t,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Td(t,e,r,n)}function Ji(t,e,n){if(ng(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=kd(t,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Td(t,e,r,n)}function T2e(t,e,n){if(ng(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=kd(t,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Td(t,e,r,n)}function E2e(t,e,n){if(ng(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=kd(t,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Td(t,e=e||r,r,n)}function _2e(t,e,n,r){return e===void 0&&(e=!0),ee.makeVariable(t,e,n,r)}function rg(t,e){if(e===void 0&&(e="float32"),e==="complex64"){var n=rg(t,"float32"),r=Cn(t,"float32");return Or(n,r)}var i=e7(Ke(t),e);return ee.makeTensor(i,t,e)}function Cn(t,e){if(e===void 0&&(e="float32"),e==="complex64"){var n=Cn(t,"float32"),r=Cn(t,"float32");return Or(n,r)}var i=V0(Ke(t),e);return ee.makeTensor(i,t,e)}function au(t,e,n){return ee.runKernelFunc(function(r){return r.fill(t,e,n)},{})}function I2e(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return ee.runKernelFunc(function(r){return r.linspace(t,e,n)},{})}function Zw(t,e,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return Cn([0],r);var i=V0(Math.abs(Math.ceil((e-t)/n)),r);e<t&&n===1&&(n=-1),i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return Yn(i,r)}var u7=Y({onesLike_:function(t){var e=M(t,"x","onesLike");if(e.dtype==="complex64"){var n=u7(cs(e)),r=$t(Oa(e));return Or(n,r)}return ee.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return $t(i)}}})}}),$t=Y({zerosLike_:function(t){var e=M(t,"x","zerosLike");return ee.runKernelFunc(function(n){return n.zerosLike(e)},{$x:e},function(n,r){return{$x:function(){return $t(n)}}})}}),cr=Y({concat_:function(t,e){e===void 0&&(e=0),V(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=Qw(t,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")}),e=mr(e,n[0].shape)[0];var r=Nm(n.map(function(a){return a.shape}),e);if(Ke(r)===0)return Br([],r);if((n=n.filter(function(a){return a.size>0})).length===1)return n[0];var i=n.map(function(a){return a.shape});k2e(i,e);var o=n,s={axis:e};return ee.runKernelFunc(function(a){return a.concat(n,e)},o,function(a){var u=i.map(function(c){return c[e]});return GP(a,u,e).map(function(c){return function(){return c}})},"Concat",s)}}),R2e=Y({concat1d_:function(t){return cr(t,0)}}),N2e=Y({concat2d_:function(t,e){return cr(t,e)}}),P2e=Y({concat3d_:function(t,e){return cr(t,e)}}),A2e=Y({concat4d_:function(t,e){return cr(t,e)}}),GP=Y({split_:function(t,e,n){n===void 0&&(n=0);var r,i=M(t,"x","split");return n=mr(n,i.shape)[0],typeof e=="number"?(V(i.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[n]/e)):(V(i.shape[n]===e.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),ee.runKernelFunc(function(o){return o.split(i,r,n)},{$x:i},function(o){return{$x:function(){return cr(o,n)}}})}});function mh(t,e){return t(e={exports:{}},e.exports),e.exports}var $2e=mh(function(t){(function(e,n,r){function i(a){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var d=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(a),c.s0<0&&(c.s0+=1),c.s1-=l(a),c.s1<0&&(c.s1+=1),c.s2-=l(a),c.s2<0&&(c.s2+=1),l=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new i(a),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.alea=s})(0,t,!1)}),D2e=mh(function(t){(function(e,n,r){function i(a){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},a===(0|a)?u.x=a:c+=a;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xor128=s})(0,t,!1)}),O2e=mh(function(t){(function(e,n,r){function i(a){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:c+=a;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xorwow=s})(0,t,!1)}),F2e=mh(function(t){(function(e,n,r){function i(a){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){a==null&&(a=+new Date);var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(l.x&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xorshift7=s})(0,t,!1)}),L2e=mh(function(t){(function(e,n,r){function i(a){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=f[h]=l^c,u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,m,v=[],g=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,g=Math.max(g,l.length)),h=0,p=-32;p<g;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),p===0&&(m=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(m=m+1640531527|0,h=(d=v[127&p]^=f+m)==0?h+1:0);for(h>=128&&(v[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=v[h+34&127],d=v[h=h+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,v[h]=f^d;c.w=m,c.X=v,c.i=h}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){a==null&&(a=+new Date);var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(l.X&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xor4096=s})(0,t,!1)}),M2e=mh(function(t){(function(e,n,r){function i(a){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):c+=a;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.tychei=s})(0,t,!1)}),Qd=mh(function(t){(function(e,n){var r,i=this,o=256,s=6,a="random",u=n.pow(o,s),c=n.pow(2,52),l=2*c,d=o-1;function f(g,y,b){var x=[],S=m(function E(I,N){var $,F=[],H=typeof I;if(N&&H=="object")for($ in I)try{F.push(E(I[$],N-1))}catch{}return F.length?F:H=="string"?I:I+"\0"}((y=y==1?{entropy:!0}:y||{}).entropy?[g,v(e)]:g??function(){try{var E;return r&&(E=r.randomBytes)?E=E(o):(E=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(E)),v(E)}catch{var I=i.navigator,N=I&&I.plugins;return[+new Date,i,N,i.screen,v(e)]}}(),3),x),C=new h(x),T=function(){for(var E=C.g(s),I=u,N=0;E<c;)E=(E+N)*o,I*=o,N=C.g(1);for(;E>=l;)E/=2,I/=2,N>>>=1;return(E+N)/I};return T.int32=function(){return 0|C.g(4)},T.quick=function(){return C.g(4)/4294967296},T.double=T,m(v(C.S),e),(y.pass||b||function(E,I,N,$){return $&&($.S&&p($,C),E.state=function(){return p(C,{})}),N?(n[a]=E,I):E})(T,S,"global"in y?y.global:this==n,y.state)}function h(g){var y,b=g.length,x=this,S=0,C=x.i=x.j=0,T=x.S=[];for(b||(g=[b++]);S<o;)T[S]=S++;for(S=0;S<o;S++)T[S]=T[C=d&C+g[S%b]+(y=T[S])],T[C]=y;(x.g=function(E){for(var I,N=0,$=x.i,F=x.j,H=x.S;E--;)I=H[$=d&$+1],N=N*o+H[d&(H[$]=H[F=d&F+I])+(H[F]=I)];return x.i=$,x.j=F,N})(o)}function p(g,y){return y.i=g.i,y.j=g.j,y.S=g.S.slice(),y}function m(g,y){for(var b,x=g+"",S=0;S<x.length;)y[d&S]=d&(b^=19*y[d&S])+x.charCodeAt(S++);return v(y)}function v(g){return String.fromCharCode.apply(0,g)}if(n["seed"+a]=f,m(n.random(),e),t.exports){t.exports=f;try{r=require("crypto")}catch{}}})([],Math)});Qd.alea=$2e,Qd.xor128=D2e,Qd.xorwow=O2e,Qd.xorshift7=F2e,Qd.xor4096=L2e,Qd.tychei=M2e;var HC=Qd.alea,HP=function(){function t(e,n,r,i,o){this.mean=e,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=HC(s.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var n,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s;while(a>=1||a===0);var u=Math.sqrt(-2*Math.log(a)/a);n=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(n)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},t.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},t.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},t}(),B2e=function(){function t(e,n,r,i){this.alpha=e,this.beta=1/n,this.dtype=r;var o=i||Math.random();this.randu=HC(o.toString()),this.randn=new HP(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var e,n,r,i,o,s;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,n=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-s+Math.log(s)),(o=this.randu())<n||Math.log(o)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},t.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},t}(),U2e=function(){function t(e,n,r,i){var o=this;if(e===void 0&&(e=0),n===void 0&&(n=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=n-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+n+" <= 1 and dtype is not float");this.random=HC(i)}return t.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function pt(t,e,n){return e===void 0&&(e="float32"),e=e||"float32",t7(t),new zy(t,e,n)}function V2e(t,e){e===void 0&&(e=!1),console.log(t.toString(e))}var c7=Y({batchToSpaceND_:function(t,e,n){var r=M(t,"x","batchToSpaceND"),i=e.reduce(function(o,s){return o*s});return V(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),V(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),V(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),ee.runKernelFunc(function(o){return o.batchToSpaceND(r,e,n)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,n)}}})}}),z2e=Y({broadcastTo_:function(t,e){var n=M(t,"broadcastTo","x"),r=n.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=n.reshape(i)}for(var o=Array.from(e),s=e.length-1;s>=0;s--)if(n.shape[s]===e[s])o[s]=1;else if(n.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=o.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return a.length===0?n.clone():ee.runKernelFunc(function(u){return u.tile(n,o)},{input:n},function(u){return{input:function(){return u.sum(a,!0)}}})}}),W2e=Y({cast_:function(t,e){var n=M(t,"x","cast");if(!OCe(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return ee.runKernelFunc(function(i){return i.cast(n,e)},{x:n},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),j2e=Y({clone_:function(t){var e=M(t,"x","clone",null);return ee.runKernelFunc(function(){return ee.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(n){return{$x:function(){return n.toFloat()}}})}}),G2e=Y({cumsum_:function(t,e,n,r){e===void 0&&(e=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var i=M(t,"x","cumsum"),o=xu([e|=0],i.rank),s=i;o!=null&&(s=i.transpose(o));var a=wu(1,i.rank)[0],u=ee.runKernelFunc(function(c){return c.cumsum(s,a,n,r)},{permutedX:s},function(c){return{permutedX:function(){return c.cumsum(e,n,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),H2e=Y({depthToSpace_:function(t,e,n){n===void 0&&(n="NHWC");var r=M(t,"x","depthToSpace"),i=n==="NHWC"?r.shape[1]:r.shape[2],o=n==="NHWC"?r.shape[2]:r.shape[3],s=n==="NHWC"?r.shape[3]:r.shape[1];return V(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),V(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),V(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape}),ee.runKernelFunc(function(a){return a.depthToSpace(r,e,n)},{$x:r})}}),us=Y({expandDims_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","expandDims",null);V(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(V(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),ta(n,r)}}),l7=Y({eye_:function(t,e,n,r){r===void 0&&(r="float32"),e==null&&(e=t);for(var i=pt([t,e],r),o=t<=e?t:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(t,e);if(n==null)return a;if(n.length===1)return em(us(a,0),[n[0],1,1]);if(n.length===2)return em(us(us(a,0),0),[n[0],n[1],1,1]);if(n.length===3)return em(us(us(us(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),q2e=Y({multinomial_:function(t,e,n,r){r===void 0&&(r=!1);var i=M(t,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);n=n||Math.random();var a=s===1?i.as2D(1,-1):i,u=ee.runKernelFunc(function(c){return c.multinomial(a,r,e,n)},{logits2D:a});return s===1?u.as1D():u}}),$I=Y({oneHot_:function(t,e,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=M(t,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),ee.runKernelFunc(function(s){return s.oneHot(i,e,n,r)},{$indices:i},function(s){return{$indices:function(){return Cn(i.shape,"float32")}}}).reshape(o)}}),gh=Y({pad_:function(t,e,n){n===void 0&&(n=0);var r=M(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:n};return ee.runKernelFunc(function(o){return o.pad(r,e,n)},{x:r},function(o){var s=e.map(function(a){return a[0]});return{x:function(){return o.slice(s,r.shape)}}},"PadV2",i)}}),K2e=Y({pad1d_:function(t,e,n){return n===void 0&&(n=0),V(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),gh(t,[e],n)}}),X2e=Y({pad2d_:function(t,e,n){return n===void 0&&(n=0),V(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),gh(t,e,n)}}),J2e=Y({pad3d_:function(t,e,n){return n===void 0&&(n=0),V(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),gh(t,e,n)}}),Y2e=Y({pad4d_:function(t,e,n){return n===void 0&&(n=0),V(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),gh(t,e,n)}}),Q2e=Y({rand_:function(t,e,n){var r=Ke(t),i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return ee.makeTensor(i,t,n)}}),Z2e=Y({randomNormal_:function(t,e,n,r,i){if(e===void 0&&(e=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new HP(e,n,r,!1,i),s=pt(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),eke=Y({randomGamma_:function(t,e,n,r,i){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new B2e(e,n,r,i),s=pt(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),d7=Y({randomUniform_:function(t,e,n,r,i){e===void 0&&(e=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var o=pt(t,r),s=new U2e(e,n,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),ta=Y({reshape_:function(t,e){var n=M(t,"x","reshape",null);e=$Ce(e,n.size),V(n.size===Ke(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return ee.runKernelFunc(function(i){return i.reshape(n,e)},{x:n},function(i){return{x:function(){return i.reshape(n.shape)}}},"Reshape",r)}}),f7=Y({spaceToBatchND_:function(t,e,n){var r=M(t,"x","spaceToBatchND");return V(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),V(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),V(r.shape.reduce(function(i,o,s){return s>0&&s<=e.length?i&&(o+n[s-1][0]+n[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),ee.runKernelFunc(function(i){return i.spaceToBatchND(r,e,n)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,n)}}})}}),h7=Y({squeeze_:function(t,e){var n=M(t,"x","squeeze");return ta(n,nf(n.shape,e).newShape)}}),Mo=Y({stack_:function(t,e){e===void 0&&(e=0);var n=Qw(t,"tensors","stack");if(V(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;V(e<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(a){Xt(i,a.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(a){V(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=n.map(function(a){return a.expandDims(e)});return cr(s,e)}}),em=Y({tile_:function(t,e){var n=M(t,"x","tile",null);V(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."});var r=[n],i={reps:e};return ee.runKernelFunc(function(o,s){var a=o.tile(n,e);return s([n]),a},{x:n},function(o,s){var a=s[0];return{x:function(){var u=$t(a);if(a.rank===1)for(var c=0;c<e[0];++c)u=u.add(o.slice([c*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(c=0;c<e[0];++c)for(var l=0;l<e[1];++l)u=u.add(o.slice([c*a.shape[0],l*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(c=0;c<e[0];++c)for(l=0;l<e[1];++l)for(var d=0;d<e[2];++d)u=u.add(o.slice([c*a.shape[0],l*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(c=0;c<e[0];++c)for(l=0;l<e[1];++l)for(d=0;d<e[2];++d)for(var f=0;f<e[3];++f)u=u.add(o.slice([c*a.shape[0],l*a.shape[1],d*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return u}}},"Tile",i,r)}}),tke=Y({truncatedNormal_:function(t,e,n,r,i){if(e===void 0&&(e=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new HP(e,n,r,!0,i),s=pt(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),lr=Y({unstack_:function(t,e){e===void 0&&(e=0),e=e||0;var n=M(t,"x","unstack");V(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length);var r={axis:e};return ee.runKernelFunc(function(i){return i.unstack(n,e)},{x:n},function(i){return{x:function(){return Mo(i,e)}}},"Unpack",r)}}),nke=function(t,e){return We(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,l,d;return je(this,function(f){switch(f.label){case 0:return n=M(t,"x","setdiff1d"),r=M(e,"y","setdiff1d"),V(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),V(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),V(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),s=new Set(o),a=0,l=0;l<i.length;l++)s.has(i[l])||a++;for(u=new zy([a],n.dtype),c=new zy([a],"int32"),l=0,d=0;l<i.length;l++)s.has(i[l])||(u.values[d]=i[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})};function eS(t,e,n,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([t[s+1]/e[s],e[s]]);i=i.concat(t.slice(o+1))}return i}function tS(t,e,n){n===void 0&&(n=!0);var r=[];if(n){r.push(e);for(var i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<t;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function nS(t,e,n,r){r===void 0&&(r=!0);var i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(var o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function p7(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function m7(t,e,n){for(var r=t.slice(0,1),i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}function g7(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(t.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],i=1,o=0;o<n.length-1;++o)i*=n[o];var s=t.shape,a=n.slice();a.pop();var u=1;for(o=r;o<t.rank;++o)u*=s[o],a.push(s[o]);var c=su(t.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[a,i,u,c]}var v7=30;function $T(t){return t<=v7?t:_I(t,Math.floor(Math.sqrt(t)))}function rke(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(o+" update.rank < "+i+". ");if(t.length<r+(n.rank-i))throw new Error(o+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(var s=0;s<i;++s)if(n.shape[s]!==e.shape[s])throw new Error(o+" updates.shape["+s+"] ("+n.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<n.rank-i;++s)if(n.shape[s+i]!==t[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+n.shape[s+i]+") != shape["+(s+i)+"] ("+t[s+i]+")")}function ike(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(t.size===0)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}rke(n,e,t)}function rS(t,e,n){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length,s=1,a=i;a<o;++a)s*=n[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:Ke(e.shape)/u,sliceSize:s,strides:su(n.slice(0,i)).concat([1]),outputSize:Ke(n)}}function oke(t,e,n){V(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),V(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(o){V(e[o]+n[o]<=t.shape[o],function(){return"Error in slice"+t.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+n[o])+") would overflow input.shape["+o+"] ("+t.shape[o]+")"})},i=0;i<t.rank;++i)r(i)}function RU(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function qP(t,e,n){for(var r=[],i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function ske(t,e,n,r,i){var o=e[i],s=n[i]||1;(t&1<<i||o==null)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=kI(0,o,a-1)}function ake(t,e,n,r,i){var o=e[i],s=n[i]||1;(t&1<<i||o==null)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s>0?kI(0,o,a):kI(-1,o,a-1)}function y7(t,e,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function b7(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function uke(t,e){V(EI(t),function(){return"The f passed in variableGrads(f) must be a function"}),V(e==null||Array.isArray(e)&&e.every(function(l){return l instanceof Rm}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=e!=null;if(!n)for(var r in e=[],ee.registeredVariables)e.push(ee.registeredVariables[r]);var i=n?e.filter(function(l){return!l.trainable}):null,o=e.length;V((e=e.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=ee.gradients(t,e,null,!0),a=s.value,u=s.grads;V(u.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),V(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var c={};return e.forEach(function(l,d){u[d]!=null&&(c[l.name]=u[d])}),i!=null&&i.forEach(function(l){return c[l.name]=null}),{value:a,grads:c}}function qC(t){return ee.customGrad(t)}var qc=Y({softmax_:function(t,e){e===void 0&&(e=-1);var n=M(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return ee.runKernelFunc(function(r,i){var o=r.softmax(n,e);return i([o]),o},{logits:n},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),cke=Y({logSoftmax_:function(t,e){e===void 0&&(e=-1);var n=M(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return qC(function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(e,!0).mul(l))}}})(n)}}),x7=function(){function t(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},t.prototype.set=function(e,n){this.dataIdsCount++,this.data.set(e,n)},t.prototype.has=function(e){return this.data.has(e)},t.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),w7=function(){function t(){}return t.prototype.time=function(e){return le("time")},t.prototype.read=function(e){return le("read")},t.prototype.readSync=function(e){return le("readSync")},t.prototype.numDataIds=function(){return le("numDataIds")},t.prototype.disposeData=function(e){return le("disposeData")},t.prototype.write=function(e,n,r){return le("write")},t.prototype.move=function(e,n,r,i){return le("move")},t.prototype.memory=function(){return le("memory")},t.prototype.floatPrecision=function(){return le("floatPrecision")},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.batchMatMul=function(e,n,r,i){return le("batchMatMul")},t.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,le("fusedBatchMatMul")},t.prototype.slice=function(e,n,r){return le("slice")},t.prototype.stridedSlice=function(e,n,r,i){return le("stridedSlice")},t.prototype.unstack=function(e,n){return le("unstack")},t.prototype.reverse=function(e,n){return le("reverse")},t.prototype.concat=function(e,n){return le("concat")},t.prototype.neg=function(e){return le("neg")},t.prototype.add=function(e,n){return le("add")},t.prototype.addN=function(e){return le("addN")},t.prototype.subtract=function(e,n){return le("subtract")},t.prototype.multiply=function(e,n){return le("multiply")},t.prototype.realDivide=function(e,n){return le("realDivide")},t.prototype.floorDiv=function(e,n){return le("floorDiv")},t.prototype.sum=function(e,n){return le("sum")},t.prototype.prod=function(e,n){return le("prod")},t.prototype.unsortedSegmentSum=function(e,n,r){return le("unsortedSegmentSum")},t.prototype.argMin=function(e,n){return le("argMin")},t.prototype.argMax=function(e,n){return le("argMax")},t.prototype.equal=function(e,n){return le("equal")},t.prototype.notEqual=function(e,n){return le("notEqual")},t.prototype.less=function(e,n){return le("less")},t.prototype.lessEqual=function(e,n){return le("lessEqual")},t.prototype.greater=function(e,n){return le("greater")},t.prototype.greaterEqual=function(e,n){return le("greaterEqual")},t.prototype.logicalNot=function(e){return le("logicalNot")},t.prototype.logicalAnd=function(e,n){return le("logicalAnd")},t.prototype.logicalOr=function(e,n){return le("logicalOr")},t.prototype.where=function(e){return le("where")},t.prototype.select=function(e,n,r){return le("select")},t.prototype.topk=function(e,n,r){return le("topk")},t.prototype.min=function(e,n){return le("min")},t.prototype.minimum=function(e,n){return le("minimum")},t.prototype.mod=function(e,n){return le("mod")},t.prototype.max=function(e,n){return le("max")},t.prototype.maximum=function(e,n){return le("maximum")},t.prototype.all=function(e,n){return le("all")},t.prototype.any=function(e,n){return le("any")},t.prototype.squaredDifference=function(e,n){return le("squaredDifference")},t.prototype.ceil=function(e){return le("ceil")},t.prototype.floor=function(e){return le("floor")},t.prototype.round=function(e){return le("round")},t.prototype.sign=function(e){return le("sign")},t.prototype.isNaN=function(e){return le("isNaN")},t.prototype.isInf=function(e){return le("isInf")},t.prototype.isFinite=function(e){return le("isFinite")},t.prototype.pow=function(e,n){return le("pow")},t.prototype.exp=function(e){return le("exp")},t.prototype.expm1=function(e){return le("expm1")},t.prototype.softmax=function(e,n){return le("softmax")},t.prototype.log=function(e){return le("log")},t.prototype.log1p=function(e){return le("log1p")},t.prototype.sqrt=function(e){return le("sqrt")},t.prototype.rsqrt=function(e){return le("rsqrt")},t.prototype.square=function(e){return le("square")},t.prototype.reciprocal=function(e){return le("reciprocal")},t.prototype.relu=function(e){return le("relu")},t.prototype.relu6=function(e){return le("relu6")},t.prototype.prelu=function(e,n){return le("prelu")},t.prototype.elu=function(e){return le("elu")},t.prototype.eluDer=function(e,n){return le("eluDer")},t.prototype.selu=function(e){return le("selu")},t.prototype.int=function(e){return le("int")},t.prototype.clip=function(e,n,r){return le("clip")},t.prototype.abs=function(e){return le("abs")},t.prototype.complexAbs=function(e){return le("complexAbs")},t.prototype.sigmoid=function(e){return le("sigmoid")},t.prototype.softplus=function(e){return le("softplus")},t.prototype.sin=function(e){return le("sin")},t.prototype.cos=function(e){return le("cos")},t.prototype.tan=function(e){return le("tan")},t.prototype.asin=function(e){return le("asin")},t.prototype.acos=function(e){return le("acos")},t.prototype.atan=function(e){return le("atan")},t.prototype.atan2=function(e,n){return le("atan2")},t.prototype.sinh=function(e){return le("sinh")},t.prototype.cosh=function(e){return le("cosh")},t.prototype.tanh=function(e){return le("tanh")},t.prototype.asinh=function(e){return le("asinh")},t.prototype.acosh=function(e){return le("acosh")},t.prototype.atanh=function(e){return le("atanh")},t.prototype.erf=function(e){return le("erf")},t.prototype.step=function(e,n){return le("step")},t.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedConv2d")},t.prototype.conv2d=function(e,n,r){return le("conv2d")},t.prototype.conv2dDerInput=function(e,n,r){return le("conv2dDerInput")},t.prototype.conv2dDerFilter=function(e,n,r){return le("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(e,n,r){return le("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(e,n,r){return le("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(e,n,r){return le("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(e,n,r){return le("conv3d")},t.prototype.conv3dDerInput=function(e,n,r){return le("conv3dDerInput")},t.prototype.conv3dDerFilter=function(e,n,r){return le("conv3dDerFilter")},t.prototype.maxPool=function(e,n){return le("maxPool")},t.prototype.maxPoolBackprop=function(e,n,r,i){return le("maxPoolBackprop")},t.prototype.avgPool=function(e,n){return le("avgPool")},t.prototype.avgPoolBackprop=function(e,n,r){return le("avgPoolBackprop")},t.prototype.avgPool3d=function(e,n){return le("avgPool3d")},t.prototype.avgPool3dBackprop=function(e,n,r){return le("avgPool3dBackprop")},t.prototype.maxPool3d=function(e,n){return le("maxPool3d")},t.prototype.maxPool3dBackprop=function(e,n,r,i){return le("maxPool3dBackprop")},t.prototype.reshape=function(e,n){return le("reshape")},t.prototype.cast=function(e,n){return le("cast")},t.prototype.tile=function(e,n){return le("tile")},t.prototype.pad=function(e,n,r){return le("pad")},t.prototype.transpose=function(e,n){return le("transpose")},t.prototype.gather=function(e,n,r){return le("gather")},t.prototype.gatherND=function(e,n){return le("gatherND")},t.prototype.scatterND=function(e,n,r){return le("scatterND")},t.prototype.batchToSpaceND=function(e,n,r){return le("batchToSpaceND")},t.prototype.spaceToBatchND=function(e,n,r){return le("spaceToBatchND")},t.prototype.resizeBilinear=function(e,n,r,i){return le("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(e,n,r){return le("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(e,n,r,i){return le("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(e,n,r){return le("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(e,n,r,i,o,s){return le("batchNormalization")},t.prototype.localResponseNormalization4D=function(e,n,r,i,o){return le("localResponseNormalization4D")},t.prototype.LRNGrad=function(e,n,r,i,o,s,a){return le("LRNGrad")},t.prototype.multinomial=function(e,n,r,i){return le("multinomial")},t.prototype.oneHot=function(e,n,r,i){return le("oneHot")},t.prototype.cumsum=function(e,n,r,i){return le("cumsum")},t.prototype.nonMaxSuppression=function(e,n,r,i,o){return le("nonMaxSuppression")},t.prototype.fft=function(e){return le("fft")},t.prototype.ifft=function(e){return le("ifft")},t.prototype.complex=function(e,n){return le("complex")},t.prototype.real=function(e){return le("real")},t.prototype.imag=function(e){return le("imag")},t.prototype.cropAndResize=function(e,n,r,i,o,s){return le("cropAndResize")},t.prototype.depthToSpace=function(e,n,r){return le("depthToSpace")},t.prototype.split=function(e,n,r){return le("split")},t.prototype.sparseToDense=function(e,n,r,i){return le("sparseToDense")},t.prototype.diag=function(e){return le("diag")},t.prototype.fill=function(e,n,r){return le("fill")},t.prototype.onesLike=function(e){return le("onesLike")},t.prototype.zerosLike=function(e){return le("zerosLike")},t.prototype.linspace=function(e,n,r){return le("linspace")},t.prototype.dispose=function(){return le("dispose")},t}();function le(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Fl(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,s=t[o]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(o)}return r}function fr(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,s=e[o];(i==null||i===1&&s>1)&&n.unshift(o)}return n}function It(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var o=t[t.length-i-1];o==null&&(o=1);var s=e[e.length-i-1];if(s==null&&(s=1),o===1)n.unshift(s);else if(s===1)n.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(o)}}return n}function jy(t,e,n,r,i,o,s){s===void 0&&(s="channelsLast");var a,u=sS(e),c=u[0],l=u[1];if(s==="channelsLast")a=[c,l,t[3],t[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);a=[c,l,t[1],t[1]]}return vh(t,a,n,r,i,o,!1,s)}function iS(t,e,n,r,i,o,s){s===void 0&&(s="NDHWC");var a,u,c=DI(e),l=c[0],d=c[1],f=c[2];if(s==="NDHWC")u="channelsLast",a=[l,d,f,t[4],t[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);u="channelsFirst",a=[l,d,f,t[1],t[1]]}return oS(t,a,n,r,i,!1,u,o)}function vh(t,e,n,r,i,o,s,a){s===void 0&&(s=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if(a==="channelsLast")c=t[0],l=t[1],d=t[2],f=t[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=t[0],f=t[1],l=t[2],d=t[3]}var h,p=e[0],m=e[1],v=e[3],g=sS(n),y=g[0],b=g[1],x=sS(r),S=x[0],C=x[1],T=tm(p,S),E=tm(m,C),I=function(G,J,ne,oe,q,Z,se,fe){var xe,be,pe;if(typeof G=="number"){xe={top:G,bottom:G,left:G,right:G,type:G===0?"VALID":"NUMBER"};var ge=function(Ie,lt,He,yt,en){yt==null&&(yt=S7(Ie,lt,He));var sn=Ie[0],xi=Ie[1],wi=Zv((sn-lt+2*yt)/He+1,en);V(Vn(wi),function(){return"The output # of rows ("+wi+") must be an integer. Change the stride and/or zero pad parameters"});var gr=Zv((xi-lt+2*yt)/He+1,en);return V(Vn(gr),function(){return"The output # of columns ("+gr+") must be an integer. Change the stride and/or zero pad parameters"}),[wi,gr]}([J,ne],Z,oe,G,fe);be=ge[0],pe=ge[1]}else if(G==="same"){be=Math.ceil(J/oe),pe=Math.ceil(ne/q);var Ce=Math.max(0,(be-1)*oe+Z-J),$e=Math.max(0,(pe-1)*q+se-ne),Ge=Math.floor(Ce/2),tt=Ce-Ge,mt=Math.floor($e/2);xe={top:Ge,bottom:tt,left:mt,right:$e-mt,type:"SAME"}}else{if(G!=="valid")throw Error("Unknown padding parameter: "+G);xe={top:0,bottom:0,left:0,right:0,type:"VALID"},be=Math.ceil((J-Z+1)/oe),pe=Math.ceil((ne-se+1)/q)}return{padInfo:xe,outHeight:be,outWidth:pe}}(i,l,d,y,b,T,E,o),N=I.padInfo,$=I.outHeight,F=I.outWidth,H=s?v*f:v;return a==="channelsFirst"?h=[c,H,$,F]:a==="channelsLast"&&(h=[c,$,F,H]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:d,inChannels:f,outHeight:$,outWidth:F,outChannels:H,padInfo:N,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:T,effectiveFilterWidth:E,dilationHeight:S,dilationWidth:C,inShape:t,outShape:h,filterShape:e}}function oS(t,e,n,r,i,o,s,a){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if(s==="channelsLast")c=t[0],l=t[1],d=t[2],f=t[3],h=t[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=t[0],h=t[1],l=t[2],d=t[3],f=t[4]}var p,m=e[0],v=e[1],g=e[2],y=e[4],b=DI(n),x=b[0],S=b[1],C=b[2],T=DI(r),E=T[0],I=T[1],N=T[2],$=tm(m,E),F=tm(v,I),H=tm(g,N),G=function(se,fe,xe,be,pe,ge,Ce,$e,Ge,tt,mt){var Ie,lt,He,yt;if(typeof se=="number"){Ie={top:se,bottom:se,left:se,right:se,front:se,back:se,type:se===0?"VALID":"NUMBER"};var en=function(Rr,Si,va,qo,Nr,ku){Nr==null&&(Nr=S7(Rr,Si,qo));var Nh=Rr[0],Pd=Rr[1],Ad=Rr[2],Ko=Zv((Nh-Si+2*Nr)/qo+1,ku);V(Vn(Ko),function(){return"The output # of depths ("+Ko+") must be an integer. Change the stride and/or zero pad parameters"});var Tu=Zv((Pd-Si+2*Nr)/qo+1,ku);V(Vn(Tu),function(){return"The output # of rows ("+Tu+") must be an integer. Change the stride and/or zero pad parameters"});var nl=Zv((Ad-Si+2*Nr)/qo+1,ku);return V(Vn(nl),function(){return"The output # of columns ("+nl+") must be an integer. Change the stride and/or zero pad parameters"}),[Ko,Tu,nl,va]}([fe,xe,be,1],$e,1,pe,se,mt);lt=en[0],He=en[1],yt=en[2]}else if(se==="same"){lt=Math.ceil(fe/pe),He=Math.ceil(xe/ge),yt=Math.ceil(be/Ce);var sn=(lt-1)*pe+$e-fe,xi=(He-1)*ge+Ge-xe,wi=(yt-1)*Ce+tt-be,gr=Math.floor(sn/2),Bi=sn-gr,Gr=Math.floor(xi/2),Ir=xi-Gr,Fn=Math.floor(wi/2);Ie={top:Gr,bottom:Ir,left:Fn,right:wi-Fn,front:gr,back:Bi,type:"SAME"}}else{if(se!=="valid")throw Error("Unknown padding parameter: "+se);Ie={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},lt=Math.ceil((fe-$e+1)/pe),He=Math.ceil((xe-Ge+1)/ge),yt=Math.ceil((be-tt+1)/Ce)}return{padInfo:Ie,outDepth:lt,outHeight:He,outWidth:yt}}(i,l,d,f,x,S,C,$,F,H,a),J=G.padInfo,ne=G.outDepth,oe=G.outHeight,q=G.outWidth,Z=o?y*h:y;return s==="channelsFirst"?p=[c,Z,ne,oe,q]:s==="channelsLast"&&(p=[c,ne,oe,q,Z]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:ne,outHeight:oe,outWidth:q,outChannels:Z,padInfo:J,strideDepth:x,strideHeight:S,strideWidth:C,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:$,effectiveFilterHeight:F,effectiveFilterWidth:H,dilationDepth:E,dilationHeight:I,dilationWidth:N,inShape:t,outShape:p,filterShape:e}}function S7(t,e,n,r){r===void 0&&(r=1);var i=tm(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function sS(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function DI(t){return typeof t=="number"?[t,t,t]:t}function tm(t,e){return e<=1?t:t+(t-1)*(e-1)}function Zv(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function Pm(t){var e=sS(t),n=e[0],r=e[1],i=e[2];return n===1&&r===1&&i===1}function po(t,e){return Pm(t)||Pm(e)}function KP(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function C7(t,e,n){if(e==="complex64"){if(t.dtype==="complex64")return t.clone();var r=Cn(t.shape),i=t.toFloat(),o=n.complex(i,r);return r.dispose(),i.dispose(),o}if(!FCe(t.dtype,e))return ee.makeTensorFromDataId(t.dataId,t.shape,e);if(t.dtype==="complex64"){var s=n.real(t);return o=s.cast(e),s.dispose(),o}if(e==="int32")return n.int(t);if(e==="bool"){var a=Oe(0,t.dtype);return o=n.notEqual(t,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function OI(t,e){return ee.makeTensorFromDataId(t.dataId,e,t.dtype)}function k7(t,e,n){var r=(e-t)/(n-1),i=V0(n,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Yn(i,"float32")}function FI(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function NU(t,e){return{real:t[2*e],imag:t[2*e+1]}}function lke(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function dke(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function fke(t,e,n){var r=function(o,s,a){return function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var m=l(c,u[h=d+(f-d>>>1)]);m>0?d=h+1:(f=h,p=!m)}return p?d:-d-1}(o,s,a||hke)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function hke(t,e){return t>e?1:t<e?-1:0}function XP(t,e,n,r,i){return T7(t,e,n,r,i,0).selectedIndices}function JP(t,e,n,r,i,o){var s=T7(t,e,n,r,i,o);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function T7(t,e,n,r,i,o,s,a){a===void 0&&(a=!1);for(var u=Array.from(e).map(function(x,S){return{score:x,boxIndex:S,suppressBeginIndex:0}}).filter(function(x){return x.score>i}).sort(PU),c=o>0?-.5/o:0,l=[],d=[];l.length<n&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,m=f.suppressBeginIndex;if(h<i)break;for(var v=!1,g=l.length-1;g>=m;--g){var y=pke(t,p,l[g]);if(y>=r){v=!0;break}if(f.score=f.score*mke(r,c,y),f.score<=i)break}f.suppressBeginIndex=l.length,v||(f.score===h?(l.push(p),d.push(f.score)):f.score>i&&fke(u,f,PU))}var b=l.length;return a&&(l.fill(0,b),d.fill(0,b)),{selectedIndices:Yn(l,"int32"),selectedScores:Yn(d,"float32"),numValidOutputs:Oe(b,"int32")}}function pke(t,e,n){var r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),h=(a-o)*(u-s),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var m=Math.max(o,c),v=Math.max(s,l),g=Math.min(a,d),y=Math.min(u,f),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(h+p-b)}function mke(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function PU(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function E7(t,e,n){var r=new Array(t.rank).fill(0),i=t.shape.slice();return e.map(function(o){i[n]=o;var s=t.slice(r,i);return r[n]+=o,s})}function _7(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=pt(n,t.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(t.rank),a=0;a<s.length;a++)s[a]=o[a]%t.shape[a];var u=t.locToIndex(s);i.values[r]=t.values[u]}return i.toTensor()}function I7(t,e,n,r,i){for(var o=e[e.length-1],s=[t.length/o,o],a=s[0],u=s[1],c=Vy(n,a*r),l=Vy("int32",a*r),d=0;d<a;d++){for(var f=d*u,h=t.subarray(f,f+u),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort(function(x,S){return S.value-x.value});var v=d*r,g=c.subarray(v,v+r),y=l.subarray(v,v+r);for(m=0;m<r;m++)g[m]=p[m].value,y[m]=p[m].index}var b=e.slice();return b[b.length-1]=r,[Br(c,b,n),Br(l,b,"int32")]}function YP(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var i=pt(t,"int32"),o=pt([n.length,t.length],"int32");for(r=0;r<n.length;r++){var s=i.indexToLoc(n[r]),a=r*t.length;o.values.set(s,a)}return o.toTensor()}var gke=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},vke=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},yke=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,s=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var a=e==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function R7(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(n){return t+"."+n})}function Qi(t,e){return e===1?[t]:R7(t,e)}function ci(){var t,e,n,r,i,o,s,a,u,c;return me().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}function pf(t,e,n){n===void 0&&(n="index");var r=su(e);return r.map(function(i,o){return"int "+t[o]+" = "+n+" / "+i+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+i:"index -= "+t[o]+" * "+i)+";"}).join("")}function QP(t){var e=su(t).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var N7=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function bke(t,e,n,r){var i=[];t.forEach(function(h){var p=Ke(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?i.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+h.name+";"),i.push("uniform int offset"+h.name+";"))});var o,s,a=i.join(`
`),u=t.map(function(h){return function(p,m,v){v===void 0&&(v=!1);var g="";g+=v?P7(p):rp(p);var y=p.shapeInfo.logicalShape,b=m.logicalShape;return y.length<=b.length&&(g+=v?function(x,S){var C,T=x.name,E=T.charAt(0).toUpperCase()+T.slice(1),I="get"+E+"AtOutCoords",N=x.shapeInfo.logicalShape.length,$=S.logicalShape.length,F=Fl(x.shapeInfo.logicalShape,S.logicalShape),H=vn($),G=$-N,J=["x","y","z","w","u","v"];C=N===0?"":$<2&&F.length>=1?"coords = 0;":F.map(function(xe){return"coords."+J[xe+G]+" = 0;"}).join(`
`);var ne="";ne=$<2&&N>0?"coords":x.shapeInfo.logicalShape.map(function(xe,be){return"coords."+J[be+G]}).join(", ");var oe="return outputValue;",q=Ke(x.shapeInfo.logicalShape)===1,Z=Ke(S.logicalShape)===1;if(N!==1||q||Z){if(q&&!Z)oe=$===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(F.length){var se=N-2,fe=N-1;F.indexOf(se)>-1&&F.indexOf(fe)>-1?oe="return vec4(outputValue.x);":F.indexOf(se)>-1?oe="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":F.indexOf(fe)>-1&&(oe="return vec4(outputValue.xx, outputValue.zz);")}}else oe=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+I+`() {
      `+H+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+E+"("+ne+`);
      `+oe+`
    }
  `}(p,m):function(x,S){var C=x.name,T=C.charAt(0).toUpperCase()+C.slice(1),E="get"+T+"AtOutCoords",I=S.texShape,N=x.shapeInfo.texShape,$=x.shapeInfo.logicalShape.length,F=S.logicalShape.length;if(!x.shapeInfo.isUniform&&$===F&&x.shapeInfo.flatOffset==null&&Cr(N,I))return`
      float `+E+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var H,G=vn(F),J=Fl(x.shapeInfo.logicalShape,S.logicalShape),ne=F-$,oe=["x","y","z","w","u","v"];H=$===0?"":F<2&&J.length>=1?"coords = 0;":J.map(function(Z){return"coords."+oe[Z+ne]+" = 0;"}).join(`
`);var q="";return q=F<2&&$>0?"coords":x.shapeInfo.logicalShape.map(function(Z,se){return"coords."+oe[se+ne]}).join(", "),`
    float `+E+`() {
      `+G+` coords = getOutputCoords();
      `+H+`
      return get`+T+"("+q+`);
    }
  `}(p,m)),g}(h,e,r)}).join(`
`),c=e.texShape,l=ci(),d=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(l),f=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+xke+`
    `+wke+`
    `+Ske+`
  `}(l);return e.isPacked?(o=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(x,S){var C=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(x,S){var C=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];if(Cr(x,S))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var T=Math.ceil(x[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `}(h,p);case 3:return m=h,v=p,g=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],y=Math.ceil(m[2]/2),b=y*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+b+`;
      index -= b * `+b+`;

      int r = 2 * (index / `+y+`);
      int c = imod(index, `+y+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(x,S){for(var C=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)],T=Math.ceil(x[x.length-1]/2),E=T*Math.ceil(x[x.length-2]/2),I=E,N="",$="b, r, c",F=2;F<x.length-1;F++)I*=x[x.length-F-1],N=`
      int b`+F+" = index / "+I+`;
      index -= b`+F+" * "+I+`;
    `+N,$="b"+F+", "+$;return`
    ivec`+x.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+N+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+x.length+"("+$+`);
    }
  `}(h,p)}var m,v,g,y,b}(e.logicalShape,c),s=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(l)):(o=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,y){return y[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+y[1]+`.0);
      }
    `:y[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+y[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      return resTexRC.x * `+y[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(g,y){return Cr(g,y)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+y[0]+", "+y[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(h,p);case 3:return m=p,v=pf(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,y){var b=pf(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+b+`
      return ivec4(r, c, d, d2);
    }
  `}(h,p);case 5:return function(g,y){var b=pf(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+y[0]+`,
                             `+y[1]+`));

      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+b+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,p);case 6:return function(g,y){var b=pf(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+b+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var m,v}(e.logicalShape,c),s=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),r&&(f+=Cke),[f,d,s,a,o,u,n].join(`
`)}function rp(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(n){var r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=n.shapeInfo.texShape,s=o[0],a=o[1];if(s===1&&a===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,c=u[0],l=u[1],d=Wd(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 1:return function(n){var r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Xh(n)+`
      }
    `;var o=n.shapeInfo.texShape,s=o[0],a=o[1];if(a===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Wd(r);return a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+a+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 2:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n.shapeInfo.texShape;if(s!=null&&Cr(r,s)){var a=s[0],u=s[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+a+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var c=nf(r),l=c.newShape,d=c.keptDims,f=l;if(f.length<r.length){var h=ip(n,f);return`
      `+rp(h)+`
      float `+o+`(int row, int col) {
        return `+o+"("+op(["row","col"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Xh(n)+`
      }
    `;var p=s[0],m=s[1],v=Wd(i);return m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(t);case 3:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=nf(r),c=u.newShape,l=u.keptDims,d=c;if(d.length<r.length){var f=ip(n,d);return`
        `+rp(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+op(["row","col","depth"],l)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+a+`, 1)));
        `+Xh(n)+`
      }
    `;var h=n.shapeInfo.texShape,p=h[0],m=h[1],v=n.shapeInfo.flatOffset;if(m===s&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(m===a&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var g=Wd(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+a+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(t);case 4:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,c=nf(r),l=c.newShape,d=c.keptDims;if(l.length<r.length){var f=ip(n,l);return`
      `+rp(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+op(["row","col","depth","depth2"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+a+", "+s+`, 1)));
        `+Xh(n)+`
      }
    `;var h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],v=p[1];if(v===u&&h==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===s&&h==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var g=Wd(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+a+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+v+", index + "+g+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);case 5:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,c=r[1]*u,l=nf(r),d=l.newShape,f=l.keptDims;if(d.length<r.length){var h=ip(n,d);return`
      `+rp(h)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+op(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+a+", "+s+`)) +
          depth3;
        `+Xh(n)+`
      }
    `;var p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,v=m[0],g=m[1];if(g===c&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===s&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=Wd(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+a+` +
          depth2 * `+s+" + depth3 + "+y+`;
      vec2 uv = uvFromFlat(`+v+", "+g+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);case 6:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=nf(r),a=s.newShape,u=s.keptDims;if(a.length<r.length){var c=ip(n,a);return`
      `+rp(c)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+op(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+f+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+Xh(n)+`
      }
    `;var m=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,g=v[0],y=v[1];if(y===p&&m==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+d+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===l&&m==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var b=Wd(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+f+` +
          depth2 * `+d+" + depth3 * "+l+" + depth4 + "+b+`;
      vec2 uv = uvFromFlat(`+g+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function P7(t){var e,n,r;switch(t.shapeInfo.logicalShape.length){case 0:return e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=ci(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=ci();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+o+`, uv);
    }
  `}(t);case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,c=u[0],l=u[1],d=ci();if(u!=null&&Cr(o,u))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+d.texture2D+"("+s+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(o[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+f[0]+", "+f[1]+`, row, col);
      return `+d.texture2D+"("+s+`, uv);
    }
  `}(t);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var l=o.slice(1),d=ip(i,l);return`
        `+P7(d)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+op(["b","row","col"],[1,2])+`);
        }
      `}var f=c[0],h=c[1],p=Math.ceil(o[2]/2),m=p*Math.ceil(o[1]/2),v=ci();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+h+", "+m+", "+p+`, b, row, col);
      return `+v.texture2D+"("+s+`, uv);
    }
  `}(t);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),c=i.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(o[s-1]/2),p=h*Math.ceil(o[s-2]/2),m="int b, int row, int col",v="b * "+p+" + (row / 2) * "+h+" + (col / 2)",g=2;g<s-1;g++)m="int b"+g+", "+m,p*=o[s-g-1],v="b"+g+" * "+p+" + "+v;var y=ci();return`
    vec4 `+u+"("+m+`) {
      int index = `+v+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+d+`);
      return `+y.texture2D+"("+a+`, uv);
    }
  `}(t)}}var xke=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wke=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ske=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Cke=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Wd(t){return"offset"+t}function Xh(t){var e=t.name,n=Ke(t.shapeInfo.logicalShape);return n<2?"return "+e+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function vn(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function ip(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function op(t,e){return e.map(function(n){return t[n]}).join(", ")}var kke=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,V(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,c=u.length,l=vn(c),d=Qi("coords",c);if(o===1){var f=vn(a=c+1);s=`
        `+f+" sourceLocR = "+f+"("+d.join()+`, 0);
        ++`+d[c-1]+`;
        `+f+" sourceLocG = "+f+"("+d.join()+`, 0);
        ++`+d[c-2]+`;
        `+f+" sourceLocA = "+f+"("+d.join()+`, 0);
        --`+d[c-1]+`;
        `+f+" sourceLocB = "+f+"("+d.join()+`, 0);
        --`+d[c-2]+";"}else a=c,s=`
        `+l+` sourceLocR = coords;
        ++`+d[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+d[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+d[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),p="."+h[a-1],m=h.map(function(E){return"int "+E}),v=Qi("sourceLocR",a-1).concat("inIdx.r"),g=Qi("sourceLocG",a-1).concat("inIdx.g"),y=Qi("sourceLocB",a-1).concat("inIdx.b"),b=Qi("sourceLocA",a-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+")));",C=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+b.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+d[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+d[c-2]+" < "+(u[c-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+S+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+x+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Tke=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=a-1-t.padInfo.top,l=u-1-t.padInfo.left,d=1/(e*n);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},Eke=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=l-1-t.padInfo.front,p=d-1-t.padInfo.top,m=f-1-t.padInfo.left,v=1/(e*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},_ke=function(t,e,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],It(t,e),It(t,n);var s="0.0";r!=null&&(It(t,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";i!=null&&(It(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Ike=function(t,e,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],It(t,e),It(t,n);var s="vec4(0.0)";r!=null&&(It(t,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";i!=null&&(It(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Rke="return areal * breal - aimag * bimag;",Nke="return areal * bimag + aimag * breal;",AU=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=It(e,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+t+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},DT="return a + b;",OT="return a - b;",$U="return a * b;",A7="return (a < 0.) ? b * a : a;",Ln=function(t,e,n){this.variableNames=["A","B"],this.outputShape=It(e,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+t+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},$7=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,$u=function(t,e,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=It(e,n);var i=this.outputShape.length,o="";if(r)if(i===0||Ke(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+vn(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=Qi("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+t+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},Pke=function(){function t(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return t.prototype.getCustomSetupFunc=function(e,n){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,n)}},t}(),Ake=function(){function t(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return t.prototype.getCustomSetupFunc=function(e,n){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,n)}},t}(),$ke=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Dke=function(t){this.outputShape=[],this.outputShape=Nm(t,1),this.variableNames=t.map(function(a,u){return"T"+u});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var i=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var o=e.length,s=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},Oke=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Nm(t,e);var n=this.outputShape,r=n.length,i=vn(r),o=Qi("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(v,g){return"T"+g});var a=new Array(t.length-1);a[0]=t[0][e];for(var u=1;u<a.length;u++)a[u]=a[u-1]+t[u][e];var c=s[e],l=s.slice(-2),d=s.join(),f="if ("+c+" < "+a[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+l.join()+`));
        }`;for(u=1;u<a.length;u++){var h=a[u-1];f+=`
        if (`+c+" < "+a[u]+"  && "+c+" >= "+a[u-1]+`) {
          return getChannel(
            getT`+u+"("+T1(s,c,h)+`),
            vec2(`+T1(l,c,h)+`));
        }`}var p=a.length,m=a[a.length-1];f+=`
        return getChannel(
          getT`+p+"("+T1(s,c,m)+`),
          vec2(`+T1(l,c,m)+"));",this.userCode=`
      float getValue(`+s.map(function(v){return"int "+v})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+n[r-2]+` &&
            `+o[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function T1(t,e,n){var r=t.indexOf(e);return t.map(function(i,o){return o===r?i+" - "+n:i}).join()}var Fke=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Lke=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dataFormat==="channelsLast",s=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=o?1:2,c=o?2:3,l=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Mke=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yF = 0; yF < `+t.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+t.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+t.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+o+`;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+t.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Bke=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+t.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Uke=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Vke=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,s=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},DU=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,s=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),h=t.inChannels%4,p=t.dataFormat==="channelsLast",m=p?1:2,v=p?2:3,g=p?3:1,y="",b="";n&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,b="result = activation(result);");var x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+s+", "+a+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+v+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+t.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+x+`
        `+b+`
        setOutput(result);
      }
    `},zke=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},OU=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=t.outChannels/t.inChannels,m="",v="";n&&(m=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,v="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+v+`
        setOutput(result);
      }
    `},FU=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=h,m="int xR; int xC; int xCOffset;",v=0;v<f;v++)for(var g=0;g<h;g++)m+=`
          vec4 xTexelR`+v+"C"+2*g+` = vec4(0.);
          vec4 wR`+v+"C"+g+` = vec4(0.);
          vec4 xR`+v+"C"+g+" = vec4(0.);";for(v=0;v<f;v++)for(var y=0;y<p;y++){if(m+=`
          xR = xRCorner + `+v*l+`;
          xC = xCCorner + `+(g=2*y)*d+`;
        `,c===1){if(g<h&&(m+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+v+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+`.xy);
                } else {
                  xR`+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                xR`+v+"C"+g+" = xTexelR"+v+"C"+g+`;
              `,g+1<h)){var b=a%2==0?Yq(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(m+=`
                  xCOffset = xC + `+a%2+" + "+b+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+v+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+v+"C"+g+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+v+"C"+(g+1)+` = vec4(
                    xTexelR`+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+b+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+`;
                `}}else g<h&&(m+=`
              if(xR >= 0 && xR < `+i+`) {
            `,a%2==1?(m+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+v+"C"+(g+2)+` = vec4(0.);
                }

                xR`+v+"C"+g+` = vec4(
                  xTexelR`+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+`.zw);
              `,g+1<h&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+(g+2)+` = vec4(0.);
                }

                xR`+v+"C"+g+` = vec4(
                  xTexelR`+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+`.xy);
              `,g+1<h&&(m+=`
                  xR`+v+"C"+(g+1)+` = vec4(
                    xTexelR`+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+`.zw);
                `)),m+="}");g<h&&(m+=`
            vec4 wTexelR`+v+"C"+g+" = getW("+v+", "+g+`, d1, q);
            wR`+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+`.xz);
          `,g+1<h&&(m+=`
              vec4 wTexelR`+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+`, d1, q);
              wR`+v+"C"+(g+1)+` =
                vec4(wTexelR`+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<f;v++)for(g=0;g<h;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var x="",S="";n&&(x=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,S="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+C+`
        `+S+`
        setOutput(result);
      }
    `},Wke=function(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],s=t[1],a=t[2],u=t[3],c=e[0],l=n[0],d=n[1];this.outputShape=[c,l,d,u];var f=r==="bilinear"?1:0,h=[s-1+".0",a-1+".0"],p=h[0],m=h[1],v=l>1?[""+(s-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=v[0],y=v[1],b=v[2],x=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],S=x[0],C=x[1],T=x[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+S+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+y+`;
        float width_scale = `+C+`;

        float in_y = `+b+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},jke=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+vn(r)+` coords = getOutputCoords();
        int end = `+LU(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+LU(r,"coords")+` = idx;
          val += getX(`+function(s,a){if(s===1)return""+a;if(s===2)return a+".x, "+a+".y";if(s===3)return a+".x, "+a+".y, "+a+".z";if(s===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function LU(t,e){if(t===1)return""+e;if(t===2)return e+".y";if(t===3)return e+".z";if(t===4)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var Gke=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Wy.DENSE;var e=Qv(t),n=ci();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+pf(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},Hke=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Wy.DENSE;var e=Qv(t),n=ci();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+pf(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},qke=function(){function t(e,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return t.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Kke=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Xke=function(t){this.variableNames=["A"],this.outTexUsage=Ro.DOWNLOAD;var e=ci();this.outputShape=t,this.userCode=`
      `+N7+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},Jke=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ro.DOWNLOAD;var e=ci();this.outputShape=t,this.userCode=`
      `+N7+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},Yke=function(t,e,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=ci(),i=e[0],o=e[1];this.outputShape=t;var s="result";n&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+QP(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},Qke=function(t,e,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=ci(),i=e[0],o=e[1];this.outputShape=t;var s="",a="result";n&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;s+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+t[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+t[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+QP(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+r.output+" = "+a+`;
      }
    `},Zke="return real * expR - imag * expI;",eTe="return real * expI + imag * expR;",MU=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+t+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},tTe=function(){function t(e,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;return function(r,i){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(n.valueLoc,e)}},t}(),nTe=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var i=vn(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<s.length;d++)d===a?l.push("int(getIndices("+c[d]+"))"):l.push(""+c[d]);return l.join()}(t,n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},rTe=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=vn(e.length),i=vn(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function iTe(t,e){var n=ci();return ZCe(t,e,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function oTe(t,e){return i2e(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function sTe(t,e){return o2e(t,e,new Uint16Array([0,1,2,2,1,3]))}function W0(t,e,n,r,i,o,s){a2e(n,r);var a=s2e(t,e),u=t.TEXTURE_2D;return Xe(t,e,function(){return t.bindTexture(u,a)}),Xe(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Xe(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Xe(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Xe(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Xe(t,e,function(){return t.texImage2D(u,0,i,n,r,0,o,s,null)}),Xe(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function aTe(t,e,n,r,i){var o=GC(n,r);return W0(t,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,t.FLOAT)}function uTe(t,e,n,r,i){var o=GC(n,r);return W0(t,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function cTe(t,e,n,r,i){var o=GC(n,r);return W0(t,e,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function lTe(t,e,n,r,i){var o=z0(n,r);return W0(t,e,o[0],o[1],i.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function dTe(t,e,n,r,i){var o=z0(n,r);return W0(t,e,o[0],o[1],i.internalFormatPackedHalfFloat,t.RGBA,i.textureTypeHalfFloat)}function fTe(t,e,n,r){return Xe(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),TU(t,e,n,"clipSpacePos",r,3,20,0)&&TU(t,e,n,"uv",r,2,20,12)}function hTe(t,e,n,r,i,o,s){var a,u,c;Xe(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(a=new Float32Array(r*i*4),u=t.FLOAT,c=s.internalFormatPackedFloat),a.set(o),Xe(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,i,0,t.RGBA,u,a)}),Xe(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function pTe(t,e,n,r){Xe(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Xe(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):Xe(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),Xe(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function mTe(t,e,n,r,i){var o=t.createBuffer();Xe(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,o)});var s=16*n*r;return Xe(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ)}),Xe(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),Xe(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),o}function gTe(t,e,n){var r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function vTe(t,e,n,r,i){var o=GC(n,r),s=o[0],a=o[1],u=new Uint8Array(n*r*4);return Xe(t,e,function(){return t.readPixels(0,0,s,a,i.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function yTe(t,e,n,r,i,o,s,a){var u=t,c=new Float32Array(function(l,d){var f=z0(l,d);return f[0]*f[1]*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function bTe(t,e,n,r){var i=new Float32Array(n*r*4);return Xe(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i)}),i}var xTe=function(){function t(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=me().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,KCe(n,e)):this.gl=bu(n);var r="WEBGL_color_buffer_float";if(me().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=w1(this.gl,this.debug,"OES_texture_float"),gs(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=w1(this.gl,this.debug,"OES_texture_half_float");else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),gs(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=w1(this.gl,this.debug,"EXT_color_buffer_half_float");else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",gs(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!gs(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=oTe(this.gl,this.debug),this.indexBuffer=sTe(this.gl,this.debug),this.framebuffer=u2e(this.gl,this.debug),this.textureConfig=zP(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return me().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;Xe(n,this.debug,function(){return n.finish()}),Xe(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Xe(n,this.debug,function(){return n.deleteFramebuffer(e.framebuffer)}),Xe(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),Xe(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),Xe(n,this.debug,function(){return n.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(e,n){return this.throwIfDisposed(),aTe(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(e,n){return this.throwIfDisposed(),uTe(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(e,n){return this.throwIfDisposed(),cTe(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(e,n){this.throwIfDisposed(),pTe(this.gl,this.debug,e,n)},t.prototype.uploadDenseMatrixToTexture=function(e,n,r,i){this.throwIfDisposed(),hTe(this.gl,this.debug,e,n,r,i,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(e,n){return this.throwIfDisposed(),dTe(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(e,n){return this.throwIfDisposed(),lTe(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.deleteMatrixTexture=function(e){var n=this;this.throwIfDisposed(),this.outputTexture===e&&(EU(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Xe(this.gl,this.debug,function(){return n.gl.deleteTexture(e)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,n,r){var i=this;return this.downloadMatrixDriver(e,function(){return vTe(i.gl,i.debug,n,r,i.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(e,n,r,i,o,s){return yTe(this.gl,e,0,0,0,o,s,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(e,n){return gTe(this.gl,e,n)},t.prototype.createBufferFromTexture=function(e,n,r){this.bindTextureToFrameBuffer(e);var i=mTe(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},t.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},t.prototype.createFence=function(e){var n,r,i=this;if(me().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},n=s}else me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(n,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(e,n,r){var i=this;return this.downloadMatrixDriver(e,function(){return bTe(i.gl,i.debug,n,r)})},t.prototype.createProgram=function(e){this.throwIfDisposed();var n=this.gl,r=e2e(n,this.debug,e),i=iTe(n,this.debug),o=n2e(n,this.debug);return Xe(n,this.debug,function(){return n.attachShader(o,i)}),Xe(n,this.debug,function(){return n.attachShader(o,r)}),r2e(n,this.debug,o),this.debug&&NT(n,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=fTe(n,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(e){var n=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Xe(this.gl,this.debug,function(){return n.gl.deleteProgram(e)})},t.prototype.setProgram=function(e){var n=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&NT(this.gl,this.debug,this.program),Xe(this.gl,this.debug,function(){return n.gl.useProgram(e)})},t.prototype.getUniformLocation=function(e,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?l2e(this.gl,this.debug,e,n):d2e(this.gl,e,n)},t.prototype.getAttributeLocation=function(e,n){var r=this;return this.throwIfDisposed(),Xe(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,n)})},t.prototype.getUniformLocationNoThrow=function(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)},t.prototype.setInputMatrixTexture=function(e,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),f2e(this.gl,this.debug,this.program,e,n,r)},t.prototype.setOutputMatrixTexture=function(e,n,r){this.setOutputMatrixTextureDriver(e,r,n)},t.prototype.setOutputPackedMatrixTexture=function(e,n,r){this.throwIfDisposed();var i=z0(n,r),o=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,o,s)},t.prototype.setOutputMatrixWriteRegion=function(e,n,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,n)},t.prototype.setOutputPackedMatrixWriteRegion=function(e,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){this.program!=null&&NT(this.gl,this.debug,this.program),S1(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Xe(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Xe(this.gl,this.debug,function(){return e.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=w1(this.gl,this.debug,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(n.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(e){return We(this,void 0,void 0,function(){var n=this;return je(this,function(r){switch(r.label){case 0:return[4,bU(function(){return n.disposed||n.isQueryAvailable(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(e,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(e,n){if(n===0)return!0;if(n===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(e){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=e;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},t.prototype.addItemToPoll=function(e,n){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1||bU(function(){return r.pollItems(),r.itemsToPoll.length===0})},t.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),PT(this.gl,this.debug,e,this.framebuffer),this.debug&&S1(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(PT(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&S1(this.gl)):EU(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(e,n){this.bindTextureToFrameBuffer(e);var r=n();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(e,n,r){this.throwIfDisposed();var i=this.gl;PT(i,this.debug,e,this.framebuffer),this.debug&&S1(i),this.outputTexture=e,Xe(i,this.debug,function(){return i.viewport(0,0,n,r)}),Xe(i,this.debug,function(){return i.scissor(0,0,n,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(e,n,r,i){var o=this;this.throwIfDisposed(),Xe(this.gl,this.debug,function(){return o.gl.scissor(e,n,r,i)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},t}();function BU(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(n,r){var i=n.logicalShape,o=e[r],s=o.shape;if(!Cr(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!n.isUniform||!o.isUniform){var a=n.texShape,u=o.isUniform?null:o.texData.texShape;if(!Cr(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var wTe=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,i=n.inChannels,o=n.strideWidth,s=n.strideHeight,a=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,d=n.dataFormat,f=a.left,h=a.top,p=i*r,m=ci(),v=d==="channelsLast",g=v?0:1,y=v?1:2,b="",x=0;x<=1;x++)for(var S=0;S<=1;S++)b+=`
          blockIndex = rc.y + `+S+`;
          pos = rc.x + `+x+`;

          if(blockIndex < `+t[1]+" && pos < "+t[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+s+" - "+h+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+e[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[y]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+v+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*x+S)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*x+S)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+b+`

        `+m.output+` = result;
      }
    `},STe=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,s=e,a=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},CTe=function(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},kTe=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=e,a=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},TTe=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,a=o-1-t.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},ETe=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=a-1-t.padInfo.front,d=u-1-t.padInfo.top,f=c-1-t.padInfo.left,h=a*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+d+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},FT=function(t,e,n,r,i,o,s){n===void 0&&(n=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=n?t[1]:t[2],u=Math.ceil(a/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";o&&(h=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+f[0]+`);
          result += (`+d[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},_Te=function(){function t(e,n,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;return function(r,i){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(n.seedLoc,e)}},t}(),ITe=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},RTe=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=Qi("rc",e),r=vn(e),i=function(a,u,c){if(a===1)return"rc > "+u[0];for(var l="",d=a-2;d<a;d++)l+=c[d]+" >= "+u[d],d<a-1&&(l+="||");return l}(e,t,n),o=function(a,u,c,l){if(a===1)return"";var d=l.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `}(e,t[t.length-1],t[t.length-2],n),s=function(a,u){var c=a.length,l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var v=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),g=2;g<d;g++)v=f[f.length-1-g]+","+v;h.push(v)}return h}(c,u);return c===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(t,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},NTe=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(u,c){return u[0]+t[c]+u[1]});var r=t.length,i=vn(r),o=e.map(function(u){return u[0]}).join(","),s=e.map(function(u,c){return u[0]+t[c]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},PTe=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(v,g){return v[0]+t[g]+v[1]});for(var r=t.length,i=vn(r),o=e.map(function(v){return v[0]}).join(","),s=e.map(function(v,g){return v[0]+t[g]}).join(","),a=Qi("rc",r),u=Qi("source",r),c=a[r-1]+" < "+this.outputShape[r-1],l=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[i+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+c+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+c+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=r===1?2:4;p<m;p++)h+=`
        `+d[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+n+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},LT=function(t,e,n){if(this.variableNames=["x"],e==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var f=e==="avg",h="0.0";if(f||(h="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+l+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+l+", "+d+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(v===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(v===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(v===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+p+`);
      }
    `}},MT=function(t,e,n){if(this.variableNames=["x"],e==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var v=e==="avg",g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+s+`);
        const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+t.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,S=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+b+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+S+`
            }

            int xC = xCCorner + `+b+`;
            if (`+(x===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+S+`
            } else if (`+(x===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+S+`
            } else if (`+(x===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+S+`
            }
          }
          setOutput(`+y+`);
        }
      }
    `}},ATe=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var s="0.0",a="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",a="min"):e==="max"&&(s="-1.0 / 1e-20",a="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(s="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(s="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var h="";i%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},$Te=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+pf(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+QP(t)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+t[1]+`;
        int cols = `+t[2]+`;

        `+n+`

        setOutput(result);
      }
    `},DTe=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=t.shape,a=s[1],u=s[2],c=[n&&a>1?i-1:i,n&&u>1?o-1:o],l=[n&&a>1?a-1:a,n&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},OTe=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=[r&&e>1?o-1:o,r&&n>1?s-1:s],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},FTe=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=[r&&e>1?o-1:o,r&&n>1?s-1:s],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},LTe=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=t.shape,a=s[1],u=s[2],c=[n&&a>1?i-1:i,n&&u>1?o-1:o],l=[n&&a>1?a-1:a,n&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},MTe=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=[r&&e>1?o-1:o,r&&n>1?s-1:s],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},BTe=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,n!==1){var r=t.map(function(o,s){return function(a){return e.indexOf(a)!==-1&&t[a]!==1?t[a]+" - coords["+a+"] - 1":"coords["+a+"]"}(s)}).join(","),i=vn(n);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+t[0]+` - coord - 1));
        }
      `},UTe=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=Qi("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],o=r[n-2]+" + 1 < "+this.outputShape[n-2],s=vn(n);function a(u){var c=t.map(function(l,d){return function(f,h){return e.indexOf(f)!==-1&&t[f]!==1?t[f]+" - "+h[f]+" - 1":""+h[f]}(d,u)});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+t[0]+` - rc - 1),
            `+t[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+t[0]+` - (rc  + 1) - 1),
                `+t[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return a(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",a(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",a(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",a(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},UU=function(t,e,n,r,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=vn(i.length),u=vn(o.length),c="";n===1?c="i":n===2&&(c="i, j");var l="getIndices("+c+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var f="getUpdates("+d+")",h=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+t+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},VTe=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/n);this.outputShape=[r,s];var a=4*Math.floor(n/4),u=n%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";i%n>0&&(l=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},zTe=function(t,e,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<e.length;u++)a.push(""+o[u]),u<t&&s.push(""+o[u]);r=s.join(),i=a.join()}var c=vn(n);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},WTe=function(){function t(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var n,r=vn(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(s===1)return"sourceLoc";if(s<=6)return BT.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(s,a){return"sourceLoc."+BT[a]+" = start["+a+"] + coords."+BT[a]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+n+`
        setOutput(getSource(`+o+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(i,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,e)}},t}(),BT=["x","y","z","w","u","v"],jTe=function(){function t(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var n=vn(this.rank),r=Qi("coords",this.rank),i=Qi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+n+"("+e.map(function(l,d){return"start["+d+"]"}).join()+");":e.map(function(l,d){return i[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+a+`
        `+u+`
        setOutput(result);
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(i,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,e)}},t}(),GTe=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=vn(n.length),o=vn(n.length),s="";if(r===1)s="coords * strides + begin";else{var a=0;s=n.map(function(u,c){return a++,n.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(a-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+t+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},HTe=function(){function t(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(e,n,r){var i,o=VU(n,r),s=zU(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===Eo.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Eo.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Eo.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Eo.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Eo.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},t.prototype.releaseTexture=function(e,n,r,i){if(this.freeTextures!=null){var o=zU(n,VU(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function VU(t,e){if(t===Ro.UPLOAD)return Eo.PACKED_2X2_FLOAT32;if(t===Ro.RENDER||t==null)return function(n){return me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Eo.PACKED_2X2_FLOAT32:Eo.UNPACKED_FLOAT32:n?Eo.PACKED_2X2_FLOAT16:Eo.UNPACKED_FLOAT16}(e);if(t===Ro.DOWNLOAD||t===Ro.PIXELS)return Eo.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function zU(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var qTe=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var i=vn(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<s.length;l++)c.push("imod("+u[l]+", "+s[l]+")");return c.join()}(t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},KTe=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var i=vn(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(a),l=0;l<s.length;l++)c[s[l]]=u[l];return c.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},XTe=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=vn(this.rank),o=R7("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+s.join()+"), "+a+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},ZP=1.7580993408473768,eA=1.0507009873554805,bt=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},ha="if (isnan(x)) return x;",JTe="return x;",WU="return abs(x);",D7=ha+`
  return (x < 0.0) ? 0.0 : x;
`,O7=ha+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,F7="return (x >= 0.0) ? x : (exp(x) - 1.0);",YTe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+ZP+`;
  float scale = `+eA+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,jU="return -x;",GU="return ceil(x);",HU="return floor(x);",qU="return exp(x);",KU="return exp(x) - 1.0;",QTe=ha+`
  return sin(x);
`,ZTe=ha+`
  return cos(x);
`,eEe=ha+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,tEe=ha+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,nEe=ha+`
  return atan(x);
`,rEe=ha+"return log(x + sqrt(x * x + 1.0));",iEe=ha+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,oEe=ha+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,E1="return x;",sEe="return x;",L7=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,M7=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,B7=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,nv=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},aEe=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=Qi("rc",e),r=vn(e),i=function(a,u){if(a===1)return"rc";for(var c="",l=0;l<a;l++)c+=u[l],l<a-1&&(c+=",");return c}(e,n),o=n.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},_1={};function I1(t,e){if(e===void 0&&(e=!1),t==="linear")return e?sEe:JTe;if(t==="relu")return e?L7:D7;if(t==="elu")return e?B7:F7;if(t==="relu6")return e?M7:O7;if(t==="prelu")return e?$7:A7;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var uEe=600,cEe=function(t){function e(n){var r,i=t.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!me().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var o=bu(me().getNumber("WEBGL_VERSION"));i.binaryCache=((r=me().getNumber("WEBGL_VERSION"))in _1||(_1[r]={}),_1[r]),i.gpgpu=new xTe(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=n,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=n.gl.canvas;return i.textureManager=new HTe(i.gpgpu),i.numMBBeforeWarning=me().global.screen==null?1024:me().global.screen.height*me().global.screen.width*window.devicePixelRatio*uEe/1024/1024,i.texData=new x7(i,ee),i}return fa(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(n,r,i){if(me().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:n,usage:Ro.UPLOAD}),o},e.prototype.move=function(n,r,i,o){if(me().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:i,dtype:o,values:r,usage:Ro.UPLOAD})},e.prototype.readSync=function(n){var r=this.texData.get(n),i=r.values,o=r.dtype,s=r.complexTensors,a=r.slice,u=r.shape,c=r.isPacked;if(a!=null){var l=void 0;l=c?new nv(u,E1):new bt(u,E1);var d=this.runWebGLProgram(l,[{dataId:n,shape:u,dtype:o}],o),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(n);if(o==="string")return i;var h,p,m=this.activeTimers!=null;return m&&(h=Pa()),o==="complex64"?p=FI(s.real.dataSync(),s.imag.dataSync()):p=this.getValuesFromTexture(n),m&&(this.downloadWaitMs+=Pa()-h),this.convertAndCacheOnCPU(n,p)},e.prototype.read=function(n){return We(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E;return je(this,function(I){switch(I.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(N){return r.push(N)})];if(i=this.texData.get(n),o=i.values,s=i.shape,a=i.slice,u=i.dtype,c=i.complexTensors,l=i.isPacked,a!=null)return d=void 0,d=l?new nv(s,E1):new bt(s,E1),f=this.runWebGLProgram(d,[{dataId:n,shape:s,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(o!=null)return[2,this.convertAndCacheOnCPU(n)];if(!me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&me().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&me().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(n),v=this.texData.get(m.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[v.texture].concat(Qv(s)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return y=I.sent(),b=y[0],x=y[1],g=FI(b,x),[3,5];case 4:p==null?g=this.getValuesFromTexture(n):(S=Ke(s),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,S)),I.label=5;case 5:return m!=null&&this.disposeData(m.dataId),C=this.convertAndCacheOnCPU(n,g),T=this.pendingRead.get(n),this.pendingRead.delete(n),T.forEach(function(N){return N(C)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,C]}})})},e.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var i=n[r];if(!YCe(i))throw me().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(n){var r,i=this.texData.get(n),o=i.shape,s=i.dtype,a=i.isPacked,u=Ke(o);if(me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(n),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(Qv(o))).subarray(0,u);return this.disposeData(c.dataId),d}var f=me().getBool("WEBGL_PACK")&&a===!0,h=f?AT(o):o,p=f?new Jke(h):new Xke(h),m=this.runWebGLProgram(p,[{shape:h,dtype:s,dataId:n}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),g},e.prototype.time=function(n){return We(this,void 0,void 0,function(){var r,i,o,s,a,u,c;return je(this,function(l){switch(l.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,n(),s=Im(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),a=Im(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return c=l.sent(),u.kernelMs=PCe(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:a[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Pa(),endMs:null}},e.prototype.endTimer=function(n){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=Pa(),n)},e.prototype.getQueryTime=function(n){return We(this,void 0,void 0,function(){var r;return je(this,function(i){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},e.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},e.prototype.releaseGPUData=function(n){var r=this.texData.get(n),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||n,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),i!=null&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,u)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},e.prototype.getDataInfo=function(n){return this.texData.get(n)},e.prototype.getCPUBackend=function(){return me().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ee.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(n,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(n,r){var i=this.makeOutput(n.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:ee.keep(n.clone()),imag:ee.keep(r.clone())},i},e.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},e.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},e.prototype.slice=function(n,r,i){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,i);if(Ke(i)===0)return Br([],i,n.dtype);var o=this.texData.get(n.dataId).isPacked,s=y7(n.shape,r,i);if(o||!s){var a=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jTe(i):new WTe(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,i)},e.prototype.shallowSlice=function(n,r,i){var o=this.texData.get(n.dataId),s=this.makeOutput(i,n.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=n.dtype;var u=b7(r,n.strides);o.slice&&(u+=o.slice.flatOffset),a.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||n.dataId};var c=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,c+1),s},e.prototype.stridedSlice=function(n,r,i,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,i,o);var s=qP(r,i,o);if(s.some(function(u){return u===0}))return Br([],s);var a=new GTe(r,o,s);return this.compileAndRun(a,[n])},e.prototype.reverse=function(n,r){var i=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new UTe(n.shape,r):new BTe(n.shape,r);return this.compileAndRun(i,[n])},e.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var i=n.map(function(h){return cs(h)}),o=n.map(function(h){return Oa(h)});return Or(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(n.length/2),a=this.concat(n.slice(0,s),r),u=this.concat(n.slice(s),r);return this.concat([a,u],r)}if(me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var c=new Oke(n.map(function(h){return h.shape}),r);return this.compileAndRun(c,n)}var l=Nm(n.map(function(h){return h.shape}),r),d=n.map(function(h){return h.as2D(-1,Ke(h.shape.slice(r)))}),f=new Dke(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},e.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,jU,n.dtype);var r=new bt(n.shape,jU);return this.compileAndRun(r,[n])},e.prototype.batchMatMul=function(n,r,i,o){var s=i?n.shape[2]:n.shape[1],a=o?r.shape[1]:r.shape[2],u=i?n.shape[1]:n.shape[2],c=n.shape[0];if((s===1||a===1)&&u>1e3){i&&(n=n.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var l=a===1?n:n.as3D(c,u,1),d=a===1?2:1,f=a===1?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=Lr(n.dtype,r.dtype),p=new FT(n.shape,[c,s,a],i,o);return this.compileAndRun(p,[n,r],h)},e.prototype.fusedBatchMatMul=function(n){var r=n.a,i=n.b,o=n.transposeA,s=n.transposeB,a=n.bias,u=n.activation,c=n.preluActivationWeights,l=o?r.shape[2]:r.shape[1],d=s?i.shape[1]:i.shape[2],f=r.shape[0],h=Lr(r.dtype,i.dtype),p=a!=null,m=c!=null,v=u?I1(u,!0):null,g=new FT(r.shape,[f,l,d],o,s,p,v,m),y=[r,i];return a&&y.push(a),c&&y.push(c),this.compileAndRun(g,y,h)},e.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var i=this.texData.get(n.dataId),o=this.texData.get(r.dataId),s=new AU(Rke,n.shape,r.shape),a=new AU(Nke,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],c=this.compileAndRun(s,u),l=this.compileAndRun(a,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,$U,n.dtype);var f=new Ln($U,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},e.prototype.batchNormalization=function(n,r,i,o,s,a){var u=[n,r,i],c=null;a!=null&&(c=a.shape,u.push(a));var l=null;if(s!=null&&(l=s.shape,u.push(s)),me().getBool("WEBGL_PACK_NORMALIZATION")){var d=new Ike(n.shape,r.shape,i.shape,c,l,o);return this.compileAndRun(d,u)}var f=new _ke(n.shape,r.shape,i.shape,c,l,o);return this.compileAndRun(f,u)},e.prototype.localResponseNormalization4D=function(n,r,i,o,s){var a=me().getBool("WEBGL_PACK_NORMALIZATION")?new kTe(n.shape,r,i,o,s):new STe(n.shape,r,i,o,s);return this.compileAndRun(a,[n])},e.prototype.LRNGrad=function(n,r,i,o,s,a,u){var c=new CTe(r.shape,o,s,a,u);return this.compileAndRun(c,[r,i,n])},e.prototype.tile=function(n,r){if(n.dtype==="string"){var i=this.readSync(n.dataId).map(function(s){return Kw(s)});return _7(pt(n.shape,n.dtype,i),r)}var o=new qTe(n.shape,r);return this.compileAndRun(o,[n])},e.prototype.pad=function(n,r,i){var o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PTe(n.shape,r,i):new NTe(n.shape,r,i);return this.compileAndRun(o,[n])},e.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var i=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new XTe(n.shape,r):new KTe(n.shape,r);return this.compileAndRun(i,[n])},e.prototype.gather=function(n,r,i){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,i);var o=new nTe(n.shape,r.size,i);return this.compileAndRun(o,[n,r])},e.prototype.batchToSpaceND=function(n,r,i){V(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,f){return d*f}),s=eS(n.shape,r,o),a=tS(s.length,r.length),u=nS(n.shape,r,o),c=p7(i,r.length),l=m7(u,i,r.length);return n.reshape(s).transpose(a).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(n,r,i){V(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(f,h){return f*h}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<n.shape.length;++a)s.push([0,0]);var u=n.pad(s),c=eS(u.shape,r,o,!1),l=tS(c.length,r.length,!1),d=nS(u.shape,r,o,!1);return u.reshape(c).transpose(l).reshape(d)},e.prototype.reduce=function(n,r,i){var o=n.shape[0],s=n.shape[1],a=$T(s),u=new ATe({windowSize:a,inSize:s,batchSize:o},r),c=this.compileAndRun(u,[n],i);return c.shape[1]===1?c:this.reduce(c,r,i)},e.prototype.argReduce=function(n,r,i){i===void 0&&(i=null);var o=n.shape[0],s=n.shape[1];i!=null&&(o=i.shape[0],s=i.shape[1]);var a=$T(s),u=new yke({windowSize:a,inSize:s,batchSize:o},r,i==null),c=[n];i!=null&&c.push(i);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(n,r,l)},e.prototype.argReducePacked=function(n,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:n.shape,s=$T(o[o.length-1]),a=new kke(o,s,r,i==null),u=i==null?[n]:[n,i],c=this.compileAndRun(a,u,"int32");return c.rank===n.rank?this.argReducePacked(n,r,c):c},e.prototype.sum=function(n,r){To("sum",r,n.rank);var i=ei(n.shape,r),o=i[0],s=Ke(i[1]),a=n.as2D(-1,s),u=TT(n.dtype);return this.reduce(a,"sum",u).reshape(o)},e.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var i=ei(n.shape,r),o=i[0],s=Ke(i[1]),a=n.as2D(-1,s),u=TT(n.dtype);return this.reduce(a,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(n,r,i){var o=0,s=xu([o],n.rank),a=n;s!=null&&(a=n.transpose(s),o=wu(1,n.rank)[0]);var u=function(h,p,m){for(var v=[],g=h.length,y=0;y<g;y++)y!==p?v.push(h[y]):v.push(m);return v}(a.shape,o,i),c=Ke([a.shape[o]]),l=a.as2D(-1,c),d=TT(n.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,i).reshape(u);return s!=null&&(f=f.transpose(WP(s))),f},e.prototype.segOpCompute=function(n,r,i,o,s){var a=n.shape[0],u=n.shape[1],c=function(f,h){var p,m=!1;for(f<=v7?(p=f,m=!0):p=_I(f,Math.floor(Math.sqrt(f)));!m;)p>h||p===f?m=!0:p=_I(f,p+1);return p}(u,s),l=new VTe({windowSize:c,inSize:u,batchSize:a,numSegments:s}),d=this.compileAndRun(l,[n,i],o);return d.shape[1]===s?d:(i=Zw(0,s).tile([u/c]),this.segOpCompute(d,r,i,o,s))},e.prototype.argMinMaxReduce=function(n,r,i){var o=[r];if(To("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,n.rank),!me().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var s=ei(n.shape,o),a=s[0],u=Ke(s[1]),c=n.as2D(-1,u);return this.argReduce(c,i).reshape(a)}return this.argReducePacked(n,i)},e.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},e.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},e.prototype.cumsum=function(n,r,i,o){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var s=new jke(n.shape,i,o);return this.compileAndRun(s,[n])},e.prototype.equal=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var i=new Ln("return float(a == b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.notEqual=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new Ln("return float(a != b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new Ln("return float(a < b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.lessEqual=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new Ln("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new Ln("return float(a > b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.greaterEqual=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new Ln("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.logicalNot=function(n){var r=new bt(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},e.prototype.logicalAnd=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new Ln("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.logicalOr=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new Ln("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.select=function(n,r,i){var o=new zTe(n.rank,r.shape,r.rank);return this.compileAndRun(o,[n,r,i],Lr(r.dtype,i.dtype))},e.prototype.where=function(n){Yw("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return YP(n.shape,r)},e.prototype.topk=function(n,r,i){return I7(n.dataSync(),n.shape,n.dtype,r)},e.prototype.min=function(n,r){To("min",r,n.rank);var i=ei(n.shape,r),o=i[0],s=Ke(i[1]),a=n.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ln(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.mod=function(n,r){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ln(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);To("max",r,n.rank);var i=ei(n.shape,r),o=i[0],s=Ke(i[1]),a=n.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ln(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.all=function(n,r){To("all",r,n.rank);var i=ei(n.shape,r),o=i[0],s=Ke(i[1]),a=n.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(n,r){To("any",r,n.rank);var i=ei(n.shape,r),o=i[0],s=Ke(i[1]),a=n.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.realDivide=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new Ln(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(i,[n,r],"float32")},e.prototype.floorDiv=function(n,r){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new Ln(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(i,[n,r],"int32")},e.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,DT);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var i=Lr(n.dtype,r.dtype);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,DT,i);var o=new Ln(DT,n.shape,r.shape);return this.compileAndRun(o,[n,r],i)},e.prototype.packedUnaryOp=function(n,r,i){var o=new nv(n.shape,r);return this.compileAndRun(o,[n],i)},e.prototype.packedBinaryOp=function(n,r,i,o,s){s===void 0&&(s=!1);var a=new $u(i,n.shape,r.shape,s);return this.compileAndRun(a,[n,r],o)},e.prototype.complexSeparableBinaryOp=function(n,r,i){var o=this,s=this.texData.get(n.dataId),a=this.texData.get(r.dataId),u=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],m=o.makeComplexComponentTensorInfo(n,h),v=o.makeComplexComponentTensorInfo(r,p),g=new Ln(i,n.shape,r.shape);return o.compileAndRun(g,[m,v],Lr(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},e.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>me().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),i=this.addN(n.slice(0,r)),o=this.addN(n.slice(r));return this.addN([i,o])}var s=n.map(function(c){return c.dtype}).reduce(function(c,l){return Lr(c,l)}),a=n.map(function(c){return c.shape}),u=me().getBool("WEBGL_PACK")?new vke(n[0].shape,a):new gke(n[0].shape,a);return this.compileAndRun(u,n,s)},e.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,OT);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var i=Lr(n.dtype,r.dtype);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,OT,n.dtype);var o=new Ln(OT,n.shape,r.shape);return this.compileAndRun(o,[n,r],i)},e.prototype.pow=function(n,r){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ln(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),o=Lr(n.dtype,r.dtype);return this.compileAndRun(i,[n,r],o)},e.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,GU,n.dtype);var r=new bt(n.shape,GU);return this.compileAndRun(r,[n])},e.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,HU,n.dtype);var r=new bt(n.shape,HU);return this.compileAndRun(r,[n])},e.prototype.sign=function(n){var r=new bt(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},e.prototype.isNaN=function(n){var r=new bt(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.isInf=function(n){var r=new bt(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.isFinite=function(n){var r=new bt(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.round=function(n){var r=new bt(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},e.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,qU,n.dtype);var r=new bt(n.shape,qU);return this.compileAndRun(r,[n])},e.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,KU,n.dtype);var r=new bt(n.shape,KU);return this.compileAndRun(r,[n])},e.prototype.softmax=function(n,r){var i=mr([r],n.shape),o=this.max(n,i),s=ho(o.shape,i),a=this.subtract(n,o.reshape(s)),u=this.exp(a),c=this.sum(u,i).reshape(s);return this.realDivide(u,c)},e.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new bt(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},e.prototype.log1p=function(n){var r=new bt(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},e.prototype.sqrt=function(n){var r=new bt(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},e.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new bt(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},e.prototype.reciprocal=function(n){var r=new bt(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},e.prototype.relu=function(n){var r;return r=me().getBool("WEBGL_PACK")?new nv(n.shape,L7):new bt(n.shape,D7),this.compileAndRun(r,[n])},e.prototype.relu6=function(n){var r;return r=me().getBool("WEBGL_PACK")?new nv(n.shape,M7):new bt(n.shape,O7),this.compileAndRun(r,[n])},e.prototype.prelu=function(n,r){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u($7,n.shape,r.shape):new Ln(A7,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.elu=function(n){if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,B7,n.dtype);var r=new bt(n.shape,F7);return this.compileAndRun(r,[n])},e.prototype.eluDer=function(n,r){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new Ln("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.selu=function(n){var r=new bt(n.shape,YTe);return this.compileAndRun(r,[n])},e.prototype.int=function(n){var r=new bt(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},e.prototype.clip=function(n,r,i){var o,s=(o=me().getBool("WEBGL_PACK_CLIP")?new Ake(n.shape):new Pke(n.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[n],null,s)},e.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,WU,n.dtype);var r=new bt(n.shape,WU);return this.compileAndRun(r,[n])},e.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),i=new $ke(n.shape),o=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(n){var r=new bt(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},e.prototype.softplus=function(n){var r=new bt(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},e.prototype.sin=function(n){var r=new bt(n.shape,QTe);return this.compileAndRun(r,[n])},e.prototype.cos=function(n){var r=new bt(n.shape,ZTe);return this.compileAndRun(r,[n])},e.prototype.tan=function(n){var r=new bt(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},e.prototype.asin=function(n){var r=new bt(n.shape,eEe);return this.compileAndRun(r,[n])},e.prototype.acos=function(n){var r=new bt(n.shape,tEe);return this.compileAndRun(r,[n])},e.prototype.atan=function(n){var r=new bt(n.shape,nEe);return this.compileAndRun(r,[n])},e.prototype.atan2=function(n,r){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ln(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.sinh=function(n){var r=new bt(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},e.prototype.cosh=function(n){var r=new bt(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},e.prototype.tanh=function(n){var r=new bt(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},e.prototype.asinh=function(n){var r=new bt(n.shape,rEe);return this.compileAndRun(r,[n])},e.prototype.acosh=function(n){var r=new bt(n.shape,iEe);return this.compileAndRun(r,[n])},e.prototype.atanh=function(n){var r=new bt(n.shape,oEe);return this.compileAndRun(r,[n])},e.prototype.erf=function(n){var r=new bt(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},e.prototype.step=function(n,r){var i=new bt(n.shape,function(o){return o===void 0&&(o=0),ha+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[n])},e.prototype.conv2dByMatMul=function(n,r,i,o,s,a){var u=n.shape,c=this.texData.get(n.dataId),l=i.inChannels,d=u[0]*u[1]*u[2],f=i.outChannels,h=i.dataFormat==="channelsLast",p=(d===1||f===1)&&l>1e3,m=u[2]%2!=0&&!!c.isPacked;if(p||!me().getBool("WEBGL_LAZILY_UNPACK")||!me().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var v=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(n,[1,v,i.inChannels]),y=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:y,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var b=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),x={dataId:n.dataId,shape:[1,b,i.inChannels],dtype:n.dtype},S=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,V(k1(c.shape,x.shape),function(){return"packed reshape "+c.shape+" to "+x.shape+" isn't free"});var C=this.reshape(r,[1,i.inChannels,i.outChannels]),T=this.fusedBatchMatMul({a:x,b:C,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),E=this.texData.get(T.dataId);return V(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=S,E.shape=i.outShape,ee.makeTensorFromDataId(T.dataId,i.outShape,T.dtype)},e.prototype.conv2dWithIm2Row=function(n,r,i,o,s,a){var u=i.filterWidth,c=i.filterHeight,l=i.inChannels,d=i.outWidth,f=i.outHeight,h=i.dataFormat==="channelsLast",p=u*c*l,m=f*d,v=[p,m],g=n.squeeze([0]),y=r.reshape([1,p,-1]),b=new wTe(v,g.shape,i),x=this.compileAndRun(b,[g]).reshape([1,v[0],v[1]]),S=o!=null,C=a!=null,T=s?I1(s,!0):null,E=new FT(x.shape,[1,m,i.outChannels],!0,!1,S,T,C),I=[x,y];o&&I.push(o),C&&I.push(a);var N=this.compileAndRun(E,I);return h?N.reshape([1,f,d,i.outChannels]):N.reshape([1,i.outChannels,f,d])},e.prototype.fusedConv2d=function(n){var r=n.input,i=n.filter,o=n.convInfo,s=n.bias,a=n.activation,u=n.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,s,a,u);if(me().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,s,a,u);var c=s!=null,l=u!=null,d=a?I1(a,!1):null,f=new DU(o,c,d,l),h=[r,i];return s&&h.push(s),u&&h.push(u),this.compileAndRun(f,h)},e.prototype.conv2d=function(n,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,i);if(me().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,i);var o=new DU(i);return this.compileAndRun(o,[n,r])},e.prototype.conv2dDerInput=function(n,r,i){var o=new Lke(i);return this.compileAndRun(o,[n,r])},e.prototype.conv2dDerFilter=function(n,r,i){var o=new Fke(i);return this.compileAndRun(o,[n,r])},e.prototype.fusedDepthwiseConv2D=function(n){var r,i=n.input,o=n.filter,s=n.convInfo,a=n.bias,u=n.activation,c=n.preluActivationWeights,l=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,d=u?I1(u,l):null,f=[i,o],h=a!=null,p=c!=null;return h&&f.push(a),p&&f.push(c),l?(r=new FU(s,h,d,p),this.compileAndRun(r,f)):(r=new OU(s,h,d,p),this.compileAndRun(r,f))},e.prototype.depthwiseConv2D=function(n,r,i){var o;return me().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new FU(i),this.compileAndRun(o,[n,r])):(o=new OU(i),this.compileAndRun(o,[n,r]))},e.prototype.depthwiseConv2DDerInput=function(n,r,i){var o=new Vke(i);return this.compileAndRun(o,[n,r])},e.prototype.depthwiseConv2DDerFilter=function(n,r,i){var o=new Uke(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3d=function(n,r,i){var o=new zke(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3dDerInput=function(n,r,i){var o=new Bke(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3dDerFilter=function(n,r,i){var o=new Mke(i);return this.compileAndRun(o,[n,r])},e.prototype.maxPool=function(n,r){var i=new LT(r,"max",!1);return this.compileAndRun(i,[n])},e.prototype.avgPool=function(n,r){var i=new LT(r,"avg",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.maxPoolBackprop=function(n,r,i,o){var s=new LT(o,"max",!0),a=this.compileAndRun(s,[r]),u=new TTe(o),c=this.compileAndRun(u,[n,a],r.dtype);return a.dispose(),c},e.prototype.avgPoolBackprop=function(n,r,i){var o=new Tke(i);return this.compileAndRun(o,[n],r.dtype)},e.prototype.cast=function(n,r){return C7(n,r,this)},e.prototype.unstack=function(n,r){for(var i=n.shape[r],o=new Array(n.rank-1),s=0,a=0;a<n.rank;a++)a!==r&&(o[s++]=n.shape[a]);var u=new Array(n.rank).fill(0),c=n.shape.slice();c[r]=1;var l=new Array(i);for(a=0;a<l.length;a++)u[r]=a,l[a]=this.slice(n,u,c).reshape(o);return l},e.prototype.avgPool3d=function(n,r){var i=new MT(r,"avg",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.avgPool3dBackprop=function(n,r,i){var o=new Eke(i);return this.compileAndRun(o,[n],r.dtype)},e.prototype.maxPool3d=function(n,r){var i=new MT(r,"max",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.maxPool3dBackprop=function(n,r,i,o){var s=new MT(o,"max",!0),a=this.compileAndRun(s,[r]),u=new ETe(o),c=this.compileAndRun(u,[n,a],r.dtype);return a.dispose(),c},e.prototype.reshape=function(n,r){var i=this.texData.get(n.dataId);if(i.isPacked&&!k1(n.shape,r)&&(i.texture===null||!k1(i.shape,r))){var o=this.packedReshape(n,r);return ee.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return OI(n,r)},e.prototype.resizeBilinear=function(n,r,i,o){var s=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new FTe(n.shape,r,i,o):new OTe(n.shape,r,i,o);return this.compileAndRun(s,[n],"float32")},e.prototype.resizeBilinearBackprop=function(n,r,i){var o=new DTe(n,r,i);return this.compileAndRun(o,[n])},e.prototype.resizeNearestNeighbor=function(n,r,i,o){var s=new MTe(n.shape,r,i,o);return this.compileAndRun(s,[n])},e.prototype.resizeNearestNeighborBackprop=function(n,r,i){var o=new LTe(n,r,i);return this.compileAndRun(o,[n])},e.prototype.multinomial=function(n,r,i,o){var s=r?n:qc(n),a=s.shape[0],u=s.shape[1],c=new _Te(a,u,i),l=c.getCustomSetupFunc(o);return this.compileAndRun(c,[s],"int32",l)},e.prototype.oneHot=function(n,r,i,o){var s=new ITe(n.size,r,i,o);return this.compileAndRun(s,[n])},e.prototype.diag=function(n){var r=new Kke(n.size);return this.compileAndRun(r,[n])},e.prototype.nonMaxSuppression=function(n,r,i,o,s){return Yw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),XP(n.dataSync(),r.dataSync(),i,o,s)},e.prototype.cropAndResize=function(n,r,i,o,s,a){var u=new Wke(n.shape,r.shape,o,s,a);return this.compileAndRun(u,[n,r,i],"float32")},e.prototype.depthToSpace=function(n,r,i){V(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=n.shape[0],s=i==="NHWC"?n.shape[1]:n.shape[2],a=i==="NHWC"?n.shape[2]:n.shape[3],u=i==="NHWC"?n.shape[3]:n.shape[1],c=s*r,l=a*r,d=u/(r*r),f=new qke(i==="NHWC"?[o,c,l,d]:[o,d,c,l],r,i);return this.compileAndRun(f,[n])},e.prototype.split=function(n,r,i){return E7(n,r,i)},e.prototype.scatterND=function(n,r,i){var o=rS(0,n,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,c=o.strides,l=o.outputSize,d=[l/u,u],f=n.reshape([a,s]),h=r.reshape([a,u]);if(l===0)return OI(Br([]),i);var p=Oe(0),m=new UU(a,s,f.rank,h.rank,c,d);return this.compileAndRun(m,[h,f,p]).reshape(i)},e.prototype.sparseToDense=function(n,r,i,o){var s=rS(0,n,i),a=s.sliceRank,u=s.numUpdates,c=s.strides,l=s.outputSize,d=new UU(u,a,n.rank,r.rank,c,[l,1]);return this.compileAndRun(d,[r,n,o]).reshape(i)},e.prototype.fft=function(n){return this.fftImpl(n,!1)},e.prototype.ifft=function(n){return this.fftImpl(n,!0)},e.prototype.fftImpl=function(n,r){var i=this.texData.get(n.dataId),o=new MU(Zke,n.shape,r),s=new MU(eTe,n.shape,r),a=[this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag)],u=this.compileAndRun(o,a),c=this.compileAndRun(s,a),l=this.complex(u,c).as2D(n.shape[0],n.shape[1]);return u.dispose(),c.dispose(),l},e.prototype.gatherND=function(n,r){var i=r.shape,o=i[i.length-1],s=g7(n,r),a=s[0],u=s[1],c=s[2],l=s[3],d=r.reshape([u,o]),f=n.reshape([n.size/c,c]),h=new rTe(o,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(a)},e.prototype.fill=function(n,r,i){if((i=i||U0(r))==="string"){var o=qw(i,Ke(n));return o.fill(r),ee.makeTensor(o,n,i,this)}var s=new tTe(n,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},e.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},e.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},e.prototype.linspace=function(n,r,i){return k7(n,r,i)},e.prototype.makeTensorInfo=function(n,r){var i=this.write(null,n,r);return this.texData.get(i).usage=null,{dataId:i,shape:n,dtype:r}},e.prototype.makeOutput=function(n,r){var i=this.makeTensorInfo(n,r).dataId;return ee.makeTensorFromDataId(i,n,r,this)},e.prototype.unpackTensor=function(n){var r=new aEe(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},e.prototype.packTensor=function(n){var r=new RTe(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},e.prototype.packedReshape=function(n,r){var i=[Xw(n.shape)].concat(Jw(n.shape)),o={dtype:n.dtype,shape:i,dataId:n.dataId},s=[Xw(r)].concat(Jw(r)),a=new $Te(s,i),u=this.runWebGLProgram(a,[o],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(n){var r,i=this.texData.get(n),o=i.isPacked,s=i.shape,a=i.dtype,u=AT(s);return r=o?new Hke(u):new Gke(u),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:n}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(n,r,i,o,s){var a=this;s===void 0&&(s=!1);var u=this.makeTensorInfo(n.outputShape,i),c=this.texData.get(u.dataId);if(n.packedOutput&&(c.isPacked=!0),n.outPackingScheme===Wy.DENSE){var l=Qv(n.outputShape);c.texShape=l.map(function(b){return 2*b})}if(n.outTexUsage!=null&&(c.usage=n.outTexUsage),Ke(u.shape)===0)return c.values=Vy(u.dtype,0),u;var d=[],f=r.map(function(b){if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var x=a.texData.get(b.dataId);if(x.texture==null){if(!n.packedInputs&&Ke(b.shape)<=me().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:x.values};n.packedInputs&&(x.isPacked=!0,x.shape=b.shape)}else if(!!x.isPacked!=!!n.packedInputs)b=x.isPacked?a.unpackTensor(b):a.packTensor(b),d.push(b),x=a.texData.get(b.dataId);else if(x.isPacked&&!k1(x.shape,b.shape)){var S=b,C=b.shape;b.shape=x.shape,b=a.packedReshape(b,C),d.push(b),x=a.texData.get(b.dataId),S.shape=C}return a.uploadToGPU(b.dataId),{shape:b.shape,texData:x,isUniform:!1}});this.uploadToGPU(u.dataId);var h,p={shape:u.shape,texData:c,isUniform:!1},m=function(b,x,S){var C="";x.concat(S).forEach(function(I){var N=I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0,$=I.isUniform?"uniform":I.texData.texShape;C+=I.shape+"_"+$+"_"+N});var T=b.userCode,E=b.constructor.name;return E+="_"+C+"_"+T}(n,f,p),v=this.getAndSaveBinary(m,function(){return function(b,x,S,C){var T=x.userCode,E=S.map(function(q,Z){var se={logicalShape:q.shape,texShape:q.isUniform?null:q.texData.texShape,isUniform:q.isUniform,isPacked:!q.isUniform&&q.texData.isPacked,flatOffset:null};return q.texData!=null&&q.texData.slice!=null&&q.texData.slice.flatOffset>0&&(se.flatOffset=q.texData.slice.flatOffset),{name:x.variableNames[Z],shapeInfo:se}}),I=E.map(function(q){return q.shapeInfo}),N={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},$=bke(E,N,T,x.packedInputs),F=b.createProgram($),H=null,G=b.getUniformLocation(F,"NAN",!1);me().getNumber("WEBGL_VERSION")===1&&(H=b.getUniformLocation(F,"INFINITY",!1));for(var J={},ne=0;ne<x.variableNames.length;ne++){var oe=x.variableNames[ne];J[oe]=b.getUniformLocation(F,oe,!1),J["offset"+oe]=b.getUniformLocation(F,"offset"+oe,!1)}return{program:x,source:$,webGLProgram:F,uniformLocations:J,inShapeInfos:I,outShapeInfo:N,infLoc:H,nanLoc:G}}(a.gpgpu,n,f,p)}),g=this.activeTimers!=null;if(g&&(h=this.startTimer()),function(b,x,S,C,T){BU(x.inShapeInfos,S),BU([x.outShapeInfo],[C]);var E=C.texData.texture,I=C.texData.texShape;C.texData.isPacked?b.setOutputPackedMatrixTexture(E,I[0],I[1]):b.setOutputMatrixTexture(E,I[0],I[1]),b.setProgram(x.webGLProgram),me().getNumber("WEBGL_VERSION")===1&&x.infLoc!==null&&b.gl.uniform1f(x.infLoc,1/0),x.nanLoc!==null&&b.gl.uniform1f(x.nanLoc,NaN),S.forEach(function(N,$){var F=x.program.variableNames[$],H=x.uniformLocations[F],G=x.uniformLocations["offset"+F];if(H!=null)if(N.isUniform)if(Ke(N.shape)<2)b.gl.uniform1f(H,N.uniformValues[0]);else{var J=N.uniformValues;J instanceof Float32Array||(J=new Float32Array(J)),b.gl.uniform1fv(H,J)}else N.texData.slice!=null&&G!=null&&b.gl.uniform1i(G,N.texData.slice.flatOffset),b.setInputMatrixTexture(N.texData.texture,H,$)}),T!=null&&T(b,x.webGLProgram),b.executeProgram()}(this.gpgpu,v,f,p,o),d.forEach(function(b){return a.disposeData(b.dataId)}),g&&(h=this.endTimer(h),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(h)})),!me().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&s===!1){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},e.prototype.compileAndRun=function(n,r,i,o,s){s===void 0&&(s=!1),i=i||r[0].dtype;var a=this.runWebGLProgram(n,r,i,o,s);return ee.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var n=this;this.disposed||(me().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Be(function(){if(!me().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=me().getBool("DEBUG");me().set("DEBUG",!1);var i=n.abs(Oe(1e-8)).dataSync()[0];if(me().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(n){var r,i=this.texData.get(n),o=i.shape,s=i.dtype,a=i.values,u=i.texture,c=i.usage,l=i.isPacked;if(u==null){var d,f=this.activeTimers!=null;f&&(d=Pa());var h=i.texShape;if(h==null&&(h=m2e(o,l),i.texShape=h),a!=null){var p=AT(o),m=void 0,v=h[1],g=h[0],y=a instanceof Uint8Array;l?(v=(r=z0(h[0],h[1]))[0],g=r[1],m=new Qke(p,[g,v],y)):m=new Yke(p,[g,v],y);var b=this.makeTensorInfo([g,v],s);this.texData.get(b.dataId).usage=y?Ro.PIXELS:Ro.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),v,g,a);var x=this.runWebGLProgram(m,[b],s,null,!0),S=this.texData.get(x.dataId);i.texture=S.texture,i.texShape=S.texShape,i.isPacked=S.isPacked,i.usage=S.usage,this.disposeData(b.dataId),this.texData.delete(x.dataId),i.values=null,f&&(this.uploadWaitMs+=Pa()-d)}else{var C=this.acquireTexture(h,c,s,l);i.texture=C}}},e.prototype.convertAndCacheOnCPU=function(n,r){var i=this.texData.get(n),o=i.dtype;return this.releaseGPUData(n),r!=null&&(i.values=function(s,a){if(a==="float32"||a==="complex64")return s;if(a==="int32"||a==="bool"){for(var u=a==="int32"?new Int32Array(s.length):new Uint8Array(s.length),c=0;c<u.length;++c)u[c]=Math.round(s[c]);return u}throw new Error("Unknown dtype "+a)}(r,o)),i.values},e.prototype.acquireTexture=function(n,r,i,o){if(this.numBytesInGPU+=this.computeBytes(n,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,o)},e.prototype.computeBytes=function(n,r){return n[0]*n[1]*Qq(r)},e}(w7);o7()&&ee.registerBackend("webgl",function(){return new cEe},2);var lEe=Y({square_:function(t){var e=M(t,"x","square"),n=[e];return ee.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},n,[])}}),Gy="SquaredDifference",U7=Y({squaredDifference_:function(t,e){var n,r=M(t,"a","squaredDifference"),i=M(e,"b","squaredDifference");n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape);var o={a:r,b:i},s=[r,i];return ee.runKernelFunc(function(a,u){var c=a.squaredDifference(r,i);return u([r,i]),c},o,function(a,u){var c=u[0],l=u[1],d=Oe(2);return{a:function(){return a.mul(c.sub(l).mul(d))},b:function(){return a.mul(l.sub(c).mul(d))}}},Gy,{},s,[])}}),dEe=Y({abs_:function(t){var e=M(t,"x","abs");return e.dtype==="complex64"?ee.runKernelFunc(function(n){return n.complexAbs(e)},{$x:e}):ee.runKernelFunc(function(n,r){var i=n.abs(e);return r([e]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mul(i.toFloat().step(-1))}}},"Abs")}}),fEe=Y({acos_:function(t){var e=M(t,"x","acos");return ee.runKernelFunc(function(n,r){var i=n.acos(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(Oe(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),hEe=Y({acosh_:function(t){var e=M(t,"x","acosh");return ee.runKernelFunc(function(n,r){var i=n.acosh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),pEe=Y({asin_:function(t){var e=M(t,"x","asin");return ee.runKernelFunc(function(n,r){var i=n.asin(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(Oe(1).sub(i.toFloat().square()).sqrt())}}})}}),mEe=Y({asinh_:function(t){var e=M(t,"x","asinh");return ee.runKernelFunc(function(n,r){var i=n.asinh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(Oe(1).add(i.toFloat().square()).sqrt())}}})}}),gEe=Y({atan_:function(t){var e=M(t,"x","atan");return ee.runKernelFunc(function(n,r){var i=n.atan(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.toFloat().square().add(1))}}})}}),vEe=Y({atanh_:function(t){var e=M(t,"x","atanh");return ee.runKernelFunc(function(n,r){var i=n.atanh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(Oe(1).sub(i.toFloat().square()))}}})}}),yEe=Y({ceil_:function(t){var e=M(t,"x","ceil");return ee.runKernelFunc(function(n){return n.ceil(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),tA=Y({clipByValue_:function(t,e,n){var r=M(t,"x","clipByValue");V(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."});var i=[r],o={min:e,max:n};return ee.runKernelFunc(function(s,a){var u=s.clip(r,e,n);return a([r]),u},{x:r},function(s,a){var u=a[0];return{x:function(){return s.where(u.greaterEqual(e).logicalAnd(u.lessEqual(n)),$t(s))}}},"ClipByValue",o,i)}}),bEe=Y({cos_:function(t){var e=M(t,"x","cos"),n=[e];return ee.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),xEe=Y({cosh_:function(t){var e=M(t,"x","cosh");return ee.runKernelFunc(function(n,r){var i=n.cosh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(n)}}})}}),wEe=Y({erf_:function(t){var e=M(t,"x","erf");return V(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),ee.runKernelFunc(function(n,r){var i=n.erf(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),LI=Y({exp_:function(t){var e=M(t,"x","exp");return ee.runKernelFunc(function(n,r){var i=n.exp(e);return r([i]),i},{x:e},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),SEe=Y({expm1_:function(t){var e=M(t,"x","expm1");return ee.runKernelFunc(function(n,r){var i=n.expm1(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.exp())}}})}}),CEe=Y({floor_:function(t){var e=M(t,"x","floor");return ee.runKernelFunc(function(n){return n.floor(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),kEe=Y({log_:function(t){var e=M(t,"x","log"),n=[e];return ee.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},n)}}),TEe=Y({log1p_:function(t){var e=M(t,"x","log1p");return ee.runKernelFunc(function(n,r){var i=n.log1p(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.add(1))}}})}}),EEe=Y({logSigmoid_:function(t){var e=M(t,"x","logSigmoid");return ee.runKernelFunc(function(n,r){var i=n.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.neg().sigmoid())}}})}}),aS=Y({neg_:function(t){var e=M(t,"x","neg"),n=[e];return ee.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),_Ee=Y({reciprocal_:function(t){var e=M(t,"x","reciprocal");return ee.runKernelFunc(function(n,r){var i=n.reciprocal(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.square().neg())}}})}}),IEe=Y({round_:function(t){var e=M(t,"x","round");return ee.runKernelFunc(function(n){return n.round(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),V7=Y({rsqrt_:function(t){var e=M(t,"x","rsqrt"),n=[e];return ee.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),z7=Y({sigmoid_:function(t){var e=M(t,"x","sigmoid");return ee.runKernelFunc(function(n,r){var i=n.sigmoid(e);return r([i]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mul(i.mul(Oe(1).sub(i)))}}},"Sigmoid")}}),REe=Y({sign_:function(t){var e=M(t,"x","sign");return ee.runKernelFunc(function(n){return n.sign(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),NEe=Y({isNaN_:function(t){var e=M(t,"x","isNaN");return ee.runKernelFunc(function(n){return n.isNaN(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),PEe=Y({isInf_:function(t){var e=M(t,"x","isInf");return ee.runKernelFunc(function(n){return n.isInf(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),AEe=Y({isFinite_:function(t){var e=M(t,"x","isFinite");return ee.runKernelFunc(function(n){return n.isFinite(e)},{$x:e},function(n){return{$x:function(){return $t(n)}}})}}),$Ee=Y({sin_:function(t){var e=M(t,"x","sin"),n=[e];return ee.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},n)}}),DEe=Y({sinh_:function(t){var e=M(t,"x","sinh");return ee.runKernelFunc(function(n,r){var i=n.sinh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(n)}}})}}),OEe=Y({softplus_:function(t){var e=M(t,"x","softplus");return ee.runKernelFunc(function(n,r){var i=n.softplus(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.sigmoid())}}})}}),FEe=Y({sqrt_:function(t){var e=M(t,"x","sqrt");return ee.runKernelFunc(function(n,r){var i=n.sqrt(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.toFloat().sqrt().mul(2))}}})}}),LEe=Y({step_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","step");return ee.runKernelFunc(function(r){return r.step(n,e)},{$x:n},function(r){return{$x:function(){return $t(r)}}})}}),MEe=Y({tan_:function(t){var e=M(t,"x","tan");return ee.runKernelFunc(function(n,r){var i=n.tan(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.cos().square())}}})}}),BEe=Y({tanh_:function(t){var e=M(t,"x","tanh");return ee.runKernelFunc(function(n,r){var i=n.tanh(e);return r([i]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return Oe(1).sub(i.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function W7(t,e,n,r,i,o){var s,a,u=M(t,"x","batchNorm"),c=M(e,"mean","batchNorm"),l=M(n,"variance","batchNorm");return i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),V(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),V(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),V(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),s!=null&&V(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),a!=null&&V(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),j0(u,c,l,a,s,o)}function j7(t,e,n,r,i,o){var s,a,u=M(t,"x","batchNorm"),c=M(e,"mean","batchNorm"),l=M(n,"variance","batchNorm");return i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),V(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),V(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),V(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),s!=null&&V(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),a!=null&&V(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),j0(u,c,l,a,s,o)}function G7(t,e,n,r,i,o){var s,a,u=M(t,"x","batchNorm"),c=M(e,"mean","batchNorm"),l=M(n,"variance","batchNorm");return i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),V(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),V(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),V(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),s!=null&&V(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),a!=null&&V(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),j0(u,c,l,a,s,o)}function j0(t,e,n,r,i,o){o==null&&(o=.001);var s,a,u,c=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),d=M(n,"variance","batchNorm");i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),V(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),V(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),V(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var f=[c,l,d,s];return ee.runKernelFunc(function(h,p){var m=h.batchNormalization(u,R1(l),R1(d),o,R1(s),R1(a));return p([c,l,d,s]),m},{x:c,mean:l,variance:d,scale:s,offset:a},function(h,p){var m=p,v=m[0],g=m[1],y=m[2],b=m[3],x=b??Oe(1),S=fr(g.shape,u.shape),C=[];if(g.rank===1){for(var T=0;T<u.shape.length-1;++T)C.push(u.shape[T]);C.push(1)}var E=v.sub(g),I=h.mul(x),N=V7(y.add(Oe(o))),$=N.mul(N).mul(N).mul(Oe(-.5));return{x:function(){return g.rank===1?h.mul(em(N.as4D(1,1,1,g.shape[0]),C)).mul(x).reshape(v.shape):h.mul(N).mul(x).reshape(v.shape)},mean:function(){var F=N.mul(Oe(-1)).mul(I);return g.rank===1&&(F=F.sum(S)),F.reshape(g.shape)},variance:function(){var F=$.mul(E).mul(I);return g.rank===1&&(F=F.sum(S)),F.reshape(g.shape)},scale:function(){var F=E.mul(N),H=h.mul(F);return g.rank===1&&(H=H.sum(S)),H.reshape(g.shape)},offset:function(){var F=h;return g.rank===1&&(F=F.sum(S)),F.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:o},f).reshape(c.shape)}function R1(t){return t==null?null:t.rank===0?t.as1D():t.rank===1?t:t.rank===2?t.as4D(1,1,t.shape[0],t.shape[1]):t.rank===3?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function KC(){s7("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var UEe=Y({batchNormalization2d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),KC(),W7(t,e,n,o,i,r)}}),VEe=Y({batchNormalization3d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),KC(),j7(t,e,n,o,i,r)}}),zEe=Y({batchNormalization4d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),KC(),G7(t,e,n,o,i,r)}}),WEe=Y({batchNormalization_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),KC(),j0(t,e,n,o,i,r)}}),H7=Y({batchNorm_:j0}),jEe=Y({batchNorm2d_:W7}),GEe=Y({batchNorm3d_:j7}),HEe=Y({batchNorm4d_:G7}),XC=Y({logicalAnd_:function(t,e){var n=M(t,"a","logicalAnd","bool"),r=M(e,"b","logicalAnd","bool");return It(n.shape,r.shape),ee.runKernelFunc(function(i){return i.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),qEe=Y({logicalNot_:function(t){var e=M(t,"x","logicalNot","bool");return ee.runKernelFunc(function(n){return n.logicalNot(e)},{$x:e})}}),q7=Y({logicalOr_:function(t,e){var n=M(t,"a","logicalOr","bool"),r=M(e,"b","logicalOr","bool");return It(n.shape,r.shape),ee.runKernelFunc(function(i){return i.logicalOr(n,r)},{$a:n,$b:r})}}),KEe=Y({logicalXor_:function(t,e){var n=M(t,"a","logicalXor","bool"),r=M(e,"b","logicalXor","bool");return It(n.shape,r.shape),q7(t,e).logicalAnd(XC(t,e).logicalNot())}}),Wf=Y({where_:function(t,e,n){var r=M(e,"a","where"),i=M(n,"b","where"),o=M(t,"condition","where","bool");return Xt(r.shape,i.shape,"Error in where: "),o.rank===1?V(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Xt(o.shape,i.shape,"Error in where: "),ee.runKernelFunc(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return $t(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),K7=function(t){return We(this,void 0,void 0,function(){var e,n,r;return je(this,function(i){switch(i.label){case 0:return[4,(e=M(t,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=YP(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},Ct=Y({add_:function(t,e){var n,r=M(t,"a","add"),i=M(e,"b","add");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s){return s.add(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=fr(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=fr(i.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}},"Add")}}),XEe=Y({addN_:function(t){V(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),V(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(i,o){return M(i,"tensors"+o,"addN")}),n=e[0];e.forEach(function(i){if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Cr(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return ee.runKernelFunc(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(s,a){o[a]=function(){return i.clone()}}),o},"AddN")}}),JEe=Y({addStrict_:function(t,e){var n=M(t,"a","addStrict"),r=M(e,"b","addStrict");return Xt(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),YEe=Y({atan2_:function(t,e){var n,r=M(t,"a","atan2"),i=M(e,"b","atan2");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],c=a[1];return{$a:function(){var l=Ct(u.square(),c.square()),d=s.mul(c.div(l)),f=fr(u.shape,o);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=Ct(u.square(),c.square()),d=aS(s.mul(u.div(l))),f=fr(c.shape,o);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Ws=Y({div_:function(t,e){var n,r=M(t,"a","div"),i=M(e,"b","div");if(n=On(r,i),r=n[0],i=n[1],r.dtype==="int32"&&i.dtype==="int32")return X7(r,i);var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var l=s.div(c.toFloat()),d=fr(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=s.mul(u.toFloat()),d=fr(c.shape,o);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),QEe=Y({divNoNan_:function(t,e){var n,r=M(t,"a","div"),i=M(e,"b","div");r=(n=On(r,i))[0],i=n[1];var o=Ws(r,i),s=$t(o),a=i.equal(s);return Wf(a,s,o)}}),ZEe=Y({divStrict_:function(t,e){var n=M(t,"a","div"),r=M(e,"b","div");return Xt(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),X7=Y({floorDiv_:function(t,e){var n,r=M(t,"a","floorDiv"),i=M(e,"b","floorDiv");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var l=s.div(c.toFloat()),d=fr(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=s.mul(u.toFloat()),d=fr(c.shape,o);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),nA=Y({maximum_:function(t,e){var n,r=M(t,"a","maximum"),i=M(e,"b","maximum");return n=On(r,i),r=n[0],i=n[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),It(r.shape,i.shape),ee.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.greaterEqual(u).toFloat())},b:function(){return o.mul(a.less(u).toFloat())}}},"Maximum")}}),e_e=Y({maximumStrict_:function(t,e){var n=M(t,"a","maximumStrict"),r=M(e,"b","maximumStrict");return Xt(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),J7=Y({minimum_:function(t,e){var n,r=M(t,"a","minimum"),i=M(e,"b","minimum");return n=On(r,i),r=n[0],i=n[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),It(r.shape,i.shape),ee.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.lessEqual(u).toFloat())},b:function(){return o.mul(a.greater(u).toFloat())}}},"Minimum")}}),t_e=Y({minimumStrict_:function(t,e){var n=M(t,"a","minimumStrict"),r=M(e,"b","minimumStrict");return Xt(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),n_e=Y({mod_:function(t,e){var n,r=M(t,"a","mod"),i=M(e,"b","mod");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],c=a[1];return{$a:function(){var l=fr(u.shape,o);return l.length>0?s.sum(l).reshape(u.shape):s},$b:function(){var l=s.mul(u.div(c).floor().neg()),d=fr(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),r_e=Y({modStrict_:function(t,e){var n=M(t,"a","modStrict"),r=M(e,"b","modStrict");return Xt(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),hi=Y({mul_:function(t,e){var n,r=M(t,"a","mul"),i=M(e,"b","mul");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var l=s.mul(c.toFloat()),d=fr(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=s.mul(u.toFloat()),d=fr(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),i_e=Y({mulStrict_:function(t,e){var n=M(t,"a","mul"),r=M(e,"b","mul");return Xt(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),uS=Y({pow_:function(t,e){var n,r=M(t,"base","pow"),i=M(e,"exp","pow");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape),s=[r,i];return ee.runKernelFunc(function(a,u){var c=a.pow(r,i);return u([r,i,c]),c},{a:r,b:i},function(a,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=a.mul(f.mul(c.pow(f.sub(Oe(1))))),p=fr(c.shape,o);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,$t(c)),p=a.mul(d.mul(h)),m=fr(l.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(l.shape)}}},"Pow",{},s,[!0])}}),o_e=Y({powStrict_:function(t,e){return Xt(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),s_e=Y({squaredDifferenceStrict_:function(t,e){var n=M(t,"a","squaredDifferenceStrict"),r=M(e,"b","squaredDifferenceStrict");return Xt(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),hr=Y({sub_:function(t,e){var n,r=M(t,"a","sub"),i=M(e,"b","sub");n=On(r,i),r=n[0],i=n[1];var o=It(r.shape,i.shape);return ee.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=fr(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=fr(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),a_e=Y({subStrict_:function(t,e){var n=M(t,"a","subStrict"),r=M(e,"b","subStrict");return Xt(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Y7=Y({equal_:function(t,e){var n,r=M(t,"a","equal"),i=M(e,"b","equal");return n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape),ee.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),u_e=Y({equalStrict_:function(t,e){var n=M(t,"a","equalStrict"),r=M(e,"b","equalStrict");return Xt(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),c_e=Y({greater_:function(t,e){var n,r=M(t,"a","greater"),i=M(e,"b","greater");return n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape),ee.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),Q7=Y({greaterEqual_:function(t,e){var n,r=M(t,"a","greaterEqual"),i=M(e,"b","greaterEqual");return n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape),ee.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return $t(a)},b:function(){return $t(u)}}},"GreaterEqual")}}),l_e=Y({greaterEqualStrict_:function(t,e){var n=M(t,"a","greaterEqualStrict"),r=M(e,"b","greaterEqualStrict");return Xt(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),d_e=Y({greaterStrict_:function(t,e){var n=M(t,"a","greaterStrict"),r=M(e,"b","greaterStrict");return Xt(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),f_e=Y({less_:function(t,e){var n,r=M(t,"a","less"),i=M(e,"b","less");return n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape),ee.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),h_e=Y({lessEqual_:function(t,e){var n,r=M(t,"a","lessEqual"),i=M(e,"b","lessEqual");return n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape),ee.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),p_e=Y({lessEqualStrict_:function(t,e){var n=M(t,"a","lessEqualStrict"),r=M(e,"b","lessEqualStrict");return Xt(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),m_e=Y({lessStrict_:function(t,e){var n=M(t,"a","lessStrict"),r=M(e,"b","lessStrict");return Xt(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),g_e=Y({notEqual_:function(t,e){var n,r=M(t,"a","notEqual"),i=M(e,"b","notEqual");return n=On(r,i),r=n[0],i=n[1],It(r.shape,i.shape),ee.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),v_e=Y({notEqualStrict_:function(t,e){var n=M(t,"a","notEqualStrict"),r=M(e,"b","notEqualStrict");return Xt(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function XU(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function JU(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var rA=Y({gather_:function(t,e,n){n===void 0&&(n=0);var r=M(t,"x","gather"),i=M(e,"indices","gather","int32");n=mr(n,r.shape)[0];var o=function(s,a,u){for(var c=s.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(s.shape[h]),d*=s.shape[h];for(h=0;h<a.rank;h++)l.push(a.shape[h]);for(h=u+1;h<s.rank;h++)l.push(s.shape[h]),f*=s.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,i,n);return ee.runKernelFunc(function(s,a){var u=s.gather(r,i.flatten(),n);return a([i]),u},{x:r,indices:i},function(s,a){var u=a[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,n),f=d.length,h=c.slice(n,c.length).slice(1),p=h.length,m=XU(0,f),v=XU(f+1,f+1+p),g=JU([d,[l],h]),y=s.reshape(g),b=u.reshape([l]),x=JU([[f],m,v]),S=y.transpose(x),C=Z7(S,b,r.shape[n]),T=WP(x);return C=C.transpose(T)},indices:function(){return u}}},"Gather",{axis:n}).reshape(o.outputShape)}}),Z7=Y({unsortedSegmentSum_:function(t,e,n){var r=M(t,"x","unsortedSegmentSum"),i=M(e,"segmentIds","unsortedSegmentSum","int32");return V(Vn(n),function(){return"numSegments must be of dtype int"}),ee.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,n);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,c){for(var l=nA(c,$t(c)),d=rA(u,l),f=Q7(c,Oe(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=us(f,p+1);f=XC(f,rg(d.shape,"bool"));var m=$t(d);return Wf(f,d,m)}(o,a)}}})}}),y_e=function(t,e,n){return We(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m;return je(this,function(v){switch(v.label){case 0:for(r=M(t,"tensor","boolMask"),i=M(e,"mask","boolMask","bool"),o=n??0,s=i.rank,a=r.shape,V(s>0,function(){return"mask cannot be scalar"}),Xt(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+s;c++)u*=a[c];return l=a.slice(0,o).concat([u],a.slice(o+s)),d=r.reshape(l),f=i.reshape([-1]),[4,K7(f)];case 1:return h=v.sent(),p=h.squeeze([1]),m=rA(d,p,o),t!==r&&r.dispose(),e!==i&&i.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,m]}})})};function eK(t,e,n,r,i,o,s){o===void 0&&(o="NHWC"),V(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var a=t,u=e,c=!1;e.rank===3&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,t[0],t[1],t[2]]),V(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),V(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),V(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var l=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?u.shape[3]:u.shape[1];V(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),V(d===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."}),s!=null&&V(Vn(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var f=KP(o),h=vh(a,n.shape,r,1,i,s,!1,f),p=ee.runKernelFunc(function(m,v){var g=m.conv2dDerInput(u,n,h);return v([n,u]),g},{dy4D:u,filter:n},function(m,v){var g=v[0],y=v[1];return{dy4D:function(){return Is(m,g,r,i,o,1,s)},filter:function(){return iA(m,y,g.shape,r,i,o,s)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function UT(t){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(t),n=e[0],r=e[1],i=e[2];return n===1&&r===1&&i===1}function tK(t,e,n,r,i){V(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var o=t,s=e,a=!1;e.rank===4&&(a=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,t[0],t[1],t[2],t[3]]);var u=o[4],c=s.shape[4];V(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),V(s.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),V(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),V(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),V(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."});var l=oS(o,n.shape,r,1,i),d=ee.runKernelFunc(function(f){return f.conv3dDerInput(s,n,l)},{dy5D:s});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var b_e=Y({conv1d_:function(t,e,n,r,i,o,s){i===void 0&&(i="NWC"),o===void 0&&(o=1);var a=M(t,"x","conv1d"),u=M(e,"filter","conv1d"),c=a,l=!1;a.rank===2&&(l=!0,c=a.as3D(1,a.shape[0],a.shape[1])),V(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),V(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),s!=null&&V(Vn(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),V(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),V(po(n,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"}),V(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Is(f,d,[1,n],r,"NHWC",[1,o],s);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Is=Y({conv2d_:function(t,e,n,r,i,o,s){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var a=M(t,"x","conv2d"),u=M(e,"filter","conv2d"),c=a,l=!1;a.rank===3&&(l=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),V(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),V(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),s!=null&&V(Vn(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var d=i==="NHWC"?c.shape[3]:c.shape[1];V(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),V(po(n,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"});var f=KP(i),h=vh(c.shape,u.shape,n,o,r,s,!1,f),p=[u,c],m=ee.runKernelFunc(function(v,g){var y=v.conv2d(c,u,h);return g([u,c]),y},{x:c,filter:u},function(v,g){var y=g,b=y[0],x=y[1];return V(Pm(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return nK(x.shape,v,b,n,r,i)},filter:function(){return iA(x,v,b.shape,n,r,i)}}},"Conv2D",h,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),x_e=Y({conv3d_:function(t,e,n,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var s=M(t,"x","conv3d"),a=M(e,"filter","conv3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),V(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),V(a.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),V(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),V(function(f,h){return UT(f)||UT(h)}(n,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),V(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var l=oS(u.shape,a.shape,n,o,r),d=ee.runKernelFunc(function(f,h){var p=f.conv3d(u,a,l);return h([u,a]),p},{x:u,$filter:a},function(f,h){V(UT(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=h[0],m=h[1];return{x:function(){return tK(p.shape,f,m,n,r)},$filter:function(){return function(v,g,y,b,x){var S=v;v.rank===4&&(S=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var C=g;C.rank===4&&(C=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),V(S.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+S.shape+"."}),V(C.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),V(y.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),V(S.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+S.shape[4]+") must match input depth in filter ("+y[3]+"."}),V(C.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+y[4]+")."});var T=oS(S.shape,y,b,1,x);return ee.runKernelFunc(function(E){return E.conv3dDerFilter(S,C,T)},{x5D:S,dy5D:C})}(p,f,m.shape,n,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),iA=Y({conv2dDerFilter_:function(t,e,n,r,i,o,s){o===void 0&&(o="NHWC");var a=t;t.rank===3&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),V(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),V(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),V(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var c=o==="NHWC"?a.shape[3]:a.shape[1],l=o==="NHWC"?u.shape[3]:u.shape[1];V(c===n[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."}),V(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."}),s!=null&&V(Vn(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var d=KP(o),f=vh(a.shape,n,r,1,i,s,!1,d);return ee.runKernelFunc(function(h){return h.conv2dDerFilter(a,u,f)},{x4D:a,dy4D:u})}}),nK=Y({conv2dDerInput_:eK}),JC=Y({depthwiseConv2d_:function(t,e,n,r,i,o,s){o===void 0&&(o=[1,1]);var a=M(t,"x","depthwiseConv2d"),u=M(e,"filter","depthwiseConv2d"),c=a,l=!1;a.rank===3&&(l=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),V(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),V(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),V(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),V(po(n,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),s!=null&&V(Vn(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var d=vh(c.shape,u.shape,n,o,r,s,!0),f=[c,u],h=ee.runKernelFunc(function(p,m){var v=p.depthwiseConv2D(c,u,d);return m([c,u]),v},{x:c,filter:u},function(p,m){V(Pm(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var v=m[0],g=m[1];return{x:function(){return rK(v.shape,p,g,d)},filter:function(){return iK(v,p,g.shape,d)}}},"DepthwiseConv2dNative",d,f);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),rK=Y({depthwiseConv2dDerInput_:function(t,e,n,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=ee.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),iK=Y({depthwiseConv2dDerFilter_:function(t,e,n,r){var i=t;t.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ee.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),oA=Y({separableConv2d_:function(t,e,n,r,i,o,s){o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC");var a=M(t,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(n,"pointwiseFilter","separableConv2d"),l=a,d=!1;if(a.rank===3&&(d=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),V(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),V(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),V(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),V(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];V(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=JC(l,u,r,i,s,o),m=Is(p,c,1,"valid",s);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),w_e=Y({conv2dTranspose_:function(t,e,n,r,i,o){return eK(n,M(t,"x","conv2dTranspose"),M(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),S_e=Y({conv3dTranspose_:function(t,e,n,r,i){return tK(n,M(t,"x","conv3dTranspose"),M(e,"filter","conv3dTranspose"),r,i)}}),YC=Y({matMul_:function(t,e,n,r){var i;n===void 0&&(n=!1),r===void 0&&(r=!1);var o=M(t,"a","matMul"),s=M(e,"b","matMul");i=On(o,s),o=i[0],s=i[1];var a=n?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],c=n?o.shape[o.rank-1]:o.shape[o.rank-2],l=r?s.shape[s.rank-2]:s.shape[s.rank-1],d=o.shape.slice(0,-2),f=s.shape.slice(0,-2),h=Ke(d),p=Ke(f);V(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),V(Cr(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),V(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=o.shape.slice(0,-2).concat([c,l]),v=n?o.as3D(h,a,c):o.as3D(h,c,a),g=r?s.as3D(p,l,u):s.as3D(p,u,l),y={transposeA:n,transposeB:r};return ee.runKernelFunc(function(b,x){var S=b.batchMatMul(v,g,n,r);return x([v,g]),S},{a:v,b:g},function(b,x){var S=x,C=S[0],T=S[1];return n||r?!n&&r?{a:function(){return b.matMul(T,!1,!1)},b:function(){return b.matMul(C,!0,!1)}}:n&&!r?{a:function(){return T.matMul(b,!1,!0)},b:function(){return C.matMul(b,!1,!1)}}:{a:function(){return T.matMul(b,!0,!0)},b:function(){return b.matMul(C,!0,!0)}}:{a:function(){return b.matMul(T,!1,!0)},b:function(){return C.matMul(b,!0,!1)}}},"BatchMatMul",y).reshape(m)}}),C_e=Y({dot_:function(t,e){var n=M(t,"t1","dot"),r=M(e,"t2","dot");V(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var i=n.rank===1?n.size:n.shape[1],o=r.rank===1?r.size:r.shape[0];return V(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),k_e=Y({outerProduct_:function(t,e){var n=M(t,"v1","outerProduct"),r=M(e,"v2","outerProduct");return V(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),G0=Y({reverse_:function(t,e){var n=M(t,"x","reverse");if(n.rank===0)return n.clone();var r=mr(e,n.shape);return ee.runKernelFunc(function(i){return i.reverse(n,r)},{$x:n},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(n)}}),T_e=Y({reverse1d_:function(t){var e=M(t,"x","reverse");return V(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),G0(e,0)}}),E_e=Y({reverse2d_:function(t,e){var n=M(t,"x","reverse");return V(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),G0(n,e)}}),__e=Y({reverse3d_:function(t,e){var n=M(t,"x","reverse");return V(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),G0(n,e)}}),I_e=Y({reverse4d_:function(t,e){var n=M(t,"x","reverse");return V(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),G0(n,e)}});function oK(t,e,n,r,i,o){var s=M(t,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),r==null&&(r=[1,1]),V(a.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),V(po(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),o!=null&&V(Vn(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=jy(a.shape,e,n,r,i,o);if(c.filterWidth===1&&c.filterHeight===1&&Cr(c.inShape,c.outShape))return s.clone();var l=[a],d=ee.runKernelFunc(function(f,h){var p=f.maxPool(a,c);return h([a,p]),p},{x:a},function(f,h){var p=h[0],m=h[1];return{x:function(){return function(v,g,y,b,x,S,C,T){var E=M(v,"dy","maxPoolBackprop"),I=M(g,"input","maxPoolBackprop"),N=M(y,"output","maxPoolBackprop");V(I.rank===E.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+E.rank+")"}),S==null&&(S=[1,1]),V(po(x,S),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+S+"'"}),V(E.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),V(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."}),T!=null&&V(Vn(C),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+C+"."});var $=jy(I.shape,b,x,S,C,T);return ee.runKernelFunc(function(F){return F.maxPoolBackprop(E,I,N,$)},{$dy:E,$input:I})}(f,p,m,e,n,r,i)}}},"MaxPool",c,l);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function sK(t,e,n,r,i,o){var s=M(t,"x","avgPool","float32");r==null&&(r=[1,1]),V(po(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),V(a.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),o!=null&&V(Vn(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=jy(a.shape,e,n,r,i,o);if(c.filterWidth===1&&c.filterHeight===1&&Cr(c.inShape,c.outShape))return s.clone();var l=ee.runKernelFunc(function(d){return d.avgPool(a,c)},{x:a},function(d){return{x:function(){return function(f,h,p,m,v,g){var y=M(f,"dy","avgPoolBackprop"),b=M(h,"input","avgPoolBackprop");V(b.rank===y.rank,function(){return"Rank of input ("+b.rank+") does not match rank of dy ("+y.rank+")"}),v==null&&(v=[1,1]),V(po(m,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+v+"'"});var x=b,S=y,C=!1;b.rank===3&&(C=!0,x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),S=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),V(S.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),V(x.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+x.rank+"."});var T=jy(x.shape,p,m,v,g),E=ee.runKernelFunc(function(I){return I.avgPoolBackprop(S,x,T)},{dy4D:S,input4D:x});return C?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(d,a,e,n,r,i)}}},"AvgPool",c);return l=l.cast(s.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var yr=Y({maxPool_:function(t,e,n,r,i){return oK(t,e,n,1,r,i)}}),H0=Y({avgPool_:function(t,e,n,r,i){return sK(t,e,n,1,r,i)}}),R_e=Y({pool_:function(t,e,n,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var s=M(t,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),V(po(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,l=jy(a.shape,e,o,i,r),d=[l.dilationHeight,l.dilationWidth];c=r==="same"?function(x,S){var C=x.map(function(I,N){return I+(I-1)*(S[N]-1)}).map(function(I){return I-1}),T=C.map(function(I){return Math.floor(I/2)}),E=C.map(function(I,N){return I-T[N]});return C.map(function(I,N){return[T[N],E[N]]})}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var f=d[0]===1&&d[1]===1,h=function(x,S,C){var T=C.map(function(G){return G[0]}),E=C.map(function(G){return G[1]}),I=x.concat(T,E),N=S.map(function(G,J){return(G-I[J]%G)%G}),$=E.map(function(G,J){return G+N[J]}),F=S.map(function(G,J){return[T[J],$[J]]}),H=S.map(function(G,J){return[0,N[J]]});return[F,H]}([l.inHeight,l.inWidth],d,c),p=h[0],m=h[1],v=f?r:"valid",g=f?a:f7(a,d,p),y=(n==="avg"?function(){return sK(g,e,o,1,v)}:function(){return oK(g,e,o,1,v)})(),b=f?y:c7(y,d,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),N_e=Y({maxPool3d_:function(t,e,n,r,i,o,s){o===void 0&&(o="NDHWC");var a=M(t,"x","maxPool3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),V(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),V(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),V(po(n,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),i!=null&&V(Vn(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=iS(u.shape,e,n,s,r,i,o),d=ee.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],m=h[1];return{x:function(){return function(v,g,y,b,x,S,C,T){var E=M(v,"dy","maxPool3dBackprop"),I=M(g,"input","maxPool3dBackprop"),N=M(y,"output","maxPool3dBackprop"),$=E,F=I,H=N,G=!1;I.rank===4&&(G=!0,$=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),F=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),H=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),V($.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+$.rank+"."}),V(F.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+F.rank+"."}),V(H.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+H.rank+"."}),S==null&&(S=[1,1,1]),V(po(x,S),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+S+"'"}),T!=null&&V(Vn(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+C+"."});var J=iS(F.shape,b,x,S,C,T),ne=ee.runKernelFunc(function(oe){return oe.maxPool3dBackprop($,F,H,J)},{dy5D:$,input5D:F});return G?ne.as4D(ne.shape[1],ne.shape[2],ne.shape[3],ne.shape[4]):ne}(f,p,m,e,n,s,r,i)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),P_e=Y({avgPool3d_:function(t,e,n,r,i,o,s){o===void 0&&(o="NDHWC");var a=M(t,"x","avgPool3d","float32"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),V(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),V(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),V(po(n,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),i!=null&&V(Vn(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=iS(u.shape,e,n,s,r,i,o),d=ee.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,m,v,g,y,b){var x=M(h,"dy","avgPool3dBackprop"),S=M(p,"input","avgPool3dBackprop"),C=x,T=S,E=!1;S.rank===4&&(E=!0,C=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]),T=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),V(C.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."}),V(T.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),g==null&&(g=[1,1,1]),V(po(v,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"}),b!=null&&V(Vn(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+b+" but got pad "+y+"."});var I=iS(T.shape,m,v,g,y,b),N=ee.runKernelFunc(function($){return $.avgPool3dBackprop(C,T,I)},{dy5D:C,input5D:T});return E?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N}(f,u,e,n,s,r,i)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),lu=Y({slice_:function(t,e,n){var r,i,o=M(t,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){V(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=n==null?new Array(o.rank).fill(-1):typeof n=="number"?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(u,c){return u>=0?u:(V(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),o.shape[c]-r[c])}),oke(o,r,i);var s=o.shape,a={begin:r,size:i};return ee.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],s[l]-r[l]-i[l]]);return{x:function(){return u.pad(c)}}},"Slice",a)}}),A_e=Y({slice1d_:function(t,e,n){var r=M(t,"x","slice1d");return V(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),lu(r,[e],[n])}}),$_e=Y({slice2d_:function(t,e,n){var r=M(t,"x","slice2d");return V(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),lu(r,e,n)}}),aK=Y({slice3d_:function(t,e,n){var r=M(t,"x","slice3d");return V(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),lu(r,e,n)}}),D_e=Y({slice4d_:function(t,e,n){var r=M(t,"x","slice4d");return V(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),lu(r,e,n)}});function uK(t,e,n,r,i){return e.rank<n.rank&&(e=e.reshape(ho(e.shape,r))),t.rank<n.rank&&(t=t.reshape(ho(t.shape,r))),{x:function(){var o=t.mul(n.equal(e).cast(t.dtype));return i==null?o:o.transpose(i)}}}var O_e=Y({all_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","all","bool"),i=mr(e,r.shape),o=i,s=xu(o,r.rank);s!=null&&(r=r.transpose(s),o=wu(o.length,r.rank));var a=ee.runKernelFunc(function(c){return c.all(r,o)},{$x:r});if(n){var u=ho(a.shape,i);return a.reshape(u)}return a}}),F_e=Y({any_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","any","bool"),i=mr(e,r.shape),o=i,s=xu(o,r.rank);s!=null&&(r=r.transpose(s),o=wu(o.length,r.rank));var a=ee.runKernelFunc(function(c){return c.any(r,o)},{$x:r});if(n){var u=ho(a.shape,i);return a.reshape(u)}return a}}),L_e=Y({argMax_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","argMax");e==null&&(e=0);var r=mr(e,n.shape),i=xu(r,n.rank);i!=null&&(n=n.transpose(i),r=wu(r.length,n.rank));var o={axis:r[0]},s=[n];return ee.runKernelFunc(function(a,u){var c=a.argMax(n,r[0]);return u([n]),c},{x:n},function(a,u){var c=u[0];return{x:function(){return $t(c)}}},"ArgMax",o,s)}}),M_e=Y({argMin_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","argMin");e==null&&(e=0);var r=mr(e,n.shape),i=xu(r,n.rank);return i!=null&&(n=n.transpose(i),r=wu(r.length,n.rank)),ee.runKernelFunc(function(o,s){var a=o.argMin(n,r[0]);return s([n]),a},{$x:n},function(o,s){var a=s[0];return{$x:function(){return $t(a)}}})}}),B_e=Y({logSumExp_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","logSumExp"),i=mr(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(n){var u=ho(a.shape,i);return a.reshape(u)}return a}}),QC=Y({max_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","max"),i=r,o=mr(e,r.shape),s=o,a=xu(s,r.rank);a!=null&&(r=r.transpose(a),s=wu(s.length,r.rank));var u=[r],c=ee.runKernelFunc(function(d,f){var h=d.max(r,s);return f([i,h]),h},{x:r},function(d,f){return uK(d,f[1],f[0],o,a)},"Max",{axes:s},u,[!0]);if(n){var l=ho(c.shape,o);c=c.reshape(l)}return c}}),U_e=Y({mean_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","mean"),i=mr(e,r.shape),o=Ke(ei(r.shape,i)[1]);return qC(function(s){var a=Oe(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,n),gradFunc:function(u){var c=s.shape.slice();return i.forEach(function(l){c[l]=1}),u.reshape(c).mul(rg(s.shape,"float32")).div(o)}}})(r)}}),V_e=Y({min_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","min"),i=r,o=mr(e,r.shape),s=o,a=xu(s,r.rank);a!=null&&(r=r.transpose(a),s=wu(s.length,r.rank));var u=[r],c=ee.runKernelFunc(function(d,f){var h=d.min(r,s);return f([i,h]),h},{x:r},function(d,f){return uK(d,f[1],f[0],o,a)},"Min",{axes:s},u,[!0]);if(n){var l=ho(c.shape,o);c=c.reshape(l)}return c}}),z_e=Y({moments_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=mr(e,(t=M(t,"x","moments")).shape),i=t.mean(r,n),o=i.shape;n||(o=ho(i.shape,r));var s=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,n)}}}),cK=Y({sum_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=mr(e,r.shape);return qC(function(o){var s=xu(i,o.rank),a=i,u=o;s!=null&&(u=o.transpose(s),a=wu(a.length,o.rank));var c=function(h){var p=o.shape.slice();return i.forEach(function(m){p[m]=1}),h.reshape(p).mul(rg(o.shape,"float32"))},l={axes:a},d=ee.runKernelFunc(function(h){return h.sum(u,a)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",l);if(n){var f=ho(d.shape,i);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),W_e=Y({prod_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=mr(e,r.shape),o=xu(i,r.rank),s=i,a=r;o!=null&&(a=r.transpose(o),s=wu(s.length,r.rank));var u=ee.runKernelFunc(function(l){return l.prod(a,s)},{permutedX:a});if(n){var c=ho(u.shape,i);u=u.reshape(c)}return u}}),lK=Y({elu_:function(t){var e=M(t,"x","elu");return ee.runKernelFunc(function(n,r){var i=n.elu(e);return r([i]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return ee.runKernelFunc(function(o){return o.eluDer(n,i)},{dy:n,y:i})}}})}}),j_e=Y({leakyRelu_:function(t,e){e===void 0&&(e=.2);var n=M(t,"x","leakyRelu");return nA(Oe(e).mul(n),n)}}),dK=Y({prelu_:function(t,e){var n=M(t,"x","prelu"),r=M(e,"alpha","prelu");return ee.runKernelFunc(function(i,o){var s=i.prelu(n,r);return o([n,r]),s},{x:n,alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{x:function(){return Wf(u,i,i.mul(a))},alpha:function(){var c=Wf(u,$t(i),i.mul(s)),l=fr(a.shape,i.shape);return l.length>0&&(c=c.sum(l)),c.reshape(a.shape)}}},"Prelu")}}),An=Y({relu_:function(t){var e=M(t,"x","relu");return e.dtype==="bool"?e.toInt():ee.runKernelFunc(function(n,r){var i=n.relu(e);return r([e]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mulStrict(i.step().toFloat())}}},"Relu")}}),fK=Y({relu6_:function(t){var e=M(t,"x","relu6");return e.dtype==="bool"?e.toInt():ee.runKernelFunc(function(n,r){var i=n.relu6(e);return r([e]),i},{x:e},function(n,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return n.mulStrict(o.toFloat())}}},"Relu6")}}),G_e=Y({selu_:function(t){var e=M(t,"x","selu");return ee.runKernelFunc(function(n,r){var i=n.selu(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){var o=i.greater(Oe(0)),s=Oe(ZP),a=Oe(eA),u=n.mul(a),c=n.mul(s).mul(i.toFloat().exp());return Wf(o,u,c)}}})}}),cd=Y({transpose_:function(t,e){var n=M(t,"x","transpose");if(e==null&&(e=n.shape.map(function(i,o){return o}).reverse()),V(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(i){V(i>=0&&i<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1)return n.clone();var r={perm:e};return ee.runKernelFunc(function(i){return i.transpose(n,e)},{x:n},function(i){var o=WP(e);return{x:function(){return i.transpose(o)}}},"Transpose",r)}}),H_e=Y({localResponseNormalization_:function(t,e,n,r,i){e===void 0&&(e=5),n===void 0&&(n=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=M(t,"x","localResponseNormalization");V(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),V(Vn(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=o,a=!1;o.rank===3&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=ee.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(s,e,n,r,i);return l([s,d]),d},{x4D:s},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return ee.runKernelFunc(function(h){return h.LRNGrad(c,d,f,e,n,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),hK=Y({norm_:function(t,e,n,r){e===void 0&&(e="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var i=function a(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return a(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(Oe(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(t=M(t,"x","norm"),e,n),o=i.shape;if(r){var s=mr(n,t.shape);o=ho(i.shape,s)}return i.reshape(o)}}),q_e=Y({basicLSTMCell_:function(t,e,n,r,i,o){var s=M(t,"forgetBias","basicLSTMCell"),a=M(e,"lstmKernel","basicLSTMCell"),u=M(n,"lstmBias","basicLSTMCell"),c=M(r,"data","basicLSTMCell"),l=M(i,"c","basicLSTMCell"),d=M(o,"h","basicLSTMCell"),f=c.concat(d,1).matMul(a).add(u),h=f.shape[0],p=f.shape[1]/4,m=[h,p],v=f.slice([0,0],m),g=f.slice([0,p],m),y=f.slice([0,2*p],m),b=f.slice([0,3*p],m),x=v.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(s.add(y).sigmoid())),S=x.tanh().mulStrict(b.sigmoid());return[x,S]}}),K_e=Y({multiRNNCell_:function(t,e,n,r){for(var i=M(e,"data","multiRNNCell"),o=Qw(n,"c","multiRNNCell"),s=Qw(r,"h","multiRNNCell"),a=i,u=[],c=0;c<t.length;c++){var l=t[c](a,o[c],s[c]);u.push(l[0]),u.push(l[1]),a=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),X_e=Y({movingAverage_:function(t,e,n,r,i){i===void 0&&(i=!0);var o=M(t,"v","movingAverage"),s=M(e,"x","movingAverage"),a=M(n,"decay","movingAverage");HCe(o,s),V(Cr(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=Oe(1),c=u.sub(a),l=s.sub(o).mul(c);if(i){V(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=M(r,"step","movingAverage");l=l.div(u.sub(uS(a,d)))}return o.add(l)}}),J_e=Y({stridedSlice_:function(t,e,n,r,i,o,s,a,u){if(i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var c=M(t,"x","stridedSlice"),l=RU(a),d=c.shape.slice();l.forEach(function(v){e[v]=0,n[v]=1,d.splice(v,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)e[f]=ske(i,e,r,c.shape,f),n[f]=ake(o,n,r,c.shape,f),r[f]=r[f]||1;var h=RU(u);h.forEach(function(v){n[v]=e[v]+1,r[v]=1});var p=qP(e,n,r),m=p.filter(function(v,g){return h.indexOf(g)===-1});return r.every(function(v){return v===1})?lu(c,e,p).reshape(m):ee.runKernelFunc(function(v){return v.stridedSlice(c,e,n,r)},{$x:c}).reshape(m)}}),Y_e=Y({topk_:function(t,e,n){e===void 0&&(e=1),n===void 0&&(n=!0);var r=M(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=ee.runKernelFunc(function(s){return s.topk(r,e,n)},{$x:r});return{values:o[0],indices:o[1]}}}),Q_e=Y({scatterND_:function(t,e,n){var r=M(t,"indices","scatterND","int32"),i=M(e,"updates","scatterND");return ike(i,r,n),ee.runKernelFunc(function(o){return o.scatterND(r,i,n)},{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),sA=Y({fft_:function(t){V(t.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return ee.runKernelFunc(function(i){return i.fft(r)},{input:t}).reshape(t.shape)}}),cS=Y({ifft_:function(t){V(t.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return ee.runKernelFunc(function(i){return i.ifft(r)},{input:t}).reshape(t.shape)}}),aA=Y({rfft_:function(t,e){V(t.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],i=t.size/r;if(e!=null&&e<r){var o=t.shape.map(function(g){return 0}),s=t.shape.map(function(g){return g});s[t.shape.length-1]=e,n=t.slice(o,s),r=e}else if(e!=null&&e>r){var a=t.shape.map(function(g){return g});a[t.shape.length-1]=e-r,n=t.concat(Cn(a),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),c=Or(n,u).as2D(i,r),l=sA(c),d=Math.floor(r/2)+1,f=cs(l),h=Oa(l),p=f.split([d,r-d],f.shape.length-1),m=h.split([d,r-d],h.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=d,Or(p[0],m[0]).reshape(v)}}),pK=Y({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),i=cS(r);return cs(i)}var o=[n,2*(e-1)],s=cs(t).as2D(n,e),a=Oa(t).as2D(n,e),u=s.slice([0,1],[n,e-2]).reverse(1),c=a.slice([0,1],[n,e-2]).reverse(1).mul(Oe(-1)),l=s.concat(u,1),d=a.concat(c,1);return r=Or(l,d).as2D(o[0],o[1]),i=cS(r),cs(i)}}),Z_e=Object.freeze({fft:sA,ifft:cS,rfft:aA,irfft:pK}),eIe=Y({sparseToDense_:function(t,e,n,r){r===void 0&&(r=0);var i=M(t,"sparseIndices","sparseToDense","int32"),o=M(e,"sparseValues","sparseToDense"),s=M(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,c,l){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,s),ee.runKernelFunc(function(a){return a.sparseToDense(i,o,n,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),tIe=Y({gatherND_:function(t,e){var n=M(e,"indices","gatherND","int32"),r=M(t,"x","gatherND");return ee.runKernelFunc(function(i){return i.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),nIe=Y({diag_:function(t){var e=M(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return ee.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(n)}}),rIe=Y({dropout_:function(t,e,n,r){var i=M(t,"x","dropout");if(V(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),V(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return t instanceof Nn?i.clone():i;var o=function(u,c){if(c==null)return u.shape.slice();if(Cr(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)c[d]==null&&u.shape[d]!=null?l.push(u.shape[d]):l.push(c[d]);return l}return c}(i,n),s=1-e,a=d7(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function mK(t,e,n){for(var r=1-t%2,i=new Float32Array(t),o=0;o<t;++o){var s=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(s)}return Yn(i,"float32")}var uA=Y({hannWindow_:function(t){return mK(t,.5,.5)}}),gK=Y({hammingWindow_:function(t){return mK(t,.54,.46)}}),cA=Y({frame_:function(t,e,n,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,s=[];o+e<=t.size;)s.push(lu(t,o,e)),o+=n;if(r)for(;o<t.size;){var a=o+e-t.size,u=cr([lu(t,o,e-a),au([a],i)]);s.push(u),o+=n}return s.length===0?td([],[0,e]):cr(s).as2D(s.length,e)}}),vK=Y({stft_:function(t,e,n,r,i){var o;i===void 0&&(i=uA),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var s=cA(t,e,n),a=hi(s,i(e)),u=[],c=0;c<s.shape[0];c++)u.push(aA(a.slice([c,0],[1,e]),r));return cr(u)}}),iIe=Object.freeze({hannWindow:uA,hammingWindow:gK,frame:cA,stft:vK}),li,oIe=function(t,e,n){return n===void 0&&(n=1),We(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m,v;return je(this,function(g){switch(g.label){case 0:return r=M(t,"predictions","inTopK"),i=M(e,"targets","inTopK"),V(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),V(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Xt(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],V(n>0&&n<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+n}),[4,r.data()];case 1:return s=g.sent(),[4,i.data()];case 2:for(a=g.sent(),u=[s.length/o,o],l=u[1],d=Vy("bool",c=u[0]),f=0;f<c;f++){for(h=f*l,p=s.subarray(h,h+l),m=[],v=0;v<p.length;v++)m.push({value:p[v],index:v});for(m.sort(function(y,b){return b.value-y.value}),d[f]=0,v=0;v<n;v++)if(m[v].index===a[f]){d[f]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),[2,Br(d,i.shape,"bool")]}})})};(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(li||(li={}));var sIe=Y({absoluteDifference_:function(t,e,n,r){r===void 0&&(r=li.SUM_BY_NONZERO_WEIGHTS);var i=M(t,"labels","absoluteDifference"),o=M(e,"predictions","absoluteDifference"),s=null;n!=null&&(s=M(n,"weights","absoluteDifference")),Xt(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Kc(a,s,r)}}),Kc=Y({computeWeightedLoss_:function(t,e,n){n===void 0&&(n=li.SUM_BY_NONZERO_WEIGHTS);var r=M(t,"losses","computeWeightedLoss"),i=null;e!=null&&(i=M(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(n===li.NONE)return o;if(n===li.SUM)return o.sum();if(n===li.MEAN){if(i==null)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(Oe(s)):a}if(n===li.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Oe(r.size));var u=i.mul(rg(r.shape)).notEqual(Oe(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+n)}}),aIe=Y({cosineDistance_:function(t,e,n,r,i){i===void 0&&(i=li.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"labels","cosineDistance"),s=M(e,"predictions","cosineDistance"),a=null;r!=null&&(a=M(r,"weights","cosineDistance")),Xt(o.shape,s.shape,"Error in cosineDistance: ");var u=Oe(1).sub(o.mul(s).sum(n,!0));return Kc(u,a,i)}}),uIe=Y({hingeLoss_:function(t,e,n,r){r===void 0&&(r=li.SUM_BY_NONZERO_WEIGHTS);var i=M(t,"labels","hingeLoss"),o=M(e,"predictions","hingeLoss"),s=null;n!=null&&(s=M(n,"weights","hingeLoss")),Xt(i.shape,o.shape,"Error in hingeLoss: ");var a=Oe(1);i=Oe(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return Kc(u,s,r)}}),cIe=Y({huberLoss_:function(t,e,n,r,i){r===void 0&&(r=1),i===void 0&&(i=li.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"labels","huberLoss"),s=M(e,"predictions","huberLoss"),a=null;n!=null&&(a=M(n,"weights","huberLoss")),Xt(o.shape,s.shape,"Error in huberLoss: ");var u=Oe(r),c=s.sub(o).abs(),l=J7(c,u),d=c.sub(l),f=Oe(.5).mul(l.square()).add(u.mul(d));return Kc(f,a,i)}}),lIe=Y({logLoss_:function(t,e,n,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=li.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"labels","logLoss"),s=M(e,"predictions","logLoss"),a=null;n!=null&&(a=M(n,"weights","logLoss")),Xt(o.shape,s.shape,"Error in logLoss: ");var u=Oe(1),c=Oe(r),l=o.mul(s.add(c).log()).neg().sub(u.sub(o).mul(u.sub(s).add(c).log()));return Kc(l,a,i)}}),dIe=Y({meanSquaredError_:function(t,e,n,r){r===void 0&&(r=li.SUM_BY_NONZERO_WEIGHTS);var i=M(t,"labels","meanSquaredError"),o=M(e,"predictions","meanSquaredError"),s=null;n!=null&&(s=M(n,"weights","meanSquaredError")),Xt(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Kc(a,s,r)}}),fIe=Y({sigmoidCrossEntropy_:function(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=li.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"multiClassLabels","sigmoidCrossEntropy"),s=M(e,"logits","sigmoidCrossEntropy"),a=null;if(n!=null&&(a=M(n,"weights","sigmoidCrossEntropy")),Xt(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Oe(r),c=Oe(1),l=Oe(.5);o=o.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=M(f,"labels","sigmoidCrossEntropyWithLogits"),m=M(h,"logits","sigmoidCrossEntropyWithLogits");Xt(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=m.relu(),g=m.mul(p),y=m.abs().neg().exp().log1p();return v.sub(g).add(y)}(o,s);return Kc(d,a,i)}}),hIe=Y({softmaxCrossEntropy_:function(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=li.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"onehotLabels","softmaxCrossEntropy"),s=M(e,"logits","softmaxCrossEntropy"),a=null;if(n!=null&&(a=M(n,"weights","softmaxCrossEntropy")),Xt(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Oe(r),c=Oe(1),l=Oe(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(p===void 0&&(p=-1),p===-1&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return qC(function(m,v,g){var y=v.logSumExp([p],!0),b=v.toFloat().sub(y);return g([m,b]),{value:b.mul(m).neg().sum([p]),gradFunc:function(x,S){var C=S[0],T=S[1],E=ho(x.shape,[p]);return[x.reshape(E).mul(C.toFloat().sub(T.exp())),x.reshape(E).mul(T.exp().sub(C.toFloat()))]}}})(f,h)}(o,s);return Kc(d,a,i)}}),pIe=Object.freeze({get Reduction(){return li},absoluteDifference:sIe,computeWeightedLoss:Kc,cosineDistance:aIe,hingeLoss:uIe,huberLoss:cIe,logLoss:lIe,meanSquaredError:dIe,sigmoidCrossEntropy:fIe,softmaxCrossEntropy:hIe});function YU(t,e){return e===void 0&&(e=!1),ee.tidy(function(){if(t.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=l7(n),o=t.clone(),s=td([[1]],[1,1]),a=s.clone(),u=n>=r?r:n,c=function(d){var f,h=o,p=a,m=i;f=ee.tidy(function(){var v=o.slice([d,d],[n-d,1]),g=v.norm(),y=o.slice([d,d],[1,1]),b=td([[-1]]).where(y.greater(0),td([[1]])),x=y.sub(b.mul(g)),S=v.div(x);a=S.shape[0]===1?s.clone():s.concat(S.slice([1,0],[S.shape[0]-1,S.shape[1]]),0);var C=b.matMul(x).div(g).neg(),T=o.slice([d,0],[n-d,r]),E=C.mul(a);if(d===0)o=T.sub(E.matMul(a.transpose().matMul(T)));else{var I=T.sub(E.matMul(a.transpose().matMul(T)));o=o.slice([0,0],[d,r]).concat(I,0)}var N=i.slice([0,d],[n,i.shape[1]-d]);if(d===0)i=N.sub(N.matMul(a).matMul(E.transpose()));else{var $=N.sub(N.matMul(a).matMul(E.transpose()));i=i.slice([0,0],[n,d]).concat($,1)}return[a,o,i]}),a=f[0],o=f[1],i=f[2],uo([h,p,m])},l=0;l<u;++l)c(l);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}var mIe=Y({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=M(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(n<=a))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+a+").");e<0&&(e=s),n<0&&(n=a);var u=Zw(0,s,1,"int32").reshape([-1,1]),c=Zw(0,a,1,"int32"),l=hr(u,c),d=XC(l.lessEqual(Oe(+e,"int32")),l.greaterEqual(Oe(-n,"int32"))),f=Cn([s,a],r.dtype);return Mo(lr(r.reshape([-1,s,a])).map(function(h){return Wf(d,h,f)})).reshape(i)}}),gIe=Y({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,V(t!=null&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(u){V(t[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+n+")"})},i=1;i<t.length;++i)r(i)}else e=!0,t=GP(t,t.shape[0],0).map(function(u){return h7(u,[0])});V(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var o=[],s=t,a=function(u){o.push(ee.tidy(function(){var c=s[u];if(u>0)for(var l=0;l<u;++l){var d=cK(o[l].mulStrict(c)).mul(o[l]);c=c.sub(d)}return c.div(hK(c,"euclidean"))}))};for(i=0;i<t.length;++i)a(i);return e?Mo(o,0):o}}),vIe=Y({qr_:function(t,e){if(e===void 0&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(t.rank===2)return YU(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(s,a){return s*a}),r=lr(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=YU(s,e),u=a[0],c=a[1];i.push(u),o.push(c)}),[Mo(i,0).reshape(t.shape),Mo(o,0).reshape(t.shape)]}}),yIe=Object.freeze({bandPart:mIe,gramSchmidt:gIe,qr:vIe});function ZC(t,e,n,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var s=t.shape[0];return n=Math.min(n,s),V(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),V(t.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),V(t.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),V(e.rank===1,function(){return"scores must be a 1D tensor"}),V(e.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]}),V(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var bIe=Y({resizeBilinear_:function(t,e,n){n===void 0&&(n=!1);var r=M(t,"images","resizeBilinear");V(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),V(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=ee.runKernelFunc(function(c,l){return l([i]),c.resizeBilinear(i,s,a,n)},{x:i},function(c,l){return{x:function(){return ee.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:s,newWidth:a});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),xIe=Y({resizeNearestNeighbor_:function(t,e,n){n===void 0&&(n=!1);var r=M(t,"images","resizeNearestNeighbor");V(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),V(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),V(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=ee.runKernelFunc(function(c,l){return l([i]),c.resizeNearestNeighbor(i,s,a,n)},{batchImages:i},function(c,l){return{batchImages:function(){return ee.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),wIe=Y({nonMaxSuppression_:function(t,e,n,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=M(t,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),a=ZC(o,s,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return ee.runKernelFunc(function(c){return c.nonMaxSuppression(o,s,n,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",u)}}),SIe=function(t,e,n,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),We(this,void 0,void 0,function(){var o,s,a,u,c,l,d;return je(this,function(f){switch(f.label){case 0:return o=M(t,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),a=ZC(o,s,n,r,i),n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return u=f.sent(),c=u[0],l=u[1],d=XP(c,l,n,r,i),o!==t&&o.dispose(),s!==e&&s.dispose(),[2,d]}})})},CIe=Y({nonMaxSuppressionWithScore_:function(t,e,n,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var s=M(t,"boxes","nonMaxSuppression"),a=M(e,"scores","nonMaxSuppression"),u=ZC(s,a,n,r,i,o),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},l=ee.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),kIe=function(t,e,n,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),We(this,void 0,void 0,function(){var s,a,u,c,l,d,f;return je(this,function(h){switch(h.label){case 0:return s=M(t,"boxes","nonMaxSuppressionAsync"),a=M(e,"scores","nonMaxSuppressionAsync"),u=ZC(s,a,n,r,i,o),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return c=h.sent(),l=c[0],d=c[1],f=JP(l,d,n,r,i,o),s!==t&&s.dispose(),a!==e&&a.dispose(),[2,f]}})})},TIe=Y({cropAndResize_:function(t,e,n,r,i,o){var s=M(t,"image","cropAndResize"),a=M(e,"boxes","cropAndResize","float32"),u=M(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=a.shape[0];return V(s.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),V(a.rank===2&&a.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+a.shape+"."}),V(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+a.shape+"."}),V(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),V(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),V(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),ee.runKernelFunc(function(l,d){return l.cropAndResize(s,a,u,r,i,o)},{images:s,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),lA=Object.freeze({resizeBilinear:bIe,resizeNearestNeighbor:xIe,nonMaxSuppression:wIe,nonMaxSuppressionAsync:SIe,nonMaxSuppressionWithScore:CIe,nonMaxSuppressionWithScoreAsync:kIe,cropAndResize:TIe}),dA=function(t,e){return!(t>0)||e==="linear"},fA=function(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},hA=function(t,e){var n=e,r=fr(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},pA=function(t,e,n){if(e==="linear")return t;if(e==="relu")return An(t);if(e==="elu")return lK(t);if(e==="relu6")return fK(t);if(e==="prelu")return dK(t,n);throw new Error("Unknown fused activation "+e+".")},EIe=Y({fusedMatMul_:function(t){var e,n=t.a,r=t.b,i=t.transposeA,o=i!==void 0&&i,s=t.transposeB,a=s!==void 0&&s,u=t.bias,c=t.activation,l=c===void 0?"linear":c,d=t.preluActivationWeights;if(dA(ee.state.gradientDepth,l)===!1){var f=YC(n,r,o,a);return u!=null&&(f=Ct(f,u)),pA(f,l,d)}var h=M(n,"a","fused matMul"),p=M(r,"b","fused matMul");e=On(h,p),h=e[0],p=e[1];var m=o?h.shape[h.rank-2]:h.shape[h.rank-1],v=a?p.shape[p.rank-1]:p.shape[p.rank-2],g=o?h.shape[h.rank-1]:h.shape[h.rank-2],y=a?p.shape[p.rank-2]:p.shape[p.rank-1],b=h.shape.slice(0,-2),x=p.shape.slice(0,-2),S=Ke(b),C=Ke(x);V(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),V(Cr(b,x),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),V(m===v,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var T,E,I=h.shape.slice(0,-2).concat([g,y]),N=o?h.as3D(S,m,g):h.as3D(S,g,m),$=a?p.as3D(C,y,v):p.as3D(C,v,y);u!=null&&It(I,(T=On(T=M(u,"bias","fused matMul"),h)[0]).shape),d!=null&&(E=M(d,"prelu weights","fused matMul"));var F={a:N,b:$};u!=null&&(F.bias=T),d!=null&&(F.preluActivationWeights=E);var H=[N,$];return ee.runKernelFunc(function(G,J){var ne=G.fusedBatchMatMul({a:N,b:$,transposeA:o,transposeB:a,bias:T,activation:l,preluActivationWeights:E});return J([N,$,ne]),ne},F,function(G,J){var ne=J[0],oe=J[1],q=J[2],Z=fA(G,q,l),se={};return u!=null&&(se={bias:function(){return hA(T,Z)}}),Object.assign(o||a?!o&&a?{a:function(){return Z.matMul(oe,!1,!1)},b:function(){return Z.matMul(ne,!0,!1)}}:o&&!a?{a:function(){return oe.matMul(Z,!1,!0)},b:function(){return ne.matMul(Z,!1,!1)}}:{a:function(){return oe.matMul(Z,!0,!0)},b:function(){return Z.matMul(ne,!0,!0)}}:{a:function(){return Z.matMul(oe,!1,!0)},b:function(){return ne.matMul(Z,!0,!1)}},se)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:l},H,[!0]).reshape(I)}}),_Ie=Y({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,s=o===void 0?"NHWC":o,a=t.dilations,u=a===void 0?[1,1]:a,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=d===void 0?"linear":d,h=t.preluActivationWeights;if(f=f||"linear",dA(ee.state.gradientDepth,f)===!1){var p=Is(e,n,r,i,s,u,c);return l!=null&&(p=Ct(p,l)),pA(p,f,h)}var m=M(e,"x","conv2d"),v=M(n,"filter","conv2d"),g=m,y=!1;m.rank===3&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),V(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),V(v.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),c!=null&&V(Vn(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),V(g.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),V(po(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),V(s==="NHWC",function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var b,x,S=vh(g.shape,v.shape,r,u,i,c);l!=null&&(b=On(b=M(l,"bias","fused conv2d"),m)[0],It(S.outShape,b.shape)),h!=null&&(x=M(h,"prelu weights","fused conv2d"));var C={x:g,filter:v};l!=null&&(C.bias=b),h!=null&&(C.preluActivationWeights=x);var T=[v,g],E=ee.runKernelFunc(function(I,N){var $=I.fusedConv2d({input:g,filter:v,convInfo:S,bias:b,activation:f,preluActivationWeights:x});return N([v,g,$]),$},C,function(I,N){var $=N,F=$[0],H=$[1],G=$[2],J=fA(I,G,f);V(Pm(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var ne={};return l!=null&&(ne={bias:function(){return hA(b,J)}}),Object.assign({x:function(){return nK(H.shape,J,F,r,i)},filter:function(){return iA(H,J,F.shape,r,i)}},ne)},"FusedConv2D",{convInfo:S,activation:f},T,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),IIe=Y({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,s=o===void 0?"NHWC":o,a=t.dilations,u=a===void 0?[1,1]:a,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=d===void 0?"linear":d,h=t.preluActivationWeights;if(dA(ee.state.gradientDepth,f)===!1){var p=JC(e,n,r,i,s,u,c);return l!=null&&(p=Ct(p,l)),pA(p,f,h)}var m=M(e,"x","depthwiseConv2d"),v=M(n,"filter","depthwiseConv2d"),g=m,y=!1;m.rank===3&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),V(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),V(v.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),V(g.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),u==null&&(u=[1,1]),V(po(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),c!=null&&V(Vn(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var b,x,S=vh(g.shape,v.shape,r,u,i,c,!0);l!=null&&(b=On(b=M(l,"bias","fused conv2d"),m)[0],It(S.outShape,b.shape)),h!=null&&(x=M(h,"prelu weights","fused depthwiseConv2d"));var C={x:g,filter:v};l!=null&&(C.bias=b),h!=null&&(C.preluActivationWeights=x);var T=[v,g],E=ee.runKernelFunc(function(I,N){var $=I.fusedDepthwiseConv2D({input:g,filter:v,convInfo:S,bias:b,activation:f,preluActivationWeights:x});return N([v,g,$]),$},C,function(I,N){V(Pm(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var $=N[0],F=N[1],H=N[2],G=fA(I,H,f),J={};return l!=null&&(J={bias:function(){return hA(b,G)}}),Object.assign({x:function(){return rK(F.shape,G,$,S)},filter:function(){return iK(F,G,$.shape,S)}},J)},"FusedDepthwiseConv2D",{convInfo:S,activation:f},T,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),RIe=Object.freeze({matMul:EIe,conv2d:_Ie,depthwiseConv2d:IIe}),NIe=Object.freeze({image:lA,linalg:yIe,losses:pIe,spectral:Z_e,fused:RIe,signal:iIe,square:lEe,squaredDifference:U7,conv1d:b_e,conv2d:Is,conv3d:x_e,depthwiseConv2d:JC,separableConv2d:oA,conv2dTranspose:w_e,conv3dTranspose:S_e,op:Y,batchNormalization2d:UEe,batchNormalization3d:VEe,batchNormalization4d:zEe,batchNormalization:WEe,batchNorm:H7,batchNorm2d:jEe,batchNorm3d:GEe,batchNorm4d:HEe,booleanMaskAsync:y_e,complex:Or,real:cs,imag:Oa,concat:cr,concat1d:R2e,concat2d:N2e,concat3d:P2e,concat4d:A2e,split:GP,matMul:YC,dot:C_e,outerProduct:k_e,reverse:G0,reverse1d:T_e,reverse2d:E_e,reverse3d:__e,reverse4d:I_e,maxPool:yr,avgPool:H0,pool:R_e,maxPool3d:N_e,avgPool3d:P_e,slice:lu,slice1d:A_e,slice2d:$_e,slice3d:aK,slice4d:D_e,abs:dEe,acos:fEe,acosh:hEe,asin:pEe,asinh:mEe,atan:gEe,atanh:vEe,ceil:yEe,clipByValue:tA,cos:bEe,cosh:xEe,erf:wEe,exp:LI,expm1:SEe,floor:CEe,log:kEe,log1p:TEe,logSigmoid:EEe,neg:aS,reciprocal:_Ee,round:IEe,rsqrt:V7,sigmoid:z7,sign:REe,isNaN:NEe,isInf:PEe,isFinite:AEe,sin:$Ee,sinh:DEe,softplus:OEe,sqrt:FEe,step:LEe,tan:MEe,tanh:BEe,all:O_e,any:F_e,argMax:L_e,argMin:M_e,logSumExp:B_e,max:QC,mean:U_e,min:V_e,moments:z_e,sum:cK,prod:W_e,equal:Y7,equalStrict:u_e,greater:c_e,greaterEqual:Q7,greaterEqualStrict:l_e,greaterStrict:d_e,less:f_e,lessEqual:h_e,lessEqualStrict:p_e,lessStrict:m_e,notEqual:g_e,notEqualStrict:v_e,add:Ct,addN:XEe,addStrict:JEe,atan2:YEe,div:Ws,divNoNan:QEe,divStrict:ZEe,floorDiv:X7,maximum:nA,maximumStrict:e_e,minimum:J7,minimumStrict:t_e,mod:n_e,modStrict:r_e,mul:hi,mulStrict:i_e,pow:uS,powStrict:o_e,squaredDifferenceStrict:s_e,sub:hr,subStrict:a_e,elu:lK,leakyRelu:j_e,prelu:dK,relu:An,relu6:fK,selu:G_e,logicalAnd:XC,logicalNot:qEe,logicalOr:q7,logicalXor:KEe,where:Wf,whereAsync:K7,buffer:pt,print:V2e,batchToSpaceND:c7,broadcastTo:z2e,cast:W2e,clone:j2e,cumsum:G2e,depthToSpace:H2e,expandDims:us,eye:l7,multinomial:q2e,oneHot:$I,pad:gh,pad1d:K2e,pad2d:X2e,pad3d:J2e,pad4d:Y2e,rand:Q2e,randomNormal:Z2e,randomGamma:eke,randomUniform:d7,reshape:ta,spaceToBatchND:f7,squeeze:h7,stack:Mo,tile:em,truncatedNormal:tke,unstack:lr,setdiff1dAsync:nke,fill:au,linspace:I2e,ones:rg,range:Zw,scalar:Oe,tensor:Br,tensor1d:Yn,tensor2d:td,tensor3d:jP,tensor4d:Ji,tensor5d:T2e,tensor6d:E2e,variable:_2e,zeros:Cn,onesLike:u7,zerosLike:$t,transpose:cd,softmax:qc,logSoftmax:cke,localResponseNormalization:H_e,norm:hK,gather:rA,unsortedSegmentSum:Z7,basicLSTMCell:q_e,multiRNNCell:K_e,movingAverage:X_e,stridedSlice:J_e,topk:Y_e,scatterND:Q_e,fft:sA,ifft:cS,rfft:aA,irfft:pK,sparseToDense:eIe,gatherND:tIe,diag:nIe,dropout:rIe,hannWindow:uA,hammingWindow:gK,frame:cA,stft:vK,inTopKAsync:oIe});function Se(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(n){n!=null&&V(n.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function VT(t,e,n,r){if(n==="linear")return t.linear(e);if(n==="relu")return t.relu(e);if(n==="elu")return t.elu(e);if(n==="relu6")return t.relu6(e);if(n==="prelu")return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var PIe=function(t){function e(){var n=t.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new x7(n,ee),n}return fa(e,t),e.prototype.write=function(n,r,i){this.firstUse&&(this.firstUse=!1,me().get("IS_NODE")&&Yw(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:n,dtype:i}),o},e.prototype.move=function(n,r,i,o){this.data.set(n,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(n){return We(this,void 0,void 0,function(){return je(this,function(r){return[2,this.readSync(n)]})})},e.prototype.readSync=function(n){var r=this.data.get(n),i=r.dtype,o=r.complexTensors;return i==="complex64"?FI(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(n).values},e.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),i=r;if(n.dtype==="string")try{i=r.map(function(o){return Kw(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return pt(n.shape,n.dtype,i)},e.prototype.makeOutput=function(n,r,i){var o=this.write(n,r,i);return ee.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},e.prototype.time=function(n){return We(this,void 0,void 0,function(){var r;return je(this,function(i){return r=Pa(),n(),[2,{kernelMs:Pa()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(n,r){var i=this.makeOutput(null,n.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:ee.keep(n.clone()),imag:ee.keep(r.clone())},i},e.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},e.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},e.prototype.slice=function(n,r,i){if(Se(n,"slice"),y7(n.shape,r,i)){var o=b7(r,n.strides),s=Ke(i);return Br(this.readSync(n.dataId).subarray(o,o+s),i,n.dtype)}for(var a=pt(i,n.dtype),u=this.bufferSync(n),c=0;c<a.size;++c){var l=a.indexToLoc(c).map(function(d,f){return d+r[f]});a.values[c]=u.get.apply(u,l)}return a.toTensor()},e.prototype.stridedSlice=function(n,r,i,o){Se(n,"stridedSlice");var s=qP(r,i,o);if(s.some(function(h){return h===0}))return Br([],s);for(var a=pt(s,n.dtype),u=this.bufferSync(n),c=0;c<a.size;c++){for(var l=a.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*o[f]+r[f];a.set.apply(a,[u.get.apply(u,d)].concat(l))}return a.toTensor()},e.prototype.diag=function(n){for(var r=this.readSync(n.dataId),i=pt([n.size,n.size],n.dtype),o=i.values,s=0;s<r.length;s++)o[s*n.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(n,r){for(var i=n.shape[r],o=new Array(n.rank-1),s=0,a=0;a<n.rank;a++)a!==r&&(o[s++]=n.shape[a]);var u=new Array(n.rank).fill(0),c=n.shape.slice();c[r]=1;var l=new Array(i);for(a=0;a<l.length;a++)u[r]=a,l[a]=this.slice(n,u,c).reshape(o);return l},e.prototype.reverse=function(n,r){Se(n,"reverse");for(var i=pt(n.shape,n.dtype),o=this.bufferSync(n),s=function(u){var c=i.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=n.shape[d]-1-l[d]}),i.set.apply(i,[o.get.apply(o,l)].concat(c))},a=0;a<i.size;a++)s(a);return i.toTensor()},e.prototype.concat=function(n,r){var i=this;if(n[0].dtype==="complex64"){var o=n.map(function(h){return cs(h)}),s=n.map(function(h){return Oa(h)});return Or(this.concat(o,r),this.concat(s,r))}var a=n.map(function(h){var p=Ke(h.shape.slice(r));return h.as2D(-1,p)}),u=Nm(a.map(function(h){return h.shape}),1),c=pt(u,n[0].dtype).values;if(a[0].shape[0]===1){var l=0;a.forEach(function(h){c.set(i.readSync(h.dataId),l),l+=h.size})}else{var d=0;a.forEach(function(h){for(var p=i.readSync(h.dataId),m=0,v=0;v<h.shape[0];++v)for(var g=v*u[1]+d,y=0;y<h.shape[1];++y)c[g+y]=p[m++];d+=h.shape[1]})}var f=Nm(n.map(function(h){return h.shape}),r);return Br(c,f,n[0].dtype)},e.prototype.neg=function(n){return Se(n,"neg"),this.multiply(Oe(-1),n)},e.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(n,r,Lr(n.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(n){var r=this;Se(n,"addN");for(var i=n.map(function(l){return r.readSync(l.dataId)}),o=pt(n[0].shape,n[0].dtype),s=o.values,a=0;a<n.length;a++)for(var u=i[a],c=0;c<s.length;c++)s[c]+=u[c];return o.toTensor()},e.prototype.softmax=function(n,r){var i=mr([r],n.shape),o=this.max(n,i),s=ho(o.shape,i),a=this.subtract(n,o.reshape(s)),u=this.exp(a),c=this.sum(u,i).reshape(s);return this.realDivide(u,c)},e.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(n,r,Lr(n.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(n,r){return Se([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(n,r,i,o){Se([n,r],"matMul");for(var s=i?n.shape[1]:n.shape[2],a=i?n.shape[2]:n.shape[1],u=o?r.shape[1]:r.shape[2],c=n.shape[0],l=this.readSync(n.dataId),d=this.readSync(r.dataId),f=i?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],h=f[0],p=f[1],m=f[2],v=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=v[0],y=v[1],b=v[2],x=a*u,S=pt([c,a,u],n.dtype),C=S.values,T=this.blockSize,E=0;E<c;E++)for(var I=0;I<a;I+=T)for(var N=0;N<u;N+=T)for(var $=0;$<s;$+=T)for(var F=Math.min(I+T,a),H=Math.min(N+T,u),G=Math.min($+T,s),J=I;J<F;J++)for(var ne=N;ne<H;ne++){for(var oe=0,q=$;q<G;q++)oe+=l[E*h+J*p+q*m]*d[q*g+ne*y+E*b];C[E*x+(J*u+ne)]+=oe}return S.toTensor()},e.prototype.fusedBatchMatMul=function(n){var r=n.a,i=n.b,o=n.transposeA,s=n.transposeB,a=n.bias,u=n.activation,c=n.preluActivationWeights,l=this.batchMatMul(r,i,o,s);return a&&(l=this.add(l,a)),u&&(l=VT(this,l,u,c)),l},e.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(n,r,Lr(n.dtype,r.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(n,r){return Se([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(n,r){return Se([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(n,r){Se(n,"sum"),To("sum",r,n.rank);for(var i=ei(n.shape,r),o=i[0],s=i[1],a=Cn(o,Lr(n.dtype,"int32")),u=Ke(s),c=this.readSync(a.dataId),l=this.readSync(n.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return a},e.prototype.prod=function(n,r){Se(n,"sum");for(var i=ei(n.shape,r),o=i[0],s=i[1],a=Cn(o,Lr(n.dtype,"int32")),u=Ke(s),c=this.readSync(a.dataId),l=this.readSync(n.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return a},e.prototype.unsortedSegmentSum=function(n,r,i){Se(n,"unsortedSegmentSum");for(var o=[],s=n.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=Oe(a,"int32"),c=Y7(u,r).asType("float32").mul(n).sum(0);o.push(c)}return Mo(o)},e.prototype.argMin=function(n,r){Se(n,"argMin");var i=[r];To("argMin",i,n.rank);for(var o=ei(n.shape,i),s=o[0],a=o[1],u=Cn(s,"int32"),c=Ke(a),l=this.readSync(u.dataId),d=this.readSync(n.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],m=0,v=0;v<c;++v){var g=d[h+v];g<p&&(p=g,m=v)}l[f]=m}return u},e.prototype.argMax=function(n,r){Se(n,"argMax");var i=[r];To("argMax",i,n.rank);for(var o=ei(n.shape,i),s=o[0],a=o[1],u=Cn(s,"int32"),c=Ke(a),l=this.readSync(u.dataId),d=this.readSync(n.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],m=0,v=0;v<c;++v){var g=d[h+v];g>p&&(p=g,m=v)}l[f]=m}return u},e.prototype.cumsum=function(n,r,i,o){if(Se(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var s=Lr(n.dtype,"int32"),a=Cn(n.shape,s),u=this.readSync(a.dataId),c=this.readSync(n.dataId),l=n.shape[n.rank-1],d=o?function(v,g){return v+l-g-1}:function(v,g){return v+g},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(h===0)u[p]=i?0:c[p];else{var m=d(f,h-1);u[p]=i?c[m]+u[m]:c[p]+u[m]}}return a},e.prototype.equal=function(n,r){return Se([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(n,r){return Se([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(n,r){return Se([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(n,r){return Se([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(n,r){return Se([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(n,r){return Se([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(n){Se(n,"logicalNot");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,n.shape,"bool")},e.prototype.logicalAnd=function(n,r){return Se([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(n,r){return Se([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i||o})},e.prototype.select=function(n,r,i){Se([n,r,i],"select");for(var o=this.readSync(n.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),u=Cn(r.shape,Lr(r.dtype,i.dtype)),c=this.readSync(u.dataId),l=0,d=n.rank===0||n.rank>1||r.rank===1?1:Ke(r.shape.slice(1)),f=0;f<o.length;f++)for(var h=0;h<d;h++)o[f]===1?c[l++]=s[f]:c[l++]=a[f];return u},e.prototype.where=function(n){Se([n],"where");var r=this.readSync(n.dataId);return YP(n.shape,r)},e.prototype.topk=function(n,r,i){return Se(n,"topk"),I7(this.readSync(n.dataId),n.shape,n.dtype,r)},e.prototype.min=function(n,r){Se(n,"min"),To("min",r,n.rank);for(var i=ei(n.shape,r),o=i[0],s=i[1],a=Cn(o,n.dtype),u=Ke(s),c=this.readSync(a.dataId),l=this.readSync(n.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];m<h&&(h=m)}c[d]=h}return a},e.prototype.minimum=function(n,r){return Se([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(n,r){return Se([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},e.prototype.max=function(n,r){Se(n,"max"),To("max",r,n.rank);for(var i=ei(n.shape,r),o=i[0],s=i[1],a=Cn(o,n.dtype),u=Ke(s),c=this.readSync(a.dataId),l=this.readSync(n.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];m>h&&(h=m)}c[d]=h}return a},e.prototype.maximum=function(n,r){return Se([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(n,r){Se(n,"all"),To("all",r,n.rank);for(var i=ei(n.shape,r),o=i[0],s=i[1],a=Cn(o,n.dtype),u=Ke(s),c=this.readSync(a.dataId),l=this.readSync(n.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];h=h&&m}c[d]=h}return a},e.prototype.any=function(n,r){Se(n,"any"),To("any",r,n.rank);for(var i=ei(n.shape,r),o=i[0],s=i[1],a=Cn(o,n.dtype),u=Ke(s),c=this.readSync(a.dataId),l=this.readSync(n.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];h=h||m}c[d]=h}return a},e.prototype.squaredDifference=function(n,r){return Se([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){var s=i-o;return s*s})},e.prototype.ceil=function(n){Se(n,"ceil");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.floor=function(n){Se(n,"floor");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.sign=function(n){Se(n,"x");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,n.shape,"float32")},e.prototype.isNaN=function(n){Se(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.isInf=function(n){Se(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.isFinite=function(n){Se(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.round=function(n){Se(n,"round");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);r[o]-s<.5?i[o]=Math.floor(r[o]):r[o]-s>.5?i[o]=Math.ceil(r[o]):i[o]=s%2==0?s:s+1}return this.makeOutput(i,n.shape,"float32")},e.prototype.exp=function(n){Se(n,"exp");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.expm1=function(n){Se(n,"expm1");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.log=function(n){Se(n,"log");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.log1p=function(n){Se(n,"log1p");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log1p(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.sqrt=function(n){Se(n,"sqrt");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.sqrt(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.rsqrt=function(n){Se(n,"rsqrt");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=1/Math.sqrt(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.reciprocal=function(n){Se(n,"reciprocal");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,n.shape,"float32")},e.prototype.linear=function(n){return n},e.prototype.relu=function(n){Se(n,"relu");for(var r=Cn(n.shape,n.dtype),i=this.readSync(r.dataId),o=this.readSync(n.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},e.prototype.relu6=function(n){Se(n,"relu");for(var r=Cn(n.shape,n.dtype),i=this.readSync(r.dataId),o=this.readSync(n.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},e.prototype.prelu=function(n,r){return Se([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(n){Se(n,"elu");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,n.shape,"float32")},e.prototype.eluDer=function(n,r){Se([n,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(n.dataId),a=0;a<o.length;++a){var u=o[a];i[a]=u>=1?s[a]:s[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(n){Se(n,"selu");for(var r=ZP,i=eA,o=new Float32Array(n.size),s=this.readSync(n.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,n.shape,"float32")},e.prototype.clip=function(n,r,i){Se(n,"clip");for(var o=new Float32Array(n.size),s=this.readSync(n.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>i?i:u<r?r:u}return this.makeOutput(o,n.shape,"float32")},e.prototype.abs=function(n){for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<n.size;++o){var s=i[2*o],a=i[2*o+1];r[o]=Math.hypot(s,a)}return this.makeOutput(r,n.shape,"float32")},e.prototype.int=function(n){Se(n,"int");for(var r=new Int32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,n.shape,"int32")},e.prototype.sigmoid=function(n){Se(n,"sigmoid");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,n.shape,"float32")},e.prototype.softplus=function(n){Se(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(n.size),o=this.readSync(n.dataId),s=0;s<o.length;++s){var a=o[s]>-r,u=o[s]<r,c=Math.exp(o[s]),l=void 0;l=u?c:a?o[s]:Math.log(1+c),i[s]=l}return this.makeOutput(i,n.shape,"float32")},e.prototype.sin=function(n){Se(n,"sin");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.cos=function(n){Se(n,"cos");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.tan=function(n){Se(n,"tan");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.asin=function(n){Se(n,"asin");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.acos=function(n){Se(n,"acos");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atan=function(n){Se(n,"atan");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atan2=function(n,r){return Se([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(n){Se(n,"sinh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.cosh=function(n){Se(n,"cosh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.tanh=function(n){Se(n,"tanh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=ACe(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.asinh=function(n){Se(n,"asinh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.acosh=function(n){Se(n,"acosh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atanh=function(n){Se(n,"atanh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.erf=function(n){Se(n,"erf");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),u=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,n.shape,"float32")},e.prototype.step=function(n,r){r===void 0&&(r=0),Se(n,"step");for(var i=new Float32Array(n.size),o=this.readSync(n.dataId),s=0;s<o.length;++s){var a=o[s];isNaN(a)?i[s]=NaN:i[s]=a>0?1:r}return this.makeOutput(i,n.shape,"float32")},e.prototype.fusedConv2d=function(n){var r=n.input,i=n.filter,o=n.convInfo,s=n.bias,a=n.activation,u=n.preluActivationWeights,c=this.conv2d(r,i,o);return s&&(c=this.add(c,s)),a&&(c=VT(this,c,a,u)),c},e.prototype.conv2d=function(n,r,i){Se([n,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,l=i.padInfo.top,d=i.dataFormat==="channelsLast",f=pt(i.outShape,n.dtype),h=n.strides[0],p=d?n.strides[1]:n.strides[2],m=d?n.strides[2]:1,v=d?1:n.strides[1],g=f.strides[0],y=d?f.strides[1]:f.strides[2],b=d?f.strides[2]:1,x=d?1:f.strides[1],S=this.readSync(n.dataId),C=this.readSync(r.dataId),T=f.values,E=0;E<i.batchSize;++E)for(var I=E*h,N=E*g,$=0;$<i.outHeight;++$)for(var F=N+$*y,H=$*i.strideHeight-l,G=0;G<o;G++){var J=H+G*a;if(!(J<0||J>=i.inHeight))for(var ne=G*r.strides[0],oe=I+J*p,q=0;q<i.outWidth;++q)for(var Z=F+q*b,se=q*i.strideWidth-c,fe=0;fe<s;fe++){var xe=se+fe*u;if(!(xe<0||xe>=i.inWidth))for(var be=oe+xe*m,pe=ne+fe*r.strides[1],ge=0;ge<i.inChannels;++ge){for(var Ce=S[be+ge*v],$e=0;$e<i.outChannels;++$e)T[Z+$e*x]+=Ce*C[pe+$e];pe+=i.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(n,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,c=i.dilationHeight,l=i.dilationWidth,d=i.padInfo.front,f=i.padInfo.left,h=i.padInfo.top,p=pt(i.outShape,n.dtype),m=this.readSync(n.dataId),v=this.readSync(r.dataId),g=p.values,y=0;y<i.batchSize;++y)for(var b=y*n.strides[0],x=y*p.strides[0],S=0;S<i.outDepth;++S)for(var C=x+S*p.strides[1],T=S*i.strideDepth-d,E=0;E<o;E++){var I=T+E*u;if(!(I<0||I>=i.inDepth))for(var N=E*r.strides[0],$=b+I*n.strides[1],F=0;F<i.outHeight;++F)for(var H=C+F*p.strides[2],G=F*i.strideHeight-h,J=0;J<s;J++){var ne=G+J*c;if(!(ne<0||ne>=i.inHeight))for(var oe=N+J*r.strides[1],q=$+ne*n.strides[2],Z=0;Z<i.outWidth;++Z)for(var se=H+Z*i.outChannels,fe=Z*i.strideWidth-f,xe=0;xe<a;xe++){var be=fe+xe*l;if(!(be<0||be>=i.inWidth))for(var pe=oe+xe*r.strides[2],ge=q+be*i.inChannels,Ce=pe,$e=0;$e<i.inChannels;++$e){for(var Ge=m[ge+$e],tt=0;tt<i.outChannels;++tt)g[se+tt]+=Ge*v[Ce+tt];Ce+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(n,r,i){Se([n,r],"conv2dDerInput");for(var o=pt(i.inShape,"float32"),s=o.values,a=this.readSync(n.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=i.batchSize,p=i.filterHeight,m=i.filterWidth,v=i.inChannels,g=i.inHeight,y=i.inWidth,b=i.outChannels,x=i.outHeight,S=i.outWidth,C=i.strideHeight,T=i.strideWidth,E=i.dataFormat,I=p-1-i.padInfo.top,N=m-1-i.padInfo.left,$=E==="channelsLast",F=o.strides[0],H=$?o.strides[1]:o.strides[2],G=$?o.strides[2]:1,J=$?1:o.strides[1],ne=n.strides[0],oe=$?n.strides[1]:n.strides[2],q=$?n.strides[2]:1,Z=$?1:n.strides[1],se=0;se<h;++se)for(var fe=0;fe<v;++fe)for(var xe=0;xe<g;++xe)for(var be=xe-I,pe=Math.max(0,Math.ceil(be/C)),ge=Math.min(x,(p+be)/C),Ce=0;Ce<y;++Ce){for(var $e=Ce-N,Ge=Math.max(0,Math.ceil($e/T)),tt=Math.min(S,(m+$e)/T),mt=0,Ie=pe;Ie<ge;++Ie)for(var lt=Ie*C-be,He=Ge;He<tt;++He)for(var yt=ne*se+oe*Ie+q*He,en=l*(p-1-lt)+d*(m-1-(He*T-$e))+f*fe,sn=0;sn<b;++sn)mt+=a[yt+Z*sn]*u[en+sn];s[F*se+H*xe+G*Ce+J*fe]=mt}return o.toTensor()},e.prototype.conv3dDerInput=function(n,r,i){for(var o=pt(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],c=a[1],l=a[2],d=a[3],f=this.readSync(n.dataId),h=n.strides,p=h[0],m=h[1],v=h[2],g=h[3],y=this.readSync(r.dataId),b=r.strides,x=b[0],S=b[1],C=b[2],T=b[3],E=i.batchSize,I=i.filterDepth,N=i.filterHeight,$=i.filterWidth,F=i.inChannels,H=i.inDepth,G=i.inHeight,J=i.inWidth,ne=i.outChannels,oe=i.outDepth,q=i.outHeight,Z=i.outWidth,se=i.strideDepth,fe=i.strideHeight,xe=i.strideWidth,be=I-1-i.padInfo.front,pe=N-1-i.padInfo.top,ge=$-1-i.padInfo.left,Ce=0;Ce<E;++Ce)for(var $e=0;$e<F;++$e)for(var Ge=0;Ge<H;++Ge)for(var tt=Ge-be,mt=Math.max(0,Math.ceil(tt/se)),Ie=Math.min(oe,(I+tt)/se),lt=0;lt<G;++lt)for(var He=lt-pe,yt=Math.max(0,Math.ceil(He/fe)),en=Math.min(q,(N+He)/fe),sn=0;sn<J;++sn){for(var xi=sn-ge,wi=Math.max(0,Math.ceil(xi/xe)),gr=Math.min(Z,($+xi)/xe),Bi=0,Gr=mt;Gr<Ie;++Gr)for(var Ir=Gr*se-tt,Fn=yt;Fn<en;++Fn)for(var Rr=Fn*fe-He,Si=wi;Si<gr;++Si)for(var va=p*Ce+m*Gr+v*Fn+g*Si,qo=x*(I-1-Ir)+S*(N-1-Rr)+C*($-1-(Si*xe-xi))+T*$e,Nr=0;Nr<ne;++Nr)Bi+=f[va+Nr]*y[qo+Nr];s[u*Ce+c*Ge+l*lt+d*sn+$e]=Bi}return o.toTensor()},e.prototype.conv2dDerFilter=function(n,r,i){Se([n,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=i.dataFormat==="channelsLast",l=pt(i.filterShape,"float32"),d=i.padInfo.left,f=i.padInfo.top,h=this.bufferSync(n),p=this.bufferSync(r),m=0;m<a;++m)for(var v=Math.max(0,Math.ceil((f-m)/o)),g=Math.min(i.outHeight,(i.inHeight+f-m)/o),y=0;y<u;++y)for(var b=Math.max(0,Math.ceil((d-y)/s)),x=Math.min(i.outWidth,(i.inWidth+d-y)/s),S=0;S<i.inChannels;++S)for(var C=0;C<i.outChannels;++C){for(var T=0,E=0;E<i.batchSize;++E)for(var I=v;I<g;++I)for(var N=m+I*o-f,$=b;$<x;++$){var F=y+$*s-d;T+=c?h.get(E,N,F,S)*p.get(E,I,$,C):h.get(E,S,N,F)*p.get(E,C,I,$)}l.set(T,m,y,S,C)}return l.toTensor()},e.prototype.conv3dDerFilter=function(n,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,c=i.filterHeight,l=i.filterWidth,d=pt(i.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],m=h[1],v=h[2],g=h[3],y=this.readSync(r.dataId),b=r.strides,x=b[0],S=b[1],C=b[2],T=b[3],E=this.readSync(n.dataId),I=n.strides,N=I[0],$=I[1],F=I[2],H=I[3],G=i.padInfo.front,J=i.padInfo.left,ne=i.padInfo.top,oe=0;oe<u;++oe)for(var q=Math.max(0,Math.ceil((G-oe)/o)),Z=Math.min(i.outDepth,(i.inDepth+G-oe)/o),se=oe*p,fe=0;fe<c;++fe)for(var xe=Math.max(0,Math.ceil((ne-fe)/s)),be=Math.min(i.outHeight,(i.inHeight+ne-fe)/s),pe=fe*m+se,ge=0;ge<l;++ge)for(var Ce=Math.max(0,Math.ceil((J-ge)/a)),$e=Math.min(i.outWidth,(i.inWidth+J-ge)/a),Ge=ge*v+pe,tt=0;tt<i.inChannels;++tt)for(var mt=tt*g+Ge,Ie=0;Ie<i.outChannels;++Ie){for(var lt=0,He=0;He<i.batchSize;++He)for(var yt=He*N,en=He*x,sn=q;sn<Z;++sn)for(var xi=(oe+sn*o-G)*$+yt,wi=sn*S+en,gr=xe;gr<be;++gr)for(var Bi=(fe+gr*s-ne)*F+xi,Gr=gr*C+wi,Ir=Ce;Ir<$e;++Ir){var Fn=Ir*T+Gr;lt+=E[(ge+Ir*a-J)*H+Bi+tt]*y[Fn+Ie]}f[mt+Ie]=lt}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,i=n.filter,o=n.convInfo,s=n.bias,a=n.activation,u=n.preluActivationWeights,c=this.depthwiseConv2D(r,i,o);return s&&(c=this.add(c,s)),a&&(c=VT(this,c,a,u)),c},e.prototype.depthwiseConv2D=function(n,r,i){Se([n,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,l=i.padInfo.top,d=i.outChannels/i.inChannels,f=pt(i.outShape,n.dtype),h=this.readSync(n.dataId),p=this.readSync(r.dataId),m=f.values,v=0;v<i.batchSize;++v)for(var g=v*n.strides[0],y=v*f.strides[0],b=0;b<i.outHeight;++b)for(var x=y+b*f.strides[1],S=b*i.strideHeight-c,C=0;C<o;++C){var T=S+C*a;if(!(T<0||T>=i.inHeight))for(var E=C*r.strides[0],I=g+T*n.strides[1],N=0;N<i.outWidth;++N)for(var $=x+N*f.strides[2],F=N*i.strideWidth-l,H=0;H<s;++H){var G=F+H*u;if(!(G<0||G>=i.inWidth))for(var J=E+H*r.strides[1],ne=I+G*i.inChannels,oe=$,q=J,Z=0;Z<i.inChannels;++Z){for(var se=h[ne+Z],fe=0;fe<d;++fe)m[oe+fe]+=se*p[q+fe];oe+=d,q+=d}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(n,r,i){Se([n,r],"depthwiseConv2DDerInput");for(var o=pt(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],c=a[1],l=a[2],d=this.readSync(n.dataId),f=n.strides,h=f[0],p=f[1],m=f[2],v=this.readSync(r.dataId),g=r.strides,y=g[0],b=g[1],x=g[2],S=i.batchSize,C=i.filterHeight,T=i.filterWidth,E=i.inChannels,I=i.inHeight,N=i.inWidth,$=i.outChannels,F=i.outHeight,H=i.outWidth,G=i.strideHeight,J=i.strideWidth,ne=C-1-i.padInfo.top,oe=T-1-i.padInfo.left,q=$/E,Z=0;Z<S;++Z)for(var se=0;se<E;++se)for(var fe=0;fe<I;++fe)for(var xe=fe-ne,be=Math.max(0,Math.ceil(xe/G)),pe=Math.min(F,(C+xe)/G),ge=0;ge<N;++ge){for(var Ce=ge-oe,$e=Math.max(0,Math.ceil(Ce/J)),Ge=Math.min(H,(T+Ce)/J),tt=0,mt=be;mt<pe;++mt)for(var Ie=mt*G-xe,lt=$e;lt<Ge;++lt)for(var He=h*Z+p*mt+m*lt,yt=y*(C-1-Ie)+b*(T-1-(lt*J-Ce))+x*se,en=0;en<q;++en)tt+=d[He+(se*q+en)]*v[yt+en];s[u*Z+c*fe+l*ge+se]=tt}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(n,r,i){Se([n,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=pt(i.filterShape,"float32"),l=i.padInfo.left,d=i.padInfo.top,f=i.outChannels/i.inChannels,h=this.bufferSync(n),p=this.bufferSync(r),m=0;m<a;++m)for(var v=Math.max(0,Math.ceil((d-m)/o)),g=Math.min(i.outHeight,(i.inHeight+d-m)/o),y=0;y<u;++y)for(var b=Math.max(0,Math.ceil((l-y)/s)),x=Math.min(i.outWidth,(i.inWidth+l-y)/s),S=0;S<i.outChannels;++S){for(var C=Math.trunc(S/f),T=S%f,E=0,I=0;I<i.batchSize;++I)for(var N=v;N<g;++N)for(var $=m+N*o-d,F=b;F<x;++F){var H=y+F*s-l;E+=h.get(I,$,H,C)*p.get(I,N,F,S)}c.set(E,m,y,C,T)}return c.toTensor()},e.prototype.tile=function(n,r){return Se(n,"tile"),_7(this.bufferSync(n),r)},e.prototype.pad=function(n,r,i){Se(n,"pad");var o=r.map(function(f,h){return f[0]+n.shape[h]+f[1]}),s=r.map(function(f){return f[0]}),a=this.bufferSync(n),u=pt(o,n.dtype);i!==0&&u.values.fill(i);for(var c=0;c<n.size;c++){var l=a.indexToLoc(c),d=l.map(function(f,h){return f+s[h]});u.set.apply(u,[a.get.apply(a,l)].concat(d))}return u.toTensor()},e.prototype.transpose=function(n,r){Se(n,"transpose");for(var i=new Array(n.rank),o=0;o<i.length;o++)i[o]=n.shape[r[o]];var s=this.readSync(n.dataId),a=pt(i,n.dtype),u=this.bufferSync(n);for(o=0;o<n.size;++o){for(var c=u.indexToLoc(o),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=a.locToIndex(l);a.values[f]=s[o]}return a.toTensor()},e.prototype.gather=function(n,r,i){Se([n,r],"gather");var o=n.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=pt(o,n.dtype),u=this.bufferSync(n),c=0;c<a.size;++c){var l=a.indexToLoc(c),d=l.slice();d[i]=s[l[i]];var f=u.locToIndex(d);a.values[c]=u.values[f]}return a.toTensor()},e.prototype.batchToSpaceND=function(n,r,i){Se([n],"batchToSpaceND");var o=r.reduce(function(d,f){return d*f}),s=eS(n.shape,r,o),a=tS(s.length,r.length),u=nS(n.shape,r,o),c=p7(i,r.length),l=m7(u,i,r.length);return n.reshape(s).transpose(a).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(n,r,i){Se([n],"spaceToBatchND");var o=r.reduce(function(f,h){return f*h}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<n.shape.length;++a)s.push([0,0]);var u=n.pad(s),c=eS(u.shape,r,o,!1),l=tS(c.length,r.length,!1),d=nS(u.shape,r,o,!1);return u.reshape(c).transpose(l).reshape(d)},e.prototype.pool=function(n,r,i){Se(n,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(n.dataId),m=pt(r.outShape,n.dtype),v=m.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],b=r.outShape[3],x=0;x<r.batchSize;++x)for(var S=x*g,C=x*n.strides[0],T=0;T<r.inChannels;++T)for(var E=0;E<r.outHeight;++E)for(var I=E*o-d,N=Math.max(0,I),$=Math.min(r.inHeight,c+I),F=S+E*y,H=0;H<r.outWidth;++H){for(var G=H*s-f,J=Math.max(0,G),ne=Math.min(r.inWidth,l+G),oe=h,q=0,Z=0,se=N;se<$;se+=a){for(var fe=C+se*n.strides[1],xe=J;xe<ne;xe+=u){var be=p[fe+xe*n.strides[2]+T];i==="max"&&be>oe?oe=be:i==="avg"&&(q+=be,Z++)}if(isNaN(oe))break}v[F+H*b+T]=i==="avg"?q/Z:oe}return m.toTensor()},e.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},e.prototype.maxPoolPositions=function(n,r){for(var i=pt(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(n),p=0;p<r.batchSize;++p)for(var m=0;m<r.inChannels;++m)for(var v=0;v<r.outHeight;++v){for(var g=v*o-d,y=g;y<0;)y+=a;for(var b=Math.min(r.inHeight,c+g),x=0;x<r.outWidth;++x){for(var S=x*s-f,C=S;C<0;)C+=u;for(var T=Math.min(r.inWidth,l+S),E=Number.NEGATIVE_INFINITY,I=-1,N=y;N<b;N+=a)for(var $=N-g,F=C;F<T;F+=u){var H=F-S,G=h.get(p,N,F,m);G>E&&(E=G,I=$*l+H)}i.set(I,p,v,x,m)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(n,r,i,o){Se([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,u=o.strideWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,m=pt(r.shape,"float32"),v=this.bufferSync(s),g=this.bufferSync(n),y=0;y<o.batchSize;++y)for(var b=0;b<o.inChannels;++b)for(var x=0;x<o.inHeight;++x)for(var S=0;S<o.inWidth;++S){for(var C=x-p,T=S-h,E=0,I=0;I<d;I+=c){var N=(C+I)/a;if(!(N<0||N>=o.outHeight||Math.floor(N)!==N))for(var $=0;$<f;$+=l){var F=(T+$)/u;if(!(F<0||F>=o.outWidth||Math.floor(F)!==F)){var H=d*f-1-v.get(y,N,F,b)===I*f+$?1:0;H!==0&&(E+=g.get(y,N,F,b)*H)}}}m.set(E,y,x,S,b)}return m.toTensor()},e.prototype.avgPoolBackprop=function(n,r,i){Se([n,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,m=pt(r.shape,"float32"),v=1/(a*u),g=this.bufferSync(n),y=0;y<i.batchSize;++y)for(var b=0;b<i.inChannels;++b)for(var x=0;x<i.inHeight;++x)for(var S=0;S<i.inWidth;++S){for(var C=x-p,T=S-h,E=0,I=0;I<d;I+=c){var N=(C+I)/o;if(!(N<0||N>=i.outHeight||Math.floor(N)!==N))for(var $=0;$<f;$+=l){var F=(T+$)/s;F<0||F>=i.outWidth||Math.floor(F)!==F||(E+=g.get(y,N,F,b))}}m.set(E*v,y,x,S,b)}return m.toTensor()},e.prototype.pool3d=function(n,r,i){Se(n,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,v=r.padInfo.left,g=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(n.dataId),b=pt(r.outShape,n.dtype),x=b.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],E=r.outShape[4],I=0;I<r.batchSize;++I)for(var N=I*S,$=I*n.strides[0],F=0;F<r.inChannels;++F)for(var H=0;H<r.outDepth;++H){for(var G=H*o-p,J=G;J<0;)J+=u;for(var ne=Math.min(r.inDepth,d+G),oe=N+H*C,q=0;q<r.outHeight;++q){for(var Z=q*s-m,se=Z;se<0;)se+=c;for(var fe=Math.min(r.inHeight,f+Z),xe=oe+q*T,be=0;be<r.outWidth;++be){for(var pe=be*a-v,ge=pe;ge<0;)ge+=l;for(var Ce=Math.min(r.inWidth,h+pe),$e=xe+be*E,Ge=g,tt=0,mt=0,Ie=J;Ie<ne;Ie+=u){for(var lt=$+Ie*n.strides[1],He=se;He<fe;He+=c){for(var yt=lt+He*n.strides[2],en=ge;en<Ce;en+=l){var sn=y[yt+en*n.strides[3]+F];if(i==="max"&&sn>Ge?Ge=sn:i==="avg"&&(tt+=sn,mt++),isNaN(Ge))break}if(isNaN(Ge))break}if(isNaN(Ge))break}x[$e+F]=i==="avg"?tt/mt:Ge}}}return b.toTensor()},e.prototype.avgPool3d=function(n,r){return Se(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(n,r,i){Se([n,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,c=i.filterHeight,l=i.filterWidth,d=i.dilationDepth,f=i.dilationHeight,h=i.dilationWidth,p=i.effectiveFilterDepth,m=i.effectiveFilterHeight,v=i.effectiveFilterWidth,g=p-1-i.padInfo.front,y=v-1-i.padInfo.left,b=m-1-i.padInfo.top,x=pt(r.shape,"float32"),S=1/(u*c*l),C=this.bufferSync(n),T=0;T<i.batchSize;++T)for(var E=0;E<i.inChannels;++E)for(var I=0;I<i.inDepth;++I)for(var N=0;N<i.inHeight;++N)for(var $=0;$<i.inWidth;++$){for(var F=I-g,H=N-b,G=$-y,J=0,ne=0;ne<p;ne+=d){var oe=(F+ne)/o;if(!(oe<0||oe>=i.outDepth||Math.floor(oe)!==oe))for(var q=0;q<m;q+=f){var Z=(H+q)/s;if(!(Z<0||Z>=i.outHeight||Math.floor(Z)!==Z))for(var se=0;se<v;se+=h){var fe=(G+se)/a;fe<0||fe>=i.outWidth||Math.floor(fe)!==fe||(J+=C.get(T,oe,Z,fe,E))}}}x.set(J*S,T,I,N,$,E)}return x.toTensor()},e.prototype.maxPool3d=function(n,r){return Se(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(n,r){for(var i=pt(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,v=r.padInfo.left,g=this.bufferSync(n),y=0;y<r.batchSize;++y)for(var b=0;b<r.inChannels;++b)for(var x=0;x<r.outDepth;++x){for(var S=x*o-p,C=S;C<0;)C+=u;for(var T=Math.min(r.inDepth,d+S),E=0;E<r.outHeight;++E){for(var I=E*s-m,N=I;N<0;)N+=c;for(var $=Math.min(r.inHeight,f+I),F=0;F<r.outWidth;++F){for(var H=F*a-v,G=H;G<0;)G+=l;for(var J=Math.min(r.inWidth,h+H),ne=Number.NEGATIVE_INFINITY,oe=-1,q=C;q<T;q+=u)for(var Z=q-S,se=N;se<$;se+=c)for(var fe=se-I,xe=G;xe<J;xe+=l){var be=xe-H,pe=g.get(y,q,se,xe,b);pe>=ne&&(ne=pe,oe=Z*f*h+fe*f+be)}i.set(oe,y,x,E,F,b)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(n,r,i,o){Se([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,u=o.strideHeight,c=o.strideWidth,l=o.dilationDepth,d=o.dilationHeight,f=o.dilationWidth,h=o.effectiveFilterDepth,p=o.effectiveFilterHeight,m=o.effectiveFilterWidth,v=h-1-o.padInfo.front,g=m-1-o.padInfo.left,y=p-1-o.padInfo.top,b=pt(r.shape,"float32"),x=this.bufferSync(s),S=this.bufferSync(n),C=0;C<o.batchSize;++C)for(var T=0;T<o.inChannels;++T)for(var E=0;E<o.inDepth;++E)for(var I=0;I<o.inHeight;++I)for(var N=0;N<o.inWidth;++N){for(var $=E-v,F=I-y,H=N-g,G=0,J=0;J<h;J+=l){var ne=($+J)/a;if(!(ne<0||ne>=o.outDepth||Math.floor(ne)!==ne))for(var oe=0;oe<p;oe+=d){var q=(F+oe)/u;if(!(q<0||q>=o.outHeight||Math.floor(q)!==q))for(var Z=0;Z<m;Z+=f){var se=(H+Z)/c;if(!(se<0||se>=o.outWidth||Math.floor(se)!==se)){var fe=h*p*m-1-x.get(C,ne,q,se,T)===J*p*m+oe*m+Z?1:0;fe!==0&&(G+=S.get(C,ne,q,se,T)*fe)}}}}b.set(G,C,E,I,N,T)}return b.toTensor()},e.prototype.cast=function(n,r){return C7(n,r,this)},e.prototype.reshape=function(n,r){return OI(n,r)},e.prototype.avgPool=function(n,r){return Se(n,"avgPool"),this.pool(n,r,"avg").toFloat()},e.prototype.resizeBilinear=function(n,r,i,o){Se(n,"resizeBilinear");for(var s=n.shape,a=s[0],u=s[1],c=s[2],l=s[3],d=this.readSync(n.dataId),f=new Float32Array(Ke([a,r,i,l])),h=[o&&r>1?u-1:u,o&&i>1?c-1:c],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],m=0,v=h[0]/p[0],g=h[1]/p[1],y=0;y<a;y++)for(var b=0;b<r;b++)for(var x=v*b,S=Math.floor(x),C=x-S,T=Math.min(u-1,Math.ceil(x)),E=y*n.strides[0]+S*n.strides[1],I=y*n.strides[0]+T*n.strides[1],N=0;N<i;N++)for(var $=g*N,F=Math.floor($),H=$-F,G=Math.min(c-1,Math.ceil($)),J=E+F*n.strides[2],ne=I+F*n.strides[2],oe=E+G*n.strides[2],q=I+G*n.strides[2],Z=0;Z<l;Z++){var se=d[J+Z],fe=d[ne+Z],xe=se+(d[oe+Z]-se)*H,be=xe+(fe+(d[q+Z]-fe)*H-xe)*C;f[m++]=be}return Br(f,[a,r,i,l])},e.prototype.resizeBilinearBackprop=function(n,r,i){Se([n,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],c=o[3],l=n.shape,d=l[1],f=l[2],h=new Float32Array(s*a*u*c),p=[i&&d>1?a-1:a,i&&f>1?u-1:u],m=[i&&d>1?d-1:d,i&&f>1?f-1:f],v=p[0]/m[0],g=p[1]/m[1],y=this.readSync(n.dataId),b=0,x=0;x<s;x++)for(var S=x*r.strides[0],C=0;C<d;C++)for(var T=C*v,E=Math.floor(T),I=Math.min(Math.ceil(T),a-1),N=S+E*r.strides[1],$=S+I*r.strides[1],F=T-E,H=1-F,G=0;G<f;G++)for(var J=G*g,ne=Math.floor(J),oe=Math.min(Math.ceil(J),u-1),q=J-ne,Z=1-q,se=N+ne*r.strides[2],fe=N+oe*r.strides[2],xe=$+ne*r.strides[2],be=$+oe*r.strides[2],pe=H*Z,ge=H*q,Ce=F*Z,$e=F*q,Ge=0;Ge<c;Ge++){var tt=y[b++];h[se+Ge]+=tt*pe,h[fe+Ge]+=tt*ge,h[xe+Ge]+=tt*Ce,h[be+Ge]+=tt*$e}return Ji(h,[s,u,a,c],r.dtype)},e.prototype.resizeNearestNeighbor=function(n,r,i,o){Se(n,"resizeNearestNeighbor");for(var s=n.shape,a=s[0],u=s[1],c=s[2],l=s[3],d=this.readSync(n.dataId),f=new Float32Array(a*r*i*l),h=[o&&r>1?u-1:u,o&&i>1?c-1:c],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],m=h[0]/p[0],v=h[1]/p[1],g=0,y=0;y<a;y++)for(var b=y*n.strides[0],x=0;x<r;x++)for(var S=m*x,C=b+Math.min(u-1,o?Math.round(S):Math.floor(S))*n.strides[1],T=0;T<i;T++)for(var E=v*T,I=C+Math.min(c-1,o?Math.round(E):Math.floor(E))*n.strides[2],N=0;N<l;N++){var $=d[I+N];f[g++]=$}return Br(f,[a,r,i,l],n.dtype)},e.prototype.resizeNearestNeighborBackprop=function(n,r,i){Se([n,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],c=o[3],l=n.shape,d=l[1],f=l[2],h=new Float32Array(s*a*u*c),p=this.readSync(n.dataId),m=[i&&d>1?a-1:a,i&&f>1?u-1:u],v=[i&&d>1?d-1:d,i&&f>1?f-1:f],g=m[0]/v[0],y=m[1]/v[1],b=1/g,x=1/y,S=2*Math.ceil(b)+2,C=2*Math.ceil(x)+2,T=0;T<s;T++)for(var E=T*r.strides[0],I=0;I<a;I++)for(var N=E+I*r.strides[1],$=Math.floor(I*b),F=Math.floor($-S/2),H=0;H<u;H++)for(var G=N+H*r.strides[2],J=Math.floor(H*x),ne=Math.floor(J-C/2),oe=0;oe<c;oe++){for(var q=0,Z=0;Z<S;Z++){var se=Z+F;if(!(se<0||se>=d)){var fe=E+se*n.strides[1],xe=se*g;if(I===Math.min(a-1,i?Math.round(xe):Math.floor(xe)))for(var be=0;be<C;be++){var pe=be+ne;if(!(pe<0||pe>=f)){var ge=fe+pe*n.strides[2],Ce=pe*y;H===Math.min(u-1,i?Math.round(Ce):Math.floor(Ce))&&(q+=p[ge+oe])}}}}h[G+oe]=q}return Ji(h,r.shape,r.dtype)},e.prototype.batchNormalization=function(n,r,i,o,s,a){Se([n,r,i,s,a],"batchNorm");for(var u=this.readSync(n.dataId),c=this.readSync(r.dataId),l=this.readSync(i.dataId),d=s?this.readSync(s.dataId):new Float32Array([1]),f=a?this.readSync(a.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,m=d.length,v=l.length,g=c.length,y=0,b=0,x=0,S=0,C=0;C<u.length;++C)h[C]=f[y++]+(u[C]-c[b++])*d[x++]/Math.sqrt(l[S++]+o),y>=p&&(y=0),b>=g&&(b=0),x>=m&&(x=0),S>=v&&(S=0);return Ji(h,n.shape)},e.prototype.localResponseNormalization4D=function(n,r,i,o,s){Se(n,"localResponseNormalization4D");var a=n.shape[3],u=a-1,c=this.readSync(n.dataId),l=n.size,d=new Float32Array(l);function f(v){for(var g=v%a,y=v-g+Math.max(0,g-r),b=v-g+Math.min(g+r,u),x=0;y<=b;y++){var S=c[y];x+=S*S}return x}for(var h=0;h<l;h++){var p=f(h),m=c[h]*Math.pow(i+o*p,-s);d[h]=m}return Ji(d,n.shape)},e.prototype.LRNGrad=function(n,r,i,o,s,a,u){Se(n,"LRNGrad");for(var c=n.shape[3],l=this.readSync(n.dataId),d=this.readSync(r.dataId),f=this.readSync(i.dataId),h=new Float32Array(n.size),p=n.size,m=0;m<p;m++){for(var v=m%c,g=m-v+Math.max(0,v-o),y=m-v+Math.min(c,v+o+1),b=0,x=g;x<y;x++)b+=Math.pow(d[x],2);for(b=a*b+s,x=g;x<y;x++){var S=-2*a*u*d[x]*f[m]/b;m===x&&(S+=Math.pow(b,-u)),S*=l[m],h[x]+=S}}return Ji(h,n.shape)},e.prototype.multinomial=function(n,r,i,o){Se(n,"multinomial");for(var s=r?n:qc(n),a=s.shape[0],u=s.shape[1],c=Cn([a,i],"int32"),l=this.readSync(c.dataId),d=this.readSync(s.dataId),f=0;f<a;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var m=1;m<p.length;++m)p[m]=p[m-1]+d[h+m];for(var v=HC(o.toString()),g=f*i,y=0;y<i;++y){var b=v();l[g+y]=p.length;for(var x=0;x<p.length;x++)if(b<p[x]){l[g+y]=x;break}}}return c},e.prototype.oneHot=function(n,r,i,o){Se(n,"oneHot");var s=new Float32Array(n.size*r);s.fill(o);for(var a=this.readSync(n.dataId),u=0;u<n.size;++u)a[u]>=0&&a[u]<r&&(s[u*r+a[u]]=i);return td(s,[n.size,r],"int32")},e.prototype.nonMaxSuppression=function(n,r,i,o,s){return Se(n,"nonMaxSuppression"),XP(this.readSync(n.dataId),this.readSync(r.dataId),i,o,s)},e.prototype.fft=function(n){return this.fftBatch(n,!1)},e.prototype.ifft=function(n){return this.fftBatch(n,!0)},e.prototype.fftBatch=function(n,r){for(var i=n.shape[0],o=n.shape[1],s=pt(n.shape,"float32"),a=pt(n.shape,"float32"),u=cs(n).as2D(i,o),c=Oa(n).as2D(i,o),l=0;l<i;l++)for(var d=u.slice([l,0],[1,o]),f=c.slice([l,0],[1,o]),h=Or(d,f),p=this.readSync(this.fftImpl(h,r).dataId),m=0;m<o;m++){var v=NU(p,m);s.values[l*o+m]=v.real,a.values[l*o+m]=v.imag}return Or(s.toTensor(),a.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(n,r){var i=n.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(n.shape[0],n.shape[1]);return r&&(s=Or(cs(s).div(Oe(o)),Oa(s).div(Oe(o)))),s}var a=this.readSync(n.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(a,o,r));return Or(u.real,u.imag).as2D(n.shape[0],n.shape[1])},e.prototype.isExponentOf2=function(n){return(n&n-1)==0},e.prototype.fftRadix2=function(n,r,i){if(r===1)return n;var o=this.readSync(n.dataId),s=r/2,a=function(g){for(var y=Math.ceil(g.length/4),b=new Float32Array(y),x=new Float32Array(y),S=0;S<g.length;S+=4)b[Math.floor(S/4)]=g[S],x[Math.floor(S/4)]=g[S+1];return{real:b,imag:x}}(o),u=Or(a.real,a.imag).as1D(),c=function(g){for(var y=Math.floor(g.length/4),b=new Float32Array(y),x=new Float32Array(y),S=2;S<g.length;S+=4)b[Math.floor(S/4)]=g[S],x[Math.floor(S/4)]=g[S+1];return{real:b,imag:x}}(o),l=Or(c.real,c.imag).as1D();u=this.fftRadix2(u,s,i),l=this.fftRadix2(l,s,i);var d=function(g,y){for(var b=new Float32Array(g/2),x=new Float32Array(g/2),S=0;S<Math.ceil(g/2);S++){var C=(y?2:-2)*Math.PI*(S/g);b[S]=Math.cos(C),x[S]=Math.sin(C)}return{real:b,imag:x}}(r,i),f=Or(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),m=cs(h).concat(cs(p)),v=Oa(h).concat(Oa(p));return Or(m,v).as1D()},e.prototype.fourierTransformByMatmul=function(n,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,u=0,c=0;c<r;c++){var l=dke(s*c,r,i),d=NU(n,c);a+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}i&&(a/=r,u/=r),lke(o,a,u,s)}return o},e.prototype.depthToSpace=function(n,r,i){V(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),V(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=n.shape[0],s=n.shape[1],a=n.shape[2],u=n.shape[3],c=s*r,l=a*r,d=u/(r*r),f=this.readSync(n.dataId),h=new Float32Array(o*c*l*d),p=0,m=0;m<o;++m)for(var v=0;v<c;++v)for(var g=Math.floor(v/r),y=v%r,b=0;b<l;++b)for(var x=Math.floor(b/r),S=(y*r+b%r)*d,C=0;C<d;++C){var T=C+S+u*(x+a*(g+s*m));h[p++]=f[T]}return Ji(h,[o,c,l,d])},e.prototype.broadcastedBinaryOp=function(n,r,i,o){var s=It(n.shape,r.shape),a=pt(s,i),u=this.readSync(n.dataId),c=this.readSync(r.dataId),l=Fl(n.shape,s),d=Fl(r.shape,s),f=a.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=o(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(n),m=this.bufferSync(r),v=function(g){var y=a.indexToLoc(g),b=y.slice(-n.rank);l.forEach(function(T){return b[T]=0});var x=p.locToIndex(b),S=y.slice(-r.rank);d.forEach(function(T){return S[T]=0});var C=m.locToIndex(S);f[g]=o(u[x],c[C])};for(h=0;h<f.length;++h)v(h)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(n,r,i){var o=It(n.shape,r.shape),s=pt(o,"float32"),a=pt(o,"float32"),u=this.readSync(n.dataId),c=this.readSync(r.dataId),l=Fl(n.shape,o),d=Fl(r.shape,o),f=s.values,h=a.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var m=p%u.length,v=p%c.length,g=i(u[2*m],u[2*m+1],c[2*v],c[2*v+1]);f[p]=g.real,h[p]=g.imag}else{var y=this.bufferSync(this.data.get(n.dataId).complexTensors.real),b=this.bufferSync(this.data.get(r.dataId).complexTensors.real),x=function(S){var C=s.indexToLoc(S),T=C.slice(-n.rank);l.forEach(function(F){return T[F]=0});var E=y.locToIndex(T),I=C.slice(-r.rank);d.forEach(function(F){return I[F]=0});var N=b.locToIndex(I),$=i(u[2*E],u[2*E+1],c[2*N],c[2*N+1]);f[S]=$.real,h[S]=$.imag};for(p=0;p<f.length;p++)x(p)}return this.complex(s.toTensor(),a.toTensor())},e.prototype.split=function(n,r,i){return E7(n,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(n,r,i,o,s,a){for(var u=n.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=o[0],m=o[1],v=pt([h,p,m,f],"float32"),g=this.readSync(r.dataId),y=this.readSync(i.dataId),b=this.readSync(n.dataId),x=n.strides,S=v.strides,C=0;C<h;C++){var T=4*C,E=g[T],I=g[T+1],N=g[T+2],$=g[T+3],F=y[C];if(!(F>=c))for(var H=p>1?(N-E)*(l-1)/(p-1):0,G=m>1?($-I)*(d-1)/(m-1):0,J=0;J<p;J++){var ne=p>1?E*(l-1)+J*H:.5*(E+N)*(l-1);if(ne<0||ne>l-1)for(var oe=0;oe<m;oe++)for(var q=0;q<f;q++){var Z=q+oe*S[2]+J*S[1]+C*S[0];v.values[Z]=a}else if(s==="bilinear"){var se=Math.floor(ne),fe=Math.ceil(ne),xe=ne-se;for(oe=0;oe<m;oe++)if((Ie=m>1?I*(d-1)+oe*G:.5*(I+$)*(d-1))<0||Ie>d-1)for(q=0;q<f;q++)Z=q+oe*S[2]+J*S[1]+C*S[0],v.values[Z]=a;else{var be=Math.floor(Ie),pe=Math.ceil(Ie),ge=Ie-be;for(q=0;q<f;q++){var Ce=b[Z=q+be*x[2]+se*x[1]+F*x[0]],$e=b[Z=q+pe*x[2]+se*x[1]+F*x[0]],Ge=b[Z=q+be*x[2]+fe*x[1]+F*x[0]],tt=Ce+($e-Ce)*ge,mt=Ge+(b[Z=q+pe*x[2]+fe*x[1]+F*x[0]]-Ge)*ge;Z=q+oe*S[2]+J*S[1]+C*S[0],v.values[Z]=tt+(mt-tt)*xe}}}else for(oe=0;oe<m;++oe){var Ie;if((Ie=m>1?I*(d-1)+oe*G:.5*(I+$)*(d-1))<0||Ie>d-1)for(q=0;q<f;q++)Z=q+oe*S[2]+J*S[1]+C*S[0],v.values[Z]=a;else{var lt=Math.round(Ie),He=Math.round(ne);for(q=0;q<f;q++){var yt=q+lt*x[2]+He*x[1]+F*x[0],en=q+oe*S[2]+J*S[1]+C*S[0];v.values[en]=b[yt]}}}}}return v.toTensor()},e.prototype.sparseToDense=function(n,r,i,o){var s=rS(0,n,i),a=s.sliceRank,u=s.numUpdates,c=s.sliceSize,l=s.strides,d=s.outputSize;return this.scatter(n,r,i,d,c,u,a,l,o,!1)},e.prototype.gatherND=function(n,r){var i=r.shape,o=i[i.length-1],s=g7(n,r),a=s[0],u=s[1],c=s[2],l=s[3];if(u===0)return Br([],a,n.dtype);for(var d=new zy([u,c],n.dtype),f=this.readSync(r.dataId),h=this.readSync(n.dataId),p=0;p<u;p++){for(var m=[],v=0,g=0;g<o;g++){var y=f[p*o+g];v+=y*l[g],m.push(y)}if(v<0||v>=n.size/c)throw new Error("Invalid indices: "+m+" does not index into "+n.shape);for(var b=0;b<c;b++)d.values[p*c+b]=h[v*c+b]}return d.toTensor().reshape(a)},e.prototype.scatterND=function(n,r,i){var o=rS(0,n,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,c=o.strides,l=o.outputSize,d=Oe(0);return this.scatter(n,r,i,l,u,a,s,c,d,!0)},e.prototype.fill=function(n,r,i){var o=qw(i=i||U0(r),Ke(n));return o.fill(r),ee.makeTensor(o,n,i,this)},e.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},e.prototype.zerosLike=function(n){var r=qw(n.dtype,Ke(n.shape));return this.makeOutput(r,n.shape,n.dtype)},e.prototype.linspace=function(n,r,i){return k7(n,r,i)},e.prototype.scatter=function(n,r,i,o,s,a,u,c,l,d){var f=[o/s,s],h=this.readSync(n.dataId),p=this.readSync(r.dataId);if(o===0)return Br([],i,r.dtype);var m=new zy(f,r.dtype);m.values.fill(this.readSync(l.dataId)[0]);for(var v=0;v<a;v++){for(var g=[],y=0,b=0;b<u;b++){var x=h[v*u+b];g.push(x),y+=x*c[b]}if(y<0||y>=o/s)throw new Error("Invalid indices: "+g+" does not index into "+i);for(var S=0;S<s;S++)d?m.values[y*s+S]+=p[v*s+S]:m.values[y*s+S]=r.rank===0?p[0]:p[v*s+S]}return m.toTensor().reshape(i)},e}(w7);ee.registerBackend("cpu",function(){return new PIe},1);for(var zT=0,QU=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e,o=i.boxes,s=i.scores,a=r,u=a.maxOutputSize,c=a.iouThreshold,l=a.scoreThreshold,d=a.softNmsSigma,f=n;Se(o,"NonMaxSuppressionWithScore");var h=JP(f.data.get(o.dataId).values,f.data.get(s.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n;Se(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var u=o[a];s[a]=u*u}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Gy,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,s=n;Se([i,o],Gy);var a=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values,c=function(f,h,p,m,v,g){var y=It(f,h),b=y.length,x=su(y),S=Vy(v,Ke(y)),C=f.length,T=h.length,E=su(f),I=su(h),N=Fl(f,y),$=Fl(h,y);if(N.length+$.length===0)for(var F=0;F<S.length;++F)S[F]=g(p[F%p.length],m[F%m.length]);else{var H=function(G){var J=VCe(G,b,x),ne=J.slice(-C);N.forEach(function(se){return ne[se]=0});var oe=wU(ne,C,E),q=J.slice(-T);$.forEach(function(se){return q[se]=0});var Z=wU(q,T,I);S[G]=g(p[oe],m[Z])};for(F=0;F<S.length;++F)H(F)}return[S,y]}(i.shape,o.shape,a,u,i.dtype,function(f,h){var p=f-h;return p*p}),l=c[0],d=c[1];return{dataId:s.write(l,d,i.dtype),shape:d,dtype:i.dtype}}}];zT<QU.length;zT++)Xq(QU[zT]);var Jh,AIe=function(t){this.variableNames=["A"];var e=ci(),n=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},$Ie=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=ci(),n=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var WT=0,ZU=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e.pixels,o=r.numChannels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],d=[l,c],f=[l,c,o];(a||s)&&(Jh==null&&(Jh=document.createElement("canvas").getContext("2d")),Jh.canvas.width=c,Jh.canvas.height=l,Jh.drawImage(i,0,0,c,l),i=Jh.canvas);var h=n.makeTensorInfo(d,"int32");n.texData.get(h.dataId).usage=Ro.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);var p=me().getBool("WEBGL_PACK")?new $Ie(f):new AIe(f),m=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;Yw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,s=i.scores,a=r,u=a.maxOutputSize,c=a.iouThreshold,l=a.scoreThreshold,d=a.softNmsSigma,f=n,h=JP(f.readSync(o.dataId),f.readSync(s.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n,o=new bt(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Gy,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,s=n,a=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $u("return (a - b) * (a - b);",i.shape,o.shape):new Ln("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];WT<ZU.length;WT++)Xq(ZU[WT]);for(var jT=0,eV=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:Gy,gradFunc:function(t,e){var n=e[0],r=e[1],i=Oe(2);return{a:function(){return hi(t,hi(i,hr(n,r)))},b:function(){return hi(t,hi(i,hr(r,n)))}}}}];jT<eV.length;jT++)NCe(eV[jT]);var DIe=function(){function t(){}return t.prototype.fetch=function(e,n){return fetch(e,n)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},t.prototype.decode=function(e,n){return new TextDecoder(n).decode(e)},t}();me().get("IS_BROWSER")&&me().setPlatform("browser",new DIe);var GT,OIe=function(){return require("node-fetch")},FIe=function(){function t(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(e,n){return me().global.fetch!=null?me().global.fetch(e,n):(GT==null&&(GT=OIe()),GT(e,n))},t.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},t.prototype.encode=function(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(e)},t.prototype.decode=function(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)},t}();me().get("IS_NODE")&&me().setPlatform("node",new FIe);var MI={float32:4,int32:4,uint16:2,uint8:1,bool:1},lS=4;function yK(t,e){for(var n={},r=0,i=function(a){var u=a.name,c=a.dtype,l=a.shape,d=Ke(l),f=void 0;if("quantization"in a){var h=a.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=MI[h.dtype],m=t.slice(r,r+d*p),v=h.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(c==="float32")f=Float32Array.from(v,function(C){return C*h.scale+h.min});else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(v,function(C){return Math.round(C*h.scale+h.min)})}r+=d*p}else if(c==="string"){var g=Ke(a.shape);f=[];for(var y=0;y<g;y++){var b=new Uint32Array(t.slice(r,r+lS))[0];r+=lS;var x=new Uint8Array(t.slice(r,r+b));f.push(x),r+=b}}else{var S=MI[c];if(m=t.slice(r,r+d*S),c==="float32")f=new Float32Array(m);else if(c==="int32")f=new Int32Array(m);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(m)}r+=d*S}n[u]=Br(f,l,c)},o=0,s=e;o<s.length;o++)i(s[o]);return n}function LIe(t){if(t===null)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(o){if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return n.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var BI=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function tV(t){return BI?Buffer.byteLength(t):new Blob([t]).size}function mA(t){var e=0;t.forEach(function(i){e+=i.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(i){n.set(new Uint8Array(i),r),r+=i.byteLength}),n.buffer}function nV(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function q0(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:tV(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:tV(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}var No=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var i=[];return(n==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(o){var s=o(e,r);s!==null&&i.push(s)}),i},t}(),nm="://",nd=function(){function t(){this.managers={}}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerManager=function(e,n){V(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(nm)&&(e=e.slice(0,e.indexOf(nm))),V(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();V(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(e){var n=this.getInstance().managers[e];if(n==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return n},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function Wx(t){if(t.indexOf(nm)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+nd.getSchemes().join(","));return{scheme:t.split(nm)[0],path:t.split(nm)[1]}}function rV(t,e,n){return n===void 0&&(n=!1),We(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d;return je(this,function(f){switch(f.label){case 0:return V(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),V((r=No.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),V(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),i=r[0],V((o=No.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),V(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),s=o[0],a=Wx(t).scheme,u=Wx(t).path,c=a===Wx(t).scheme,[4,i.load()];case 1:return l=f.sent(),n&&c?[4,nd.getManager(a).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,s.save(l)];case 4:return d=f.sent(),!n||c?[3,6]:[4,nd.getManager(a).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var mf="models_store",Ll="model_info_store";function bK(){if(!me().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function UI(t){var e=t.result;e.createObjectStore(mf,{keyPath:"modelPath"}),e.createObjectStore(Ll,{keyPath:"modelPath"})}var rm=function(){function t(e){if(this.indexedDB=bK(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return t.prototype.save=function(e){return We(this,void 0,void 0,function(){return je(this,function(n){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},t.prototype.load=function(){return We(this,void 0,void 0,function(){return je(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(e,n){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return UI(s)},s.onsuccess=function(){var a=s.result;if(n==null){var u=a.transaction(mf,"readonly"),c=u.objectStore(mf).get(r.modelPath);c.onsuccess=function(){if(c.result==null)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(c.result.modelArtifacts)},c.onerror=function(m){return a.close(),o(c.error)},u.oncomplete=function(){return a.close()}}else{var l,d=q0(n),f=a.transaction(Ll,"readwrite"),h=f.objectStore(Ll),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var m=(l=a.transaction(mf,"readwrite")).objectStore(mf).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:d});m.onsuccess=function(){return i({modelArtifactsInfo:d})},m.onerror=function(v){var g=(h=f.objectStore(Ll)).delete(r.modelPath);g.onsuccess=function(){return a.close(),o(m.error)},g.onerror=function(y){return a.close(),o(m.error)}}},p.onerror=function(m){return a.close(),o(p.error)},f.oncomplete=function(){l==null?a.close():l.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},t.URL_SCHEME="indexeddb://",t}(),iV=function(t){return me().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(rm.URL_SCHEME)?(e=t.slice(rm.URL_SCHEME.length),new rm(e)):null;var e};No.registerSaveRouter(iV),No.registerLoadRouter(iV);var MIe=function(){function t(){this.indexedDB=bK()}return t.prototype.listModels=function(){return We(this,void 0,void 0,function(){var e=this;return je(this,function(n){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return UI(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(Ll,"readonly"),u=a.objectStore(Ll).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},t.prototype.removeModel=function(e){return We(this,void 0,void 0,function(){var n=this;return je(this,function(r){var i;return e=(i=e).startsWith(rm.URL_SCHEME)?i.slice(rm.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return UI(a)},a.onsuccess=function(){var u,c=a.result,l=c.transaction(Ll,"readwrite"),d=l.objectStore(Ll),f=d.get(e);f.onsuccess=function(){if(f.result==null)return c.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var h=d.delete(e),p=function(){var m=(u=c.transaction(mf,"readwrite")).objectStore(mf).delete(e);m.onsuccess=function(){return o(f.result.modelArtifactsInfo)},m.onerror=function(v){return s(f.error)}};h.onsuccess=p,h.onerror=function(m){return p(),c.close(),s(f.error)}},f.onerror=function(h){return c.close(),s(f.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},a.onerror=function(u){return s(a.error)}})]})})},t}();if(me().getBool("IS_BROWSER"))try{nd.registerManager(rm.URL_SCHEME,new MIe)}catch{}var zu="/",sp="tensorflowjs_models",xK="info",BIe="model_topology",UIe="weight_specs",VIe="weight_data",zIe="model_metadata";function wK(t){return{info:[sp,t,xK].join(zu),topology:[sp,t,BIe].join(zu),weightSpecs:[sp,t,UIe].join(zu),weightData:[sp,t,VIe].join(zu),modelMetadata:[sp,t,zIe].join(zu)}}function WIe(t){var e=t.split(zu);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(zu)}var im=function(){function t(e){if(!me().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=wK(this.modelPath)}return t.prototype.save=function(e){return We(this,void 0,void 0,function(){var n,r,i;return je(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=q0(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(BI)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),u="",c=0,l=a.length;c<l;c++)u+=String.fromCharCode(a[c]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return We(this,void 0,void 0,function(){var e,n,r,i,o,s,a;return je(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(o),n.format=s.format,n.generatedBy=s.generatedBy,n.convertedBy=s.convertedBy,n.userDefinedMetadata=s.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(c){if(BI){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(a),[2,n]})})},t.URL_SCHEME="localstorage://",t}(),oV=function(t){return me().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(im.URL_SCHEME)?(e=t.slice(im.URL_SCHEME.length),new im(e)):null;var e};No.registerSaveRouter(oV),No.registerLoadRouter(oV);var jIe=function(){function t(){V(me().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),V(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return We(this,void 0,void 0,function(){var e,n,r,i,o,s;return je(this,function(a){for(e={},n=sp+zu,r=zu+xK,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(n)&&o.endsWith(r)&&(s=WIe(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},t.prototype.removeModel=function(e){return We(this,void 0,void 0,function(){var n,r;return je(this,function(i){var o;if(e=(o=e).startsWith(im.URL_SCHEME)?o.slice(im.URL_SCHEME.length):o,n=wK(e),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},t}();if(me().getBool("IS_BROWSER"))try{nd.registerManager(im.URL_SCHEME,new jIe)}catch{}var GIe="model",HIe=".json",qIe=".weights.bin";function sV(t){return new Promise(function(e){return setTimeout(e)}).then(t)}var HT=function(){function t(e){if(!me().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),e!=null&&e.length!==0||(e=GIe),this.modelTopologyFileName=e+HIe,this.weightDataFileName=e+qIe}return t.prototype.save=function(e){return We(this,void 0,void 0,function(){var n,r,i,o,s,a;return je(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,sV(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=n,[4,sV(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:q0(e)}]}})})},t.URL_SCHEME="downloads://",t}(),KIe=function(){function t(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return t.prototype.load=function(){return We(this,void 0,void 0,function(){var e,n,r=this;return je(this,function(i){return e=this.files[0],n=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){n.length===0&&o({modelTopology:l});var d=c.weightsManifest;if(d!=null){var f;try{f=r.checkManifestAndWeightFiles(d,n)}catch(v){return void s(v)}var h=[],p=[],m=[];d.forEach(function(v){v.paths.forEach(function(g){p.push(g),m.push(null)}),h.push.apply(h,v.weights)}),d.forEach(function(v){v.paths.forEach(function(g){var y=new FileReader;y.onload=function(b){var x=b.target.result,S=p.indexOf(g);m[S]=x,m.indexOf(null)===-1&&o({modelTopology:l,weightSpecs:h,weightData:mA(m),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},y.onerror=function(b){return s("Failed to weights data from file of path '"+g+"'.")},y.readAsArrayBuffer(f[g])})})}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(u){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},t.prototype.checkManifestAndWeightFiles=function(e,n){for(var r=[],i=n.map(function(u){return nV(u.name)}),o={},s=0,a=e;s<a.length;s++)a[s].paths.forEach(function(u){var c=nV(u);if(r.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),i.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");o[u]=n[i.indexOf(c)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return o},t}();function aV(t,e,n,r){(function(o){V(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(t),function(o,s){V(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),V(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),V(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(n=n??0,r=r??1);var i=0;return Promise.all(t.map(function(o){return o.then(function(s){var a=n+ ++i/t.length*(r-n);return e(a),s}),o}))}function SK(t,e){return We(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,l;return je(this,function(d){switch(d.label){case 0:return e==null&&(e={}),n=e.fetchFunc==null?me().platform.fetch:e.fetchFunc,r=t.map(function(f){return n(f,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,aV(r,e.onProgress,i,o)];case 3:s=d.sent(),d.label=4;case 4:return a=s.map(function(f){return f.arrayBuffer()}),u=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return l=d.sent(),[3,8];case 6:return[4,aV(a,e.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function uV(t){var e=this;return function(n,r,i){return r===void 0&&(r=""),We(e,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p;return je(this,function(m){switch(m.label){case 0:if(o=n.map(function(){return!1}),s={},a=i!=null?i.map(function(){return!1}):[],u=[],n.forEach(function(v,g){var y=0;v.weights.forEach(function(b){var x="quantization"in b?b.quantization.dtype:b.dtype,S=MI[x]*Ke(b.shape),C=function(){o[g]=!0,s[g]==null&&(s[g]=[]),s[g].push({manifestEntry:b,groupOffset:y,sizeBytes:S})};i!=null?i.forEach(function(T,E){T===b.name&&(C(),a[E]=!0)}):C(),u.push(b.name),y+=S})}),!a.every(function(v){return v}))throw c=i.filter(function(v,g){return!a[g]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=o.reduce(function(v,g,y){return g&&v.push(y),v},[]),d=[],l.forEach(function(v){n[v].paths.forEach(function(g){var y=r+(r.endsWith("/")?"":"/")+g;d.push(y)})}),[4,t(d)];case 1:return f=m.sent(),h={},p=0,l.forEach(function(v){for(var g=n[v].paths.length,y=0,b=0;b<g;b++)y+=f[p+b].byteLength;for(var x=new ArrayBuffer(y),S=new Uint8Array(x),C=0,T=0;T<g;T++){var E=new Uint8Array(f[p+T]);S.set(E,C),C+=E.byteLength}s[v].forEach(function(I){var N=yK(x.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var $ in N)h[$]=N[$]}),p+=g}),[2,h]}})})}}No.registerSaveRouter(function(t){return me().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(HT.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new HT(e)}(t.slice(HT.URL_SCHEME.length)):null});var CK=function(){function t(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(V(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=me().platform.fetch,V(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&V(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return t.prototype.save=function(e){return We(this,void 0,void 0,function(){var n,r,i,o;return je(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&n.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:q0(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},t.prototype.load=function(){return We(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,l,d,f;return je(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return n=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=n.modelTopology,o=n.weightsManifest,s=n.generatedBy,a=n.convertedBy,u=n.format,c=n.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:i,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:s,convertedBy:a,format:u}]}})})},t.prototype.loadWeights=function(e){return We(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,l,d,f;return je(this,function(h){switch(h.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var m=p.lastIndexOf("/"),v=p.lastIndexOf("?"),g=p.substring(0,m),y=v>m?p.substring(v):"";return[g+"/",y]}(n),i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,c=e;u<c.length;u++)l=c[u],a.push.apply(a,l.weights);return d=[],e.forEach(function(p){p.paths.forEach(function(m){d.push(s+m+o)})}),[4,SK(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[a,mA(f)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function VI(t){return t.match(CK.URL_SCHEME_REGEX)!=null}var cV=function(t,e){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(n){return VI(n)}):VI(t))?zI(t,{onProgress:e}):null};function zI(t,e){return new CK(t,e)}No.registerSaveRouter(cV),No.registerLoadRouter(cV);var qT=function(){function t(e){this.modelArtifacts=e}return t.prototype.load=function(){return We(this,void 0,void 0,function(){return je(this,function(e){return[2,this.modelArtifacts]})})},t}(),XIe=function(){function t(e){this.saveHandler=e}return t.prototype.save=function(e){return We(this,void 0,void 0,function(){return je(this,function(n){return[2,this.saveHandler(e)]})})},t}(),kK=Object.freeze({browserFiles:function(t){return new KIe(t)},browserHTTPRequest:function(t,e){return zI(t,e)},concatenateArrayBuffers:mA,decodeWeights:yK,encodeWeights:function(t,e){return We(this,void 0,void 0,function(){var n,r,i,o,s,a=this;return je(this,function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(t)?t.map(function(c){return c.name}):Object.keys(t),o=function(c){var l=i[c],d=Array.isArray(t)?t[c].tensor:t[l];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var h=new Promise(function(p){return We(a,void 0,void 0,function(){var m,v,g,y,b,x,S;return je(this,function(C){switch(C.label){case 0:return[4,d.bytes()];case 1:for(m=C.sent(),v=m.reduce(function(T,E){return T+E.length},0)+lS*m.length,g=new Uint8Array(v),y=0,b=0;b<m.length;b++)x=m[b],S=new Uint8Array(new Uint32Array([x.length]).buffer),g.set(S,y),y+=lS,g.set(x,y),y+=x.length;return p(g),[2]}})})});r.push(h)}else r.push(d.data());e!=null&&(f.group=e),n.push(f)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:LIe(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new qT(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new qT({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new qT({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return No.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:q0,getSaveHandlers:function(t){return No.getSaveHandlers(t)},http:zI,isHTTPScheme:VI,loadWeights:function(t,e,n,r){return e===void 0&&(e=""),We(this,void 0,void 0,function(){return je(this,function(i){return[2,uV(function(o){return SK(o,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return No.registerLoadRouter(t)},registerSaveRouter:function(t){return No.registerSaveRouter(t)},weightsLoaderFactory:uV,withSaveHandler:function(t){return new XIe(t)},copyModel:function(t,e){return We(this,void 0,void 0,function(){return je(this,function(n){return[2,rV(t,e,!1)]})})},listModels:function(){return We(this,void 0,void 0,function(){var t,e,n,r,i,o,s;return je(this,function(a){switch(a.label){case 0:t=nd.getSchemes(),e={},n=0,r=t,a.label=1;case 1:return n<r.length?(i=r[n],[4,nd.getManager(i).listModels()]):[3,4];case 2:for(s in o=a.sent())e[i+nm+s]=o[s];a.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return We(this,void 0,void 0,function(){return je(this,function(n){return[2,rV(t,e,!0)]})})},removeModel:function(t){return We(this,void 0,void 0,function(){var e;return je(this,function(n){return e=Wx(t),[2,nd.getManager(e.scheme).removeModel(e.path)]})})}}),Yh;Y({confusionMatrix_:function(t,e,n){var r=M(t,"labels","confusionMatrix"),i=M(e,"predictions","confusionMatrix");V(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),V(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),V(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),V(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),V(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var o=$I(r.asType("int32"),n),s=$I(i.asType("int32"),n);return o.transpose().matMul(s).asType("int32")}});var JIe=Y({fromPixels_:function(t,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,o=!1,s=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)o=!0;else{if(t.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);s=!0}if(i&&i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Kq("FromPixels",ee.backendName)!=null)return ee.runKernel("FromPixels",{pixels:t},{numChannels:e});var a,u,c=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],d=c[1];if(s?a=t.getContext("2d").getImageData(0,0,l,d).data:r||n?a=t.data:(o||i)&&(Yh==null&&(Yh=document.createElement("canvas").getContext("2d")),Yh.canvas.width=l,Yh.canvas.height=d,Yh.drawImage(t,0,0,l,d),a=Yh.getImageData(0,0,l,d).data),e===4)u=new Int32Array(a);else{var f=l*d;u=new Int32Array(f*e);for(var h=0;h<f;h++)for(var p=0;p<e;++p)u[h*e+p]=a[4*h+p]}return jP(u,[d,l,e],"int32")}}),gA=Object.freeze({toPixels:function(t,e){return We(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E;return je(this,function(I){switch(I.label){case 0:if(n=M(t,"img","toPixels"),t instanceof Nn||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],(s=n.rank===2?1:n.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,n.data()];case 1:return a=I.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=I.sent(),d=l[0],f=l[1],h=d[0],p=f[0],u.dispose(),c.dispose(),n.dtype==="float32"){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(m=n.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),g=0;g<i*o;++g)y=void 0,b=void 0,x=void 0,S=void 0,s===1?(y=a[g]*m,b=a[g]*m,x=a[g]*m,S=255):s===3?(y=a[3*g]*m,b=a[3*g+1]*m,x=a[3*g+2]*m,S=255):s===4&&(y=a[4*g]*m,b=a[4*g+1]*m,x=a[4*g+2]*m,S=a[4*g+3]*m),v[(C=4*g)+0]=Math.round(y),v[C+1]=Math.round(b),v[C+2]=Math.round(x),v[C+3]=Math.round(S);return e!=null&&(e.width=o,e.height=i,T=e.getContext("2d"),E=new ImageData(v,o,i),T.putImageData(E,0,0)),n!==t&&n.dispose(),[2,v]}})})},fromPixels:JIe}),YIe=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(e,n){return new e(n)},t}(),QIe=function(){function t(){this.classNameMap={}}return t.getMap=function(){return t.instance==null&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function yh(t){V(t.className!=null,function(){return"Class being registered does not have the static className property defined."}),V(typeof t.className=="string",function(){return"className is required to be a string, but got type "+typeof t.className}),V(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),QIe.register(t)}var bh=function(t){function e(){return t!==null&&t.apply(this,arguments)||this}return fa(e,t),e.prototype.minimize=function(n,r,i){r===void 0&&(r=!1);var o=this.computeGradients(n,i),s=o.value,a=o.grads;if(i!=null){var u=i.map(function(c){return{name:c.name,tensor:a[c.name]}});this.applyGradients(u)}else this.applyGradients(a);return uo(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(n,r){return uke(n,r)},e.prototype.dispose=function(){this.iterations_!=null&&uo(this.iterations_)},e.prototype.saveIterations=function(){return We(this,void 0,void 0,function(){return je(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Oe(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){return je(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){return je(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(n){return We(this,void 0,void 0,function(){var r;return je(this,function(i){switch(i.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,n.slice(1)]}})})},e}(YIe);Object.defineProperty(bh,Symbol.hasInstance,{value:function(t){return t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null}});var ZIe=function(t){function e(n,r,i){i===void 0&&(i=null);var o=t.call(this)||this;return o.learningRate=n,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=ee.backend.epsilon()),o}return fa(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=ee.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Be(function(){return $t(s).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Be(function(){return $t(s).variable(!1)})});var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var u=r.accumulatedGrads[o].variable,c=r.accumulatedUpdates[o].variable;Be(function(){var l=u.mul(r.rho).add(a.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(uo(this.accumulatedGrads.map(function(n){return n.variable})),uo(this.accumulatedUpdates.map(function(n){return n.variable})))},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){var n;return je(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){var r;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(bh);yh(ZIe);var eRe=function(t){function e(n,r){r===void 0&&(r=.1);var i=t.call(this)||this;return i.learningRate=n,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return fa(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=ee.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Be(function(){return au(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var u=r.accumulatedGrads[o].variable;Be(function(){var c=u.add(a.square());u.assign(c);var l=a.div(c.add(ee.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(l)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&uo(this.accumulatedGrads.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){return je(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(bh);yh(eRe);var tRe=function(t){function e(n,r,i,o){o===void 0&&(o=null);var s=t.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],Be(function(){s.accBeta1=Oe(r).variable(),s.accBeta2=Oe(i).variable()}),o==null&&(s.epsilon=ee.backend.epsilon()),s}return fa(e,t),e.prototype.applyGradients=function(n){var r=this,i=Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n);Be(function(){var o=hr(1,r.accBeta1),s=hr(1,r.accBeta2);i.forEach(function(a,u){var c=ee.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Be(function(){return $t(c).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:Be(function(){return $t(c).variable(!1)})});var l=Array.isArray(n)?n[u].tensor:n[a];if(l!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),m=h.div(o),v=p.div(s);d.assign(h),f.assign(p);var g=m.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(g)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&uo(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&uo(this.accumulatedSecondMoment.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){var n;return je(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){var r,i=this;return je(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),Be(function(){i.accBeta1.assign(uS(i.beta1,i.iterations_+1)),i.accBeta2.assign(uS(i.beta2,i.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(bh);yh(tRe);var nRe=function(t){function e(n,r,i,o,s){o===void 0&&(o=null),s===void 0&&(s=0);var a=t.call(this)||this;return a.learningRate=n,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Be(function(){a.iteration=Oe(0).variable(),a.accBeta1=Oe(r).variable()}),o==null&&(a.epsilon=ee.backend.epsilon()),a}return fa(e,t),e.prototype.applyGradients=function(n){var r=this,i=Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n);Be(function(){var o=hr(1,r.accBeta1),s=Ws(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var c=ee.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:$t(c).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:$t(c).variable(!1)});var l=Array.isArray(n)?n[u].tensor:n[a];if(l!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),m=l.abs(),v=p.maximum(m);d.assign(h),f.assign(v);var g=s.div(o).mul(h.div(v.add(r.epsilon))).add(c);c.assign(g)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&uo(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&uo(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){return je(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){return je(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(bh);yh(nRe);var TK=function(t){function e(n){var r=t.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return fa(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=Array.isArray(n)?n[o].tensor:n[i];if(s!=null){var a=ee.registeredVariables[i];Be(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=S2e(Oe(-n))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){return je(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(n,r){return new n(r.learningRate)},e.className="SGD",e}(bh);yh(TK);var rRe=function(t){function e(n,r,i){i===void 0&&(i=!1);var o=t.call(this,n)||this;return o.learningRate=n,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=Oe(o.momentum),o}return fa(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=ee.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:Be(function(){return $t(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(n)?n[o].tensor:n[i];u!=null&&Be(function(){var c,l=r.m.mul(a).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(s):r.c.mul(l).add(s),a.assign(l),s.assign(c)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&uo(this.accumulations.map(function(n){return n.variable}))},e.prototype.setMomentum=function(n){this.momentum=n},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){return je(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(TK);yh(rRe);var iRe=function(t){function e(n,r,i,o,s){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),s===void 0&&(s=!1);var a=t.call(this)||this;if(a.learningRate=n,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,o==null&&(a.epsilon=ee.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return fa(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=ee.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Be(function(){return $t(s).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:Be(function(){return $t(s).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Be(function(){return $t(s).variable(!1)})});var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var u=r.accumulatedMeanSquares[o].variable,c=r.accumulatedMoments[o].variable;Be(function(){var l=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,f=d.mul(r.decay).add(a.mul(1-r.decay)),h=c.mul(r.momentum).add(a.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=s.sub(h);s.assign(p)}else{var m=u.mul(r.decay).add(a.square().mul(1-r.decay));h=c.mul(r.momentum).add(a.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),u.assign(m),c.assign(h),p=s.sub(h),s.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&uo(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&uo(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&uo(this.accumulatedMoments.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return We(this,void 0,void 0,function(){var n;return je(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return We(this,void 0,void 0,function(){var r;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(bh);yh(iRe);Nn.prototype.squaredDifference=function(t){return U7(this,t)},he=NIe;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var WI=function(t,e){return WI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},WI(t,e)};function ht(t,e){WI(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var oi=function(){return oi=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},oi.apply(this,arguments)};function Je(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(l){try{c(r.next(l))}catch(d){s(d)}}function u(l){try{c(r.throw(l))}catch(d){s(d)}}function c(l){l.done?o(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})}function Ye(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){n.label=c[1];break}if(c[0]===6&&n.label<o[1]){n.label=o[1],o=c;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(c);break}o[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(l){c=[6,l],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ey(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var om=function(){function t(e,n){if(!If(e)||!If(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:n}));this._width=e,this._height=n}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function e2(t,e){return t instanceof Nn&&t.shape.length===e}function oRe(t){return e2(t,2)}function t2(t){return e2(t,3)}function rd(t){return e2(t,4)}function sRe(t){return t%1!==0}function lV(t){return t%2===0}function aRe(t,e){e===void 0&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function dV(t){return t&&t.width&&t.height}function uRe(t,e){var n=t.width,r=t.height,i=e/Math.max(r,n);return new om(Math.round(n*i),Math.round(r*i))}function vA(t){return t.reduce(function(e,n){return e.add(n)},new qt(0,0)).div(new qt(t.length,t.length))}function Hy(t,e,n){return Array(t).fill(0).map(function(r,i){return e+i*n})}function If(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||t===0}function fV(t){return If(t)&&0<=t&&t<=1}var qt=function(){function t(e,n){this._x=e,this._y=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),ld=function(){function t(e,n){n===void 0&&(n=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(If),o=[r.x,r.y,r.width,r.height].every(If);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],u=s[1],c=s[2],l=s[3];t.assertIsValidBox({x:a,y:u,width:c,height:l},"Box.constructor",n),this._x=a,this._y=u,this._width=c,this._height=l}return t.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(If)},t.assertIsValidBox=function(e,n,r){if(r===void 0&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new qt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new qt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new qt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new qt(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),n=e[0],r=e[1],i=e[2],o=e[3];return new t({x:n,y:r,width:i,height:o})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),n=e[0],r=e[1],i=e[2],o=e[3];return new t({x:n,y:r,width:i,height:o})},t.prototype.toSquare=function(){var e=this,n=e.x,r=e.y,i=e.width,o=e.height,s=Math.abs(i-o);return i<o&&(n-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new t({x:n,y:r,width:i,height:o})},t.prototype.rescale=function(e){var n=dV(e)?e.width:e,r=dV(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n],i=r[0],o=r[1],s=r[2],a=r[3];return new t({x:i,y:o,width:s,height:a})},t.prototype.clipAtImageBorders=function(e,n){var r=this,i=r.x,o=r.y,s=r.right,a=r.bottom,u=Math.max(i,0),c=Math.max(o,0),l=s-u,d=a-c,f=Math.min(l,e-u),h=Math.min(d,n-c);return new t({x:u,y:c,width:f,height:h}).floor()},t.prototype.shift=function(e,n){var r=this,i=r.width,o=r.height,s=this.x+e,a=this.y+n;return new t({x:s,y:a,width:i,height:o})},t.prototype.padAtBorders=function(e,n){var r=this.width+1,i=this.height+1,o=1,s=1,a=r,u=i,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>n&&(a=-d+n+r,d=n),f>e&&(u=-f+e+i,f=e),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:s,edy:u,dx:o,edx:a,y:l,ey:f,x:c,ex:d,w:r,h:i}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),n2=function(t){ht(e,t);function e(n,r,i,o,s){return s===void 0&&(s=!1),t.call(this,{left:n,top:r,right:i,bottom:o},s)||this}return e}(ld),EK=function(){function t(e,n,r,i,o){this._imageDims=new om(o.width,o.height),this._score=e,this._classScore=n,this._className=r,this._box=new ld(i).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new ld(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),Su=function(t){ht(e,t);function e(n,r,i){return t.call(this,n,n,"",r,i)||this}return e.prototype.forSize=function(n,r){var i=t.prototype.forSize.call(this,n,r),o=i.score,s=i.relativeBox,a=i.imageDims;return new e(o,s,a)},e}(EK);function cRe(t,e,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left)),i=Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top)),o=r*i;return n?o/(t.area+e.area-o):o/Math.min(t.area,e.area)}function lRe(t){var e=t.map(function(a){return a.x}),n=t.map(function(a){return a.y}),r=e.reduce(function(a,u){return u<a?u:a},1/0),i=n.reduce(function(a,u){return u<a?u:a},1/0),o=e.reduce(function(a,u){return a<u?u:a},0),s=n.reduce(function(a,u){return a<u?u:a},0);return new n2(r,i,o,s)}function qy(t,e,n,r){r===void 0&&(r=!0);for(var i=e.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var u=i,c=[],l=0;l<u.length;l++){var d=u[l],f=t[a],h=t[d];c.push(cRe(f,h,r))}i=i.filter(function(p,m){return c[m]<=n})};i.length>0;)s();return o}function K0(t,e){return Be(function(){var n=e[0],r=e[1],i=e[2],o=au(ey(t.shape.slice(0,3),[1]),n),s=au(ey(t.shape.slice(0,3),[1]),r),a=au(ey(t.shape.slice(0,3),[1]),i),u=cr([o,s,a],3);return hr(t,u)})}function dRe(t,e){return e===void 0&&(e=!1),Be(function(){var n=t.shape.slice(1),r=n[0],i=n[1];if(r===i)return t;var o=Math.abs(r-i),s=Math.round(o*(e?.5:1)),a=r>i?2:1,u=function(h){var p=t.shape.slice();return p[a]=h,au(p,0)},c=u(s),l=o-c.shape[a],d=e&&l?u(l):null,f=[d,t,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return cr(f,a)})}function KT(t){return 1/(1+Math.exp(-t))}var yA=function(t){ht(e,t);function e(n,r,i,o,s){return s===void 0&&(s=!1),t.call(this,{x:n,y:r,width:i,height:o},s)||this}return e}(ld),fRe=.5,hRe=.43,pRe=.45,dS=function(){function t(e,n,r){r===void 0&&(r=new qt(0,0));var i=n.width,o=n.height;this._imgDims=new om(i,o),this._shift=r,this._positions=e.map(function(s){return s.mul(new qt(i,o)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new qt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(n){return n.sub(e._shift).div(new qt(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new this.constructor(this.relativePositions,{width:e,height:n})},t.prototype.shiftBy=function(e,n){return new this.constructor(this.relativePositions,this._imgDims,new qt(e,n))},t.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},t.prototype.align=function(e,n){if(n===void 0&&(n={}),e){var r=e instanceof Su?e.box.floor():new ld(e);return this.shiftBy(r.x,r.y).align(null,n)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),o=i.useDlibAlignment,s=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(s)},t.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),n=e[0],r=e[1],i=e[2],o=function(d){return i.sub(d).magnitude()},s=(o(n)+o(r))/2,a=Math.floor(s/pRe),u=vA(e),c=Math.floor(Math.max(0,u.x-fRe*a)),l=Math.floor(Math.max(0,u.y-hRe*a));return new yA(c,l,Math.min(a,this.imageWidth+c),Math.min(a,this.imageHeight+l))},t.prototype.alignMinBbox=function(e){var n=lRe(this.positions);return n.pad(n.width*e,n.height*e)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),mRe=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],vA([n[3],n[4]])]},e}(dS),gRe=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(vA)},e}(dS),hV=function(){function t(e,n){this._label=e,this._distance=n}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+aRe(this.distance)+")":"")},t}(),pV=function(t){ht(e,t);function e(n,r){var i=t.call(this,n)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(n,r){if(ld.assertIsValidBox(n,r),!If(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(ld),N1=function(){function t(e,n){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=n}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(r){return new Float32Array(r)});return new t(e.label,n)},t}();(function(t){ht(e,t);function e(n,r,i,o){var s=t.call(this,n,r)||this;return s._score=i,s._classScore=o,s}return e.assertIsValidPredictedBox=function(n,r){if(pV.assertIsValidLabeledBox(n,r),!fV(n.score)||!fV(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(pV);function vRe(t){return t.detection instanceof Su}function bA(t,e){var n={detection:e};return Object.assign({},t,n)}function _K(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:e}}function IK(t){var e="";if(!t)try{t=require("fs")}catch(r){e=r.toString()}var n=t?function(r){return new Promise(function(i,o){t.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:n}}function RK(){var t=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,n=function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=IK();return oi({Canvas:t||function(){function s(){}return s}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function s(){}return s}(),Image:e||function(){function s(){}return s}(),ImageData:global.ImageData||function(){function s(){}return s}(),Video:global.HTMLVideoElement||function(){function s(){}return s}(),createCanvasElement:n,createImageElement:r,fetch:i},o)}function NK(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function PK(){return typeof global=="object"&&typeof require=="function"&&typeof ZZ<"u"&&typeof process<"u"&&!!process.version}var nr;function yRe(){if(!nr)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return nr}function jI(t){nr=t}function xA(){NK()&&jI(_K()),PK()&&jI(RK())}function bRe(t){if(nr||xA(),!nr)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=e===void 0?nr.Canvas:e,r=t.Image,i=r===void 0?nr.Image:r;nr.Canvas=n,nr.Image=i,nr.createCanvasElement=t.createCanvasElement||function(){return new n},nr.createImageElement=t.createImageElement||function(){return new i},nr.ImageData=t.ImageData||nr.ImageData,nr.Video=t.Video||nr.Video,nr.fetch=t.fetch||nr.fetch,nr.readFile=t.readFile||nr.readFile}var vi={getEnv:yRe,setEnv:jI,initialize:xA,createBrowserEnv:_K,createFileSystem:IK,createNodejsEnv:RK,monkeyPatch:bRe,isBrowser:NK,isNodejs:PK};xA();function AK(t){return!vi.isNodejs()&&typeof t=="string"?document.getElementById(t):t}function jf(t){var e=vi.getEnv(),n=e.Canvas,r=e.CanvasRenderingContext2D;if(t instanceof r)return t;var i=AK(t);if(!(i instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var mV;(function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"})(mV||(mV={}));function $K(t){var e=vi.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function xRe(t){return new Promise(function(e,n){if(t instanceof vi.getEnv().Canvas||$K(t))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),n(o))}t.addEventListener("load",r),t.addEventListener("error",i)})}function DK(t){var e=vi.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new om(t.naturalWidth,t.naturalHeight):t instanceof r?new om(t.videoWidth,t.videoHeight):new om(t.width,t.height)}function r2(t){var e=t.width,n=t.height,r=vi.getEnv().createCanvasElement,i=r();return i.width=e,i.height=n,i}function wA(t,e){var n=vi.getEnv().ImageData;if(!(t instanceof n)&&!$K(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||DK(t),i=r.width,o=r.height,s=r2({width:i,height:o});return t instanceof n?jf(s).putImageData(t,0,0):jf(s).drawImage(t,0,0,i,o),s}function wRe(t,e){return Je(this,void 0,void 0,function(){var n,r,i,o,s,a;return Ye(this,function(u){switch(u.label){case 0:return n=e||vi.getEnv().createCanvasElement(),r=t.shape.slice(rd(t)?1:0),i=r[0],o=r[1],s=r[2],a=Be(function(){return t.as3D(i,o,s).toInt()}),[4,gA.toPixels(a,n)];case 1:return u.sent(),a.dispose(),[2,n]}})})}function gV(t){var e=vi.getEnv(),n=e.Image,r=e.Canvas,i=e.Video;return t instanceof n||t instanceof r||t instanceof i}function SRe(t,e,n){n===void 0&&(n=!1);var r=vi.getEnv(),i=r.Image,o=r.Canvas;if(!(t instanceof i||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=DK(t),a=e/Math.max(s.height,s.width),u=a*s.width,c=a*s.height,l=r2({width:e,height:e}),d=t instanceof o?t:wA(t),f=Math.abs(u-c)/2,h=n&&u<c?f:0,p=n&&c<u?f:0;return jf(l).drawImage(d,h,p,u,c),l}var fS=function(){function t(e,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=n,this._batchSize=e.length,e.forEach(function(i,o){if(t2(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(rd(i)){var s=i.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var a=i instanceof vi.getEnv().Canvas?i:wA(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Hy(this.batchSize,0,1).map(function(n,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},t.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},t.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},t.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},t.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(e),r=this.getInputHeight(e);return uRe({width:n,height:r},this.inputSize)},t.prototype.toBatchTensor=function(e,n){var r=this;return n===void 0&&(n=!0),this._inputSize=e,Be(function(){var i=Hy(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof Nn){var u=rd(a)?a:a.expandDims();return u=dRe(u,n),(u.shape[1]!==e||u.shape[2]!==e)&&(u=lA.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(a instanceof vi.getEnv().Canvas)return gA.fromPixels(SRe(a,e,n));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),o=Mo(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3);return o})},t}();function kr(t){return Je(this,void 0,void 0,function(){var e,n,r;return Ye(this,function(i){switch(i.label){case 0:if(t instanceof fS)return[2,t];if(e=Array.isArray(t)?t:[t],!e.length)throw new Error("toNetInput - empty array passed as input");return n=function(o){return Array.isArray(t)?" at input index "+o+":":""},r=e.map(AK),r.forEach(function(o,s){if(!gV(o)&&!t2(o)&&!rd(o))throw typeof e[s]=="string"?new Error("toNetInput -"+n(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+n(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(rd(o)){var a=o.shape[0];if(a!==1)throw new Error("toNetInput -"+n(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return gV(o)&&xRe(o)}))];case 1:return i.sent(),[2,new fS(r,Array.isArray(t))]}})})}function SA(t,e){return Je(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Ye(this,function(c){switch(c.label){case 0:return n=vi.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,kr(t)];case 1:if(i=c.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof n?(s=o,[3,4]):[3,2];case 2:return[4,wRe(o)];case 3:s=c.sent(),c.label=4;case 4:r=s,c.label=5;case 5:return a=jf(r),u=e.map(function(l){return l instanceof Su?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,m=r2({width:h,height:p});return jf(m).putImageData(a.getImageData(d,f,h,p),0,0),m})]}})})}function CA(t,e){return Je(this,void 0,void 0,function(){return Ye(this,function(n){if(!t2(t)&&!rd(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(rd(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Be(function(){var r=t.shape.slice(rd(t)?1:0),i=r[0],o=r[1],s=r[2],a=e.map(function(c){return c instanceof Su?c.forSize(o,i).box:c}).map(function(c){return c.clipAtImageBorders(o,i)}),u=a.map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return aK(t.as3D(i,o,s),[d,l,0],[h,f,s])});return u})]})})}function CRe(t,e){return Je(this,void 0,void 0,function(){var n,r;return Ye(this,function(i){switch(i.label){case 0:return n=vi.getEnv().fetch,[4,n(t,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function kRe(t){return Je(this,void 0,void 0,function(){return Ye(this,function(e){switch(e.label){case 0:return[4,CRe(t)];case 1:return[2,e.sent().json()]}})})}function OK(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if(t==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"";t=t.replace(r,"");var i=t.split("/").filter(function(a){return a}),o=t.endsWith(".json")?i[i.length-1]:n,s=r+(t.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=t.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+o:s+"/"+o}}function TRe(t,e){return Je(this,void 0,void 0,function(){var n,r,i,o;return Ye(this,function(s){switch(s.label){case 0:return n=OK(t,e),r=n.manifestUri,i=n.modelBaseUri,[4,kRe(r)];case 1:return o=s.sent(),[2,kK.loadWeights(o,i)]}})})}var Xc=function(){function t(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(e){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;return r[i]},t.prototype.reassignParamFromPath=function(e,n){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=n},t.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Rm})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Rm)})},t.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(n){var r=n.path,i=n.tensor;e.reassignParamFromPath(r,i.variable())})},t.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(n){var r=n.path,i=n.tensor,o=Br(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(n){if(e&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var n=e.tensor;return Array.from(n.dataSync())}).reduce(function(e,n){return e.concat(n)}))},t.prototype.load=function(e){return Je(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return n.sent(),[2]}})})},t.prototype.loadFromUri=function(e){return Je(this,void 0,void 0,function(){var n;return Ye(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,TRe(e,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},t.prototype.loadFromDisk=function(e){return Je(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,l,d;return Ye(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=vi.getEnv().readFile,r=OK(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,s=function(h){return Promise.all(h.map(function(p){return n(p).then(function(m){return m.buffer})}))},a=kK.weightsLoaderFactory(s),l=(c=JSON).parse,[4,n(i)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,a(u,o)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(e){var n=this.extractParamsFromWeigthMap(e),r=n.paramMappings,i=n.params;this._paramMappings=r,this._params=i},t.prototype.extractWeights=function(e){var n=this.extractParams(e),r=n.paramMappings,i=n.params;this._paramMappings=r,this._params=i},t.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=e.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=n.obj,i=n.objProp;if(!r||!i||!(r[i]instanceof Nn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},t}();function Po(t,e,n){return Be(function(){var r=oA(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=Ct(r,e.bias),r})}function XT(t,e,n){return n===void 0&&(n=!1),Be(function(){var r=An(n?Ct(Is(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):Po(t,e.conv0,[2,2])),i=Po(r,e.conv1,[1,1]),o=An(Ct(r,i)),s=Po(o,e.conv2,[1,1]);return An(Ct(r,Ct(i,s)))})}function P1(t,e,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),Be(function(){var i=An(n?Ct(Is(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Po(t,e.conv0,r?[2,2]:[1,1])),o=Po(i,e.conv1,[1,1]),s=An(Ct(i,o)),a=Po(s,e.conv2,[1,1]),u=An(Ct(i,Ct(o,a))),c=Po(u,e.conv3,[1,1]);return An(Ct(i,Ct(o,Ct(a,c))))})}function oa(t,e,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),Be(function(){var i=Ct(Is(t,e.filters,[1,1],n),e.bias);return r?An(i):i})}function Jc(t,e){Object.keys(t).forEach(function(n){e.some(function(r){return r.originalPath===n})||t[n].dispose()})}function i2(t,e){return function(n,r,i,o){var s=Ji(t(n*r*i*i),[i,i,n,r]),a=Yn(t(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function kA(t,e){return function(n,r,i){var o=td(t(n*r),[n,r]),s=Yn(t(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var FK=function(){function t(e,n,r){this.depthwise_filter=e,this.pointwise_filter=n,this.bias=r}return t}();function TA(t,e){return function(n,r,i){var o=Ji(t(9*n),[3,3,n,1]),s=Ji(t(n*r),[1,1,n,r]),a=Yn(t(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new FK(o,s,a)}}function EA(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),i=t(e+"/bias",1);return new FK(n,r,i)}}function Ed(t,e){return function(n,r,i){var o=t[n];if(!e2(o,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:n,paramPath:i||n}),o}}function Yc(t){var e=t;function n(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:n,getRemainingWeights:r}}function LK(t,e){var n=i2(t,e),r=TA(t,e);function i(s,a,u,c){c===void 0&&(c=!1);var l=c?n(s,a,3,u+"/conv0"):r(s,a,u+"/conv0"),d=r(a,a,u+"/conv1"),f=r(a,a,u+"/conv2");return{conv0:l,conv1:d,conv2:f}}function o(s,a,u,c){c===void 0&&(c=!1);var l=i(s,a,u,c),d=l.conv0,f=l.conv1,h=l.conv2,p=r(a,a,u+"/conv3");return{conv0:d,conv1:f,conv2:h,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function ERe(t){var e=[],n=Yc(t),r=n.extractWeights,i=n.getRemainingWeights,o=LK(r,e).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2"),c=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u,dense3:c}}}function MK(t){return function(e){var n=t(e+"/filters",4),r=t(e+"/bias",1);return{filters:n,bias:r}}}function BK(t,e){var n=Ed(t,e),r=MK(n),i=EA(n);function o(a,u){u===void 0&&(u=!1);var c=u?r(a+"/conv0"):i(a+"/conv0"),l=i(a+"/conv1"),d=i(a+"/conv2");return{conv0:c,conv1:l,conv2:d}}function s(a,u){u===void 0&&(u=!1);var c=u?r(a+"/conv0"):i(a+"/conv0"),l=i(a+"/conv1"),d=i(a+"/conv2"),f=i(a+"/conv3");return{conv0:c,conv1:l,conv2:d,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:s}}function _Re(t){var e=[],n=BK(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Jc(t,e),{params:r,paramMappings:e}}var UK=function(t){ht(e,t);function e(){return t.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Be(function(){var i=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=K0(i,o).div(Oe(255)),a=P1(s,r.dense0,!0);return a=P1(a,r.dense1),a=P1(a,r.dense2),a=P1(a,r.dense3),a=H0(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(n){return _Re(n)},e.prototype.extractParams=function(n){return ERe(n)},e}(Xc);function Qa(t,e){return Be(function(){return Ct(YC(t,e.weights),e.bias)})}function IRe(t,e,n){var r=[],i=Yc(t),o=i.extractWeights,s=i.getRemainingWeights,a=kA(o,r),u=a(e,n,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:u}}}function RRe(t){var e=[],n=Ed(t,e);function r(o){var s=n(o+"/weights",2),a=n(o+"/bias",1);return{weights:s,bias:a}}var i={fc:r("fc")};return Jc(t,e),{params:i,paramMappings:e}}function VK(t){var e={},n={};return Object.keys(t).forEach(function(r){var i=r.startsWith("fc")?n:e;i[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var zK=function(t){ht(e,t);function e(n,r){var i=t.call(this,n)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(n){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Be(function(){var o=n instanceof fS?r.faceFeatureExtractor.forwardInput(n):n;return Qa(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),t.prototype.dispose.call(this,n)},e.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(n){return IRe(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(n){var r=VK(n),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),RRe(o)},e.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=n.slice(0,n.length-o),a=n.slice(n.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e}(Xc),vV=["neutral","happy","sad","angry","fearful","disgusted","surprised"],NRe=function(){function t(e){var n=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);vV.forEach(function(r,i){n[r]=e[i]})}return t.prototype.asSortedArray=function(){var e=this;return vV.map(function(n){return{expression:n,probability:e[n]}}).sort(function(n,r){return r.probability-n.probability})},t}(),PRe=function(t){ht(e,t);function e(n){return n===void 0&&(n=new UK),t.call(this,"FaceExpressionNet",n)||this}return e.prototype.forwardInput=function(n){var r=this;return Be(function(){return qc(r.runNet(n))})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(n){return Je(this,void 0,void 0,function(){var r,i,o,s,a=this;return Ye(this,function(u){switch(u.label){case 0:return[4,kr(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(lr(i).map(function(c){return Je(a,void 0,void 0,function(){var l;return Ye(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return o=u.sent(),i.dispose(),s=o.map(function(c){return new NRe(c)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(zK);function WK(t,e){var n={expressions:e};return Object.assign({},t,n)}function ARe(t){return vRe(t)&&t.landmarks instanceof dS&&t.unshiftedLandmarks instanceof dS&&t.alignedRect instanceof Su}function _A(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),i=r.align(),o=t.detection.imageDims,s=new Su(t.detection.score,i.rescale(o.reverse()),o),a={landmarks:r,unshiftedLandmarks:e,alignedRect:s};return Object.assign({},t,a)}function $Re(t,e){var n=i2(t,e),r=TA(t,e);function i(s,a,u){var c=r(s,a,u+"/separable_conv0"),l=r(a,a,u+"/separable_conv1"),d=n(s,a,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:d}}function o(s,a){var u=r(s,s,a+"/separable_conv0"),c=r(s,s,a+"/separable_conv1"),l=r(s,s,a+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function DRe(t,e){var n=[],r=Yc(t),i=r.extractWeights,o=r.getRemainingWeights,s=$Re(i,n),a=s.extractConvParams,u=s.extractSeparableConvParams,c=s.extractReductionBlockParams,l=s.extractMainBlockParams,d=a(3,32,3,"entry_flow/conv_in"),f=c(32,64,"entry_flow/reduction_block_0"),h=c(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:f,reduction_block_1:h},m={};Hy(e,0,1).forEach(function(b){m["main_block_"+b]=l(128,"middle_flow/main_block_"+b)});var v=c(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),y={reduction_block:v,separable_conv:g};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{entry_flow:p,middle_flow:m,exit_flow:y}}}function ORe(t,e){var n=Ed(t,e),r=MK(n),i=EA(n);function o(a){var u=i(a+"/separable_conv0"),c=i(a+"/separable_conv1"),l=r(a+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function s(a){var u=i(a+"/separable_conv0"),c=i(a+"/separable_conv1"),l=i(a+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:s}}function FRe(t,e){var n=[],r=ORe(t,n),i=r.extractConvParams,o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,u=i("entry_flow/conv_in"),c=s("entry_flow/reduction_block_0"),l=s("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:c,reduction_block_1:l},f={};Hy(e,0,1).forEach(function(v){f["main_block_"+v]=a("middle_flow/main_block_"+v)});var h=s("exit_flow/reduction_block"),p=o("exit_flow/separable_conv"),m={reduction_block:h,separable_conv:p};return Jc(t,n),{params:{entry_flow:d,middle_flow:f,exit_flow:m},paramMappings:n}}function jK(t,e,n){return Ct(Is(t,e.filters,n,"same"),e.bias)}function JT(t,e,n){n===void 0&&(n=!0);var r=n?An(t):t;return r=Po(r,e.separable_conv0,[1,1]),r=Po(An(r),e.separable_conv1,[1,1]),r=yr(r,[3,3],[2,2],"same"),r=Ct(r,jK(t,e.expansion_conv,[2,2])),r}function LRe(t,e){var n=Po(An(t),e.separable_conv0,[1,1]);return n=Po(An(n),e.separable_conv1,[1,1]),n=Po(An(n),e.separable_conv2,[1,1]),n=Ct(n,t),n}var MRe=function(t){ht(e,t);function e(n){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return e.prototype.forwardInput=function(n){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Be(function(){var o=n.toBatchTensor(112,!0),s=[122.782,117.001,104.298],a=K0(o,s).div(Oe(256)),u=An(jK(a,i.entry_flow.conv_in,[2,2]));return u=JT(u,i.entry_flow.reduction_block_0,!1),u=JT(u,i.entry_flow.reduction_block_1),Hy(r._numMainBlocks,0,1).forEach(function(c){u=LRe(u,i.middle_flow["main_block_"+c])}),u=JT(u,i.exit_flow.reduction_block),u=An(Po(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(n){return FRe(n,this._numMainBlocks)},e.prototype.extractParams=function(n){return DRe(n,this._numMainBlocks)},e}(Xc);function BRe(t){var e=[],n=Yc(t),r=n.extractWeights,i=n.getRemainingWeights,o=kA(r,e),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:a}}}}function URe(t){var e=[],n=Ed(t,e);function r(o){var s=n(o+"/weights",2),a=n(o+"/bias",1);return{weights:s,bias:a}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Jc(t,e),{params:i,paramMappings:e}}var hS;(function(t){t.FEMALE="female",t.MALE="male"})(hS||(hS={}));var VRe=function(t){ht(e,t);function e(n){n===void 0&&(n=new MRe(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(n){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Be(function(){var o=n instanceof fS?r.faceFeatureExtractor.forwardInput(n):n,s=H0(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),a=Qa(s,i.fc.age).as1D(),u=Qa(s,i.fc.gender);return{age:a,gender:u}})},e.prototype.forwardInput=function(n){var r=this;return Be(function(){var i=r.runNet(n),o=i.age,s=i.gender;return{age:o,gender:qc(s)}})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(n){return Je(this,void 0,void 0,function(){var r,i,o,s,a,u,c=this;return Ye(this,function(l){switch(l.label){case 0:return[4,kr(n)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return i=l.sent(),o=lr(i.age),s=lr(i.gender),a=o.map(function(d,f){return{ageTensor:d,genderTensor:s[f]}}),[4,Promise.all(a.map(function(d){var f=d.ageTensor,h=d.genderTensor;return Je(c,void 0,void 0,function(){var p,m,v,g,y;return Ye(this,function(b){switch(b.label){case 0:return[4,f.data()];case 1:return p=b.sent()[0],[4,h.data()];case 2:return m=b.sent()[0],v=m>.5,g=v?hS.MALE:hS.FEMALE,y=v?m:1-m,f.dispose(),h.dispose(),[2,{age:p,gender:g,genderProbability:y}]}})})}))];case 3:return u=l.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),t.prototype.dispose.call(this,n)},e.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(n){return BRe(n)},e.prototype.extractParamsFromWeigthMap=function(n){var r=VK(n),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),URe(o)},e.prototype.extractParams=function(n){var r=1539,i=n.slice(0,n.length-r),o=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(Xc),GK=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.postProcess=function(n,r,i){var o=i.map(function(a){var u=a.width,c=a.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),s=o.length;return Be(function(){var a=function(f,h){return Mo([au([68],f),au([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=o[f],m=p.width,v=p.height;return h(m,v)?Math.abs(m-v)/2:0},c=function(f){return u(f,function(h,p){return h<p})},l=function(f){return u(f,function(h,p){return p<h})},d=n.mul(au([s,136],r)).sub(Mo(Array.from(Array(s),function(f,h){return a(c(h),l(h))}))).div(Mo(Array.from(Array(s),function(f,h){return a(o[h].width,o[h].height)})));return d})},e.prototype.forwardInput=function(n){var r=this;return Be(function(){var i=r.runNet(n);return r.postProcess(i,n.inputSize,n.inputDimensions.map(function(o){var s=o[0],a=o[1];return{height:s,width:a}}))})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(n){return Je(this,void 0,void 0,function(){var r,i,o,s=this;return Ye(this,function(a){switch(a.label){case 0:return[4,kr(n)];case 1:return r=a.sent(),i=Be(function(){return lr(s.forwardInput(r))}),[4,Promise.all(i.map(function(u,c){return Je(s,void 0,void 0,function(){var l,d,f,h,p;return Ye(this,function(m){switch(m.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[m.sent()]),h=l.filter(function(v,g){return lV(g)}),p=l.filter(function(v,g){return!lV(g)}),[2,new gRe(Array(68).fill(0).map(function(v,g){return new qt(h[g],p[g])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(zK),HK=function(t){ht(e,t);function e(n){return n===void 0&&(n=new UK),t.call(this,"FaceLandmark68Net",n)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(GK);function zRe(t){var e=[],n=BK(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Jc(t,e),{params:r,paramMappings:e}}function WRe(t){var e=[],n=Yc(t),r=n.extractWeights,i=n.getRemainingWeights,o=LK(r,e).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u}}}var jRe=function(t){ht(e,t);function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Be(function(){var i=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=K0(i,o).div(Oe(255)),a=XT(s,r.dense0,!0);return a=XT(a,r.dense1),a=XT(a,r.dense2),a=H0(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(n){return zRe(n)},e.prototype.extractParams=function(n){return WRe(n)},e}(Xc),GRe=function(t){ht(e,t);function e(n){return n===void 0&&(n=new jRe),t.call(this,"FaceLandmark68TinyNet",n)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(GK);(function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(HK);function HRe(t,e){return Ct(hi(t,e.weights),e.biases)}function IA(t,e,n,r,i){i===void 0&&(i="same");var o=e.conv,s=o.filters,a=o.bias,u=Is(t,s,n,i);return u=Ct(u,a),u=HRe(u,e.scale),r?An(u):u}function qRe(t,e){return IA(t,e,[1,1],!0)}function qK(t,e){return IA(t,e,[1,1],!1)}function KK(t,e){return IA(t,e,[2,2],!0,"valid")}function KRe(t,e){function n(a,u,c){var l=t(a),d=l.length/(u*c*c);if(sRe(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return Be(function(){return cd(Ji(l,[u,d,c,c]),[2,3,1,0])})}function r(a,u,c,l){var d=n(a,u,c),f=Yn(t(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}function i(a,u){var c=Yn(t(a)),l=Yn(t(a));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function o(a,u,c,l){var d=r(a,u,c,l+"/conv"),f=i(u,l+"/scale");return{conv:d,scale:f}}function s(a,u,c,l,d){d===void 0&&(d=!1);var f=o((d?.5:1)*a,u,c,l+"/conv1"),h=o(a,u,c,l+"/conv2");return{conv1:f,conv2:h}}return{extractConvLayerParams:o,extractResidualLayerParams:s}}function XRe(t){var e=Yc(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=KRe(n,i),s=o.extractConvLayerParams,a=o.extractResidualLayerParams,u=s(4704,32,7,"conv32_down"),c=a(9216,32,3,"conv32_1"),l=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),h=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),m=a(36864,64,3,"conv64_3"),v=a(147456,128,3,"conv128_down",!0),g=a(147456,128,3,"conv128_1"),y=a(147456,128,3,"conv128_2"),b=a(589824,256,3,"conv256_down",!0),x=a(589824,256,3,"conv256_1"),S=a(589824,256,3,"conv256_2"),C=a(589824,256,3,"conv256_down_out"),T=Be(function(){return cd(td(n(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:S,conv256_down_out:C,fc:T};return{params:E,paramMappings:i}}function JRe(t,e){var n=Ed(t,e);function r(s){var a=n(s+"/scale/weights",1),u=n(s+"/scale/biases",1);return{weights:a,biases:u}}function i(s){var a=n(s+"/conv/filters",4),u=n(s+"/conv/bias",1),c=r(s);return{conv:{filters:a,bias:u},scale:c}}function o(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function YRe(t){var e=[],n=JRe(t,e),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,o=r("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),l=i("conv64_1"),d=i("conv64_2"),f=i("conv64_3"),h=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),v=i("conv256_down"),g=i("conv256_1"),y=i("conv256_2"),b=i("conv256_down_out"),x=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!oRe(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var S={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return Jc(t,e),{params:S,paramMappings:e}}function Ca(t,e){var n=qRe(t,e.conv1);return n=qK(n,e.conv2),n=Ct(n,t),n=An(n),n}function A1(t,e){var n=KK(t,e.conv1);n=qK(n,e.conv2);var r=H0(t,2,2,"valid"),i=Cn(r.shape),o=r.shape[3]!==n.shape[3],s=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(s){var a=ey(n.shape);a[1]=1;var u=Cn(a);n=cr([n,u],1);var c=ey(n.shape);c[2]=1;var l=Cn(c);n=cr([n,l],2)}return r=o?cr([r,i],3):r,n=Ct(r,n),n=An(n),n}var QRe=function(t){ht(e,t);function e(){return t.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Be(function(){var i=n.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],s=K0(i,o).div(Oe(256)),a=KK(s,r.conv32_down);a=yr(a,3,2,"valid"),a=Ca(a,r.conv32_1),a=Ca(a,r.conv32_2),a=Ca(a,r.conv32_3),a=A1(a,r.conv64_down),a=Ca(a,r.conv64_1),a=Ca(a,r.conv64_2),a=Ca(a,r.conv64_3),a=A1(a,r.conv128_down),a=Ca(a,r.conv128_1),a=Ca(a,r.conv128_2),a=A1(a,r.conv256_down),a=Ca(a,r.conv256_1),a=Ca(a,r.conv256_2),a=A1(a,r.conv256_down_out);var u=a.mean([1,2]),c=YC(u,r.fc);return c})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(n){return Je(this,void 0,void 0,function(){var r,i,o,s=this;return Ye(this,function(a){switch(a.label){case 0:return[4,kr(n)];case 1:return r=a.sent(),i=Be(function(){return lr(s.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(n){return YRe(n)},e.prototype.extractParams=function(n){return XRe(n)},e}(Xc);function XK(t,e){var n={descriptor:e};return Object.assign({},t,n)}function JK(t,e){var n={age:e};return Object.assign({},t,n)}function YK(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var QK=function(){function t(e){var n=e===void 0?{}:e,r=n.minFaceSize,i=n.scaleFactor,o=n.maxNumScales,s=n.scoreThresholds,a=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function ZRe(t,e){function n(u,c){var l=Ji(t(9*u),[3,3,u,1]),d=Yn(t(u)),f=Yn(t(u)),h=Yn(t(u)),p=Yn(t(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}function r(u,c,l,d,f){var h=Ji(t(u*c*l*l),[l,l,u,c]),p=Yn(t(c));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function i(u,c,l,d){var f=r(u,c,l,d,!0),h=f.filters,p=f.bias;return{filters:h,batch_norm_offset:p}}function o(u,c,l){var d=n(u,l+"/depthwise_conv"),f=i(u,c,1,l+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:f}}function s(){var u=i(3,32,3,"mobilenetv1/conv_0"),c=o(32,64,"mobilenetv1/conv_1"),l=o(64,128,"mobilenetv1/conv_2"),d=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),h=o(256,256,"mobilenetv1/conv_5"),p=o(256,512,"mobilenetv1/conv_6"),m=o(512,512,"mobilenetv1/conv_7"),v=o(512,512,"mobilenetv1/conv_8"),g=o(512,512,"mobilenetv1/conv_9"),y=o(512,512,"mobilenetv1/conv_10"),b=o(512,512,"mobilenetv1/conv_11"),x=o(512,1024,"mobilenetv1/conv_12"),S=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:m,conv_8:v,conv_9:g,conv_10:y,conv_11:b,conv_12:x,conv_13:S}}function a(){var u=i(1024,256,1,"prediction_layer/conv_0"),c=i(256,512,3,"prediction_layer/conv_1"),l=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),f=i(256,128,1,"prediction_layer/conv_4"),h=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),m=i(64,128,3,"prediction_layer/conv_7"),v=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),y=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),b=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),x=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),S=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),N=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),$=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),F={box_encoding_predictor:v,class_predictor:g},H={box_encoding_predictor:y,class_predictor:b},G={box_encoding_predictor:x,class_predictor:S},J={box_encoding_predictor:C,class_predictor:T},ne={box_encoding_predictor:E,class_predictor:I},oe={box_encoding_predictor:N,class_predictor:$};return{conv_0:u,conv_1:c,conv_2:l,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:m,box_predictor_0:F,box_predictor_1:H,box_predictor_2:G,box_predictor_3:J,box_predictor_4:ne,box_predictor_5:oe}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:a}}function eNe(t){var e=[],n=Yc(t),r=n.extractWeights,i=n.getRemainingWeights,o=ZRe(r,e),s=o.extractMobilenetV1Params,a=o.extractPredictionLayerParams,u=s(),c=a(),l=jP(r(5118*4),[1,5118,4]),d={extra_dim:l};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:e}}function tNe(t,e){var n=Ed(t,e);function r(c,l,d){var f=n(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),h=n(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:f,batch_norm_offset:h}}function i(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv",p=n(d+"/depthwise_weights",4,f+"/filters"),m=n(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),v=n(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),g=n(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),y=n(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:v,batch_norm_mean:g,batch_norm_variance:y},pointwise_conv:r("MobilenetV1",c,h)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(c,l){var d=n(c+"/weights",4,l+"/filters"),f=n(c+"/biases",1,l+"/bias");return{filters:d,bias:f}}function a(c){var l=s("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),d=s("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function nNe(t){var e=[],n=tNe(t,e),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,o=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!t2(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return Jc(t,e),{params:s,paramMappings:e}}function Ea(t,e,n){return Be(function(){var r=Is(t,e.filters,n,"same");return r=Ct(r,e.batch_norm_offset),tA(r,0,6)})}var rNe=.0010000000474974513;function iNe(t,e,n){return Be(function(){var r=JC(t,e.filters,n,"same");return r=H7(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,rNe),tA(r,0,6)})}function oNe(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}function sNe(t,e){return Be(function(){var n=null,r=Ea(t,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,s){var a=s+1,u=oNe(a);r=iNe(r,o.depthwise_conv,u),r=Ea(r,o.pointwise_conv,[1,1]),a===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function aNe(t,e,n,r,i){var o=t.shape[0],s=Math.min(n,o),a=e.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>i}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return a.forEach(function(l){if(!(c.length>=s)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=uNe(t,l.boxIndex,c[f]);if(h!==0&&(l.score*=u(h),l.score<=i))break}d===l.score&&c.push(l.boxIndex)}}),c}function uNe(t,e,n){var r=t.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),f=(s-i)*(a-o),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(i,u),m=Math.max(o,c),v=Math.min(s,l),g=Math.min(a,d),y=Math.max(v-p,0)*Math.max(g-m,0);return y/(f+h-y)}function cNe(t){var e=lr(cd(t,[1,0])),n=[hr(e[2],e[0]),hr(e[3],e[1])],r=[Ct(e[0],Ws(n[0],Oe(2))),Ct(e[1],Ws(n[1],Oe(2)))];return{sizes:n,centers:r}}function lNe(t,e){var n=cNe(t),r=n.sizes,i=n.centers,o=lr(cd(e,[1,0])),s=Ws(hi(LI(Ws(o[2],Oe(5))),r[0]),Oe(2)),a=Ct(hi(Ws(o[0],Oe(10)),r[0]),i[0]),u=Ws(hi(LI(Ws(o[3],Oe(5))),r[1]),Oe(2)),c=Ct(hi(Ws(o[1],Oe(10)),r[1]),i[1]);return cd(Mo([hr(a,s),hr(c,u),Ct(a,s),Ct(c,u)]),[1,0])}function dNe(t,e,n){return Be(function(){var r=t.shape[0],i=lNe(ta(em(n.extra_dim,[r,1,1]),[-1,4]),ta(t,[-1,4]));i=ta(i,[r,i.shape[0]/r,4]);var o=z7(lu(e,[0,0,1],[-1,-1,-1])),s=lu(o,[0,0,0],[-1,-1,1]);s=ta(s,[r,s.shape[1]]);var a=lr(i),u=lr(s);return{boxes:a,scores:u}})}function Qh(t,e){return Be(function(){var n=t.shape[0],r=ta(oa(t,e.box_encoding_predictor),[n,-1,1,4]),i=ta(oa(t,e.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function fNe(t,e,n){return Be(function(){var r=Ea(t,n.conv_0,[1,1]),i=Ea(r,n.conv_1,[2,2]),o=Ea(i,n.conv_2,[1,1]),s=Ea(o,n.conv_3,[2,2]),a=Ea(s,n.conv_4,[1,1]),u=Ea(a,n.conv_5,[2,2]),c=Ea(u,n.conv_6,[1,1]),l=Ea(c,n.conv_7,[2,2]),d=Qh(e,n.box_predictor_0),f=Qh(t,n.box_predictor_1),h=Qh(i,n.box_predictor_2),p=Qh(s,n.box_predictor_3),m=Qh(u,n.box_predictor_4),v=Qh(l,n.box_predictor_5),g=cr([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),y=cr([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,m.classPrediction,v.classPrediction],1);return{boxPredictions:g,classPredictions:y}})}var X0=function(){function t(e){var n=e===void 0?{}:e,r=n.minConfidence,i=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),ZK=function(t){ht(e,t);function e(){return t.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Be(function(){var i=n.toBatchTensor(512,!1).toFloat(),o=hr(hi(i,Oe(.007843137718737125)),Oe(1)),s=sNe(o,r.mobilenetv1),a=fNe(s.out,s.conv11,r.prediction_layer),u=a.boxPredictions,c=a.classPredictions;return dNe(u,c,r.output_layer)})},e.prototype.forward=function(n){return Je(this,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,kr(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E;return Ye(this,function(I){switch(I.label){case 0:return i=new X0(r),o=i.maxResults,s=i.minConfidence,[4,kr(n)];case 1:for(a=I.sent(),u=this.forwardInput(a),c=u.boxes,l=u.scores,d=c[0],f=l[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return v=(m=Array).from,[4,f.data()];case 2:return p=v.apply(m,[I.sent()]),g=.5,y=aNe(d,p,o,g,s),b=a.getReshapedInputDimensions(0),x=a.inputSize,S=x/b.width,C=x/b.height,T=d.arraySync(),E=y.map(function(N){var $=[Math.max(0,T[N][0]),Math.min(1,T[N][2])].map(function(oe){return oe*C}),F=$[0],H=$[1],G=[Math.max(0,T[N][1]),Math.min(1,T[N][3])].map(function(oe){return oe*S}),J=G[0],ne=G[1];return new Su(p[N],new yA(J,F,ne-J,H-F),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(n){return nNe(n)},e.prototype.extractParams=function(n){return eNe(n)},e}(Xc);(function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(ZK);var hNe=.4,pNe=[new qt(.738768,.874946),new qt(2.42204,2.65704),new qt(4.30971,7.04493),new qt(10.246,4.59428),new qt(12.6868,11.8741)],mNe=[new qt(1.603231,2.094468),new qt(6.041143,7.080126),new qt(2.882459,3.518061),new qt(4.266906,5.178857),new qt(9.041765,10.66308)],gNe=[117.001,114.697,97.404],vNe="tiny_yolov2_model",yNe="tiny_yolov2_separable_conv_model",$1=function(t){return typeof t=="number"};function bNe(t){if(!t)throw new Error("invalid config: "+t);if(typeof t.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!$1(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(e){return e||{}}).every(function(e){return $1(e.x)&&$1(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||t.meanRgb.length!==3||!t.meanRgb.every($1)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}function RA(t){return Be(function(){var e=hi(t,Oe(.10000000149011612));return Ct(An(hr(t,e)),e)})}function gl(t,e){return Be(function(){var n=gh(t,[[0,0],[1,1],[1,1],[0,0]]);return n=Is(n,e.conv.filters,[1,1],"valid"),n=hr(n,e.bn.sub),n=hi(n,e.bn.truediv),n=Ct(n,e.conv.bias),RA(n)})}function vl(t,e){return Be(function(){var n=gh(t,[[0,0],[1,1],[1,1],[0,0]]);return n=oA(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),n=Ct(n,e.bias),RA(n)})}function xNe(t,e){var n=i2(t,e);function r(s,a){var u=Yn(t(s)),c=Yn(t(s));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:c}}function i(s,a,u){var c=n(s,a,3,u+"/conv"),l=r(a,u+"/bn");return{conv:c,bn:l}}var o=TA(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function wNe(t,e,n,r){var i=Yc(t),o=i.extractWeights,s=i.getRemainingWeights,a=[],u=xNe(o,a),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,f;if(e.withSeparableConvs){var h=r[0],p=r[1],m=r[2],v=r[3],g=r[4],y=r[5],b=r[6],x=r[7],S=r[8],C=e.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),T=d(p,m,"conv1"),E=d(m,v,"conv2"),I=d(v,g,"conv3"),N=d(g,y,"conv4"),$=d(y,b,"conv5"),F=x?d(b,x,"conv6"):void 0,H=S?d(x,S,"conv7"):void 0,G=c(S||x||b,5*n,1,"conv8");f={conv0:C,conv1:T,conv2:E,conv3:I,conv4:N,conv5:$,conv6:F,conv7:H,conv8:G}}else{var h=r[0],p=r[1],m=r[2],v=r[3],g=r[4],y=r[5],b=r[6],x=r[7],S=r[8],C=l(h,p,"conv0"),T=l(p,m,"conv1"),E=l(m,v,"conv2"),I=l(v,g,"conv3"),N=l(g,y,"conv4"),$=l(y,b,"conv5"),F=l(b,x,"conv6"),H=l(x,S,"conv7"),G=c(S,5*n,1,"conv8");f={conv0:C,conv1:T,conv2:E,conv3:I,conv4:N,conv5:$,conv6:F,conv7:H,conv8:G}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:f,paramMappings:a}}function SNe(t,e){var n=Ed(t,e);function r(a){var u=n(a+"/sub",1),c=n(a+"/truediv",1);return{sub:u,truediv:c}}function i(a){var u=n(a+"/filters",4),c=n(a+"/bias",1);return{filters:u,bias:c}}function o(a){var u=i(a+"/conv"),c=r(a+"/bn");return{conv:u,bn:c}}var s=EA(n);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:s}}function CNe(t,e){var n=[],r=SNe(t,n),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Jc(t,n),{params:a,paramMappings:n}}var yV;(function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"})(yV||(yV={}));var NA=function(){function t(e){var n=e===void 0?{}:e,r=n.inputSize,i=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),e9=function(t){ht(e,t);function e(n){var r=t.call(this,"TinyYolov2")||this;return bNe(n),r._config=n,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(n,r){var i=gl(n,r.conv0);return i=yr(i,[2,2],[2,2],"same"),i=gl(i,r.conv1),i=yr(i,[2,2],[2,2],"same"),i=gl(i,r.conv2),i=yr(i,[2,2],[2,2],"same"),i=gl(i,r.conv3),i=yr(i,[2,2],[2,2],"same"),i=gl(i,r.conv4),i=yr(i,[2,2],[2,2],"same"),i=gl(i,r.conv5),i=yr(i,[2,2],[1,1],"same"),i=gl(i,r.conv6),i=gl(i,r.conv7),oa(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(n,r){var i=this.config.isFirstLayerConv2d?RA(oa(n,r.conv0,"valid",!1)):vl(n,r.conv0);return i=yr(i,[2,2],[2,2],"same"),i=vl(i,r.conv1),i=yr(i,[2,2],[2,2],"same"),i=vl(i,r.conv2),i=yr(i,[2,2],[2,2],"same"),i=vl(i,r.conv3),i=yr(i,[2,2],[2,2],"same"),i=vl(i,r.conv4),i=yr(i,[2,2],[2,2],"same"),i=vl(i,r.conv5),i=yr(i,[2,2],[1,1],"same"),i=r.conv6?vl(i,r.conv6):i,i=r.conv7?vl(i,r.conv7):i,oa(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(n,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return Be(function(){var s=n.toBatchTensor(r,!1).toFloat();return s=i.config.meanRgb?K0(s,i.config.meanRgb):s,s=s.div(Oe(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},e.prototype.forward=function(n,r){return Je(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,kr(n)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(n,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i,o,s,a,u,c,l,d,f,h,p,m,v,g,y=this;return Ye(this,function(b){switch(b.label){case 0:return i=new NA(r),o=i.inputSize,s=i.scoreThreshold,[4,kr(n)];case 1:return a=b.sent(),[4,this.forwardInput(a,o)];case 2:return u=b.sent(),c=Be(function(){return lr(u)[0].expandDims()}),l={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(c,a.getReshapedInputDimensions(0),s)];case 3:return d=b.sent(),u.dispose(),c.dispose(),f=d.map(function(x){return x.box}),h=d.map(function(x){return x.score}),p=d.map(function(x){return x.classScore}),m=d.map(function(x){return y.config.classes[x.label]}),v=qy(f.map(function(x){return x.rescale(o)}),h,this.config.iouThreshold,!0),g=v.map(function(x){return new EK(h[x],p[x],m[x],f[x],l)}),[2,g]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(n){return CNe(n,this.config)},e.prototype.extractParams=function(n){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return wNe(n,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(n,r,i){return Je(this,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E,I,N,$,F,H,G,J,ne,oe,q=this;return Ye(this,function(Z){switch(Z.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),u=a/o,c=a/s,l=n.shape[1],d=this.config.anchors.length,f=Be(function(){var se=n.reshape([l,l,d,q.boxEncodingSize]),fe=se.slice([0,0,0,0],[l,l,d,4]),xe=se.slice([0,0,0,4],[l,l,d,1]),be=q.withClassScores?qc(se.slice([0,0,0,5],[l,l,d,q.config.classes.length]),3):Oe(0);return[fe,xe,be]}),h=f[0],p=f[1],m=f[2],v=[],[4,p.array()];case 1:return g=Z.sent(),[4,h.array()];case 2:y=Z.sent(),b=0,Z.label=3;case 3:if(!(b<l))return[3,12];x=0,Z.label=4;case 4:if(!(x<l))return[3,11];S=0,Z.label=5;case 5:return S<d?(C=KT(g[b][x][S][0]),!i||C>i?(T=(x+KT(y[b][x][S][0]))/l*u,E=(b+KT(y[b][x][S][1]))/l*c,I=Math.exp(y[b][x][S][2])*this.config.anchors[S].x/l*u,N=Math.exp(y[b][x][S][3])*this.config.anchors[S].y/l*c,$=T-I/2,F=E-N/2,H={row:b,col:x,anchor:S},this.withClassScores?[4,this.extractPredictedClass(m,H)]:[3,7]):[3,9]):[3,10];case 6:return oe=Z.sent(),[3,8];case 7:oe={classScore:1,label:0},Z.label=8;case 8:G=oe,J=G.classScore,ne=G.label,v.push(oi({box:new n2($,F,$+I,F+N),score:C,classScore:C*J,label:ne},H)),Z.label=9;case 9:return S++,[3,5];case 10:return x++,[3,4];case 11:return b++,[3,3];case 12:return h.dispose(),p.dispose(),m.dispose(),[2,v]}})})},e.prototype.extractPredictedClass=function(n,r){return Je(this,void 0,void 0,function(){var i,o,s,a;return Ye(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,n.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return a[i][o][s][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Xc),kNe=function(t){ht(e,t);function e(n){n===void 0&&(n=!0);var r=this,i=Object.assign({},{withSeparableConvs:n,iouThreshold:hNe,classes:["face"]},n?{anchors:mNe,meanRgb:gNe}:{anchors:pNe,withClassScores:!0});return r=t.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(n,r){return Je(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return[4,this.detect(n,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new Su(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?yNe:vNe},e.prototype.extractParamsFromWeigthMap=function(n){return t.prototype.extractParamsFromWeigthMap.call(this,n)},e}(e9),t9=function(t){ht(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return e}(NA),J0=function(){function t(){}return t.prototype.then=function(e){return Je(this,void 0,void 0,function(){var n;return Ye(this,function(r){switch(r.label){case 0:return n=e,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return Je(this,void 0,void 0,function(){return Ye(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},t}();function o2(t,e,n,r,i){return i===void 0&&(i=function(o){var s=o.alignedRect;return s}),Je(this,void 0,void 0,function(){var o,s,a,u,c;return Ye(this,function(l){switch(l.label){case 0:return o=t.map(function(d){return ARe(d)?i(d):d.detection}),a=r,a?[3,5]:e instanceof Nn?[4,CA(e,o)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,SA(e,o)];case 3:u=l.sent(),l.label=4;case 4:a=u,l.label=5;case 5:return s=a,[4,n(s)];case 6:return c=l.sent(),s.forEach(function(d){return d instanceof Nn&&d.dispose()}),[2,c]}})})}function PA(t,e,n,r,i){return Je(this,void 0,void 0,function(){var o=this;return Ye(this,function(s){return[2,o2([t],e,function(a){return Je(o,void 0,void 0,function(){return Ye(this,function(u){return[2,n(a[0])]})})},r,i)]})})}function TNe(t){return Be(function(){return Mo(lr(t,3).reverse(),3)})}var D1=2,pS=12;function ENe(t,e){var n=i2(t,e),r=kA(t,e);function i(c,l){var d=Yn(t(c));return e.push({paramPath:l}),d}function o(c,l,d){d===void 0&&(d=!1);var f=n(c[0],c[1],3,l+"/conv1"),h=i(c[1],l+"/prelu1_alpha"),p=n(c[1],c[2],3,l+"/conv2"),m=i(c[2],l+"/prelu2_alpha"),v=n(c[2],c[3],d?2:3,l+"/conv3"),g=i(c[3],l+"/prelu3_alpha");return{conv1:f,prelu1_alpha:h,conv2:p,prelu2_alpha:m,conv3:v,prelu3_alpha:g}}function s(){var c=o([3,10,16,32],"pnet"),l=n(32,2,1,"pnet/conv4_1"),d=n(32,4,1,"pnet/conv4_2");return oi(oi({},c),{conv4_1:l,conv4_2:d})}function a(){var c=o([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return oi(oi({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})}function u(){var c=o([3,32,64,64],"onet"),l=n(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),v=r(256,10,"onet/fc2_3");return oi(oi({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:m,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:a,extractONetParams:u}}function _Ne(t){var e=Yc(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=ENe(n,i),s=o.extractPNetParams,a=o.extractRNetParams,u=o.extractONetParams,c=s(),l=a(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:i}}function INe(t,e){var n=Ed(t,e);function r(l){var d=n(l+"/weights",4,l+"/filters"),f=n(l+"/bias",1);return{filters:d,bias:f}}function i(l){var d=n(l+"/weights",2),f=n(l+"/bias",1);return{weights:d,bias:f}}function o(l){return n(l,1)}function s(l){var d=r(l+"/conv1"),f=o(l+"/prelu1_alpha"),h=r(l+"/conv2"),p=o(l+"/prelu2_alpha"),m=r(l+"/conv3"),v=o(l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:h,prelu2_alpha:p,conv3:m,prelu3_alpha:v}}function a(){var l=s("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return oi(oi({},l),{conv4_1:d,conv4_2:f})}function u(){var l=s("rnet"),d=i("rnet/fc1"),f=o("rnet/prelu4_alpha"),h=i("rnet/fc2_1"),p=i("rnet/fc2_2");return oi(oi({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})}function c(){var l=s("onet"),d=r("onet/conv4"),f=o("onet/prelu4_alpha"),h=i("onet/fc1"),p=o("onet/prelu5_alpha"),m=i("onet/fc2_1"),v=i("onet/fc2_2"),g=i("onet/fc2_3");return oi(oi({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:m,fc2_2:v,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:u,extractONetParams:c}}function RNe(t){var e=[],n=INe(t,e),r=n.extractPNetParams,i=n.extractRNetParams,o=n.extractONetParams,s=r(),a=i(),u=o();return Jc(t,e),{params:{pnet:s,rnet:a,onet:u},paramMappings:e}}function GI(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}function NNe(t,e,n){for(var r=n[0],i=n[1],o=pS/t,s=[],a=Math.min(r,i)*o,u=0;a>=12;)s.push(o*Math.pow(e,u)),a=a*e,u+=1;return s}var AA=function(t){ht(e,t);function e(n,r,i,o){return t.call(this,{left:n,top:r,right:i,bottom:o},!0)||this}return e}(ld);function n9(t){return Be(function(){return hi(hr(t,Oe(127.5)),Oe(.0078125))})}function sm(t,e){return Be(function(){return Ct(An(t),hi(e,aS(An(aS(t)))))})}function $A(t,e,n){return n===void 0&&(n=!1),Be(function(){var r=oa(t,e.conv1,"valid");return r=sm(r,e.prelu1_alpha),r=yr(r,n?[2,2]:[3,3],[2,2],"same"),r=oa(r,e.conv2,"valid"),r=sm(r,e.prelu2_alpha),r=n?r:yr(r,[3,3],[2,2],"valid"),r=oa(r,e.conv3,"valid"),r=sm(r,e.prelu3_alpha),r})}function PNe(t,e){return Be(function(){var n=$A(t,e,!0),r=oa(n,e.conv4_1,"valid"),i=us(QC(r,3),3),o=qc(hr(r,i),3),s=oa(n,e.conv4_2,"valid");return{prob:o,regions:s}})}function ANe(t,e){return Be(function(){var n=GI(e,t.shape.slice(1)),r=n.height,i=n.width,o=lA.resizeBilinear(t,[r,i]),s=n9(o);return cd(s,[0,2,1,3])})}function $Ne(t,e,n,r){for(var i=[],o=t.arraySync(),s=0;s<t.shape[0];s++)for(var a=0;a<t.shape[1];a++)o[s][a]>=r&&i.push(new qt(a,s));var u=i.map(function(c){var l=new n2(Math.round((c.y*D1+1)/n),Math.round((c.x*D1+1)/n),Math.round((c.y*D1+pS)/n),Math.round((c.x*D1+pS)/n)),d=o[c.y][c.x],f=e.arraySync(),h=new AA(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3]);return{cell:l,score:d,region:h}});return u}function DNe(t,e,n,r,i){i.stage1=[];var o=e.map(function(f){return Be(function(){var h={scale:f},p=ANe(t,f),m=Date.now(),v=PNe(p,r),g=v.prob,y=v.regions;h.pnet=Date.now()-m;var b=lr(lr(g,3)[1])[0],x=lr(y)[0];return{scoresTensor:b,regionsTensor:x,scale:f,statsForScale:h}})}),s=o.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,m=f.scale,v=f.statsForScale,g=$Ne(h,p,m,n);if(h.dispose(),p.dispose(),!g.length)return i.stage1.push(v),[];var y=Date.now(),b=qy(g.map(function(x){return x.cell}),g.map(function(x){return x.score}),.5);return v.nms=Date.now()-y,v.numBoxes=b.length,i.stage1.push(v),b.map(function(x){return g[x]})}),a=s.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(a.length>0){var l=Date.now(),d=qy(a.map(function(f){return f.cell}),a.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-l,c=d.map(function(f){return a[f].score}),u=d.map(function(f){return a[f]}).map(function(f){var h=f.cell,p=f.region;return new n2(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function r9(t,e,n){var r=n.width,i=n.height;return Je(this,void 0,void 0,function(){var o,s,a,u=this;return Ye(this,function(c){switch(c.label){case 0:return o=jf(t),[4,Promise.all(e.map(function(l){return Je(u,void 0,void 0,function(){var d,f,h,p,m,v,g,y;return Ye(this,function(b){return d=l.padAtBorders(t.height,t.width),f=d.y,h=d.ey,p=d.x,m=d.ex,v=p-1,g=f-1,y=o.getImageData(v,g,m-v,h-g),[2,vi.isNodejs()?wA(y):createImageBitmap(y)]})})}))];case 1:return s=c.sent(),a=[],s.forEach(function(l){var d=r2({width:r,height:i}),f=jf(d);f.drawImage(l,0,0,r,i);for(var h=f.getImageData(0,0,r,i).data,p=[],m=0;m<h.length;m+=4)p.push(h[m+2]),p.push(h[m+1]),p.push(h[m]);a.push(p)}),[2,a.map(function(l){var d=Be(function(){var f=cd(Ji(l,[1,r,i,3]),[0,2,1,3]).toFloat();return n9(f)});return d})]}})})}function ONe(t,e){return Be(function(){var n=$A(t,e),r=ta(n,[n.shape[0],e.fc1.weights.shape[0]]),i=Qa(r,e.fc1),o=sm(i,e.prelu4_alpha),s=Qa(o,e.fc2_1),a=us(QC(s,1),1),u=qc(hr(s,a),1),c=Qa(o,e.fc2_2),l=lr(u,1)[1];return{scores:l,regions:c}})}function FNe(t,e,n,r,i){return Je(this,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p,m,v,g,y;return Ye(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,r9(t,e,{width:24,height:24})];case 1:return s=b.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(x){var S=ONe(x,r);return x.dispose(),S}),i.stage2_rnet=Date.now()-o,u=a.length>1?cr(a.map(function(x){return x.scores})):a[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[b.sent()]),u.dispose(),f=c.map(function(x,S){return{score:x,idx:S}}).filter(function(x){return x.score>n}).map(function(x){var S=x.idx;return S}),h=f.map(function(x){return e[x]}),p=f.map(function(x){return c[x]}),m=[],v=[],h.length>0&&(o=Date.now(),g=qy(h,p,.7),i.stage2_nms=Date.now()-o,y=g.map(function(x){var S=a[f[x]].regions.arraySync();return new AA(S[0][0],S[0][1],S[0][2],S[0][3])}),v=g.map(function(x){return p[x]}),m=g.map(function(x,S){return h[x].calibrate(y[S])})),a.forEach(function(x){x.regions.dispose(),x.scores.dispose()}),[2,{boxes:m,scores:v}]}})})}function LNe(t,e){return Be(function(){var n=$A(t,e);n=yr(n,[2,2],[2,2],"same"),n=oa(n,e.conv4,"valid"),n=sm(n,e.prelu4_alpha);var r=ta(n,[n.shape[0],e.fc1.weights.shape[0]]),i=Qa(r,e.fc1),o=sm(i,e.prelu5_alpha),s=Qa(o,e.fc2_1),a=us(QC(s,1),1),u=qc(hr(s,a),1),c=Qa(o,e.fc2_2),l=Qa(o,e.fc2_3),d=lr(u,1)[1];return{scores:d,regions:c,points:l}})}function MNe(t,e,n,r,i){return Je(this,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p,m,v,g,y,b;return Ye(this,function(x){switch(x.label){case 0:return o=Date.now(),[4,r9(t,e,{width:48,height:48})];case 1:return s=x.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(S){var C=LNe(S,r);return S.dispose(),C}),i.stage3_onet=Date.now()-o,u=a.length>1?cr(a.map(function(S){return S.scores})):a[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[x.sent()]),u.dispose(),f=c.map(function(S,C){return{score:S,idx:C}}).filter(function(S){return S.score>n}).map(function(S){var C=S.idx;return C}),h=f.map(function(S){var C=a[S].regions.arraySync();return new AA(C[0][0],C[0][1],C[0][2],C[0][3])}),p=f.map(function(S,C){return e[S].calibrate(h[C])}),m=f.map(function(S){return c[S]}),v=[],g=[],y=[],p.length>0&&(o=Date.now(),b=qy(p,m,.7,!1),i.stage3_nms=Date.now()-o,v=b.map(function(S){return p[S]}),g=b.map(function(S){return m[S]}),y=b.map(function(S,C){return Array(5).fill(0).map(function(T,E){var I=a[S].points.arraySync();return new qt(I[0][E]*(v[C].width+1)+v[C].left,I[0][E+5]*(v[C].height+1)+v[C].top)})})),a.forEach(function(S){S.regions.dispose(),S.scores.dispose(),S.points.dispose()}),[2,{boxes:v,scores:g,points:y}]}})})}var BNe=function(t){ht(e,t);function e(){return t.call(this,"Mtcnn")||this}return e.prototype.load=function(n){return Je(this,void 0,void 0,function(){return Ye(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,n)]})})},e.prototype.loadFromDisk=function(n){return Je(this,void 0,void 0,function(){return Ye(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,n)]})})},e.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E;return Ye(this,function(I){switch(I.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=n.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),u=Be(function(){return TNe(us(gA.fromPixels(o)).toFloat())}),c=function(N){return u.dispose(),s.total=Date.now()-a,N},l=u.shape.slice(1),d=l[0],f=l[1],h=new QK(r),p=h.minFaceSize,m=h.scaleFactor,v=h.maxNumScales,g=h.scoreThresholds,y=h.scaleSteps,b=(y||NNe(p,m,[d,f])).filter(function(N){var $=GI(N,[d,f]);return Math.min($.width,$.height)>pS}).slice(0,v),s.scales=b,s.pyramid=b.map(function(N){return GI(N,[d,f])}),x=Date.now(),[4,DNe(u,b,g[0],i.pnet,s)];case 1:return S=I.sent(),s.total_stage1=Date.now()-x,S.boxes.length?(s.stage2_numInputBoxes=S.boxes.length,x=Date.now(),[4,FNe(o,S.boxes,g[1],i.rnet,s)]):[2,c({results:[],stats:s})];case 2:return C=I.sent(),s.total_stage2=Date.now()-x,C.boxes.length?(s.stage3_numInputBoxes=C.boxes.length,x=Date.now(),[4,MNe(o,C.boxes,g[2],i.onet,s)]):[2,c({results:[],stats:s})];case 3:return T=I.sent(),s.total_stage3=Date.now()-x,E=T.boxes.map(function(N,$){return _A(bA({},new Su(T.scores[$],new yA(N.left/f,N.top/d,N.width/f,N.height/d),{height:d,width:f})),new mRe(T.points[$].map(function(F){return F.sub(new qt(N.left,N.top)).div(new qt(N.width,N.height))}),{width:N.width,height:N.height}))}),[2,c({results:E,stats:s})]}})})},e.prototype.forward=function(n,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,kr(n)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,kr(n)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(n){return RNe(n)},e.prototype.extractParams=function(n){return _Ne(n)},e}(Xc),UNe=.4,VNe=[new qt(1.603231,2.094468),new qt(6.041143,7.080126),new qt(2.882459,3.518061),new qt(4.266906,5.178857),new qt(9.041765,10.66308)],zNe=[117.001,114.697,97.404],WNe=function(t){ht(e,t);function e(){var n=this,r={withSeparableConvs:!0,iouThreshold:UNe,classes:["face"],anchors:VNe,meanRgb:zNe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=t.call(this,r)||this,n}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(n,r){return Je(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return[4,this.detect(n,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new Su(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(n){return t.prototype.extractParamsFromWeigthMap.call(this,n)},e}(e9),pi={ssdMobilenetv1:new ZK,tinyFaceDetector:new WNe,tinyYolov2:new kNe,mtcnn:new BNe,faceLandmark68Net:new HK,faceLandmark68TinyNet:new GRe,faceRecognitionNet:new QRe,faceExpressionNet:new PRe,ageGenderNet:new VRe},i9=function(t){ht(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.extractedFaces=i,o}return e}(J0),DA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r,i=this;return Ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,o2(n,this.input,function(s){return Je(i,void 0,void 0,function(){return Ye(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return pi.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,n.map(function(s,a){return WK(s,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new MA(this,this.input)},e}(i9),OA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r;return Ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),n?[4,PA(n,this.input,function(o){return pi.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,WK(n,r)]}})})},e.prototype.withAgeAndGender=function(){return new BA(this,this.input)},e}(i9),FA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new UA(this,this.input)},e.prototype.withFaceDescriptors=function(){return new zA(this,this.input)},e}(DA),LA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new VA(this,this.input)},e.prototype.withFaceDescriptor=function(){return new WA(this,this.input)},e}(OA),o9=function(t){ht(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.extractedFaces=i,o}return e}(J0),MA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r,i=this;return Ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,o2(n,this.input,function(s){return Je(i,void 0,void 0,function(){return Ye(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return pi.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,n.map(function(s,a){var u=r[a],c=u.age,l=u.gender,d=u.genderProbability;return JK(YK(s,l,d),c)})]}})})},e.prototype.withFaceExpressions=function(){return new DA(this,this.input)},e}(o9),BA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r,i,o,s;return Ye(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?[4,PA(n,this.input,function(u){return pi.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,o=r.gender,s=r.genderProbability,[2,JK(YK(n,o,s),i)]}})})},e.prototype.withFaceExpressions=function(){return new OA(this,this.input)},e}(o9),UA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new FA(this,this.input)},e.prototype.withFaceDescriptors=function(){return new zA(this,this.input)},e}(MA),VA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new LA(this,this.input)},e.prototype.withFaceDescriptor=function(){return new WA(this,this.input)},e}(BA),s9=function(t){ht(e,t);function e(n,r){var i=t.call(this)||this;return i.parentTask=n,i.input=r,i}return e}(J0),zA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r;return Ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,o2(n,this.input,function(o){return Promise.all(o.map(function(s){return pi.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,s){return XK(n[s],o)})]}})})},e.prototype.withFaceExpressions=function(){return new FA(this,this.input)},e.prototype.withAgeAndGender=function(){return new UA(this,this.input)},e}(s9),WA=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r;return Ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),n?[4,PA(n,this.input,function(o){return pi.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,XK(n,r)]}})})},e.prototype.withFaceExpressions=function(){return new LA(this,this.input)},e.prototype.withAgeAndGender=function(){return new VA(this,this.input)},e}(s9),a9=function(t){ht(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?pi.faceLandmark68TinyNet:pi.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(J0),jNe=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r,i,o,s,a=this;return Ye(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(c){return c.detection}),this.input instanceof Nn?[4,CA(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,SA(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(c){return a.landmarkNet.detectLandmarks(c)}))];case 6:return s=u.sent(),i.forEach(function(c){return c instanceof Nn&&c.dispose()}),[2,n.map(function(c,l){return _A(c,s[l])})]}})})},e.prototype.withFaceExpressions=function(){return new FA(this,this.input)},e.prototype.withAgeAndGender=function(){return new UA(this,this.input)},e.prototype.withFaceDescriptors=function(){return new zA(this,this.input)},e}(a9),GNe=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r,i,o,s;return Ye(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?(r=n.detection,this.input instanceof Nn?[4,CA(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,SA(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return s=a.sent(),i.forEach(function(u){return u instanceof Nn&&u.dispose()}),[2,_A(n,s)]}})})},e.prototype.withFaceExpressions=function(){return new LA(this,this.input)},e.prototype.withAgeAndGender=function(){return new VA(this,this.input)},e.prototype.withFaceDescriptor=function(){return new WA(this,this.input)},e}(a9),u9=function(t){ht(e,t);function e(n,r){r===void 0&&(r=new X0);var i=t.call(this)||this;return i.input=n,i.options=r,i}return e}(J0),c9=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r,i,o;return Ye(this,function(s){switch(s.label){case 0:return n=this,r=n.input,i=n.options,i instanceof QK?[4,pi.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(o=i instanceof t9?function(a){return pi.tinyFaceDetector.locateFaces(a,i)}:i instanceof X0?function(a){return pi.ssdMobilenetv1.locateFaces(a,i)}:i instanceof NA?function(a){return pi.tinyYolov2.locateFaces(a,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return Je(n,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return bA({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new jNe(this.runAndExtendWithFaceDetections(),this.input,n)},e.prototype.withFaceExpressions=function(){return new DA(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new MA(this.runAndExtendWithFaceDetections(),this.input)},e}(u9),HNe=function(t){ht(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var n,r;return Ye(this,function(i){switch(i.label){case 0:return[4,new c9(this.input,this.options)];case 1:return n=i.sent(),r=n[0],n.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return Je(n,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?bA({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new GNe(this.runAndExtendWithFaceDetection(),this.input,n)},e.prototype.withFaceExpressions=function(){return new OA(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new BA(this.runAndExtendWithFaceDetection(),this.input)},e}(u9);function qNe(t,e){return e===void 0&&(e=new X0),new HNe(t,e)}function KNe(t,e){return e===void 0&&(e=new X0),new c9(t,e)}function l9(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function t(e,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof N1)return s;if(s instanceof Float32Array)return new N1(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new N1(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(e,n){return n.map(function(r){return l9(r,e)}).reduce(function(r,i){return r+i},0)/(n.length||1)},t.prototype.matchDescriptor=function(e){var n=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new hV(o,n.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},t.prototype.findBestMatch=function(e){var n=this.matchDescriptor(e);return n.distance<this.distanceThreshold?n:new hV("unknown",n.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},t.fromJSON=function(e){var n=e.labeledDescriptors.map(function(r){return N1.fromJSON(r)});return new t(n,e.distanceThreshold)},t})();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XNe=1e-7,JNe=1e-4;class d9{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class jA{refCount(e){return ji("refCount")}incRef(e){return ji("incRef")}timerAvailable(){return!0}time(e){return ji("time")}read(e){return ji("read")}readSync(e){return ji("readSync")}readToGPU(e,n){return ji("readToGPU")}numDataIds(){return ji("numDataIds")}disposeData(e,n){return ji("disposeData")}write(e,n,r){return ji("write")}move(e,n,r,i,o){return ji("move")}createTensorFromGPUData(e,n,r){return ji("createTensorFromGPUData")}memory(){return ji("memory")}floatPrecision(){return ji("floatPrecision")}epsilon(){return this.floatPrecision()===32?XNe:JNe}dispose(){return ji("dispose")}}function ji(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Wu(t,e,n)}function YNe(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,Wu(t,n,r),Wu(e,n,r)}function Ky(t,e,n){return Math.max(t,Math.min(e,n))}function s2(t){return t%2===0?t:t+1}function Wu(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function h9(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function QNe(t,e){const n=Math.random();return e*n+(1-n)*t}function ZNe(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n}function L(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Wr(t,e,n=""){L(yn(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function xh(t){L(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function _e(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function ePe(t){return t.length===0}function p9(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function yn(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Gf(t){return t%1===0}function tPe(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function mS(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function nPe(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return f9(e),e}function Rf(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function HI(t,e=i=>0,n,r){return new Promise((i,o)=>{let s=0;const a=()=>{if(t()){i();return}s++;const u=e(s);if(n!=null&&s>=n){o();return}r!=null?r(a,u):setTimeout(a,u)};a()})}function m9(t,e){let n=1,r=-1;for(let o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(t[o]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${o}`);r=o}else if(t[o]<0)throw Error(`Shapes can not be < 0. Found ${t[o]} at dim ${o}`);if(r===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function tr(t,e){const n=e.length;return t=t==null?e.map((r,i)=>i):[].concat(t),L(t.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),L(t.every(r=>Gf(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?n+r:r)}function Qc(t,e){const n=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:tr(e,t).sort();let s=0;for(let a=0;a<t.length;++a){if(o!=null){if(o[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(o[s]==null||o[s]>a)&&t[a]===1&&(n.push(t[a]),r.push(a)),o[s]<=a&&s++}t[a]!==1&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function zc(t,e){return Qn(t,e)}function Qn(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function g9(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function v9(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function y9(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Xy(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function b9(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function bc(t){return typeof t=="string"||t instanceof String}function x9(t){return typeof t=="boolean"}function w9(t){return typeof t=="number"}function ig(t){return Array.isArray(t)?ig(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":w9(t)?"float32":bc(t)?"string":x9(t)?"bool":"float32"}function dd(t){return!!(t&&t.constructor&&t.call&&t.apply)}function gS(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function dr(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function S9(t,e,n,r=!1){const i=new Array;if(e.length===1){const o=e[0]*(r?2:1);for(let s=0;s<o;s++)i[s]=n[t+s]}else{const o=e[0],s=e.slice(1),a=s.reduce((u,c)=>u*c)*(r?2:1);for(let u=0;u<o;u++)i[u]=S9(t+u*a,s,n,r)}return i}function Nf(t,e,n=!1){if(t.length===0)return e[0];const r=t.reduce((i,o)=>i*o)*(n?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return S9(0,t,e,n)}function rPe(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function GA(t,e){const n=Wc(t,e);for(let r=0;r<n.length;r++)n[r]=1;return n}function Wc(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function iPe(t,e){const n=t.reduce((r,i)=>r*i,1);if(e==null||e==="float32")return Nf(t,new Float32Array(n));if(e==="int32")return Nf(t,new Int32Array(n));if(e==="bool")return Nf(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function vo(t){t.forEach(e=>{L(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function vS(t,e,n){if(e===0)return 0;if(e===1)return t[0];let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function a2(t,e,n){if(e===0)return[];if(e===1)return[t];const r=new Array(e);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}function fd(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV="tfjsflags";class C9{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=oPe,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){const i=this.urlFlags[e];ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(fd(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);bV in e&&e[bV].split(",").forEach(r=>{const[i,o]=r.split(":");this.urlFlags[i]=aPe(i,o)})}}function oPe(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(sPe(e,r[0],r[1]),r.join("="))),e}function sPe(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function aPe(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function ae(){return HA}let HA=null;function uPe(t){HA=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let YT;function k9(){if(YT==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");YT=t}return YT}function cPe(){const t=k9();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function qA(t,e){const n=cPe();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const KA="Abs",XA="Acos",JA="Acosh",u2="Add",YA="AddN",QA="All",ZA="Any",e$="ArgMax",t$="ArgMin",n$="Asin",r$="Asinh",i$="Atan",o$="Atanh",s$="Atan2",a$="AvgPool",T9="AvgPoolGrad",u$="AvgPool3D",E9="AvgPool3DGrad",c$="BatchMatMul",l$="BatchToSpaceND",d$="Bincount",f$="BitwiseAnd",lPe="BroadcastTo",h$="BroadcastArgs",c2="Cast",p$="Ceil",m$="ClipByValue",g$="Complex",v$="ComplexAbs",y$="Concat",b$="Conv2D",x$="Conv2DBackpropFilter",w$="Conv2DBackpropInput",S$="Conv3D",_9="Conv3DBackpropFilterV2",C$="Conv3DBackpropInputV2",k$="Cos",T$="Cosh",E$="Cumprod",_$="Cumsum",I$="CropAndResize",R$="DenseBincount",N$="DepthToSpace",P$="DepthwiseConv2dNative",A$="DepthwiseConv2dNativeBackpropFilter",$$="DepthwiseConv2dNativeBackpropInput",D$="Diag",O$="Dilation2D",dPe="Dilation2DBackpropInput",fPe="Dilation2DBackpropFilter",F$="Draw",L$="RealDiv",M$="Einsum",B$="Elu",I9="EluGrad",U$="Erf",V$="Equal",z$="Exp",W$="ExpandDims",j$="Expm1",G$="FFT",H$="Fill",q$="FlipLeftRight",K$="Floor",X$="FloorDiv",J$="FusedBatchNorm",Y$="GatherV2",Q$="GatherNd",Z$="Greater",eD="GreaterEqual",l2="Identity",tD="IFFT",nD="Imag",rD="IsFinite",iD="IsInf",oD="IsNan",sD="LeakyRelu",aD="Less",uD="LessEqual",cD="LinSpace",lD="Log",dD="Log1p",fD="LogicalAnd",hD="LogicalNot",pD="LogicalOr",hPe="LogicalXor",pPe="LogSoftmax",mPe="LowerBound",mD="LRN",R9="LRNGrad",gPe="MatrixBandPart",gD="Max",vD="Maximum",yD="MaxPool",N9="MaxPoolGrad",bD="MaxPool3D",P9="MaxPool3DGrad",xD="MaxPoolWithArgmax",wD="Mean",SD="Min",CD="Minimum",kD="MirrorPad",TD="Mod",ED="Multinomial",_D="Multiply",ID="Neg",RD="NotEqual",ND="NonMaxSuppressionV3",PD="NonMaxSuppressionV4",AD="NonMaxSuppressionV5",$D="OnesLike",DD="OneHot",OD="Pack",FD="PadV2",vPe="Pool",LD="Pow",MD="Prelu",BD="Prod",UD="RaggedGather",VD="RaggedRange",zD="RaggedTensorToTensor",WD="Range",jD="Real",GD="Reciprocal",HD="Relu",qD="Reshape",KD="ResizeNearestNeighbor",A9="ResizeNearestNeighborGrad",XD="ResizeBilinear",$9="ResizeBilinearGrad",JD="Relu6",YD="Reverse",QD="Round",ZD="Rsqrt",eO="ScatterNd",tO="TensorScatterUpdate",nO="SearchSorted",rO="Select",iO="Selu",oO="Slice",sO="Sin",aO="Sinh",uO="Sign",cO="Sigmoid",lO="Softplus",dO="Sqrt",fO="Sum",hO="SpaceToBatchND",pO="SplitV",mO="Softmax",gO="SparseFillEmptyRows",vO="SparseReshape",yO="SparseSegmentMean",bO="SparseSegmentSum",xO="SparseToDense",wO="SquaredDifference",D9="Square",SO="StaticRegexReplace",CO="StridedSlice",kO="StringNGrams",TO="StringSplit",EO="StringToHashBucketFast",_O="Sub",IO="Tan",RO="Tanh",d2="Tile",NO="TopK",PO="Transform",ty="Transpose",AO="Unique",$O="Unpack",DO="UnsortedSegmentSum",yPe="UpperBound",OO="ZerosLike",FO="Step",yS="FromPixels",LO="RotateWithOffset",bS="_FusedMatMul",xS="FusedConv2D",wS="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(...t){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(...t)}function bPe(...t){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Am=qA("kernelRegistry",()=>new Map),Jy=qA("gradRegistry",()=>new Map);function Yy(t,e){const n=BO(t,e);return Am.get(n)}function qI(t){return Jy.get(t)}function SS(t){const e=Am.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[o,s]=i,[a]=o.split("_");a===t&&n.push(s)}return n}function MO(t){const{kernelName:e,backendName:n}=t,r=BO(e,n);Am.has(r)&&ls(`The kernel '${e}' for backend '${n}' is already registered`),Am.set(r,t)}function xPe(t){const{kernelName:e}=t;Jy.has(e)&&ae().getBool("DEBUG")&&ls(`Overriding the gradient for '${e}'`),Jy.set(e,t)}function wPe(t,e){const n=BO(t,e);if(!Am.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);Am.delete(n)}function SPe(t){if(!Jy.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);Jy.delete(t)}function CPe(t,e){SS(t).forEach(r=>{const i=Object.assign({},r,{backendName:e});MO(i)})}function BO(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var F9=mn,vs=null;try{vs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function mn(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}mn.prototype.__isLong__;Object.defineProperty(mn.prototype,"__isLong__",{value:!0});function yo(t){return(t&&t.__isLong__)===!0}mn.isLong=yo;var xV={},wV={};function wh(t,e){var n,r,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(r=wV[t],r)?r:(n=gn(t,(t|0)<0?-1:0,!0),i&&(wV[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(r=xV[t],r)?r:(n=gn(t,t<0?-1:0,!1),i&&(xV[t]=n),n))}mn.fromInt=wh;function ys(t,e){if(isNaN(t))return e?gf:bs;if(e){if(t<0)return gf;if(t>=L9)return U9}else{if(t<=-CV)return no;if(t+1>=CV)return B9}return t<0?ys(-t,e).neg():gn(t%$m|0,t/$m|0,e)}mn.fromNumber=ys;function gn(t,e,n){return new mn(t,e,n)}mn.fromBits=gn;var CS=Math.pow;function UO(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return bs;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return UO(t.substring(1),e,n).neg();for(var i=ys(CS(n,8)),o=bs,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+a),n);if(a<8){var c=ys(CS(n,a));o=o.mul(c).add(ys(u))}else o=o.mul(i),o=o.add(ys(u))}return o.unsigned=e,o}mn.fromString=UO;function pa(t,e){return typeof t=="number"?ys(t,e):typeof t=="string"?UO(t,e):gn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}mn.fromValue=pa;var SV=65536,kPe=1<<24,$m=SV*SV,L9=$m*$m,CV=L9/2,kV=wh(kPe),bs=wh(0);mn.ZERO=bs;var gf=wh(0,!0);mn.UZERO=gf;var $p=wh(1);mn.ONE=$p;var M9=wh(1,!0);mn.UONE=M9;var KI=wh(-1);mn.NEG_ONE=KI;var B9=gn(-1,2147483647,!1);mn.MAX_VALUE=B9;var U9=gn(-1,-1,!0);mn.MAX_UNSIGNED_VALUE=U9;var no=gn(0,-2147483648,!1);mn.MIN_VALUE=no;var Ae=mn.prototype;Ae.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ae.toNumber=function(){return this.unsigned?(this.high>>>0)*$m+(this.low>>>0):this.high*$m+(this.low>>>0)};Ae.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(no)){var n=ys(e),r=this.div(n),i=r.mul(n).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=ys(CS(e,6),this.unsigned),s=this,a="";;){var u=s.div(o),c=s.sub(u.mul(o)).toInt()>>>0,l=c.toString(e);if(s=u,s.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}};Ae.getHighBits=function(){return this.high};Ae.getHighBitsUnsigned=function(){return this.high>>>0};Ae.getLowBits=function(){return this.low};Ae.getLowBitsUnsigned=function(){return this.low>>>0};Ae.getNumBitsAbs=function(){if(this.isNegative())return this.eq(no)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Ae.isZero=function(){return this.high===0&&this.low===0};Ae.eqz=Ae.isZero;Ae.isNegative=function(){return!this.unsigned&&this.high<0};Ae.isPositive=function(){return this.unsigned||this.high>=0};Ae.isOdd=function(){return(this.low&1)===1};Ae.isEven=function(){return(this.low&1)===0};Ae.equals=function(e){return yo(e)||(e=pa(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ae.eq=Ae.equals;Ae.notEquals=function(e){return!this.eq(e)};Ae.neq=Ae.notEquals;Ae.ne=Ae.notEquals;Ae.lessThan=function(e){return this.comp(e)<0};Ae.lt=Ae.lessThan;Ae.lessThanOrEqual=function(e){return this.comp(e)<=0};Ae.lte=Ae.lessThanOrEqual;Ae.le=Ae.lessThanOrEqual;Ae.greaterThan=function(e){return this.comp(e)>0};Ae.gt=Ae.greaterThan;Ae.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ae.gte=Ae.greaterThanOrEqual;Ae.ge=Ae.greaterThanOrEqual;Ae.compare=function(e){if(yo(e)||(e=pa(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ae.comp=Ae.compare;Ae.negate=function(){return!this.unsigned&&this.eq(no)?no:this.not().add($p)};Ae.neg=Ae.negate;Ae.add=function(e){yo(e)||(e=pa(e));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,a=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,d=0,f=0,h=0;return h+=o+c,f+=h>>>16,h&=65535,f+=i+u,d+=f>>>16,f&=65535,d+=r+a,l+=d>>>16,d&=65535,l+=n+s,l&=65535,gn(f<<16|h,l<<16|d,this.unsigned)};Ae.subtract=function(e){return yo(e)||(e=pa(e)),this.add(e.neg())};Ae.sub=Ae.subtract;Ae.multiply=function(e){if(this.isZero())return bs;if(yo(e)||(e=pa(e)),vs){var n=vs.mul(this.low,this.high,e.low,e.high);return gn(n,vs.get_high(),this.unsigned)}if(e.isZero())return bs;if(this.eq(no))return e.isOdd()?no:bs;if(e.eq(no))return this.isOdd()?no:bs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(kV)&&e.lt(kV))return ys(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,o=this.low>>>16,s=this.low&65535,a=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,d=0,f=0,h=0,p=0;return p+=s*l,h+=p>>>16,p&=65535,h+=o*l,f+=h>>>16,h&=65535,h+=s*c,f+=h>>>16,h&=65535,f+=i*l,d+=f>>>16,f&=65535,f+=o*c,d+=f>>>16,f&=65535,f+=s*u,d+=f>>>16,f&=65535,d+=r*l+i*c+o*u+s*a,d&=65535,gn(h<<16|p,d<<16|f,this.unsigned)};Ae.mul=Ae.multiply;Ae.divide=function(e){if(yo(e)||(e=pa(e)),e.isZero())throw Error("division by zero");if(vs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?vs.div_u:vs.div_s)(this.low,this.high,e.low,e.high);return gn(n,vs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?gf:bs;var r,i,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return gf;if(e.gt(this.shru(1)))return M9;o=gf}else{if(this.eq(no)){if(e.eq($p)||e.eq(KI))return no;if(e.eq(no))return $p;var s=this.shr(1);return r=s.div(e).shl(1),r.eq(bs)?e.isNegative()?$p:KI:(i=this.sub(e.mul(r)),o=r.add(i.div(e)),o)}else if(e.eq(no))return this.unsigned?gf:bs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=bs}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:CS(2,a-48),c=ys(r),l=c.mul(e);l.isNegative()||l.gt(i);)r-=u,c=ys(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=$p),o=o.add(c),i=i.sub(l)}return o};Ae.div=Ae.divide;Ae.modulo=function(e){if(yo(e)||(e=pa(e)),vs){var n=(this.unsigned?vs.rem_u:vs.rem_s)(this.low,this.high,e.low,e.high);return gn(n,vs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ae.mod=Ae.modulo;Ae.rem=Ae.modulo;Ae.not=function(){return gn(~this.low,~this.high,this.unsigned)};Ae.and=function(e){return yo(e)||(e=pa(e)),gn(this.low&e.low,this.high&e.high,this.unsigned)};Ae.or=function(e){return yo(e)||(e=pa(e)),gn(this.low|e.low,this.high|e.high,this.unsigned)};Ae.xor=function(e){return yo(e)||(e=pa(e)),gn(this.low^e.low,this.high^e.high,this.unsigned)};Ae.shiftLeft=function(e){return yo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):gn(0,this.low<<e-32,this.unsigned)};Ae.shl=Ae.shiftLeft;Ae.shiftRight=function(e){return yo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):gn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ae.shr=Ae.shiftRight;Ae.shiftRightUnsigned=function(e){if(yo(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var r=this.low;return gn(r>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?gn(n,0,this.unsigned):gn(n>>>e-32,0,this.unsigned)};Ae.shru=Ae.shiftRightUnsigned;Ae.shr_u=Ae.shiftRightUnsigned;Ae.toSigned=function(){return this.unsigned?gn(this.low,this.high,!1):this};Ae.toUnsigned=function(){return this.unsigned?this:gn(this.low,this.high,!0)};Ae.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ae.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ae.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};mn.fromBytes=function(e,n,r){return r?mn.fromBytesLE(e,n):mn.fromBytesBE(e,n)};mn.fromBytesLE=function(e,n){return new mn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};mn.fromBytesBE=function(e,n){return new mn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const V9=m0(F9),TPe=Gz({__proto__:null,default:V9},[F9]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rf=V9||TPe;function Y0(t){return rf.fromString(t,!0,16)}const z9=Y0("c3a5c85c97cb3127"),Zd=Y0("b492b66fbe98f273"),si=Y0("9ae16a3b2f90404f");function XI(t){return t.xor(t.shru(47))}function W9(t,e,n){const r=t.slice(e,e+n);return rf.fromBytes(Array.from(r),!0,!0)}function un(t,e){return W9(t,e,8)}function TV(t,e){return W9(t,e,4)}function or(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function id(t,e,n=Y0("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let i=e.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function EPe(t,e,n,r,i,o){i=i.add(t),o=or(o.add(i).add(r),21);const s=i;return i=i.add(e),i=i.add(n),o=o.add(or(i,44)),[i.add(r),o.add(s)]}function O1(t,e,n,r){return EPe(un(t,e),un(t,e+8),un(t,e+16),un(t,e+24),n,r)}function _Pe(t,e=t.length){if(e>=8){const n=si.add(e*2),r=un(t,0).add(si),i=un(t,e-8),o=or(i,37).mul(n).add(r),s=or(r,25).add(i).mul(n);return id(o,s,n)}if(e>=4){const n=si.add(e*2),r=TV(t,0);return id(r.shl(3).add(e),TV(t,e-4),n)}if(e>0){const n=t[0],r=t[e>>1],i=t[e-1],o=n+(r<<8),s=e+(i<<2);return XI(si.mul(o).xor(z9.mul(s))).mul(si)}return si}function IPe(t,e=t.length){const n=si.add(e*2),r=un(t,0).mul(Zd),i=un(t,8),o=un(t,e-8).mul(n),s=un(t,e-16).mul(si);return id(or(r.add(i),43).add(or(o,30)).add(s),r.add(or(i.add(si),18)).add(o),n)}function RPe(t,e=t.length){const n=si.add(e*2),r=un(t,0).mul(si),i=un(t,8),o=un(t,e-8).mul(n),s=un(t,e-16).mul(si),a=or(r.add(i),43).add(or(o,30)).add(s),u=id(a,r.add(or(i.add(si),18)).add(o),n),c=un(t,16).mul(n),l=un(t,24),d=a.add(un(t,e-32)).mul(n),f=u.add(un(t,e-24)).mul(n);return id(or(c.add(l),43).add(or(d,30)).add(f),c.add(or(l.add(r),18)).add(d),n)}function j9(t,e=t.length){const n=rf.fromNumber(81,!0);if(e<=32)return e<=16?_Pe(t,e):IPe(t,e);if(e<=64)return RPe(t,e);let r=n,i=n.mul(Zd).add(113),o=XI(i.mul(si).add(113)).mul(si),s=[rf.UZERO,rf.UZERO],a=[rf.UZERO,rf.UZERO];r=r.mul(si).add(un(t,0));let u=0;const c=(e-1>>6)*64,l=c+(e-1&63)-63;do r=or(r.add(i).add(s[0]).add(un(t,u+8)),37).mul(Zd),i=or(i.add(s[1]).add(un(t,u+48)),42).mul(Zd),r=r.xor(a[1]),i=i.add(s[0]).add(un(t,u+40)),o=or(o.add(a[0]),33).mul(Zd),s=O1(t,u,s[1].mul(Zd),r.add(a[0])),a=O1(t,u+32,o.add(a[1]),i.add(un(t,u+16))),[o,r]=[r,o],u+=64;while(u!==c);const d=Zd.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),s[0]=s[0].add(a[0]),a[0]=a[0].add(s[0]),r=or(r.add(i).add(s[0]).add(un(t,u+8)),37).mul(d),i=or(i.add(s[1]).add(un(t,u+48)),42).mul(d),r=r.xor(a[1].mul(9)),i=i.add(s[0].mul(9).add(un(t,u+40))),o=or(o.add(a[0]),33).mul(d),s=O1(t,u,s[1].mul(d),r.add(a[0])),a=O1(t,u+32,o.add(a[1]),i.add(un(t,u+16))),[o,r]=[r,o],id(id(s[0],a[0],d).add(XI(i).mul(z9)).add(o),id(s[1],a[1],d).add(r),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(t,e){return e==="string"?_c(t):Q0([t],e)}function NPe(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Q0(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=du(t)),ae().getBool("DEBUG")&&g9(t,e),NPe(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let r=0;r<n.length;++r)Math.round(t[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${e}`)}function os(){return ae().platform.now()}function PPe(t,e){return ae().platform.fetch(t,e)}function _c(t,e="utf-8"){return e=e||"utf-8",ae().platform.encode(t,e)}function Hf(t,e="utf-8"){return e=e||"utf-8",ae().platform.decode(t,e)}function sr(t){return ae().platform.isTypedArray!=null?ae().platform.isTypedArray(t):O9(t)}function du(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||fd(t)||t==null||sr(t)&&n)e.push(t);else if(Array.isArray(t)||sr(t))for(let r=0;r<t.length;++r)du(t[r],e,n);else{let r=-1;for(const i of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(i)&&(r=Math.max(r,Number(i)));for(let i=0;i<=r;i++)du(t[i],e,n)}return e}const APe=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:yn,arraysEqualWithNull:p9,assert:L,assertNonNegativeIntegerDimensions:vo,assertNonNull:xh,assertShapesMatch:Wr,bytesFromStringArray:b9,bytesPerElement:Xy,checkConversionForErrors:g9,clamp:Ky,computeStrides:dr,convertBackendValuesAndArrayBuffer:rPe,createScalarValue:Sh,createShuffledIndices:nPe,decodeString:Hf,distSquared:ZNe,encodeString:_c,fetch:PPe,fingerPrint64:j9,flatten:du,getArrayFromDType:Qn,getTypedArrayFromDType:zc,hasEncodingLoss:y9,hexToLong:Y0,indexToLoc:a2,inferDtype:ig,inferFromImplicitShape:m9,isBoolean:x9,isFunction:dd,isInt:Gf,isNumber:w9,isPromise:fd,isScalarShape:ePe,isString:bc,isTypedArray:sr,isValidDtype:v9,locToIndex:vS,makeOnesTypedArray:GA,makeZerosNestedTypedArray:iPe,makeZerosTypedArray:Wc,nearestDivisor:gS,nearestLargerEven:s2,now:os,parseAxisParam:tr,randUniform:QNe,repeatedTry:HI,rightPad:Rf,shuffle:f9,shuffleCombo:YNe,sizeFromShape:_e,sizeToSquarishShape:mS,squeezeShape:Qc,sum:h9,swap:Wu,tanh:tPe,toNestedArray:Nf,toTypedArray:Q0},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Pe{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new OPe)}profileKernel(e,n,r){let i;const o=()=>{i=r()};let s;const a=os();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(o);else{o();for(const c of i)c.dataSync();s=Promise.resolve({kernelMs:os()-a})}if(ae().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<i.length;c++){const l=i[c];l.data().then(d=>{DPe(d,l.dtype,e)})}return{kernelName:e,outputs:i,inputs:n,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:r,timeMs:i,inputs:o,extraInfo:s}=e;r.forEach(a=>{Promise.all([a.data(),i,s]).then(u=>{this.logger.logKernelProfile(n,a,u[0],u[1],o,u[2])})})}}function DPe(t,e,n){if(e!=="float32")return!1;for(let r=0;r<t.length;r++){const i=t[r];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class OPe{logKernelProfile(e,n,r,i,o,s){const a=typeof i=="number"?Rf(`${i}ms`,9):i.error,u=Rf(e,25),c=n.rank,l=n.size,d=Rf(n.shape.toString(),14);let f="";for(const h in o){const p=o[h];if(p!=null){const m=p.shape||n.shape,v=m.length;f+=`${h}: ${v}D ${v>0?m:""} `}}console.log(`%c${u}	%c${a}	%c${c}D ${d}	%c${l}	%c${f}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FPe(t,e,n){const r={},i={};for(let u=0;u<e.length;u++)r[e[u].id]=!0;for(let u=0;u<t.length;u++){const c=t[u],l=c.inputs;for(const d in l){const f=l[d];let h=!1;for(let p=0;p<e.length;p++)if(r[f.id]){c.outputs.forEach(m=>r[m.id]=!0),h=!0,i[c.id]=!0;break}if(h)break}}const o={};o[n.id]=!0;const s={};for(let u=t.length-1;u>=0;u--){const c=t[u],l=c.inputs;for(let d=0;d<c.outputs.length;d++)if(o[c.outputs[d].id]){for(const f in l)o[l[f].id]=!0,s[c.id]=!0;break}}const a=[];for(let u=0;u<t.length;u++){const c=t[u];if(i[c.id]&&s[c.id]){const l={};for(const f in c.inputs){const h=c.inputs[f];r[h.id]&&(l[f]=h)}const d=Object.assign({},c);d.inputs=l,d.outputs=c.outputs,a.push(d)}}return a}function LPe(t,e,n,r){for(let i=e.length-1;i>=0;i--){const o=e[i],s=[];if(o.outputs.forEach(u=>{const c=t[u.id];c!=null?s.push(c):s.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(s);for(const u in o.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);const l=o.inputs[u];if(!yn(c.shape,l.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(t[l.id]==null)t[l.id]=c;else{const d=t[l.id];t[l.id]=r(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EV=20,rv=3,QT=7;function MPe(t,e,n,r){const i=dr(e),o=BPe(t,e,n,i),s=e.length,a=jx(t,e,n,i,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${s}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map(c=>"    "+c).join(`
`)),u.join(`
`)}function BPe(t,e,n,r){const i=_e(e),o=r[r.length-1],s=new Array(o).fill(0),a=e.length,u=n==="complex64"?wv(t):t;if(a>1)for(let c=0;c<i/o;c++){const l=c*o;for(let d=0;d<o;d++)s[d]=Math.max(s[d],xv(u[l+d],0,n).length)}return s}function xv(t,e,n){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(QT))} + ${parseFloat(t[1].toFixed(QT))}j`:bc(t)?r=`'${t}'`:n==="bool"?r=G9(t):r=parseFloat(t.toFixed(QT)).toString(),Rf(r,e)}function G9(t){return t===0?"false":"true"}function jx(t,e,n,r,i,o=!0){const s=n==="complex64"?2:1,a=e[0],u=e.length;if(u===0){if(n==="complex64"){const m=wv(t);return[xv(m[0],0,n)]}return n==="bool"?[G9(t[0])]:[t[0].toString()]}if(u===1){if(a>EV){const v=rv*s;let g=Array.from(t.slice(0,v)),y=Array.from(t.slice((a-rv)*s,a*s));return n==="complex64"&&(g=wv(g),y=wv(y)),["["+g.map((b,x)=>xv(b,i[x],n)).join(", ")+", ..., "+y.map((b,x)=>xv(b,i[a-rv+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?wv(t):Array.from(t)).map((v,g)=>xv(v,i[g],n)).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),d=r[0]*s,f=[];if(a>EV){for(let m=0;m<rv;m++){const v=m*d,g=v+d;f.push(...jx(t.slice(v,g),c,n,l,i,!1))}f.push("...");for(let m=a-rv;m<a;m++){const v=m*d,g=v+d;f.push(...jx(t.slice(v,g),c,n,l,i,m===a-1))}}else for(let m=0;m<a;m++){const v=m*d,g=v+d;f.push(...jx(t.slice(v,g),c,n,l,i,m===a-1))}const h=u===2?",":"";f[0]="["+(a>0?f[0]+h:"");for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+h;let p=`,
`;for(let m=2;m<u;m++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":p),f}function wv(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qf{constructor(e,n,r){if(this.dtype=n,this.shape=e.slice(),this.size=_e(e),r!=null){const i=r.length;L(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Qn(n,this.size),this.strides=dr(e)}set(e,...n){n.length===0&&(n=[0]),L(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const r=this.locToIndex(n);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const i of e){if(i<0||i>=this.shape[n]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}n++}let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=this.strides[i]*e[i];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(e/this.strides[r]),e-=n[r]*this.strides[r];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return js().makeTensor(this.values,this.shape,this.dtype)}}let js=null,ap=null;function UPe(t){js=t}function VPe(t){ap=t}class Mt{constructor(e,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=_e(e),this.strides=dr(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return ap.buffer(this.shape,this.dtype,e)}bufferSync(){return ap.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Nf(this.shape,e,this.dtype==="complex64")}arraySync(){return Nf(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=js().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(r=>Hf(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),js().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=js().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Hf(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await js().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(js().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return ap.print(this,e)}clone(){return this.throwIfDisposed(),ap.clone(this)}toString(e=!1){const n=this.dataSync();return MPe(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),ap.cast(this,e)}variable(e=!0,n,r){return this.throwIfDisposed(),js().makeVariable(this,e,n,r)}}Object.defineProperty(Mt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function zPe(){return qA("Tensor",()=>Mt)}zPe();class Qy extends Mt{constructor(e,n,r,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=n,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!yn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);js().disposeTensor(this),this.dataId=e.dataId,js().incRef(this,null)}dispose(){js().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Qy,Symbol.hasInstance,{value:t=>t instanceof Mt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var JI;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(JI||(JI={}));var YI;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(YI||(YI={}));var QI;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(QI||(QI={}));var ZI;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(ZI||(ZI={}));var eR;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(eR||(eR={}));const WPe={float32:ZI,int32:YI,bool:QI,complex64:eR};function la(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return WPe[t][e]}function f2(t){return la(t,"int32")}function H9(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function q9(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function In(t,e){if(t.dtype===e.dtype)return[t,e];const n=la(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function K9(t,e){L(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function jPe(t,e){return e.some(n=>n.id===t.id)}function VO(t){const e=[];return X9(t,e,new Set),e}function X9(t,e,n){if(t==null)return;if(t instanceof Mt){e.push(t);return}if(!GPe(t))return;const r=t;for(const i in r){const o=r[i];n.has(o)||(n.add(o),X9(o,e,n))}}function GPe(t){return Array.isArray(t)||typeof t=="object"}const HPe=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:K9,getTensorsInContainer:VO,isTensorInList:jPe,makeTypesMatch:In},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(t){return t.kernelName!=null}class _V{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Dm{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new _V}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,r=1){return e in this.registryFactory?(ls(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(e);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new $Pe(this.backendInstance),!0}setupRegisteredKernels(){SS(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){SS(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof jA)&&typeof r.then=="function"){const i=++this.pendingBackendInitId,o=r.then(s=>i<this.pendingBackendInitId?!1:(this.registry[e]=s,this.pendingBackendInit=null,!0)).catch(s=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,ls(`Initialization of backend ${e} failed`),ls(s.stack||s.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return ls(`Initialization of backend ${e} failed`),ls(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n],{success:i,asyncInit:o}=this.initializeBackend(r);if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const r=this.state.tensorInfo.get(n),i=r.backend,o=this.readSync(n),s=i.refCount(n);i.disposeData(n,!0),r.backend=e,e.move(n,o,r.shape,r.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let r=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let i;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,n,r){e();try{const i=r();return n(),i}catch(i){throw n(),i}}nextTensorId(){return Dm.nextTensorId++}nextVariableId(){return Dm.nextVariableId++}clone(e){const n=X.runKernel(l2,{x:e}),r={x:e},i=s=>({x:()=>{const a="float32",u={x:s},c={dtype:a};return X.runKernel(c2,u,c)}}),o=[];return this.addTapeNode(this.state.activeScope.name,r,[n],i,o,{}),n}runKernel(e,n,r){if(this.backendName==null&&this.backend,!(Yy(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,r){const i=this.backend.numDataIds();let o=0;r.forEach(u=>{o+=u.dtype==="complex64"?3:1});const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-o-s;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,r=[];const i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let u;const c=ZT(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(ZT(e)){const{kernelName:p,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;const g=Yy(p,this.backendName);L(g!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const y=this.backend.numDataIds();u=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});const b=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,y,b);const x=b.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(i){const S=this.getTensorsForGradient(p,m,x);r=this.saveTensorsForBackwardMode(S)}return x}}else{const{forwardFunc:p}=e,m=v=>{i&&(r=v.map(g=>this.keep(this.clone(g))))};a=()=>{const v=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,m));const g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,g),g}}const{inputs:l,attrs:d}=e,f=ZT(e)?null:e.backwardsFunc;let h;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(h=this.profiler.profileKernel(c,l,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),n=h.outputs)}),i&&this.addTapeNode(c,l,n,f,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(p=>l[p]!=null?l[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,n,r){const i=qI(e);if(i!=null){const o=i.inputsToSave||[],s=i.outputsToSave||[];let a;i.saveAllInputs?(L(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=o.map(c=>n[c]);const u=r.filter((c,l)=>s[l]);return a.concat(u)}return[]}makeTensor(e,n,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;let o=e;r==="string"&&bc(e[0])&&(o=e.map(u=>_c(u)));const s=i.write(o,n,r),a=new Mt(n,r,s,this.nextTensorId());if(this.trackTensor(a,i),r==="string"){const u=this.state.tensorInfo.get(s),c=b9(o);this.state.numBytes+=c-u.bytes,u.bytes=c}return a}makeTensorFromDataId(e,n,r,i){r=r||"float32";const o={dataId:e,shape:n,dtype:r};return this.makeTensorFromTensorInfo(o,i)}makeTensorFromTensorInfo(e,n){const{dataId:r,shape:i,dtype:o}=e,s=new Mt(i,o,r,this.nextTensorId());return this.trackTensor(s,n),s}makeVariable(e,n=!0,r,i){r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const o=new Qy(e,n,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Xy(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Qy||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*Xy(e.dtype);this.state.numBytes-=r}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,r,i,o,s){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:o},u=qI(e);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=c=>(c=c.map((l,d)=>{if(l==null){const f=r[d],h=Wc(f.size,f.dtype);return this.makeTensor(h,f.shape,f.dtype)}return l}),i(c.length>1?c:c[0],o,s))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=VO(e),r=new Set(n.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const s=this.state.activeScope.track[o];!s.kept&&!r.has(s.id)&&s.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(o=>{!o.kept&&o.scopeId===i.id&&this.track(o)})}gradients(e,n,r,i=!1){if(L(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));L(o instanceof Mt,()=>"The result y returned by f() must be a tensor.");const s=FPe(this.state.activeTape,n,o);if(!i&&s.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=r??qPe(o.shape),LPe(a,s,c=>this.tidy(c),KPe);const u=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const l of c.saved)l.dispose()}),this.state.activeTape=null),{value:o,grads:u}})}customGrad(e){return L(dd(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{L(n.every(a=>a instanceof Mt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const i={};n.forEach((a,u)=>{i[u]=a});const o=(a,u)=>(r=e(...n,u),L(r.value instanceof Mt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),L(dd(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),s=(a,u)=>{const c=r.gradFunc(a,u),l=Array.isArray(c)?c:[c];L(l.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),L(l.every(f=>f instanceof Mt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return l.forEach((f,h)=>{d[h]=()=>f}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:s,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=os(),r=await this.backend.time(e);return r.wallMs=os()-n,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new _V;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Dm.nextTensorId=0;Dm.nextVariableId=0;function qPe(t){const e=GA(_e(t),"float32");return X.makeTensor(e,t,"float32")}function J9(){const t=k9();if(t._tfengine==null){const e=new C9(t);t._tfengine=new Dm(e)}return uPe(t._tfengine.ENV),UPe(()=>t._tfengine),t._tfengine}const X=J9();function KPe(t,e){const n={a:t,b:e};return X.runKernel(u2,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XPe(){return typeof navigator<"u"&&navigator!=null}let tR;function JPe(t){tR=t}function zO(t){if(tR!==void 0)return tR;if(t||XPe()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function WO(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const YPe=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:WO,isMobile:zO,mockIsMobile:JPe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oi=ae();Oi.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Oi.registerFlag("IS_BROWSER",()=>WO());Oi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Oi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Oi.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Oi.registerFlag("PROD",()=>!1);Oi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Oi.getBool("DEBUG"));Oi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Oi.registerFlag("IS_TEST",()=>!1);Oi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Oi.getBool("DEBUG"));Oi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Oi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Oi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fu(t,e){let n=t;if(sr(t))return e==="string"?[]:[t.length];if(H9(t)){const i=t.channels||"RGBA";return[t.height,t.width*i.length]}else if(q9(t))return[t.buffer.size/(e==null?4:Xy(e))];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||sr(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Y9(t,r,[]),r}function Y9(t,e,n){if(n=n||[],!Array.isArray(t)&&!sr(t)){L(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}L(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),L(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const r=e.slice(1);for(let i=0;i<t.length;++i)Y9(t[i],r,n.concat(i))}function IV(t,e,n,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function O(t,e,n,r="numeric"){if(t instanceof Mt)return IV(r,t.dtype,e,n),t;let i=ig(t);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),IV(r,i,e,n),t==null||!sr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const u=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${u}'`)}const o=fu(t,i);!sr(t)&&!Array.isArray(t)&&(t=[t]);const a=i!=="string"?Q0(t,i):du(t,[],!0);return X.makeTensor(a,o,i)}function Zy(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((o,s)=>O(o,`${e}[${s}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jO="__op";function K(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+jO;const i=(...o)=>{X.startScope(n);try{const s=r(...o);return fd(s)&&console.error("Cannot return a Promise inside of tidy."),X.endScope(s),s}catch(s){throw X.endScope(null),s}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QPe(t,e){const n=O(t,"real","complex"),r=O(e,"imag","complex");Wr(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return X.runKernel(g$,i)}const jc=K({complex_:QPe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _d(t,e,n,r){if(r==null)r=ig(t);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(q9(t)||H9(t)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return X.backend.createTensorFromGPUData(t,e||n,r)}if(!sr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){vo(e);const i=_e(e),o=_e(n);L(i===o,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${o}`);for(let s=0;s<n.length;++s){const a=n[s],u=s===n.length-1?a!==_e(e.slice(s)):!0;L(n[s]===e[s]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!sr(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=r!=="string"?Q0(t,r):du(t,[],!0),X.makeTensor(t,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(t,e,n){const r=fu(t,n);return _d(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nR={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class ma{static join(e){return new ma(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>sr(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let r=0;r<e.length;r++){const i=e[r];r!==e.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=n+i.byteLength;this.shards.push({buffer:i,start:n,end:o}),n=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const i=n-e,o=new ArrayBuffer(i),s=new Uint8Array(o);let a=0;for(let u=r;u<this.shards.length;u++){const c=this.shards[u],d=e+a-c.start,f=a,p=Math.min(n,c.end)-c.start,m=new Uint8Array(c.buffer,d,p-d);if(s.set(m,f),a+=m.length,n<c.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(i){return e<i.start?-1:e>=i.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=ZPe(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function ZPe(t,e){let n=0,r=t.length;for(;n<=r;){const i=Math.floor((r-n)/2)+n,o=e(t[i]);if(o===0)return i;o<0?r=i:n=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kS=4;async function eAe(t,e){const n=[],r=[],i=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<i.length;++s){const a=i[s],u=Array.isArray(t)?t[s].tensor:t[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);const c={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const l=new Promise(async d=>{const f=await u.bytes(),h=f.reduce((v,g)=>v+g.length,0)+kS*f.length,p=new Uint8Array(h);let m=0;for(let v=0;v<f.length;v++){const g=f[v],y=new Uint8Array(new Uint32Array([g.length]).buffer);p.set(y,m),m+=kS,p.set(g,m),m+=g.length}d(p)});r.push(l)}else r.push(u.data());e!=null&&(c.group=e),n.push(c)}const o=await Promise.all(r);return{data:tAe(o),specs:n}}function Q9(t,e){const n=new ma(t),r={};let i,o=0;for(const s of e){const a=s.name,u=s.dtype,c=s.shape,l=_e(c);let d;if("quantization"in s){const f=s.quantization;if(f.dtype==="uint8"||f.dtype==="uint16"){if(!("min"in f&&"scale"in f))throw new Error(`Weight ${s.name} with quantization ${f.dtype} doesn't have corresponding metadata min and scale.`)}else if(f.dtype==="float16"){if(u!=="float32")throw new Error(`Weight ${s.name} is quantized with ${f.dtype} which only supports weights of type float32 not ${u}.`)}else throw new Error(`Weight ${s.name} has unknown quantization dtype ${f.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const h=nR[f.dtype],p=n.slice(o,o+l*h),m=f.dtype==="uint8"?new Uint8Array(p):new Uint16Array(p);if(u==="float32")if(f.dtype==="uint8"||f.dtype==="uint16"){d=new Float32Array(m.length);for(let v=0;v<m.length;v++){const g=m[v];d[v]=g*f.scale+f.min}}else if(f.dtype==="float16")i===void 0&&(i=uAe()),d=i(m);else throw new Error(`Unsupported quantization type ${f.dtype} for weight type float32.`);else if(u==="int32"){if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error(`Unsupported quantization type ${f.dtype} for weight type int32.`);d=new Int32Array(m.length);for(let v=0;v<m.length;v++){const g=m[v];d[v]=Math.round(g*f.scale+f.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);o+=l*h}else if(u==="string"){const f=_e(s.shape);d=[];for(let h=0;h<f;h++){const p=new Uint32Array(n.slice(o,o+kS))[0];o+=kS;const m=new Uint8Array(n.slice(o,o+p));d.push(m),o+=p}}else{const f=nR[u],h=n.slice(o,o+l*f);if(u==="float32")d=new Float32Array(h);else if(u==="int32")d=new Int32Array(h);else if(u==="bool")d=new Uint8Array(h);else if(u==="complex64"){d=new Float32Array(h);const p=new Float32Array(d.length/2),m=new Float32Array(d.length/2);for(let y=0;y<p.length;y++)p[y]=d[y*2],m[y]=d[y*2+1];const v=ks(p,c,"float32"),g=ks(m,c,"float32");r[a]=jc(v,g),v.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);o+=l*f}u!=="complex64"&&(r[a]=ks(d,c,u))}return r}function tAe(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(o=>{if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const r=new Uint8Array(e);let i=0;return n.forEach(o=>{r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}const GO=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function RV(t){return GO?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function nAe(t){if(GO)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let r=0,i=e.length;r<i;r++)n+=String.fromCharCode(e[r]);return btoa(n)}function rAe(t){if(GO){const r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)n.set([e.charCodeAt(r)],r);return n.buffer}function iAe(t){return ma.join(t)}function NV(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function Z9(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function eX(t,e,n){const r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(r.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=n}return t.signature!=null&&(r.signature=t.signature),t.userDefinedMetadata!=null&&(r.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(r.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(r.initializerSignature=t.initializerSignature),r}async function HO(t,e){let n,r;return t.weightsManifest!=null&&([n,r]=await e(t.weightsManifest)),eX(t,n,r)}function Z0(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:RV(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:RV(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new ma(t.weightData).byteLength}}function tX(t){const e=[];for(const n of t)e.push(...n.weights);return e}function oAe(){const t=n=>{let r=n<<13,i=0;for(;!(r&8388608);)i-=8388608,r<<=1;return r&=-8388609,i+=947912704,r|i},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function sAe(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function aAe(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function uAe(){const t=oAe(),e=sAe(),n=aAe();return r=>{const i=new ArrayBuffer(4*r.length),o=new Uint32Array(i);for(let s=0;s<r.length;s++){const a=r[s],u=t[n[a>>10]+(a&1023)]+e[a>>10];o[s]=u}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class En{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return En.instance==null&&(En.instance=new En),En.instance}static registerSaveRouter(e){En.getInstance().saveRouters.push(e)}static registerLoadRouter(e){En.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return En.getHandlers(e,"save")}static getLoadHandlers(e,n){return En.getHandlers(e,"load",n)}static getHandlers(e,n,r){const i=[];return(n==="load"?En.getInstance().loadRouters:En.getInstance().saveRouters).forEach(s=>{const a=s(e,r);a!==null&&i.push(a)}),i}}const cAe=t=>En.registerSaveRouter(t),lAe=t=>En.registerLoadRouter(t),dAe=t=>En.getSaveHandlers(t),fAe=(t,e)=>En.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rR="tensorflowjs",iR=1,vf="models_store",Ml="model_info_store";function nX(){if(!ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function oR(t){const e=t.result;e.createObjectStore(vf,{keyPath:"modelPath"}),e.createObjectStore(Ml,{keyPath:"modelPath"})}class Kf{constructor(e){if(this.indexedDB=nX(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((r,i)=>{const o=this.indexedDB.open(rR,iR);o.onupgradeneeded=()=>oR(o),o.onsuccess=()=>{const s=o.result;if(n==null){const a=s.transaction(vf,"readonly"),c=a.objectStore(vf).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return s.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=l=>(s.close(),i(c.error)),a.oncomplete=()=>s.close()}else{n.weightData=ma.join(n.weightData);const a=Z0(n),u=s.transaction(Ml,"readwrite");let c=u.objectStore(Ml),l;try{l=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return i(f)}let d;l.onsuccess=()=>{d=s.transaction(vf,"readwrite");const f=d.objectStore(vf);let h;try{h=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return i(p)}h.onsuccess=()=>r({modelArtifactsInfo:a}),h.onerror=p=>{c=u.objectStore(Ml);const m=c.delete(this.modelPath);m.onsuccess=()=>(s.close(),i(h.error)),m.onerror=v=>(s.close(),i(h.error))}},l.onerror=f=>(s.close(),i(l.error)),u.oncomplete=()=>{d==null?s.close():d.oncomplete=()=>s.close()}}},o.onerror=s=>i(o.error)})}}Kf.URL_SCHEME="indexeddb://";const rX=t=>ae().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Kf.URL_SCHEME)?hAe(t.slice(Kf.URL_SCHEME.length)):null;En.registerSaveRouter(rX);En.registerLoadRouter(rX);function hAe(t){return new Kf(t)}function pAe(t){return t.startsWith(Kf.URL_SCHEME)?t.slice(Kf.URL_SCHEME.length):t}class mAe{constructor(){this.indexedDB=nX()}async listModels(){return new Promise((e,n)=>{const r=this.indexedDB.open(rR,iR);r.onupgradeneeded=()=>oR(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Ml,"readonly"),a=o.objectStore(Ml).getAll();a.onsuccess=()=>{const u={};for(const c of a.result)u[c.modelPath]=c.modelArtifactsInfo;e(u)},a.onerror=u=>(i.close(),n(a.error)),o.oncomplete=()=>i.close()},r.onerror=i=>n(r.error)})}async removeModel(e){return e=pAe(e),new Promise((n,r)=>{const i=this.indexedDB.open(rR,iR);i.onupgradeneeded=()=>oR(i),i.onsuccess=()=>{const o=i.result,s=o.transaction(Ml,"readwrite"),a=s.objectStore(Ml),u=a.get(e);let c;u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const l=a.delete(e),d=()=>{c=o.transaction(vf,"readwrite");const h=c.objectStore(vf).delete(e);h.onsuccess=()=>n(u.result.modelArtifactsInfo),h.onerror=p=>r(u.error)};l.onsuccess=d,l.onerror=f=>(d(),o.close(),r(u.error))}},u.onerror=l=>(o.close(),r(u.error)),s.oncomplete=()=>{c==null?o.close():c.oncomplete=()=>o.close()}},i.onerror=o=>r(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ju="/",up="tensorflowjs_models",iX="info",gAe="model_topology",vAe="weight_specs",yAe="weight_data",bAe="model_metadata";function oX(t){return{info:[up,t,iX].join(ju),topology:[up,t,gAe].join(ju),weightSpecs:[up,t,vAe].join(ju),weightData:[up,t,yAe].join(ju),modelMetadata:[up,t,bAe].join(ju)}}function sX(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function xAe(t){const e=t.split(ju);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(ju)}function wAe(t){return t.startsWith(Xf.URL_SCHEME)?t.slice(Xf.URL_SCHEME.length):t}class Xf{constructor(e){if(!ae().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=oX(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Z0(e),o=ma.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,nAe(o));const s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw sX(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=r;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(s==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=rAe(s),n}}Xf.URL_SCHEME="localstorage://";const aX=t=>ae().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Xf.URL_SCHEME)?SAe(t.slice(Xf.URL_SCHEME.length)):null;En.registerSaveRouter(aX);En.registerLoadRouter(aX);function SAe(t){return new Xf(t)}class CAe{constructor(){L(ae().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),L(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=up+ju,r=ju+iX;for(let i=0;i<this.LS.length;++i){const o=this.LS.key(i);if(o.startsWith(n)&&o.endsWith(r)){const s=xAe(o);e[s]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=wAe(e);const n=oX(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return sX(n),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const am="://";class ni{constructor(){this.managers={}}static getInstance(){return ni.instance==null&&(ni.instance=new ni),ni.instance}static registerManager(e,n){L(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(am)&&(e=e.slice(0,e.indexOf(am))),L(e.length>0,()=>"scheme must not be an empty string.");const r=ni.getInstance();L(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=n}static getManager(e){const n=ni.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(ni.getInstance().managers)}}function Gx(t){if(t.indexOf(am)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ni.getSchemes().join(",")}`);return{scheme:t.split(am)[0],path:t.split(am)[1]}}async function uX(t,e,n=!1){L(t!==e,()=>`Old path and new path are the same: '${t}'`);const r=En.getLoadHandlers(t);L(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),L(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);const i=r[0],o=En.getSaveHandlers(e);L(o.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),L(o.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`);const s=o[0],a=Gx(t).scheme,u=Gx(t).path,c=a===Gx(t).scheme,l=await i.load();n&&c&&await ni.getManager(a).removeModel(u);const d=await s.save(l);return n&&!c&&await ni.getManager(a).removeModel(u),d.modelArtifactsInfo}async function kAe(){const t=ni.getSchemes(),e={};for(const n of t){const r=await ni.getManager(n).listModels();for(const i in r){const o=n+am+i;e[o]=r[i]}}return e}async function TAe(t){const e=Gx(t);return ni.getManager(e.scheme).removeModel(e.path)}async function EAe(t,e){return uX(t,e,!1)}async function _Ae(t,e){return uX(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IAe{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!ae().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const i=this.functionRefs[r.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return O9(e)}}if(ae().get("IS_BROWSER")){ae().setPlatform("browser",new IAe);try{ni.registerManager(Xf.URL_SCHEME,new CAe)}catch{}try{ni.registerManager(Kf.URL_SCHEME,new mAe)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RAe={importFetch:()=>require("node-fetch")};let eE;class NAe{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return ae().global.fetch!=null?ae().global.fetch(e,n):(eE==null&&(eE=RAe.importFetch()),eE(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ae().get("IS_NODE")&&!ae().get("IS_BROWSER")&&ae().setPlatform("node",new NAe);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tn(t,e="float32",n){return e=e||"float32",vo(t),new qf(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PAe(t,e){const n=O(t,"x","cast");if(!v9(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return X.runKernel(c2,r,i)}const Dt=K({cast_:PAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AAe(t){const n={x:O(t,"x","clone","string_or_numeric")};return X.runKernel(l2,n)}const Ic=K({clone_:AAe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J9();const $Ae={buffer:Tn,cast:Dt,clone:Ic,print:qO};VPe($Ae);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DAe(){ae().set("PROD",!0)}function OAe(){ae().set("DEBUG",!0)}function FAe(){ae().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function LAe(t){ae().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function MAe(){X.disposeVariables()}function Bs(){return X}function BAe(){return X.memory()}function UAe(t){return X.profile(t)}function ot(t,e){return X.tidy(t,e)}function mi(t){VO(t).forEach(n=>n.dispose())}function na(t){return X.keep(t)}function VAe(t){return X.time(t)}function zAe(t){return X.setBackend(t)}function WAe(){return X.ready()}function cX(){return X.backendName}function jAe(t){X.removeBackend(t)}function GAe(t){return X.findBackend(t)}function HAe(t){return X.findBackendFactory(t)}function lX(t,e,n=1){return X.registerBackend(t,e,n)}function dX(){return X.backend}function qAe(t,e){ae().setPlatform(t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KAe(t,e){let n=O(t,"a","add"),r=O(e,"b","add");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(u2,i)}const it=K({add_:KAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XAe(t,e){let n=O(t,"a","floorDiv"),r=O(e,"b","floorDiv");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(X$,i)}const KO=K({floorDiv_:XAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JAe(t,e){let n=O(t,"a","div"),r=O(e,"b","div");if([n,r]=In(n,r),n.dtype==="int32"&&r.dtype==="int32")return KO(n,r);const i={a:n,b:r},o={};return X.runKernel(L$,i,o)}const rn=K({div_:JAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YAe(t,e){let n=O(t,"a","mul"),r=O(e,"b","mul");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(_D,i)}const Pe=K({mul_:YAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QAe(t){const e=O(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return X.runKernel(v$,n)}else{const n={x:e};return X.runKernel(KA,n)}}const qi=K({abs_:QAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZAe(t){const n={x:O(t,"x","acos")};return X.runKernel(XA,n)}const fX=K({acos_:ZAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e$e(t){const n={x:O(t,"x","acosh")};return X.runKernel(JA,n)}const hX=K({acosh_:e$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t$e(t){L(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),L(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((i,o)=>O(i,`tensors${o}`,"addN")),n=e[0];e.forEach(i=>{if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(i=>{if(!yn(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=e;return X.runKernel(YA,r)}const pX=K({addN_:t$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$e(t,e=null,n=!1){const i={x:O(t,"x","all","bool")},o={axis:e,keepDims:n};return X.runKernel(QA,i,o)}const mX=K({all_:n$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r$e(t,e=null,n=!1){const i={x:O(t,"x","any","bool")},o={axis:e,keepDims:n};return X.runKernel(ZA,i,o)}const gX=K({any_:r$e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i$e(t,e=0){const r={x:O(t,"x","argMax")},i={axis:e};return X.runKernel(e$,r,i)}const XO=K({argMax_:i$e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o$e(t,e=0){const r={x:O(t,"x","argMin")},i={axis:e};return X.runKernel(t$,r,i)}const vX=K({argMin_:o$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s$e(t){const n={x:O(t,"x","asin")};return X.runKernel(n$,n)}const yX=K({asin_:s$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$e(t){const n={x:O(t,"x","asinh")};return X.runKernel(r$,n)}const bX=K({asinh_:a$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u$e(t){const n={x:O(t,"x","atan")};return X.runKernel(i$,n)}const xX=K({atan_:u$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c$e(t,e){let n=O(t,"a","atan2"),r=O(e,"b","atan2");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(s$,i)}const wX=K({atan2_:c$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l$e(t){const n={x:O(t,"x","atanh")};return X.runKernel(o$,n)}const SX=K({atanh_:l$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(t,e,n,r,i="NHWC",o){const s=t[3],a=[...e,s],u=og(i);return Go(t,a,n,o,r,null,null,u)}function Ch(t,e,n,r,i,o,s="channelsLast"){const[a,u]=e0(e);let c;if(s==="channelsLast")c=[a,u,t[3],t[3]];else if(s==="channelsFirst")c=[a,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return Go(t,c,n,r,i,o,!1,s)}function eb(t,e,n,r,i,o,s="NDHWC"){const[a,u,c]=sR(e);let l,d;if(s==="NDHWC")d="channelsLast",l=[a,u,c,t[4],t[4]];else if(s==="NCDHW")d="channelsFirst",l=[a,u,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return tb(t,l,n,r,i,!1,d,o)}function Go(t,e,n,r,i,o,s=!1,a="channelsLast"){let[u,c,l,d]=[-1,-1,-1,-1];if(a==="channelsLast")[u,c,l,d]=t;else if(a==="channelsFirst")[u,d,c,l]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,h,,p]=e,[m,v]=e0(n),[g,y]=e0(r),b=um(f,g),x=um(h,y),{padInfo:S,outHeight:C,outWidth:T}=h$e(i,c,l,m,v,b,x,o,a),E=s?p*d:p;let I;return a==="channelsFirst"?I=[u,E,C,T]:a==="channelsLast"&&(I=[u,C,T,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:d,outHeight:C,outWidth:T,outChannels:E,padInfo:S,strideHeight:m,strideWidth:v,filterHeight:f,filterWidth:h,effectiveFilterHeight:b,effectiveFilterWidth:x,dilationHeight:g,dilationWidth:y,inShape:t,outShape:I,filterShape:e}}function tb(t,e,n,r,i,o=!1,s="channelsLast",a){let[u,c,l,d,f]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,d,f]=t;else if(s==="channelsFirst")[u,f,c,l,d]=t;else throw new Error(`Unknown dataFormat ${s}`);const[h,p,m,,v]=e,[g,y,b]=sR(n),[x,S,C]=sR(r),T=um(h,x),E=um(p,S),I=um(m,C),{padInfo:N,outDepth:$,outHeight:F,outWidth:H}=p$e(i,c,l,d,g,y,b,T,E,I,a),G=o?v*f:v;let J;return s==="channelsFirst"?J=[u,G,$,F,H]:s==="channelsLast"&&(J=[u,$,F,H,G]),{batchSize:u,dataFormat:s,inDepth:c,inHeight:l,inWidth:d,inChannels:f,outDepth:$,outHeight:F,outWidth:H,outChannels:G,padInfo:N,strideDepth:g,strideHeight:y,strideWidth:b,filterDepth:h,filterHeight:p,filterWidth:m,effectiveFilterDepth:T,effectiveFilterHeight:E,effectiveFilterWidth:I,dilationDepth:x,dilationHeight:S,dilationWidth:C,inShape:t,outShape:J,filterShape:e}}function d$e(t,e,n,r,i){r==null&&(r=JO(t,e,n));const o=t[0],s=t[1],a=t0((o-e+2*r)/n+1,i),u=t0((s-e+2*r)/n+1,i);return[a,u]}function f$e(t,e,n,r,i,o){i==null&&(i=JO(t,e[0],r[0]));const s=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*i>=e[a]&&(s[a]=t0((t[a]-e[a]+2*i)/r[a]+1,o));return s}function JO(t,e,n,r=1){const i=um(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function e0(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function sR(t){return typeof t=="number"?[t,t,t]:t}function um(t,e){return e<=1?t:t+(t-1)*(e-1)}function h$e(t,e,n,r,i,o,s,a,u){let c,l,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const h=d$e([e,n],o,r,t,a);l=h[0],d=h[1]}else if(t==="same"){l=Math.ceil(e/r),d=Math.ceil(n/i);const f=Math.max(0,(l-1)*r+o-e),h=Math.max(0,(d-1)*i+s-n),p=Math.floor(f/2),m=f-p,v=Math.floor(h/2),g=h-v;c={top:p,bottom:m,left:v,right:g,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),d=Math.ceil((n-s+1)/i);else if(typeof t=="object"){const f=u==="channelsLast"?t[1][0]:t[2][0],h=u==="channelsLast"?t[1][1]:t[2][1],p=u==="channelsLast"?t[2][0]:t[3][0],m=u==="channelsLast"?t[2][1]:t[3][1];c={top:f,bottom:h,left:p,right:m,type:f===0&&h===0&&p===0&&m===0?"VALID":"EXPLICIT"},l=t0((e-o+f+h)/r+1,a),d=t0((n-s+p+m)/i+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:l,outWidth:d}}function p$e(t,e,n,r,i,o,s,a,u,c,l){let d,f,h,p;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const v=f$e([e,n,r,1],[a,u,c],1,[i,o,s],t,l);f=v[0],h=v[1],p=v[2]}else if(t==="same"){f=Math.ceil(e/i),h=Math.ceil(n/o),p=Math.ceil(r/s);const m=(f-1)*i+a-e,v=(h-1)*o+u-n,g=(p-1)*s+c-r,y=Math.floor(m/2),b=m-y,x=Math.floor(v/2),S=v-x,C=Math.floor(g/2),T=g-C;d={top:x,bottom:S,left:C,right:T,front:y,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:f,outHeight:h,outWidth:p}}function t0(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function n0(t){const[e,n,r]=e0(t);return e===1&&n===1&&r===1}function bo(t,e){return n0(t)||n0(e)}function Jf(t){return e0(t).every(e=>e>0)}function og(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Rs(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")L(Gf(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(i=>{L(Gf(i),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m$e(t,e){const r={x:O(t,"x","reshape","string_or_numeric")},i={shape:e};return X.runKernel(qD,r,i)}const ve=K({reshape_:m$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g$e(t,e,n,r,i){const o=O(t,"x","avgPool","float32"),s=1;L(bo(n,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);let a=o,u=!1;o.rank===3&&(u=!0,a=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]])),L(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Rs("avgPool",r,i);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:i};let d=X.runKernel(a$,c,l);return d=Dt(d,o.dtype),u?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const YO=K({avgPool_:g$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v$e(t,e,n,r,i,o="NDHWC"){const s=O(t,"x","avgPool3d","float32");let a=s,u=!1;s.rank===4&&(u=!0,a=ve(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),L(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),L(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),L(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Rs("avgPool3d",r,i);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:o};let d=X.runKernel(u$,c,l);return d=Dt(d,a.dtype),u?ve(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const kX=K({avgPool3d_:v$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y$e(t,e=0){L(t.length>=1,()=>"Pass at least one tensor to concat");const n=Zy(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),n.length===1)return Ic(n[0]);const r=n,i={axis:e};return X.runKernel(y$,r,i)}const Vr=K({concat_:y$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$e(t,e,n=!1,r=!1){let i=O(t,"a","matMul"),o=O(e,"b","matMul");[i,o]=In(i,o);const s={a:i,b:o},a={transposeA:n,transposeB:r};return X.runKernel(c$,s,a)}const Lt=K({matMul_:b$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x$e(t){const n={x:O(t,"x","sigmoid","float32")};return X.runKernel(cO,n)}const uu=K({sigmoid_:x$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$e(t,e,n){const r=O(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const i={x:r},o={begin:e,size:n};return X.runKernel(oO,i,o)}const Jt=K({slice_:w$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S$e(t){const n={x:O(t,"x","tanh","float32")};return X.runKernel(RO,n)}const TS=K({tanh_:S$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C$e(t,e,n,r,i,o){const s=O(t,"forgetBias","basicLSTMCell"),a=O(e,"lstmKernel","basicLSTMCell"),u=O(n,"lstmBias","basicLSTMCell"),c=O(r,"data","basicLSTMCell"),l=O(i,"c","basicLSTMCell"),d=O(o,"h","basicLSTMCell"),f=Vr([c,d],1),h=Lt(f,a),p=it(h,u),m=p.shape[0],v=p.shape[1]/4,g=[m,v],y=Jt(p,[0,0],g),b=Jt(p,[0,v],g),x=Jt(p,[0,v*2],g),S=Jt(p,[0,v*3],g),C=it(Pe(uu(y),TS(b)),Pe(l,uu(it(s,x)))),T=Pe(TS(C),uu(S));return[C,T]}const TX=K({basicLSTMCell_:C$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$e(t,e,n){const r=O(t,"x","batchToSpaceND"),i=e.reduce((a,u)=>a*u);L(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),L(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),L(r.shape[0]%i===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`);const o={x:r},s={blockShape:e,crops:n};return X.runKernel(l$,o,s)}const QO=K({batchToSpaceND_:k$e});function T$e(t){let e;return t.rank===0||t.rank===1?e=ve(t,[1,1,1,t.size]):t.rank===2?e=ve(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=ve(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E$e(t,e,n,r,i,o){o==null&&(o=.001);const s=O(t,"x","batchNorm"),a=O(e,"mean","batchNorm"),u=O(n,"variance","batchNorm");let c;i!=null&&(c=O(i,"scale","batchNorm"));let l;r!=null&&(l=O(r,"offset","batchNorm")),L(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:T$e(s),scale:c,offset:l,mean:a,variance:u},h={varianceEpsilon:o},p=X.runKernel(J$,f,h);return ve(p,s.shape)}const nb=K({batchNorm_:E$e});function _$e(t,e,n,r,i,o){const s=O(t,"x","batchNorm"),a=O(e,"mean","batchNorm"),u=O(n,"variance","batchNorm");let c;i!=null&&(c=O(i,"scale","batchNorm"));let l;return r!=null&&(l=O(r,"offset","batchNorm")),L(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),L(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),L(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&L(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&L(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`),nb(s,a,u,l,c,o)}const EX=K({batchNorm2d_:_$e});function I$e(t,e,n,r,i,o){const s=O(t,"x","batchNorm"),a=O(e,"mean","batchNorm"),u=O(n,"variance","batchNorm");let c;i!=null&&(c=O(i,"scale","batchNorm"));let l;return r!=null&&(l=O(r,"offset","batchNorm")),L(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),L(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),L(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&L(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&L(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`),nb(s,a,u,l,c,o)}const _X=K({batchNorm3d_:I$e});function R$e(t,e,n,r,i,o){const s=O(t,"x","batchNorm"),a=O(e,"mean","batchNorm"),u=O(n,"variance","batchNorm");let c;i!=null&&(c=O(i,"scale","batchNorm"));let l;return r!=null&&(l=O(r,"offset","batchNorm")),L(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),L(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),L(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&L(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&L(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`),nb(s,a,u,l,c,o)}const IX=K({batchNorm4d_:R$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N$e(t,e,n){const r=O(t,"x","bincount"),i=O(e,"weights","bincount");L(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),L(n>=0,()=>`size must be non-negative, but got ${n}.`),L(i.size===r.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},s={size:n};return X.runKernel(d$,o,s)}const ZO=K({bincount_:N$e});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$e(t,e){const n=O(t,"x","bitwiseAnd"),r=O(e,"y","bitwiseAnd");if(!yn(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);const i={a:n,b:r};return X.runKernel(f$,i)}const RX=K({bitwiseAnd_:P$e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A$e(t,e){const n=O(t,"s0","broadcastArgs","int32"),r=O(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return X.runKernel(h$,i)}const NX=K({broadcastArgs_:A$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $$e(t,e){let n=O(t,"broadcastTo","x");const r=n.shape;if(vo(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=ve(n,c)}const i=n.shape,o=Array.from(e);for(let c=e.length-1;c>=0;c--)if(i[c]===e[c])o[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(o.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return Ic(n);const a={x:n},u={reps:o};return X.runKernel(d2,a,u)}const cm=K({broadcastTo_:$$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D$e(t){const n={x:O(t,"x","ceil","float32")};return X.runKernel(p$,n)}const PX=K({ceil_:D$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sg(t,e,n){vo(t),n=n||ig(e);const r={shape:t,value:e,dtype:n};return X.runKernel(H$,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O$e(t,e,n){const r=O(t,"x","clipByValue");if(L(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return sg(r.shape,e,r.dtype);const i={x:r},o={clipValueMin:e,clipValueMax:n};return X.runKernel(m$,i,o)}const AX=K({clipByValue_:O$e});function F$e(t){return Vr(t,0)}const $X=K({concat1d_:F$e});function L$e(t,e){return Vr(t,e)}const DX=K({concat2d_:L$e});function M$e(t,e){return Vr(t,e)}const OX=K({concat3d_:M$e});function B$e(t,e){return Vr(t,e)}const FX=K({concat4d_:B$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$e(t,e,n,r,i="NHWC",o=[1,1],s){const a=O(t,"x","conv2d","float32"),u=O(e,"filter","conv2d","float32");let c=a,l=!1;a.rank===3&&(l=!0,c=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),L(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Rs("conv2d",r,s);const d=i==="NHWC"?c.shape[3]:c.shape[1];L(d===u.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${u.shape[2]}.`),L(bo(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),L(Jf(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),L(Jf(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:i,dilations:o,dimRoundingMode:s},p=X.runKernel(b$,f,h);return l?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const rb=K({conv2d_:U$e});function V$e(t,e,n,r,i="NWC",o=1,s){const a=O(t,"x","conv1d"),u=O(e,"filter","conv1d");let c=a,l=!1;a.rank===2&&(l=!0,c=ve(a,[1,a.shape[0],a.shape[1]])),L(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),L(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Rs("conv1d",r,s),L(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),L(bo(n,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`),L(Jf(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),L(Jf(n),()=>"Error in conv1D: Stride should be larger than 0."),L(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const d=ve(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=ve(c,[c.shape[0],1,c.shape[1],c.shape[2]]),v=rb(f,d,[1,n],r,"NHWC",[1,o],s);return l?ve(v,[v.shape[2],v.shape[3]]):ve(v,[v.shape[0],v.shape[2],v.shape[3]])}const LX=K({conv1d_:V$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$e(t,e,n,r,i,o="NHWC",s){L(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,u=e,c=!1;e.rank===3&&(c=!0,u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),L(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),L(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),L(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const l=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?u.shape[3]:u.shape[1];L(l===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`),L(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),Rs("conv2dDerInput",i,s);const f={dy:u,filter:n},h={strides:r,pad:i,dataFormat:o,dimRoundingMode:s,inputShape:a},p=X.runKernel(w$,f,h);return c?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const MX=K({conv2DBackpropInput_:z$e});function W$e(t,e,n,r,i,o){const s=O(t,"x","conv2dTranspose"),a=O(e,"filter","conv2dTranspose");return MX(n,s,a,r,i,"NHWC",o)}const BX=K({conv2dTranspose_:W$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$e(t,e,n,r,i="NDHWC",o=[1,1,1]){const s=O(t,"x","conv3d"),a=O(e,"filter","conv3d");let u=s,c=!1;s.rank===4&&(c=!0,u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),L(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),L(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),L(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),L(bo(n,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),L(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),L(Jf(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),L(Jf(n),()=>"Error in conv3D: Strides should be larger than 0.");const l={x:u,filter:a},d={strides:n,pad:r,dataFormat:i,dilations:o},f=X.runKernel(S$,l,d);return c?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const UX=K({conv3d_:j$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$e(t,e,n,r,i){L(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let o=t,s=e,a=!1;e.rank===4&&(a=!0,s=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=s.shape[4];L(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),L(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),L(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),L(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),L(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const l={dy:s,filter:n},d={pad:i,strides:r,inputShape:o},f=X.runKernel(C$,l,d);return a?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const H$e=K({conv3DBackpropInput_:G$e});function q$e(t,e,n,r,i){const o=O(t,"x","conv3dTranspose"),s=O(e,"filter","conv3dTranspose");return H$e(n,o,s,r,i)}const VX=K({conv3dTranspose_:q$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$e(t){const n={x:O(t,"x","cos","float32")};return X.runKernel(k$,n)}const zX=K({cos_:K$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$e(t){const n={x:O(t,"x","cosh","float32")};return X.runKernel(T$,n)}const WX=K({cosh_:X$e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$e(t,e=0,n=!1,r=!1){const o={x:O(t,"x","cumprod")},s={axis:e,exclusive:n,reverse:r};return X.runKernel(E$,o,s)}const jX=K({cumprod_:J$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$e(t,e=0,n=!1,r=!1){const o={x:O(t,"x","cumsum")},s={axis:e,exclusive:n,reverse:r};return X.runKernel(_$,o,s)}const GX=K({cumsum_:Y$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$e(t,e,n,r=!1){const i=O(t,"x","denseBincount"),o=O(e,"weights","denseBincount");L(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),L(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),L(n>=0,()=>`size must be non-negative, but got ${n}.`),L(o.size===i.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${o.shape}.`);const s={x:i,weights:o},a={size:n,binaryOutput:r};return X.runKernel(R$,s,a)}const HX=K({denseBincount_:Q$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$e(t,e,n="NHWC"){const r=O(t,"x","depthToSpace","float32"),i=n==="NHWC"?r.shape[1]:r.shape[2],o=n==="NHWC"?r.shape[2]:r.shape[3],s=n==="NHWC"?r.shape[3]:r.shape[1];L(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),L(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e}  for depthToSpace with input shape
    ${r.shape}`),L(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${r.shape}`),L(s%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${s} for depthToSpace with input shape ${r.shape}`);const a={x:r},u={blockSize:e,dataFormat:n};return X.runKernel(N$,a,u)}const qX=K({depthToSpace_:Z$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eDe(t,e,n,r,i="NHWC",o=[1,1],s){const a=O(t,"x","depthwiseConv2d","float32"),u=O(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;a.rank===3&&(l=!0,c=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),L(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const d=i==="NHWC"?c.shape[3]:c.shape[1];L(d===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${u.shape[2]}.`),Rs("depthwiseConv2d",r,s);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:i,dilations:o,dimRoundingMode:s},p=X.runKernel(P$,f,h);return l?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const h2=K({depthwiseConv2d_:eDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tDe(t){const n={x:O(t,"x","diag")};return X.runKernel(D$,n)}const KX=K({diag_:tDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nDe(t,e,n,r,i=[1,1],o="NHWC"){const s=O(t,"x","dilation2d"),a=O(e,"filter","dilation2d");L(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),L(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),L(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let u=s,c=!1;s.rank===3&&(u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0),L(u.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`);const l={x:u,filter:a},d={strides:n,pad:r,dilations:i},f=X.runKernel(O$,l,d);return c?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const XX=K({dilation2d_:nDe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const o=n-1-i,s=t[o]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(o)}return r}function eF(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],o=e.length-r-1,s=e[o];(i==null||i===1&&s>1)&&n.unshift(o)}return n}function Pt(t,e){const n=Math.max(t.length,e.length),r=new Array(n);for(let i=0;i<n;i++){let o=t[t.length-i-1];o==null&&(o=1);let s=e[e.length-i-1];if(s==null&&(s=1),o===1)r[n-i-1]=s;else if(s===1)r[n-i-1]=o;else if(o!==s){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else r[n-i-1]=o}return r}const rDe=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Pt,getBroadcastDims:r0,getReductionAxes:eF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iDe(t,e){let n=O(t,"a","equal","string_or_numeric"),r=O(e,"b","equal","string_or_numeric");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(V$,i)}const ib=K({equal_:iDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oDe(t,e,n){const r=O(e,"a","where"),i=O(n,"b","where"),o=O(t,"condition","where","bool"),s=Pt(Pt(o.shape,r.shape),i.shape),a=cm(o,s),u=cm(r,s),c=cm(i,s),l={condition:a,t:u,e:c};return X.runKernel(rO,l)}const Rc=K({where_:oDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sDe(t){const n={x:O(t,"x","zerosLike")};return X.runKernel(OO,n)}const co=K({zerosLike_:sDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aDe(t,e){let n=O(t,"a","div"),r=O(e,"b","div");[n,r]=In(n,r);const i=rn(n,r),o=co(i),s=ib(r,o);return Rc(s,o,i)}const JX=K({divNoNan_:aDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uDe(t,e){const n=O(t,"t1","dot"),r=O(e,"t2","dot");L((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=n.rank===1?n.size:n.shape[1],o=r.rank===1?r.size:r.shape[0];if(L(i===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${o}.`),n.rank===1&&r.rank===1){const s=ve(n,[1,-1]),a=ve(r,[-1,1]),u=Lt(s,a);return ve(u,[])}else if(n.rank===1&&r.rank===2){const s=ve(n,[1,-1]),a=ve(r,[r.shape[0],r.shape[1]]),u=Lt(s,a);return ve(u,[u.size])}else if(n.rank===2&&r.rank===1){const s=ve(r,[-1,1]),a=Lt(n,s);return ve(a,[a.size])}else{const s=ve(r,[r.shape[0],r.shape[1]]);return Lt(n,s)}}const YX=K({dot_:uDe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cDe(t,...e){const n=e.map((i,o)=>O(i,`tensors${o}`,"einsum")),r={equation:t};return X.runKernel(M$,n,r)}const of=K({einsum_:cDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lDe(t){const n={x:O(t,"x","elu","float32")};return X.runKernel(B$,n)}const tF=K({elu_:lDe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dDe(t,e){const n=O(t,"x","ensureShape","string_or_numeric");if(!p9(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const QX=K({ensureShape_:dDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fDe(t){let e=O(t,"x","erf");L(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Dt(e,"float32"));const n={x:e};return X.runKernel(U$,n)}const ZX=K({erf_:fDe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nF(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function eJ(t,e,n){const r=t.length+e.length,i=[];let o=0,s=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?i.push(t[o++]):i.push(e[s++]);return i}function Cu(t,e){const n=[],r=t.length;for(let o=0;o<r;o++)e.indexOf(o)===-1&&n.push(t[o]);const i=e.map(o=>t[o]);return[n,i]}function Ho(t,e){const n=e.map(r=>1);return eJ(t,n,e)}function ga(t,e,n){L(nF(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Ns(t,e){if(nF(t,e))return null;const n=[];for(let r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);return t.forEach(r=>n.push(r)),n}function rF(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Ps(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hDe(t,e=null,n=!1){const i={x:O(t,"x","max")},o={reductionIndices:e,keepDims:n};return X.runKernel(gD,i,o)}const Pf=K({max_:hDe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pDe(t,e=null,n=!1){const i={x:O(t,"x","min")},o={axis:e,keepDims:n};return X.runKernel(SD,i,o)}const ES=K({min_:pDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mDe(t,e){let n=O(t,"base","pow"),r=O(e,"exp","pow");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(LD,i)}const Om=K({pow_:mDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vt(t,e){if((sr(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&sr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _d(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gDe(t){const n={x:O(t,"x","sqrt","float32")};return X.runKernel(dO,n)}const hu=K({sqrt_:gDe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vDe(t){const e=O(t,"x","square"),n={};return X.runKernel("Square",{x:e},n)}const Ts=K({square_:vDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yDe(t,e=null,n=!1){let r=O(t,"x","sum");r.dtype==="bool"&&(r=Dt(r,"int32"));const i={x:r},o={axis:e,keepDims:n};return X.runKernel(fO,i,o)}const cn=K({sum_:yDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bDe(t,e="euclidean",n=null,r=!1){t=O(t,"x","norm");const i=tJ(t,e,n);let o=i.shape;if(r){const s=tr(n,t.shape);o=Ho(i.shape,s)}return ve(i,o)}function tJ(t,e,n=null){if(t.rank===0)return qi(t);if(t.rank!==1&&n===null)return tJ(ve(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return cn(qi(t),n);if(e===1/0)return Pf(qi(t),n);if(e===-1/0)return ES(qi(t),n);if(e==="euclidean"||e===2)return hu(cn(Om(qi(t),vt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Pf(cn(qi(t),n[0]),n[1]-1);if(e===1/0)return Pf(cn(qi(t),n[1]),n[0]);if(e===-1/0)return ES(cn(qi(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return hu(cn(Ts(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ob=K({norm_:bDe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xDe(t,e=null,n=!1){return ob(t,"euclidean",e,n)}const nJ=K({euclideanNorm_:xDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wDe(t){const n={x:O(t,"x","exp")};return X.runKernel(z$,n)}const hd=K({exp_:wDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SDe(t,e=0){const n=O(t,"x","expandDims","string_or_numeric");L(e<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:e};return X.runKernel(W$,r,i)}const _i=K({expandDims_:SDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CDe(t){const n={x:O(t,"x","expm1")};return X.runKernel(j$,n)}const rJ=K({expm1_:CDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kDe(t,e){const n=O(t,"x","tile","string_or_numeric");L(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const r={x:n},i={reps:e};return X.runKernel(d2,r,i)}const lm=K({tile_:kDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TDe(t,e,n,r="float32"){e==null&&(e=t);const i=Tn([t,e],r),o=t<=e?t:e;for(let a=0;a<o;++a)i.set(1,a,a);const s=ve(i.toTensor(),[t,e]);if(n==null)return s;if(n.length===1)return lm(_i(s,0),[n[0],1,1]);if(n.length===2)return lm(_i(_i(s,0),0),[n[0],n[1],1,1]);if(n.length===3)return lm(_i(_i(_i(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const iF=K({eye_:TDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EDe(t){const n={x:O(t,"x","floor","float32")};return X.runKernel(K$,n)}const oF=K({floor_:EDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _De(t,e,n=0,r=0){const i=O(t,"x","gather"),o=O(e,"indices","gather","int32"),s={x:i,indices:o},a={axis:n,batchDims:r};return X.runKernel(Y$,s,a)}const sF=K({gather_:_De});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IDe(t,e){let n=O(t,"a","greater","string_or_numeric"),r=O(e,"b","greater","string_or_numeric");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(Z$,i)}const ag=K({greater_:IDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RDe(t,e){let n=O(t,"a","greaterEqual","string_or_numeric"),r=O(e,"b","greaterEqual","string_or_numeric");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(eD,i)}const aF=K({greaterEqual_:RDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NDe(t){const n={input:O(t,"input","imag")};return X.runKernel(nD,n)}const sb=K({imag_:NDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PDe(t){const n={x:O(t,"x","isFinite")};return X.runKernel(rD,n)}const iJ=K({isFinite_:PDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ADe(t){const n={x:O(t,"x","isInf")};return X.runKernel(iD,n)}const oJ=K({isInf_:ADe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $De(t){const n={x:O(t,"x","isNaN")};return X.runKernel(oD,n)}const sJ=K({isNaN_:$De});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DDe(t,e=.2){const r={x:O(t,"x","leakyRelu")},i={alpha:e};return X.runKernel(sD,r,i)}const uF=K({leakyRelu_:DDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ODe(t,e){let n=O(t,"a","less","string_or_numeric"),r=O(e,"b","less","string_or_numeric");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(aD,i)}const _S=K({less_:ODe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FDe(t,e){let n=O(t,"a","lessEqual","string_or_numeric"),r=O(e,"b","lessEqual","string_or_numeric");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(uD,i)}const p2=K({lessEqual_:FDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return X.runKernel(cD,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LDe(t,e=5,n=1,r=1,i=.5){const o=O(t,"x","localResponseNormalization");L(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),L(Gf(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let s=o,a=!1;o.rank===3&&(a=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:s},c={depthRadius:e,bias:n,alpha:r,beta:i},l=X.runKernel(mD,u,c);return a?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const uJ=K({localResponseNormalization_:LDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MDe(t){const n={x:O(t,"x","log","float32")};return X.runKernel(lD,n)}const Fm=K({log_:MDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BDe(t){const n={x:O(t,"x","log1p")};return X.runKernel(dD,n)}const cF=K({log1p_:BDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UDe(t){return L(dd(t),()=>"The f passed in grad(f) must be a function"),(e,n)=>{const r=O(e,"x","tf.grad","string_or_numeric"),i=n!=null?O(n,"dy","tf.grad"):null;return X.tidy(()=>{const{value:o,grads:s}=X.gradients(()=>t(r),[r],i);return i!=null&&Wr(o.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),m2(s),s[0]})}}function VDe(t){return L(dd(t),()=>"The f passed in grads(f) must be a function"),(e,n)=>{L(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=Zy(e,"args","tf.grads","string_or_numeric"),i=n!=null?O(n,"dy","tf.grads"):null;return X.tidy(()=>{const{value:o,grads:s}=X.gradients(()=>t(...r),r,i);return i!=null&&Wr(o.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),m2(s),s})}}function zDe(t){return L(dd(t),()=>"The f passed in valueAndGrad(f) must be a function"),(e,n)=>{L(e instanceof Mt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),L(n==null||n instanceof Mt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=X.gradients(()=>t(e),[e],n);return m2(r),{grad:r[0],value:i}}}function WDe(t){return L(dd(t),()=>"The f passed in valueAndGrads(f) must be a function"),(e,n)=>{L(Array.isArray(e)&&e.every(i=>i instanceof Mt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),L(n==null||n instanceof Mt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=X.gradients(()=>t(...e),e,n);return n!=null&&Wr(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),m2(r.grads),r}}function cJ(t,e){L(dd(t),()=>"The f passed in variableGrads(f) must be a function"),L(e==null||Array.isArray(e)&&e.every(c=>c instanceof Qy),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in X.registeredVariables)e.push(X.registeredVariables[c])}const r=n?e.filter(c=>!c.trainable):null,i=e.length;e=e.filter(c=>c.trainable),L(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const o=!0,{value:s,grads:a}=X.gradients(t,e,null,o);L(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),L(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);const u={};return e.forEach((c,l)=>{a[l]!=null&&(u[c.name]=a[l])}),r!=null&&r.forEach(c=>u[c.name]=null),{value:s,grads:u}}function pu(t){return X.customGrad(t)}function m2(t){if(t.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jDe(t){const n={x:O(t,"x","neg")};return X.runKernel(ID,n)}const sa=K({neg_:jDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GDe(t){const n={x:O(t,"x","softplus")};return X.runKernel(lO,n)}const lF=K({softplus_:GDe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HDe(t){const e=O(t,"x","logSigmoid");return pu(r=>({value:sa(lF(sa(r))),gradFunc:s=>Pe(s,uu(sa(r)))}))(e)}const lJ=K({logSigmoid_:HDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qDe(t,e){let n=O(t,"a","sub"),r=O(e,"b","sub");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(_O,i)}const gt=K({sub_:qDe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KDe(t,e=-1){const n=O(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return pu((i,o)=>{const a=Pf(i,e,!0),u=gt(i,a),c=gt(Dt(u,"float32"),Fm(cn(hd(u),e,!0)));return o([c]),{value:c,gradFunc:(d,f)=>{const[h]=f,p=!0,m=hd(h);return gt(d,Pe(cn(d,e,p),m))}}})(n)}const dJ=K({logSoftmax_:KDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XDe(t,e=null,n=!1){const r=O(t,"x","logSumExp"),i=tr(e,r.shape),o=Pf(r,i,!0),s=gt(r,o),a=hd(s),u=cn(a,i),c=Fm(u),l=it(ve(o,c.shape),c);if(n){const d=Ho(l.shape,i);return ve(l,d)}return l}const dF=K({logSumExp_:XDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDe(t,e){const n=O(t,"a","logicalAnd","bool"),r=O(e,"b","logicalAnd","bool");Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(fD,i)}const i0=K({logicalAnd_:JDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YDe(t){const n={x:O(t,"x","logicalNot","bool")};return X.runKernel(hD,n)}const fF=K({logicalNot_:YDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QDe(t,e){const n=O(t,"a","logicalOr","bool"),r=O(e,"b","logicalOr","bool");Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(pD,i)}const hF=K({logicalOr_:QDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZDe(t,e){const n=O(t,"a","logicalXor","bool"),r=O(e,"b","logicalXor","bool");return Pt(n.shape,r.shape),i0(hF(t,e),fF(i0(t,e)))}const fJ=K({logicalXor_:ZDe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F1=2147483648;function eOe(t,e,n="left"){const r=O(t,"sortedSequence","searchSorted"),i=O(e,"values","searchSorted"),o=r.shape[r.shape.length-1],s=i.shape[i.shape.length-1],a=ve(r,[-1,o]),u=ve(i,[-1,s]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(_e(u.shape)>=F1)throw new Error(`values tensor size must less than ${F1}`);if(a.shape[1]>=F1)throw new Error(`trailing dim_size must less than ${F1} for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return X.runKernel(nO,c,l)}const g2=K({searchSorted_:eOe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(t,e){return g2(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tOe(t,e,n,r,i){const o=O(t,"x","maxPool"),s=1;let a=o,u=!1;o.rank===3&&(u=!0,a=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]])),L(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),L(bo(n,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Rs("maxPool",r,i);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:i},d=X.runKernel(yD,c,l);return u?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const pF=K({maxPool_:tOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nOe(t,e=[1,1,1],n,r,i,o="NDHWC"){const s=O(t,"x","maxPool3d");let a=s,u=!1;s.rank===4&&(u=!0,a=ve(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),L(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),L(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Rs("maxPool3d",r,i);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:o},d=X.runKernel(bD,c,l);return u?ve(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const pJ=K({maxPool3d_:nOe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rOe(t,e,n,r,i=!1){const s={x:O(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:r,includeBatchInIndex:i},u=X.runKernel(xD,s,a);return{result:u[0],indexes:u[1]}}const mJ=K({maxPoolWithArgmax_:rOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iOe(t,e){let n=O(t,"a","maximum"),r=O(e,"b","maximum");[n,r]=In(n,r),n.dtype==="bool"&&(n=Dt(n,"int32"),r=Dt(r,"int32")),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(vD,i)}const mF=K({maximum_:iOe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oOe(t,e=null,n=!1){const i={x:O(t,"x","mean")},o={axis:e,keepDims:n};return X.runKernel(wD,i,o)}const o0=K({mean_:oOe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pd(t,e="float32"){if(vo(t),e==="complex64"){const r=pd(t,"float32"),i=pd(t,"float32");return jc(r,i)}const n=Wc(_e(t),e);return X.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bl(t,e="float32"){if(vo(t),e==="complex64"){const r=Bl(t,"float32"),i=pd(t,"float32");return jc(r,i)}const n=GA(_e(t),e);return X.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let r=O(t,"x","meshgrid",t instanceof Mt?t.dtype:"float32");if(e===void 0)return[r];let i=O(e,"y","meshgrid",e instanceof Mt?e.dtype:"float32");const o=_e(r.shape),s=_e(i.shape);return n==="xy"?(r=ve(r,[1,-1]),i=ve(i,[-1,1]),[Lt(Bl([s,1],r.dtype),r),Lt(i,Bl([1,o],i.dtype))]):(r=ve(r,[-1,1]),i=ve(i,[1,-1]),[Lt(r,Bl([1,s],r.dtype)),Lt(Bl([o,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sOe(t,e){let n=O(t,"a","minimum"),r=O(e,"b","minimum");[n,r]=In(n,r),n.dtype==="bool"&&(n=Dt(n,"int32"),r=Dt(r,"int32")),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(CD,i)}const s0=K({minimum_:sOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aOe(t,e,n){L(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=O(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");L(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<r.rank;a++)L(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),L(e[a][0]>=0&&e[a][0]<=r.shape[a]-i&&e[a][1]>=0&&e[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape ${r.shape}`);const o={paddings:e,mode:n},s={x:r};return X.runKernel(kD,s,o)}const gF=K({mirrorPad_:aOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uOe(t,e){let n=O(t,"a","mod"),r=O(e,"b","mod");[n,r]=In(n,r);const i={a:n,b:r};return X.runKernel(TD,i)}const vJ=K({mod_:uOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cOe(t,e=null,n=!1){t=O(t,"x","moments");const r=tr(e,t.shape),i=o0(t,r,n);let o=i.shape;n||(o=Ho(i.shape,r));const s=Ts(gt(Dt(t,"float32"),ve(i,o))),a=o0(s,r,n);return{mean:i,variance:a}}const yJ=K({moments_:cOe});function lOe(t,e,n,r){const i=O(e,"data","multiRNNCell"),o=Zy(n,"c","multiRNNCell"),s=Zy(r,"h","multiRNNCell");let a=i;const u=[];for(let d=0;d<t.length;d++){const f=t[d](a,o[d],s[d]);u.push(f[0]),u.push(f[1]),a=f[1]}const c=[],l=[];for(let d=0;d<u.length;d+=2)c.push(u[d]),l.push(u[d+1]);return[c,l]}const bJ=K({multiRNNCell_:lOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dOe(t,e,n,r=!1){const i=O(t,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(s>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${s}`);n=n||Math.random();const u={logits:s===1?ve(i,[1,-1]):i},c={numSamples:e,seed:n,normalized:r},l=X.runKernel(ED,u,c);return s===1?ve(l,[l.size]):l}const xJ=K({multinomial_:dOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fOe(t,e){let n=O(t,"a","notEqual","string_or_numeric"),r=O(e,"b","notEqual","string_or_numeric");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r};return X.runKernel(RD,i)}const vF=K({notEqual_:fOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hOe(t,e,n=1,r=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:O(t,"indices","oneHot","int32")},a={dtype:i,depth:e,onValue:n,offValue:r};return X.runKernel(DD,s,a)}const a0=K({oneHot_:hOe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pOe(t){const n={x:O(t,"x","onesLike")};return X.runKernel($D,n)}const wJ=K({onesLike_:pOe});function mOe(t,e){const n=O(t,"v1","outerProduct"),r=O(e,"v2","outerProduct");L(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=ve(n,[-1,1]),o=ve(r,[1,-1]);return Lt(i,o)}const SJ=K({outerProduct_:mOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gOe(t,e,n=0){const r=O(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},o={x:r};return X.runKernel(FD,o,i)}const kh=K({pad_:gOe});function vOe(t,e,n=0){return L(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),kh(t,[e],n)}const CJ=K({pad1d_:vOe});function yOe(t,e,n=0){return L(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),kh(t,e,n)}const kJ=K({pad2d_:yOe});function bOe(t,e,n=0){return L(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),kh(t,e,n)}const yF=K({pad3d_:bOe});function xOe(t,e,n=0){return L(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),kh(t,e,n)}const TJ=K({pad4d_:xOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wOe(t,e,n){const r=O(t,"x","spaceToBatchND");L(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),L(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),L(r.shape.reduce((s,a,u)=>u>0&&u<=e.length?s&&(a+n[u-1][0]+n[u-1][1])%e[u-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const i={x:r},o={blockShape:e,paddings:n};return X.runKernel(hO,i,o)}const bF=K({spaceToBatchND_:wOe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SOe(t,e,n,r,i,o,s){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");const a=O(t,"x","maxPool");let u=a,c=!1;a.rank===3&&(c=!0,u=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(bo(o,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${i}'`);const l=Ch(u.shape,e,o,i,r),d=[l.dilationHeight,l.dilationWidth];let f;r==="same"?f=kOe([l.filterHeight,l.filterWidth],d):f=[[0,0],[0,0]];const h=d[0]===1&&d[1]===1,[p,m]=COe([l.inHeight,l.inWidth],d,f),v=h?r:"valid",g=h?u:bF(u,d,p),b=(n==="avg"?()=>YO(g,e,o,v,s):()=>pF(g,e,o,v,s))(),x=h?b:QO(b,d,m);return c?ve(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function COe(t,e,n){const r=n.map(l=>l[0]),i=n.map(l=>l[1]),o=t.concat(r,i),s=e.map((l,d)=>(l-o[d]%l)%l),a=i.map((l,d)=>l+s[d]),u=e.map((l,d)=>[r[d],a[d]]),c=e.map((l,d)=>[0,s[d]]);return[u,c]}function kOe(t,e){const r=t.map((s,a)=>s+(s-1)*(e[a]-1)).map(s=>s-1),i=r.map(s=>Math.floor(s/2)),o=r.map((s,a)=>s-i[a]);return r.map((s,a)=>[i[a],o[a]])}const EJ=K({pool_:SOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TOe(t,e){const n=O(t,"x","prelu"),r=O(e,"alpha","prelu"),i={x:n,alpha:r};return X.runKernel(MD,i)}const xF=K({prelu_:TOe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EOe(t,e=null,n=!1){let r=O(t,"x","prod");r.dtype==="bool"&&(r=Dt(r,"int32"));const i={x:r},o={axis:e,keepDims:n};return X.runKernel(BD,i,o)}const _J=K({prod_:EOe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Oe(t,e,n,r){const i=t.map((l,d)=>O(l,`tensors${d}`,"raggedGather","int32")),o=O(e,"paramsDenseValues","raggedGather"),s=O(n,"indices","raggedGather","int32"),a={paramsNestedSplits:i,paramsDenseValues:o,indices:s},u={outputRaggedRank:r},c=X.runKernel(UD,a,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}const IJ=K({raggedGather_:_Oe});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IOe(t,e,n){const r=O(t,"starts","raggedRange"),i=O(e,"limits","raggedRange",r.dtype),o=O(n,"deltas","raggedRange",r.dtype),s={starts:r,limits:i,deltas:o},a=X.runKernel(VD,s);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const RJ=K({raggedRange_:IOe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ROe(t,e,n,r,i){const o=O(t,"shape","raggedTensorToTensor","int32"),s=O(e,"values","raggedTensorToTensor"),a=O(n,"defaultValue","raggedTensorToTensor",s.dtype),u=r.map((d,f)=>O(d,`tensors${f}`,"raggedTensorToTensor","int32")),c={shape:o,values:s,defaultValue:a,rowPartitionTensors:u},l={rowPartitionTypes:i};return X.runKernel(zD,c,l)}const NJ=K({raggedTensorToTensor_:ROe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NOe(t,e,n){vo(t);const r=_e(t);let i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else if(n==="bool")i=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let o=0;o<r;o++)i[o]=e();return X.makeTensor(i,t,n)}const PJ=K({rand_:NOe});var wF={exports:{}};wF.exports;(function(t){(function(e,n,r){function i(u){var c=this,l=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function o(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function s(u,c){var l=new i(u),d=c&&c.state,f=l.next;return f.int32=function(){return l.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&o(d,l),f.state=function(){return o(l,{})}),f}function a(){var u=4022871197,c=function(l){l=String(l);for(var d=0;d<l.length;d++){u+=l.charCodeAt(d);var f=.02519603282416938*u;u=f>>>0,f-=u,f*=u,u=f>>>0,f-=u,u+=f*4294967296}return(u>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.alea=s})(Ii,t,!1)})(wF);var POe=wF.exports,SF={exports:{}};SF.exports;(function(t){(function(e,n,r){function i(a){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},a===(a|0)?u.x=a:c+=a;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xor128=s})(Ii,t,!1)})(SF);var AOe=SF.exports,CF={exports:{}};CF.exports;(function(t){(function(e,n,r){function i(a){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(d^d<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(a|0)?u.x=a:c+=a;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xorwow=s})(Ii,t,!1)})(CF);var $Oe=CF.exports,kF={exports:{}};kF.exports;(function(t){(function(e,n,r){function i(a){var u=this;u.next=function(){var l=u.x,d=u.i,f,h;return f=l[d],f^=f>>>7,h=f^f<<24,f=l[d+1&7],h^=f^f>>>10,f=l[d+3&7],h^=f^f>>>3,f=l[d+4&7],h^=f^f<<7,f=l[d+7&7],f=f^f<<13,h^=f^f<<9,l[d]=h,u.i=d+1&7,h};function c(l,d){var f,h=[];if(d===(d|0))h[0]=d;else for(d=""+d,f=0;f<d.length;++f)h[f&7]=h[f&7]<<15^d.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],l.x=h,l.i=0,f=256;f>0;--f)l.next()}c(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){a==null&&(a=+new Date);var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,l&&(l.x&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xorshift7=s})(Ii,t,!1)})(kF);var DOe=kF.exports,TF={exports:{}};TF.exports;(function(t){(function(e,n,r){function i(a){var u=this;u.next=function(){var l=u.w,d=u.X,f=u.i,h,p;return u.w=l=l+1640531527|0,p=d[f+34&127],h=d[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=d[f]=p^h,u.i=f,p+(l^l>>>16)|0};function c(l,d){var f,h,p,m,v,g=[],y=128;for(d===(d|0)?(h=d,d=null):(d=d+"\0",h=0,y=Math.max(y,d.length)),p=0,m=-32;m<y;++m)d&&(h^=d.charCodeAt((m+32)%d.length)),m===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,m>=0&&(v=v+1640531527|0,f=g[m&127]^=h+v,p=f==0?p+1:0);for(p>=128&&(g[(d&&d.length||0)&127]=-1),p=127,m=4*128;m>0;--m)h=g[p+34&127],f=g[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,g[p]=h^f;l.w=v,l.X=g,l.i=p}c(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){a==null&&(a=+new Date);var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,l&&(l.X&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.xor4096=s})(Ii,t,!1)})(TF);var OOe=TF.exports,EF={exports:{}};EF.exports;(function(t){(function(e,n,r){function i(a){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=a|0):c+=a;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&o(l,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=s:r&&r.amd?r(function(){return s}):this.tychei=s})(Ii,t,!1)})(EF);var FOe=EF.exports,AJ={exports:{}};const LOe={},MOe=Object.freeze(Object.defineProperty({__proto__:null,default:LOe},Symbol.toStringTag,{value:"Module"})),BOe=bee(MOe);(function(t){(function(e,n,r){var i=256,o=6,s=52,a="random",u=r.pow(i,o),c=r.pow(2,s),l=c*2,d=i-1,f;function h(x,S,C){var T=[];S=S==!0?{entropy:!0}:S||{};var E=g(v(S.entropy?[x,b(n)]:x??y(),3),T),I=new p(T),N=function(){for(var $=I.g(o),F=u,H=0;$<c;)$=($+H)*i,F*=i,H=I.g(1);for(;$>=l;)$/=2,F/=2,H>>>=1;return($+H)/F};return N.int32=function(){return I.g(4)|0},N.quick=function(){return I.g(4)/4294967296},N.double=N,g(b(I.S),n),(S.pass||C||function($,F,H,G){return G&&(G.S&&m(G,I),$.state=function(){return m(I,{})}),H?(r[a]=$,F):$})(N,E,"global"in S?S.global:this==r,S.state)}function p(x){var S,C=x.length,T=this,E=0,I=T.i=T.j=0,N=T.S=[];for(C||(x=[C++]);E<i;)N[E]=E++;for(E=0;E<i;E++)N[E]=N[I=d&I+x[E%C]+(S=N[E])],N[I]=S;(T.g=function($){for(var F,H=0,G=T.i,J=T.j,ne=T.S;$--;)F=ne[G=d&G+1],H=H*i+ne[d&(ne[G]=ne[J=d&J+F])+(ne[J]=F)];return T.i=G,T.j=J,H})(i)}function m(x,S){return S.i=x.i,S.j=x.j,S.S=x.S.slice(),S}function v(x,S){var C=[],T=typeof x,E;if(S&&T=="object")for(E in x)try{C.push(v(x[E],S-1))}catch{}return C.length?C:T=="string"?x:x+"\0"}function g(x,S){for(var C=x+"",T,E=0;E<C.length;)S[d&E]=d&(T^=S[d&E]*19)+C.charCodeAt(E++);return b(S)}function y(){try{var x;return f&&(x=f.randomBytes)?x=x(i):(x=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(x)),b(x)}catch{var S=e.navigator,C=S&&S.plugins;return[+new Date,e,C,e.screen,b(n)]}}function b(x){return String.fromCharCode.apply(0,x)}if(g(r.random(),n),t.exports){t.exports=h;try{f=BOe}catch{}}else r["seed"+a]=h})(typeof self<"u"?self:Ii,[],Math)})(AJ);var UOe=AJ.exports,VOe=POe,zOe=AOe,WOe=$Oe,jOe=DOe,GOe=OOe,HOe=FOe,Th=UOe;Th.alea=VOe;Th.xor128=zOe;Th.xorwow=WOe;Th.xorshift7=jOe;Th.xor4096=GOe;Th.tychei=HOe;var _F=Th;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qOe=.001,$J=.1;function KOe(t,e,n){return n==null&&(n=IF()),aR(t,e,(r,i)=>RF(r,i,n))}function IF(){return X.backend.floatPrecision()===32?qOe:$J}function aR(t,e,n){let r=!0;if((sr(t)||sr(e))&&(r=!1),sr(t)&&sr(e)&&(r=!0),r){const s=t.constructor.name,a=e.constructor.name;if(s!==a)throw new Error(`Arrays are of different type. Actual: ${s}. Expected: ${a}`)}if(Array.isArray(t)&&Array.isArray(e)){const s=fu(t),a=fu(e);if(!yn(s,a))throw new Error(`Arrays have different shapes. Actual: [${s}]. Expected: [${a}]`)}const i=sr(t)?t:du(t),o=sr(e)?e:du(e);if(i.length!==o.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${o.length}.
Actual:   ${i}.
Expected: ${o}.`);for(let s=0;s<o.length;++s){const a=i[s],u=o[s];if(!n(a,u))throw new Error(`Arrays differ: actual[${s}] = ${a}, expected[${s}] = ${u}.
Actual:   ${i}.
Expected: ${o}.`)}typeof expect<"u"&&expect().nothing()}function XOe(t,e){t().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function JOe(t,e){const n=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return bc(t)||bc(t[0])||bc(e)||bc(e[0])?aR(t,n,(r,i)=>r==i):aR(t,e,(r,i)=>RF(r,i,0))}function YOe(t,e,n){if(n==null&&(n=IF()),!RF(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function RF(t,e,n){return!isFinite(t)&&!isFinite(e)?!0:!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function QOe(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)}function ZOe(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let i=0;i<r.length;i++)if(n[i]!==r[i])throw new Error(`Expected ArrayBuffer value at ${i} to be ${r[i]} but got ${n[i]} instead`)}function DJ(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?DJ(n):t[e]=_c(n)}return t}function eFe(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise(n=>{e.addEventListener("loadeddata",r=>n(e)),e.load()})}async function tFe(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise(e=>{t.requestVideoFrameCallback(e)})}const nFe=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:$J,createVideoElement:eFe,encodeStrings:DJ,expectArrayBuffersEqual:ZOe,expectArraysClose:KOe,expectArraysEqual:JOe,expectNumbersClose:YOe,expectPromiseToFail:XOe,expectValuesInRange:QOe,play:tFe,testEpsilon:IF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NF{constructor(e,n,r,i,o){this.mean=e,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const s=o||Math.random();this.random=_F.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let e,n,r=!1;for(;!r;){let i,o,s;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);const a=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class rFe{constructor(e,n,r,i){this.alpha=e,this.beta=1/n,this.dtype=r;const o=i||Math.random();this.randu=_F.alea(o.toString()),this.randn=new NF(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,r,i,o,s;for(;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,e=i*i,n=1-.331*e*e,r=.5*e+this.d*(1-s+Math.log(s)),o=this.randu(),o<n||Math.log(o)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class iFe{constructor(e=0,n=1,r,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=_F.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oFe(t,e,n=1,r="float32",i){if(vo(t),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const o=new rFe(e,n,r,i),s=Tn(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const OJ=K({randomGamma_:oFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sFe(t,e=0,n=1,r,i){if(vo(t),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const o=new NF(e,n,r,!1,i),s=Tn(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const PF=K({randomNormal_:sFe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aFe(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return PF(t,0,1,e,n)}const FJ=K({randomStandardNormal_:aFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uFe(t,e=0,n=1,r="float32",i){vo(t);const o=Tn(t,r),s=new iFe(e,n,null,i);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const v2=K({randomUniform_:uFe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cFe(t,e,n,r){return v2(t,e,n,"int32",r)}const LJ=K({randomUniformInt_:cFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function md(t,e,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return X.runKernel(WD,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lFe(t){const n={input:O(t,"input","real")};return X.runKernel(jD,n)}const Lm=K({real_:lFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dFe(t){const n={x:O(t,"x","reciprocal")};return X.runKernel(GD,n)}const MJ=K({reciprocal_:dFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fFe(t){const n={x:O(t,"x","relu")};return X.runKernel(HD,n)}const ab=K({relu_:fFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hFe(t){const n={x:O(t,"x","relu6")};return X.runKernel(JD,n)}const AF=K({relu6_:hFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pFe(t,e){const r={x:O(t,"x","reverse")},i={dims:e};return X.runKernel(YD,r,i)}const gd=K({reverse_:pFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mFe(t){const e=O(t,"x","reverse");return L(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),gd(e,0)}const BJ=K({reverse1d_:mFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gFe(t,e){const n=O(t,"x","reverse");return L(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),gd(n,e)}const UJ=K({reverse2d_:gFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vFe(t,e){const n=O(t,"x","reverse");return L(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),gd(n,e)}const VJ=K({reverse3d_:vFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yFe(t,e){const n=O(t,"x","reverse");return L(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),gd(n,e)}const zJ=K({reverse4d_:yFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bFe(t){const n={x:O(t,"x","round")};return X.runKernel(QD,n)}const $F=K({round_:bFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xFe(t){const n={x:O(t,"x","rsqrt","float32")};return X.runKernel(ZD,n)}const WJ=K({rsqrt_:xFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wFe(t){const n={x:O(t,"x","selu")};return X.runKernel(iO,n)}const jJ=K({selu_:wFe});function SFe(t,e,n,r,i,o=[1,1],s="NHWC"){const a=O(t,"x","separableConv2d"),u=O(e,"depthwiseFilter","separableConv2d"),c=O(n,"pointwiseFilter","separableConv2d");let l=a,d=!1;if(a.rank===3&&(d=!0,l=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");L(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),L(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),L(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),L(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),L(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=u.shape[2],h=u.shape[3];L(c.shape[2]===f*h,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*h}, but got ${c.shape[2]}.`);const p=h2(l,u,r,i,s,o),v=rb(p,c,1,"valid",s);return d?ve(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const GJ=K({separableConv2d_:SFe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function CFe(t,e){const n=O(t,"x","setdiff1d"),r=O(e,"y","setdiff1d");L(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),L(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),L(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),o=await r.data(),s=new Set(o);let a=0;for(let l=0;l<i.length;l++)s.has(i[l])||a++;const u=new qf([a],n.dtype),c=new qf([a],"int32");for(let l=0,d=0;l<i.length;l++)s.has(i[l])||(u.values[d]=i[l],c.values[d]=l,d++);return[u.toTensor(),c.toTensor()]}const HJ=CFe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kFe(t){const n={x:O(t,"x","sign")};return X.runKernel(uO,n)}const qJ=K({sign_:kFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TFe(t){const n={x:O(t,"x","sin","float32")};return X.runKernel(sO,n)}const KJ=K({sin_:TFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EFe(t){const n={x:O(t,"x","sinh")};return X.runKernel(aO,n)}const XJ=K({sinh_:EFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Fe(t,e,n){const r=O(t,"x","slice1d");return L(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Jt(r,[e],[n])}const JJ=K({slice1d_:_Fe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IFe(t,e,n){const r=O(t,"x","slice2d");return L(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Jt(r,e,n)}const YJ=K({slice2d_:IFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RFe(t,e,n){const r=O(t,"x","slice3d");return L(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Jt(r,e,n)}const QJ=K({slice3d_:RFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NFe(t,e,n){const r=O(t,"x","slice4d");return L(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Jt(r,e,n)}const ZJ=K({slice4d_:NFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PFe(t,e=-1){const n=O(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},i={dim:e};return X.runKernel(mO,r,i)}const eY=K({softmax_:PFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AFe(t){L(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return X.runKernel(G$,e)}const y2=K({fft_:AFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Fe(t){L(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return X.runKernel(tD,e)}const u0=K({ifft_:$Fe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DFe(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=ve(t,[n,e]);r=u0(i)}else{const i=[n,2*(e-1)],o=ve(Lm(t),[n,e]),s=ve(sb(t),[n,e]),a=gd(Jt(o,[0,1],[n,e-2]),1),u=Pe(gd(Jt(s,[0,1],[n,e-2]),1),vt(-1)),c=Vr([o,a],1),l=Vr([s,u],1),d=ve(jc(c,l),[i[0],i[1]]);r=u0(d)}if(r=Lm(r),t.rank===3&&t.shape[0]!==0){const i=r,o=t.shape[0];r=ve(r,[o,r.shape[0]/o,r.shape[1]]),i.dispose()}return r}const DF=K({irfft_:DFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OFe(t,e,n=0){const i={x:O(t,"x","split")},o={numOrSizeSplits:e,axis:n};return X.runKernel(pO,i,o)}const Mm=K({split_:OFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FFe(t,e){L(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(e!=null&&e<n){const p=t.shape.map(v=>0),m=t.shape.map(v=>v);m[t.shape.length-1]=e,i=Jt(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,i=Vr([t,pd(p)],t.shape.length-1),n=e}else i=t;const o=co(i),s=ve(jc(i,o),[r,n]),a=y2(s),u=Math.floor(n/2)+1,c=Lm(a),l=sb(a),d=Mm(c,[u,n-u],c.shape.length-1),f=Mm(l,[u,n-u],l.shape.length-1),h=i.shape.slice();return h[i.shape.length-1]=u,ve(jc(d[0],f[0]),h)}const b2=K({rfft_:FFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LFe(t,e){let n=O(t,"a","squaredDifference"),r=O(e,"b","squaredDifference");[n,r]=In(n,r),Pt(n.shape,r.shape);const i={a:n,b:r},o={};return X.runKernel(wO,i,o)}const OF=K({squaredDifference_:LFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MFe(t,e){const n=O(t,"x","squeeze","string_or_numeric");return ve(n,Qc(n.shape,e).newShape)}const xs=K({squeeze_:MFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BFe(t,e=0){const n=Zy(t,"tensors","stack","string_or_numeric");L(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&L(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,i={axis:e};return X.runKernel(OD,r,i)}const mu=K({stack_:BFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UFe(t,e=0){const r={x:O(t,"x","step")},i={alpha:e};return X.runKernel(FO,r,i)}const FF=K({step_:UFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VFe(t,e,n,r,i=0,o=0,s=0,a=0,u=0){const l={x:O(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:r,beginMask:i,endMask:o,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:u};return X.runKernel(CO,l,d)}const tY=K({stridedSlice_:VFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zFe(t){const n={x:O(t,"x","tan","float32")};return X.runKernel(IO,n)}const nY=K({tan_:zFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ao(t,e){xh(t);const n=fu(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _d(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Af(t,e,n){if(xh(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=fu(t,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _d(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LF(t,e,n){if(xh(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=fu(t,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return _d(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rY(t,e,n){if(xh(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=fu(t,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return _d(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iY(t,e,n){if(xh(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=fu(t,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return _d(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oY(t,e,n){if(xh(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=fu(t,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,_d(t,e,r,n)}function MF(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(o+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(o+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(o+` update.rank != ${i+t.length-r}`);for(let s=0;s<i;++s)if(n.shape[s]!==e.shape[s])throw new Error(o+` updates.shape[${s}] (${n.shape[s]}) != indices.shape[${s}] (${e.shape[s]}).`);for(let s=0;s<n.rank-i;++s)if(n.shape[s+i]!==t[s+r])throw new Error(o+` updates.shape[${s+i}] (${n.shape[s+i]}) != shape[${s+i}] (${t[s+i]})`)}function x2(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}MF(n,e,t)}function ub(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length;let s=1;for(let d=i;d<o;++d)s*=n[d];const a=i<1?1:i,u=_e(e.shape)/a,c=[...dr(n.slice(0,i)),1],l=_e(n);return{sliceRank:i,numUpdates:u,sliceSize:s,strides:c,outputSize:l}}const WFe=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:ub,validateInput:x2,validateUpdateShape:MF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jFe(t,e,n){const r=O(t,"tensor","tensorScatterupdate"),i=O(e,"indices","tensorScatterupdate","int32"),o=O(n,"updates","tensorScatterupdate");if(x2(o,i,r.shape),r.dtype!==o.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${o.dtype}.`);const s={tensor:r,indices:i,updates:o},a={};return X.runKernel(tO,s,a)}const sY=K({tensorScatterUpdate_:jFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GFe(t,e=1,n=!0){const r=O(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const o={x:r},s={k:e,sorted:n},[a,u]=X.runKernel(NO,o,s);return{values:a,indices:u}}const aY=K({topk_:GFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HFe(t,e=0,n=1,r,i){if(vo(t),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new NF(e,n,r,!0,i),s=Tn(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const uY=K({truncatedNormal_:HFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qFe(t,e=0){const n=O(t,"x","unique","string_or_numeric");L(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:e},[o,s]=X.runKernel(AO,r,i);return{values:o,indices:s}}const cY=K({unique_:qFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KFe(t,e,n){const r=O(t,"x","unsortedSegmentSum"),i=O(e,"segmentIds","unsortedSegmentSum","int32");L(Gf(n),()=>"numSegments must be of dtype int");const o={x:r,segmentIds:i},s={numSegments:n};return X.runKernel(DO,o,s)}const lY=K({unsortedSegmentSum_:KFe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XFe(t,e=0){const n=O(t,"x","unstack","string_or_numeric");L(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const r={value:n},i={axis:e};return X.runKernel($O,r,i)}const Id=K({unstack_:XFe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dY(t,e){return g2(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(t,e=!0,n,r){return X.makeVariable(t,e,n,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BF(t,e){const n=[];for(let o=0;o<e.length;o++)e[o]&&n.push(o);const r=Tn(t,"int32"),i=Tn([n.length,t.length],"int32");for(let o=0;o<n.length;o++){const s=r.indexToLoc(n[o]),a=o*t.length;i.values.set(s,a)}return i.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function JFe(t){const e=O(t,"condition","whereAsync","bool"),n=await e.data(),r=BF(e.shape,n);return t!==e&&e.dispose(),r}const UF=JFe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function YFe(t,e,n){const r=O(t,"tensor","boolMask"),i=O(e,"mask","boolMask","bool"),o=n??0,s=i.rank,a=r.shape;L(s>0,()=>"mask cannot be scalar"),Wr(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let m=o;m<o+s;m++)u*=a[m];const c=a.slice(0,o).concat([u],a.slice(o+s)),l=ve(r,c),d=ve(i,[-1]),f=await UF(d),h=xs(f,[1]),p=sF(l,h,o);return t!==r&&r.dispose(),e!==i&&i.dispose(),h.dispose(),l.dispose(),d.dispose(),f.dispose(),p}const hY=YFe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QFe(t,e,n){const r=O(t,"x","transpose");if(e==null&&(e=r.shape.map((s,a)=>a).reverse()),L(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(s=>{L(s>=0&&s<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const i={x:r},o={perm:e};return r.dtype==="complex64"?ot(()=>{let s=Lm(r),a=sb(r);return s=X.runKernel(ty,{x:s},o),a=X.runKernel(ty,{x:a},o),n&&(a=sa(a)),jc(s,a)}):X.runKernel(ty,i,o)}const c0=K({transpose_:QFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZFe(t,e,n,r,i=!0){const o=O(t,"v","movingAverage"),s=O(e,"x","movingAverage"),a=O(n,"decay","movingAverage");K9(o,s),L(yn(o.shape,s.shape),()=>"Shape mismatch in v and x");const u=vt(1),c=gt(u,a);let l=Pe(gt(s,o),c);if(i){L(r!=null,()=>"When using zeroDebias: true, step is required.");const d=O(r,"step","movingAverage");l=rn(l,gt(u,Om(a,d)))}return it(o,l)}const pY=K({movingAverage_:ZFe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3e(t,e,n){vo(n);const r=O(t,"indices","scatterND","int32"),i=O(e,"updates","scatterND");x2(i,r,n);const o={indices:r,updates:i},s={shape:n};return X.runKernel(eO,o,s)}const mY=K({scatterND_:e3e});function t3e(t,e,n,r){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const s=e.size;if(!(e.rank===0||e.rank===1&&s===i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n3e(t,e,n,r=0){vo(n);const i=O(t,"sparseIndices","sparseToDense","int32"),o=O(e,"sparseValues","sparseToDense","string_or_numeric"),s=O(r,"defaultValue","sparseToDense",o.dtype);t3e(i,o,n,s);const a={sparseIndices:i,sparseValues:o,defaultValue:s},u={outputShape:n};return X.runKernel(xO,a,u)}const gY=K({sparseToDense_:n3e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3e(t,e){const n=O(e,"indices","gatherND","int32"),i={params:O(t,"x","gatherND","string_or_numeric"),indices:n};return X.runKernel(Q$,i)}const vY=K({gatherND_:r3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i3e(t,e){if(e==null)return t.shape.slice();if(yn(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)e[r]==null&&t.shape[r]!=null?n.push(t.shape[r]):n.push(e[r]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3e(t,e,n,r){const i=O(t,"x","dropout");if(L(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),L(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Mt?i.clone():i;const o=i3e(i,n),s=1-e,a=rn(oF(it(v2(o,0,1,"float32",r),s)),s);return Pe(i,a)}const yY=K({dropout_:o3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VF(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function w2(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let o=0;o<t;++o){const s=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(s)}return Ao(i,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function s3e(t,e,n=1){const r=O(t,"predictions","inTopK"),i=O(e,"targets","inTopK");L(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),L(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),Wr(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];L(n>0&&n<=o,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`);const s=await r.data(),a=await i.data(),[u,c]=[s.length/o,o],l=zc("bool",u);for(let d=0;d<u;d++){const f=d*c,h=s.subarray(f,f+c),p=[];for(let m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort((m,v)=>v.value-m.value),l[d]=0;for(let m=0;m<n;m++)if(p[m].index===a[d]){l[d]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),ks(l,i.shape,"bool")}const bY=s3e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3e(t,e,n,r,i,o="NHWC",s){let a=t;t.rank===3&&(a=ve(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]])),L(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),L(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),L(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=o==="NHWC"?a.shape[3]:a.shape[1],l=o==="NHWC"?u.shape[3]:u.shape[1];L(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),L(l===n[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`),Rs("conv2dDerFilter",i,s);const d={x:a,dy:u},f={strides:r,pad:i,dataFormat:o,dimRoundingMode:s,filterShape:n};return X.runKernel(x$,d,f)}const u3e=K({conv2DBackpropFilter_:a3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return Pe(t,FF(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function C2(t,e){let n=e;const r=eF(t.shape,e.shape);return r.length>0&&(n=cn(n,r)),ve(n,t.shape)}function k2(t,e,n,r){if(e==="linear")return t;if(e==="relu")return ab(t);if(e==="elu")return tF(t);if(e==="relu6")return AF(t);if(e==="prelu")return xF(t,n);if(e==="leakyrelu")return uF(t,r);if(e==="sigmoid")return uu(t);throw new Error(`Unknown fused activation ${e}.`)}const T2=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c3e({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",T2(X.state.gradientDepth,u)===!1){L(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=rb(t,e,n,r,i,o,s);return a!=null&&(C=it(C,a)),k2(C,u,c,l)}const d=O(t,"x","conv2d","float32"),f=O(e,"filter","conv2d","float32");let h=d,p=!1;d.rank===3&&(p=!0,h=ve(d,[1,d.shape[0],d.shape[1],d.shape[2]])),L(h.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${h.rank}.`),L(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),Rs("fused conv2d",r,s);const m=i==="NHWC"?h.shape[3]:h.shape[1];L(f.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${f.shape[2]}.`),L(bo(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);const v=Go(h.shape,f.shape,n,o,r,s);let g;a!=null&&(g=O(a,"bias","fused conv2d"),[g]=In(g,d),i==="NHWC"?Pt(v.outShape,g.shape):(L(g.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`),L(g.shape.length===0||g.shape[0]===v.outChannels||g.shape[0]===1,()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let y;if(c!=null){const C=c.shape;if(L(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)L(C[0]===1||C[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${v.outChannels}).`);else if(C.length===3)try{Pt(C,v.outShape)}catch{const E=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(E)}y=O(c,"prelu weights","fused conv2d")}const b=(C,T)=>{L(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[E,I,N,$]=T,F=S2(C,N,u);L(n0(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const H=MX(I.shape,F,E,n,r),G=u3e(I,F,E.shape,n,r),J=[H,G];if($!=null){const ne=C2($,F);J.push(ne)}return J},x={x:h,filter:f,bias:g,preluActivationWeights:y},S={strides:n,pad:r,dataFormat:i,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:l};return a==null?pu((T,E,I)=>{let N=X.runKernel(xS,x,S);return I([E,T,N]),p&&(N=ve(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:b}})(h,f):pu((T,E,I,N)=>{let $=X.runKernel(xS,x,S);return N([E,T,$,I]),p&&($=ve($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(h,f,g)}const l3e=K({fusedConv2d_:c3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d3e(t,e,n,r,i,o=[1,1],s){let a=t;t.rank===3&&(a=ve(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:i,dimRoundingMode:s,dilations:o,filterShape:n};return X.runKernel(A$,c,l)}const f3e=K({depthwiseConv2dNativeBackpropFilter_:d3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h3e(t,e,n,r,i,o=[1,1],s){let a=e,u=!1;e.rank===3&&(u=!0,a=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:i,dimRoundingMode:s,dilations:o,inputShape:t},d=X.runKernel($$,c,l);return u?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const p3e=K({depthwiseConv2dNativeBackpropInput_:h3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3e({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(T2(X.state.gradientDepth,u)===!1){let S=h2(t,e,n,r,i,o,s);return a!=null&&(S=it(S,a)),k2(S,u,c,l)}const d=O(t,"x","depthwiseConv2d","float32"),f=O(e,"filter","depthwiseConv2d","float32");let h=d,p=!1;d.rank===3&&(p=!0,h=ve(d,[1,d.shape[0],d.shape[1],d.shape[2]])),L(h.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),L(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),L(h.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${h.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),o==null&&(o=[1,1]),L(bo(n,o),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Rs("fused depthwiseConv2d",r,s);const m=Go(h.shape,f.shape,n,o,r,s,!0);let v;a!=null&&(v=O(a,"bias","fused conv2d"),[v]=In(v,d),Pt(m.outShape,v.shape));let g;c!=null&&(g=O(c,"prelu weights","fused depthwiseConv2d"));const y=(S,C)=>{L(n0(o),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);const[T,E,I,N]=C,$=S2(S,I,u),F=p3e(E.shape,$,T,n,r,o,s),H=f3e(E,$,T.shape,n,r,o,s);if(N!=null){const G=C2(v,$);return[F,H,G]}return[F,H]},b={x:h,filter:f,bias:v,preluActivationWeights:g},x={strides:n,pad:r,dataFormat:i,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:l};return a==null?pu((C,T,E)=>{let I=X.runKernel(wS,b,x);return E([T,C,I]),p&&(I=ve(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:y}})(h,f):pu((C,T,E,I)=>{let N=X.runKernel(wS,b,x);return I([T,C,N,E]),p&&(N=ve(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:y}})(h,f,v)}const g3e=K({fusedDepthwiseConv2d_:m3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3e({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:o="linear",preluActivationWeights:s,leakyreluAlpha:a=.2}){if(T2(X.state.gradientDepth,o)===!1){let $=Lt(t,e,n,r);return i!=null&&($=it($,i)),k2($,o,s,a)}let u=O(t,"a","fused matMul"),c=O(e,"b","fused matMul");[u,c]=In(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?u.shape[u.rank-1]:u.shape[u.rank-2],h=r?c.shape[c.rank-2]:c.shape[c.rank-1],p=u.shape.slice(0,-2),m=c.shape.slice(0,-2),v=_e(p),g=_e(m);L(l===d,()=>`Error in fused matMul: inner shapes (${l}) and (${d}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`);const b=Pt(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,h]),x=n?ve(u,[v,l,f]):ve(u,[v,f,l]),S=r?ve(c,[g,h,d]):ve(c,[g,d,h]);let C;i!=null&&(C=O(i,"bias","fused matMul"),[C]=In(C,u),Pt(b,C.shape));let T;s!=null&&(T=O(s,"prelu weights","fused matMul"));const E=($,F)=>{const[H,G,J,ne]=F,oe=S2(ve($,J.shape),J,o);let q,Z;if(!n&&!r?(q=Lt(oe,G,!1,!0),Z=Lt(H,oe,!0,!1)):!n&&r?(q=Lt(oe,G,!1,!1),Z=Lt(oe,H,!0,!1)):n&&!r?(q=Lt(G,oe,!1,!0),Z=Lt(H,oe,!1,!1)):(q=Lt(G,oe,!0,!0),Z=Lt(oe,H,!0,!0)),i!=null){const se=C2(ne,oe);return[q,Z,se]}else return[q,Z]},I={a:x,b:S,bias:C,preluActivationWeights:T},N={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};return i==null?pu((F,H,G)=>{const J=X.runKernel(bS,I,N);return G([F,H,J]),{value:ve(J,b),gradFunc:E}})(x,S):pu((F,H,G,J)=>{const ne=X.runKernel(bS,I,N);return J([F,H,ne,G]),{value:ve(ne,b),gradFunc:E}})(x,S,C)}const y3e=K({fusedMatMul_:v3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xY=Object.freeze(Object.defineProperty({__proto__:null,conv2d:l3e,depthwiseConv2d:g3e,matMul:y3e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b3e(t){return w2(t,.54,.46)}const x3e=K({hammingWindow_:b3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w3e(t){return w2(t,.5,.5)}const wY=K({hannWindow_:w3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S3e(t,e,n,r=!1,i=0){let o=0;const s=[];for(;o+e<=t.size;)s.push(Jt(t,o,e)),o+=n;if(r)for(;o<t.size;){const a=o+e-t.size,u=Vr([Jt(t,o,e-a),sg([a],i)]);s.push(u),o+=n}return s.length===0?Af([],[0,e]):ve(Vr(s),[s.length,e])}const SY=K({frame_:S3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C3e(t,e,n,r,i=wY){r==null&&(r=VF(e));const o=SY(t,e,n),s=Pe(o,i(e));return b2(s,r)}const k3e=K({stft_:C3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T3e(t,e,n,r,i="bilinear",o=0){const s=O(t,"image","cropAndResize"),a=O(e,"boxes","cropAndResize","float32"),u=O(n,"boxInd","cropAndResize","int32"),c=a.shape[0];L(s.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`),L(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),L(u.rank===1&&u.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),L(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),L(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),L(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const l={image:s,boxes:a,boxInd:u},d={method:i,extrapolationValue:o,cropSize:r};return X.runKernel(I$,l,d)}const E3e=K({cropAndResize_:T3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _3e(t){const e=O(t,"image","flipLeftRight","float32");L(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return X.runKernel(q$,n,{})}const I3e=K({flipLeftRight_:_3e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R3e(t){const e=O(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];L(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),L(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,lm(e,i)}const N3e=K({grayscaleToRGB_:R3e});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P3e(t){const e=O(t,"image","RGBToGrayscale"),n=e.rank-1,r=e.shape[n];L(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),L(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const i=e.dtype,o=Dt(e,"float32"),s=Ao([.2989,.587,.114]);let a;switch(e.rank){case 2:a=of("ij,j->i",o,s);break;case 3:a=of("ijk,k->ij",o,s);break;case 4:a=of("ijkl,l->ijk",o,s);break;case 5:a=of("ijklm,m->ijkl",o,s);break;case 6:a=of("ijklmn,n->ijklm",o,s);break;default:throw new Error("Not a valid tensor rank.")}return a=_i(a,-1),Dt(a,i)}const A3e=K({rgbToGrayscale_:P3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $3e(t,e,n=0,r=.5){const i=O(t,"image","rotateWithOffset","float32");L(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const o={image:i},s={radians:e,fillValue:n,center:r};return X.runKernel(LO,o,s)}const D3e=K({rotateWithOffset_:$3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ug(t,e,n,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);const s=t.shape[0];return n=Math.min(n,s),L(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),L(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),L(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),L(e.rank===1,()=>"scores must be a 1D tensor"),L(e.shape[0]===s,()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${e.shape[0]}`),L(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O3e(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const o=O(t,"boxes","nonMaxSuppression","float32"),s=O(e,"scores","nonMaxSuppression","float32"),a=ug(o,s,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return X.runKernel(ND,{boxes:o,scores:s},u)}const F3e=K({nonMaxSuppression_:O3e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3e(t,e,n){const r=M3e(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function M3e(t,e,n){return U3e(t,e,n||B3e)}function B3e(t,e){return t>e?1:t<e?-1:0}function U3e(t,e,n){let r=0,i=t.length,o=0,s=!1;for(;r<i;){o=r+(i-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(i=o,s=!a)}return s?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(t,e,n,r,i){return GF(t,e,n,r,i,0)}function WF(t,e,n,r,i,o){return GF(t,e,n,r,i,0,!1,o,!0)}function jF(t,e,n,r,i,o){return GF(t,e,n,r,i,o,!0)}function GF(t,e,n,r,i,o,s=!1,a=!1,u=!1){const c=[];for(let v=0;v<e.length;v++)e[v]>i&&c.push({score:e[v],boxIndex:v,suppressBeginIndex:0});c.sort(PV);const l=o>0?-.5/o:0,d=[],f=[];for(;d.length<n&&c.length>0;){const v=c.pop(),{score:g,boxIndex:y,suppressBeginIndex:b}=v;if(g<i)break;let x=!1;for(let S=d.length-1;S>=b;--S){const C=V3e(t,y,d[S]);if(C>=r){x=!0;break}if(v.score=v.score*z3e(r,l,C),v.score<=i)break}v.suppressBeginIndex=d.length,x||(v.score===g?(d.push(y),f.push(v.score)):v.score>i&&L3e(c,v,PV))}const h=d.length,p=n-h;a&&p>0&&(d.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const m={selectedIndices:d};return s&&(m.selectedScores=f),u&&(m.validOutputs=h),m}function V3e(t,e,n){const r=t.subarray(e*4,e*4+4),i=t.subarray(n*4,n*4+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),h=(a-o)*(u-s),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;const m=Math.max(o,c),v=Math.max(s,l),g=Math.min(a,d),y=Math.min(u,f),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(h+p-b)}function z3e(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function PV(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function W3e(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const o=O(t,"boxes","nonMaxSuppressionAsync"),s=O(e,"scores","nonMaxSuppressionAsync"),a=ug(o,s,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u=await Promise.all([o.data(),s.data()]),c=u[0],l=u[1],{selectedIndices:d}=zF(c,l,n,r,i);return o!==t&&o.dispose(),s!==e&&s.dispose(),Ao(d,"int32")}const j3e=W3e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3e(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=0){const s=O(t,"boxes","nonMaxSuppression"),a=O(e,"scores","nonMaxSuppression"),u=ug(s,a,n,r,i,o);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma;const c={boxes:s,scores:a},l={maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o},d=X.runKernel(AD,c,l);return{selectedIndices:d[0],selectedScores:d[1]}}const H3e=K({nonMaxSuppressionWithScore_:G3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function q3e(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=0){const s=O(t,"boxes","nonMaxSuppressionAsync"),a=O(e,"scores","nonMaxSuppressionAsync"),u=ug(s,a,n,r,i,o);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([s.data(),a.data()]),l=c[0],d=c[1],{selectedIndices:f,selectedScores:h}=jF(l,d,n,r,i,o);return s!==t&&s.dispose(),a!==e&&a.dispose(),{selectedIndices:Ao(f,"int32"),selectedScores:Ao(h)}}const K3e=q3e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X3e(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=!1){const s=O(t,"boxes","nonMaxSuppression"),a=O(e,"scores","nonMaxSuppression"),u=ug(s,a,n,r,i,null),c=u.maxOutputSize,l=u.iouThreshold,d=u.scoreThreshold,f={boxes:s,scores:a},h={maxOutputSize:c,iouThreshold:l,scoreThreshold:d,padToMaxOutputSize:o},p=X.runKernel(PD,f,h);return{selectedIndices:p[0],validOutputs:p[1]}}const J3e=K({nonMaxSuppressionPadded_:X3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Y3e(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=!1){const s=O(t,"boxes","nonMaxSuppressionAsync"),a=O(e,"scores","nonMaxSuppressionAsync"),u=ug(s,a,n,r,i,null),c=u.maxOutputSize,l=u.iouThreshold,d=u.scoreThreshold,[f,h]=await Promise.all([s.data(),a.data()]),{selectedIndices:p,validOutputs:m}=WF(f,h,c,l,d,o);return s!==t&&s.dispose(),a!==e&&a.dispose(),{selectedIndices:Ao(p,"int32"),validOutputs:vt(m,"int32")}}const Q3e=Y3e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z3e(t,e,n=!1,r=!1){const i=O(t,"images","resizeBilinear");L(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),L(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),L(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=X.runKernel(XD,a,u);return s?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const eLe=K({resizeBilinear_:Z3e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tLe(t,e,n=!1,r=!1){const i=O(t,"images","resizeNearestNeighbor");L(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),L(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),L(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),L(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=X.runKernel(KD,a,u);return s?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const nLe=K({resizeNearestNeighbor_:tLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rLe(t,e="binary",n=!1,r=.5){const i=O(t,"image","threshold"),o=.2989,s=.587,a=.114,u=i.shape[0]*i.shape[1];let c=Pe(Ao([r]),255),l,d,f,h;if(L(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),L(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),L(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),L(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),i.shape[2]===3){[l,d,f]=Mm(i,[1,1,1],-1);const v=Pe(l,o),g=Pe(d,s),y=Pe(f,a);h=it(it(v,g),y)}else h=t;if(e==="otsu"){const v=ZO(Dt($F(h),"int32"),ks([]),256);c=iLe(v,u)}const p=n?p2(h,c):ag(h,c);return Dt(Pe(p,255),"int32")}function iLe(t,e){let n=Ao([-1]),r=Ao([0]),i=Ao([0]),o,s,a,u,c,l;for(let d=0;d<t.size-1;d++){o=Jt(t,0,d+1),s=Jt(t,d+1),c=rn(cn(o),e),l=rn(cn(s),e);const f=cn(Pe(o,md(0,o.size)));a=rn(f,cn(o));const h=sg(s.shape,o.size),p=it(md(0,s.size),h),m=Pe(s,p);u=rn(cn(m),cn(s));const v=gt(a,u),g=gt(a,u),y=Pe(c,l);i=Pe(Pe(y,v),g);const b=ag(i,r);r=Rc(b,i,r),n=Rc(b,Ao([d]),n)}return n}const oLe=K({threshold_:rLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sLe(t,e,n="nearest",r="constant",i=0,o){const s=O(t,"image","transform","float32"),a=O(e,"transforms","transform","float32");L(s.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`),L(a.rank===2&&(a.shape[0]===s.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),L(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const u={image:s,transforms:a},c={interpolation:n,fillMode:r,fillValue:i,outputShape:o};return X.runKernel(PO,u,c)}const aLe=K({transform_:sLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uLe(t,e,n){const r=O(t,"a","bandPart");L(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[o,s]=r.shape.slice(-2);let a,u;typeof e=="number"?(L(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),L(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=O(e<0?o:e,"numLower","bandPart")):(L(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Rc(_S(e,0),o,s0(e,o))),typeof n=="number"?(L(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),L(n<=s,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${s}).`),u=O(n<0?s:n,"numUpper","bandPart")):(L(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=Rc(_S(n,0),s,s0(n,s)));const c=ve(md(0,o,1,"int32"),[-1,1]),l=md(0,s,1,"int32"),d=gt(c,l),f=i0(p2(d,a),aF(d,sa(u))),h=pd([o,s],r.dtype);return ve(mu(Id(ve(r,[-1,o,s])).map(p=>Rc(f,p,h))),i)}const cLe=K({bandPart_:uLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lLe(t){let e;if(Array.isArray(t)){e=!1,L(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=t[0].shape[0];for(let o=1;o<t.length;++o)L(t[o].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[o].shape[0]} vs. ${i})`)}else e=!0,t=Mm(t,t.shape[0],0).map(i=>xs(i,[0]));L(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],r=t;for(let i=0;i<t.length;++i)n.push(X.tidy(()=>{let o=r[i];if(i>0)for(let s=0;s<i;++s){const a=Pe(cn(Pe(n[s],o)),n[s]);o=gt(o,a)}return rn(o,ob(o,"euclidean"))}));return e?mu(n,0):n}const dLe=K({gramSchmidt_:lLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fLe(t,e=!1){if(L(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return AV(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((u,c)=>u*c),r=Id(ve(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];r.forEach(u=>{const[c,l]=AV(u,e);i.push(c),o.push(l)});const s=ve(mu(i,0),t.shape),a=ve(mu(o,0),t.shape);return[s,a]}}function AV(t,e=!1){return X.tidy(()=>{L(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],r=t.shape[1];let i=iF(n),o=Ic(t);const s=Af([[1]],[1,1]);let a=Ic(s);const u=n>=r?r:n;for(let c=0;c<u;++c){const l=o,d=a,f=i;[a,o,i]=X.tidy(()=>{const h=Jt(o,[c,c],[n-c,1]),p=ob(h),m=Jt(o,[c,c],[1,1]),v=Rc(ag(m,0),Af([[-1]]),Af([[1]])),g=gt(m,Pe(v,p)),y=rn(h,g);y.shape[0]===1?a=Ic(s):a=Vr([s,Jt(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);const b=sa(rn(Lt(v,g),p)),x=Jt(o,[c,0],[n-c,r]),S=Pe(b,a),C=c0(a);if(c===0)o=gt(x,Lt(S,Lt(C,x)));else{const I=gt(x,Lt(S,Lt(C,x)));o=Vr([Jt(o,[0,0],[c,r]),I],0)}const T=c0(S),E=Jt(i,[0,c],[n,i.shape[1]-c]);if(c===0)i=gt(E,Lt(Lt(E,a),T));else{const I=gt(E,Lt(Lt(E,a),T));i=Vr([Jt(i,[0,0],[n,c]),I],1)}return[a,o,i]}),mi([l,d,f])}return!e&&n>r&&(i=Jt(i,[0,0],[n,r]),o=Jt(o,[0,0],[r,r])),[i,o]})}const hLe=K({qr_:fLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var di;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(di||(di={}));function pLe(t,e,n=di.SUM_BY_NONZERO_WEIGHTS){const r=O(t,"losses","computeWeightedLoss");let i=null;e!=null&&(i=O(e,"weights","computeWeightedLoss"));const o=i==null?r:Pe(r,i);if(n===di.NONE)return o;if(n===di.SUM)return cn(o);if(n===di.MEAN){if(i==null)return o0(o);{const s=r.size/i.size,a=rn(cn(o),cn(i));return s>1?rn(a,vt(s)):a}}if(n===di.SUM_BY_NONZERO_WEIGHTS){if(i==null)return rn(cn(o),vt(r.size));{const s=Pe(i,Bl(r.shape)),a=Dt(cn(vF(s,vt(0))),"float32");return rn(cn(o),a)}}throw Error(`Unknown reduction: ${n}`)}const Zc=K({computeWeightedLoss_:pLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mLe(t,e,n,r=di.SUM_BY_NONZERO_WEIGHTS){const i=O(t,"labels","absoluteDifference"),o=O(e,"predictions","absoluteDifference");let s=null;n!=null&&(s=O(n,"weights","absoluteDifference")),Wr(i.shape,o.shape,"Error in absoluteDifference: ");const a=qi(gt(i,o));return Zc(a,s,r)}const gLe=K({absoluteDifference_:mLe});function vLe(t,e,n,r,i=di.SUM_BY_NONZERO_WEIGHTS){const o=O(t,"labels","cosineDistance"),s=O(e,"predictions","cosineDistance");let a=null;r!=null&&(a=O(r,"weights","cosineDistance")),Wr(o.shape,s.shape,"Error in cosineDistance: ");const u=vt(1),c=gt(u,cn(Pe(o,s),n,!0));return Zc(c,a,i)}const yLe=K({cosineDistance_:vLe});function bLe(t,e,n,r=di.SUM_BY_NONZERO_WEIGHTS){let i=O(t,"labels","hingeLoss");const o=O(e,"predictions","hingeLoss");let s=null;n!=null&&(s=O(n,"weights","hingeLoss")),Wr(i.shape,o.shape,"Error in hingeLoss: ");const a=vt(1);i=gt(Pe(vt(2),i),a);const u=ab(gt(a,Pe(i,o)));return Zc(u,s,r)}const xLe=K({hingeLoss_:bLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wLe(t,e,n,r=1,i=di.SUM_BY_NONZERO_WEIGHTS){const o=O(t,"labels","huberLoss"),s=O(e,"predictions","huberLoss");let a=null;n!=null&&(a=O(n,"weights","huberLoss")),Wr(o.shape,s.shape,"Error in huberLoss: ");const u=vt(r),c=qi(gt(s,o)),l=s0(c,u),d=gt(c,l),f=it(Pe(vt(.5),Ts(l)),Pe(u,d));return Zc(f,a,i)}const SLe=K({huberLoss_:wLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CLe(t,e,n,r=1e-7,i=di.SUM_BY_NONZERO_WEIGHTS){const o=O(t,"labels","logLoss"),s=O(e,"predictions","logLoss");let a=null;n!=null&&(a=O(n,"weights","logLoss")),Wr(o.shape,s.shape,"Error in logLoss: ");const u=vt(1),c=vt(r),l=sa(Pe(o,Fm(it(s,c)))),d=Pe(gt(u,o),Fm(it(gt(u,s),c))),f=gt(l,d);return Zc(f,a,i)}const kLe=K({logLoss_:CLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TLe(t,e,n,r=di.SUM_BY_NONZERO_WEIGHTS){const i=O(t,"labels","meanSquaredError"),o=O(e,"predictions","meanSquaredError");let s=null;n!=null&&(s=O(n,"weights","meanSquaredError")),Wr(i.shape,o.shape,"Error in meanSquaredError: ");const a=OF(i,o);return Zc(a,s,r)}const ELe=K({meanSquaredError_:TLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Le(t,e){const n=O(t,"labels","sigmoidCrossEntropyWithLogits"),r=O(e,"logits","sigmoidCrossEntropyWithLogits");Wr(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=ab(r),o=Pe(r,n),s=cF(hd(sa(qi(r))));return it(gt(i,o),s)}function ILe(t,e,n,r=0,i=di.SUM_BY_NONZERO_WEIGHTS){let o=O(t,"multiClassLabels","sigmoidCrossEntropy");const s=O(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=O(n,"weights","sigmoidCrossEntropy")),Wr(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const c=vt(r),l=vt(1),d=vt(.5);o=it(Pe(o,gt(l,c)),Pe(d,c))}const u=_Le(o,s);return Zc(u,a,i)}const RLe=K({sigmoidCrossEntropy_:ILe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NLe(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return pu((i,o,s)=>{const u=dF(o,[n],!0),c=gt(Dt(o,"float32"),u);s([i,c]);const l=sa(Pe(c,i));return{value:cn(l,[n]),gradFunc:(h,p)=>{const[m,v]=p,g=Ho(h.shape,[n]);return[Pe(ve(h,g),gt(Dt(m,"float32"),hd(v))),Pe(ve(h,g),gt(hd(v),Dt(m,"float32")))]}}})(t,e)}function PLe(t,e,n,r=0,i=di.SUM_BY_NONZERO_WEIGHTS){let o=O(t,"onehotLabels","softmaxCrossEntropy");const s=O(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=O(n,"weights","softmaxCrossEntropy")),Wr(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const c=vt(r),l=vt(1),d=vt(o.shape[1]);o=it(Pe(o,gt(l,c)),rn(c,d))}const u=NLe(o,s);return Zc(u,a,i)}const ALe=K({softmaxCrossEntropy_:PLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Le(t,e,n,r){const i=O(t,"indices","sparseFillEmptyRows","int32"),o=O(e,"values","sparseFillEmptyRows"),s=O(n,"denseShape","sparseFillEmptyRows","int32"),a=O(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(o.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(s.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${s.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:i,values:o,denseShape:s,defaultValue:a},c=X.runKernel(gO,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}const DLe=K({sparseFillEmptyRows_:$Le});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OLe(t,e,n){const r=O(t,"inputIndices","sparseReshape","int32"),i=O(e,"inputShape","sparseReshape","int32"),o=O(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const s={inputIndices:r,inputShape:i,newShape:o},a=X.runKernel(vO,s);return{outputIndices:a[0],outputShape:a[1]}}const FLe=K({sparseReshape_:OLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LLe(t,e,n){const r=O(t,"data","sparseSegmentMean"),i=O(e,"indices","sparseSegmentMean","int32"),o=O(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(o.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${o.shape}`);const s={data:r,indices:i,segmentIds:o};return X.runKernel(yO,s)}const MLe=K({sparseSegmentMean_:LLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BLe(t,e,n){const r=O(t,"data","sparseSegmentSum"),i=O(e,"indices","sparseSegmentSum","int32"),o=O(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(o.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${o.shape}`);const s={data:r,indices:i,segmentIds:o};return X.runKernel(bO,s)}const ULe=K({sparseSegmentSum_:BLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VLe(t,e,n,r,i,o,s,a){const u=O(t,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=O(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:i,rightPad:o,padWidth:s,preserveShortSequences:a},d={data:u,dataSplits:c},f=X.runKernel(kO,d,l);return{nGrams:f[0],nGramsSplits:f[1]}}const zLe=K({stringNGrams_:VLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WLe(t,e,n=!0){const r=O(t,"input","stringSplit","string"),i=O(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const o={skipEmpty:n},s={input:r,delimiter:i},a=X.runKernel(TO,s,o);return{indices:a[0],values:a[1],shape:a[2]}}const jLe=K({stringSplit_:WLe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GLe(t,e){const n=O(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return X.runKernel(EO,i,r)}const HLe=K({stringToHashBucketFast_:GLe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qLe(t,e,n,r=!0){const i=O(t,"input","staticRegexReplace","string"),o={pattern:e,rewrite:n,replaceGlobal:r};return X.runKernel(SO,{x:i},o)}const KLe=K({staticRegexReplace_:qLe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CY={fft:y2,ifft:u0,rfft:b2,irfft:DF},kY={hammingWindow:x3e,hannWindow:wY,frame:SY,stft:k3e},Yf={flipLeftRight:I3e,grayscaleToRGB:N3e,resizeNearestNeighbor:nLe,resizeBilinear:eLe,rgbToGrayscale:A3e,rotateWithOffset:D3e,cropAndResize:E3e,nonMaxSuppression:F3e,nonMaxSuppressionAsync:j3e,nonMaxSuppressionWithScore:H3e,nonMaxSuppressionWithScoreAsync:K3e,nonMaxSuppressionPadded:J3e,nonMaxSuppressionPaddedAsync:Q3e,threshold:oLe,transform:aLe},TY={bandPart:cLe,gramSchmidt:dLe,qr:hLe},EY={absoluteDifference:gLe,computeWeightedLoss:Zc,cosineDistance:yLe,hingeLoss:xLe,huberLoss:SLe,logLoss:kLe,meanSquaredError:ELe,sigmoidCrossEntropy:RLe,softmaxCrossEntropy:ALe},_Y={sparseFillEmptyRows:DLe,sparseReshape:FLe,sparseSegmentMean:MLe,sparseSegmentSum:ULe},IY={stringNGrams:zLe,stringSplit:jLe,stringToHashBucketFast:HLe,staticRegexReplace:KLe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XLe=new Map,uR=new Map;class RY{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class El{constructor(){this.classNameMap={}}static getMap(){return El.instance==null&&(El.instance=new El),El.instance}static register(e){El.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function NY(t,e,n){L(t.className!=null,()=>"Class being registered does not have the static className property defined."),L(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),L(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const r=n,i=e+">"+r;return El.register(t),XLe.set(i,t),uR.set(t,i),t}function JLe(t){return uR.has(t)?uR.get(t):t.className}const YLe=Object.freeze(Object.defineProperty({__proto__:null,Serializable:RY,SerializationMap:El,getRegisteredName:JLe,registerClass:NY},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rd extends RY{minimize(e,n=!1,r){const{value:i,grads:o}=this.computeGradients(e,r);if(r!=null){const s=r.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(s)}else this.applyGradients(o);return mi(o),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return cJ(e,n)}dispose(){this.iterations_!=null&&mi(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:vt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Rd,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HF extends Rd{static get className(){return"Adadelta"}constructor(e,n,r=null){super(),this.learningRate=e,this.rho=n,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=X.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const o=X.registeredVariables[r],s=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accum_grad`,variable:ot(()=>co(o).variable(s))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${r}/accum_var`,variable:ot(()=>co(o).variable(s))});const a=Array.isArray(e)?e[i].tensor:e[r];if(a==null)return;const u=this.accumulatedGrads[i].variable,c=this.accumulatedUpdates[i].variable;ot(()=>{const l=it(Pe(u,this.rho),Pe(Ts(a),1-this.rho)),d=Pe(rn(hu(it(c,this.epsilon)),hu(it(u,this.epsilon))),a),f=it(Pe(c,this.rho),Pe(Ts(d),1-this.rho));u.assign(l),c.assign(f);const h=it(Pe(d,-this.learningRate),o);o.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(mi(this.accumulatedGrads.map(e=>e.variable)),mi(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedUpdates=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qF extends Rd{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const o=X.registeredVariables[r];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accumulator`,variable:ot(()=>sg(o.shape,this.initialAccumulatorValue).variable(!1))});const s=Array.isArray(e)?e[i].tensor:e[r];if(s==null)return;const a=this.accumulatedGrads[i].variable;ot(()=>{const u=it(a,Ts(s));a.assign(u);const c=it(Pe(rn(s,hu(it(u,X.backend.epsilon()))),-this.learningRate),o);o.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&mi(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KF extends Rd{static get className(){return"Adam"}constructor(e,n,r,i=null){super(),this.learningRate=e,this.beta1=n,this.beta2=r,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ot(()=>{this.accBeta1=vt(n).variable(),this.accBeta2=vt(r).variable()}),i==null&&(this.epsilon=X.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ot(()=>{const r=gt(1,this.accBeta1),i=gt(1,this.accBeta2);n.forEach((o,s)=>{const a=X.registeredVariables[o],u=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${o}/m`,variable:ot(()=>co(a).variable(u))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${o}/v`,variable:ot(()=>co(a).variable(u))});const c=Array.isArray(e)?e[s].tensor:e[o];if(c==null)return;const l=this.accumulatedFirstMoment[s].variable,d=this.accumulatedSecondMoment[s].variable,f=it(Pe(l,this.beta1),Pe(c,1-this.beta1)),h=it(Pe(d,this.beta2),Pe(Ts(c),1-this.beta2)),p=rn(f,r),m=rn(h,i);l.assign(f),d.assign(h);const v=it(Pe(rn(p,it(hu(m),this.epsilon)),-this.learningRate),a);a.assign(v)}),this.accBeta1.assign(Pe(this.accBeta1,this.beta1)),this.accBeta2.assign(Pe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&mi(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&mi(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),ot(()=>{this.accBeta1.assign(Om(this.beta1,this.iterations_+1)),this.accBeta2.assign(Om(this.beta2,this.iterations_+1))});const n=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XF extends Rd{static get className(){return"Adamax"}constructor(e,n,r,i=null,o=0){super(),this.learningRate=e,this.beta1=n,this.beta2=r,this.epsilon=i,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ot(()=>{this.iteration=vt(0).variable(),this.accBeta1=vt(n).variable()}),i==null&&(this.epsilon=X.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ot(()=>{const r=gt(1,this.accBeta1),i=rn(-this.learningRate,it(Pe(this.iteration,this.decay),1));n.forEach((o,s)=>{const a=X.registeredVariables[o],u=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${o}/m`,variable:co(a).variable(u)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${o}/v`,variable:co(a).variable(u)});const c=Array.isArray(e)?e[s].tensor:e[o];if(c==null)return;const l=this.accumulatedFirstMoment[s].variable,d=this.accumulatedWeightedInfNorm[s].variable,f=it(Pe(l,this.beta1),Pe(c,1-this.beta1)),h=Pe(d,this.beta2),p=qi(c),m=mF(h,p);l.assign(f),d.assign(m);const v=it(Pe(rn(i,r),rn(f,it(m,this.epsilon))),a);a.assign(v)}),this.iteration.assign(it(this.iteration,1)),this.accBeta1.assign(Pe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&mi(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&mi(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2 extends Rd{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const o=Array.isArray(e)?e[i].tensor:e[r];if(o==null)return;const s=X.registeredVariables[r];ot(()=>{const a=it(Pe(this.c,o),s);s.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=na(vt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JF extends E2{static get className(){return"Momentum"}constructor(e,n,r=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=r,this.accumulations=[],this.m=vt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const o=X.registeredVariables[r];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${r}/momentum`,variable:ot(()=>co(o).variable(!1))});const s=this.accumulations[i].variable,a=Array.isArray(e)?e[i].tensor:e[r];a!=null&&ot(()=>{let u;const c=it(Pe(this.m,s),a);this.useNesterov?u=it(Pe(this.c,it(a,Pe(c,this.m))),o):u=it(Pe(this.c,c),o),s.assign(c),o.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&mi(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YF extends Rd{static get className(){return"RMSProp"}constructor(e,n=.9,r=0,i=null,o=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=r,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,i==null&&(this.epsilon=X.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,i)=>{const o=X.registeredVariables[r],s=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${r}/rms`,variable:ot(()=>co(o).variable(s))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${r}/momentum`,variable:ot(()=>co(o).variable(s))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${r}/mg`,variable:ot(()=>co(o).variable(s))});const a=Array.isArray(e)?e[i].tensor:e[r];if(a==null)return;const u=this.accumulatedMeanSquares[i].variable,c=this.accumulatedMoments[i].variable;ot(()=>{const l=it(Pe(u,this.decay),Pe(Ts(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[i].variable,f=it(Pe(d,this.decay),Pe(a,1-this.decay)),h=rn(Pe(a,this.learningRate),hu(gt(l,it(Ts(f),this.epsilon)))),p=it(Pe(c,this.momentum),h);u.assign(l),d.assign(f),c.assign(p);const m=gt(o,p);o.assign(m)}else{const d=it(Pe(u,this.decay),Pe(Ts(a),1-this.decay)),f=it(Pe(c,this.momentum),rn(Pe(a,this.learningRate),hu(it(d,this.epsilon))));u.assign(d),c.assign(f);const h=gt(o,f);o.assign(h)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&mi(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&mi(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&mi(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedMoments=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QLe=[HF,qF,KF,XF,JF,YF,E2];function ZLe(){for(const t of QLe)NY(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eMe="model",tMe=".json",nMe=".weights.bin";function $V(t){return new Promise(e=>setTimeout(e)).then(t)}class Qf{constructor(e){if(!ae().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Qf.URL_SCHEME)&&(e=e.slice(Qf.URL_SCHEME.length)),(e==null||e.length===0)&&(e=eMe),this.modelJsonFileName=e+tMe,this.weightDataFileName=e+nMe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=ma.join(e.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const i=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o=Z9(e,i),s=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=s,await $V(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,await $V(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Z0(e)}}}}Qf.URL_SCHEME="downloads://";class rMe{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const r=new FileReader;r.onload=i=>{const o=JSON.parse(i.target.result),s=o.modelTopology;if(s==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(o.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:s});return}const u=HO(o,c=>this.loadWeights(c));e(u)},r.onerror=i=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(e){const n=[],r=[];for(const s of e)n.push(...s.weights),r.push(...s.paths);const i=this.checkManifestAndWeightFiles(e),o=r.map(s=>this.loadWeightsFile(s,i[s]));return Promise.all(o).then(s=>[n,s])}loadWeightsFile(e,n){return new Promise((r,i)=>{const o=new FileReader;o.onload=s=>{const a=s.target.result;r(a)},o.onerror=s=>i(`Failed to weights data from file of path '${e}'.`),o.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],r=this.weightsFiles.map(o=>NV(o.name)),i={};for(const o of e)o.paths.forEach(s=>{const a=NV(s);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);i[s]=this.weightsFiles[r.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return i}}const iMe=t=>ae().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Qf.URL_SCHEME)?oMe(t.slice(Qf.URL_SCHEME.length)):null;En.registerSaveRouter(iMe);function oMe(t="model"){return new Qf(t)}function sMe(t){return new rMe(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(t,e,n,r){s(t),n=n??0,r=r??1,a(n,r);let i=0;const o=u=>(u.then(c=>{const l=n+ ++i/t.length*(r-n);return e(l),c}),u);function s(u){L(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,c){L(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),L(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),L(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(t.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function PY(t,e){e==null&&(e={});const n=e.fetchFunc==null?ae().platform.fetch:e.fetchFunc,r=t.map(d=>n(d,e.requestInit,{isBinary:!0})),i=0,o=.5,a=(e.onProgress==null?await Promise.all(r):await DV(r,e.onProgress,i,o)).map(d=>d.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(a):await DV(a,e.onProgress,u,c)}async function aMe(t,e="",n,r){return AY(s=>PY(s,{requestInit:r}))(t,e,n)}function AY(t){return async(e,n="",r)=>{const i=e.map(()=>!1),o={},s=r!=null?r.map(()=>!1):[],a=[];if(e.forEach((h,p)=>{let m=0;h.weights.forEach(v=>{const g="quantization"in v?v.quantization.dtype:v.dtype,y=nR[g]*_e(v.shape),b=()=>{i[p]=!0,o[p]==null&&(o[p]=[]),o[p].push({manifestEntry:v,groupOffset:m,sizeBytes:y})};r!=null?r.forEach((x,S)=>{x===v.name&&(b(),s[S]=!0)}):b(),a.push(v.name),m+=y})}),!s.every(h=>h)){const h=r.filter((p,m)=>!s[m]);throw new Error(`Could not find weights in manifest with names: ${h.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const u=i.reduce((h,p,m)=>(p&&h.push(m),h),[]),c=[];u.forEach(h=>{e[h].paths.forEach(p=>{const m=n+(n.endsWith("/")?"":"/")+p;c.push(m)})});const l=await t(c),d={};let f=0;return u.forEach(h=>{const p=e[h].paths.length,m=new ma(l.slice(f,f+p));o[h].forEach(g=>{const y=m.slice(g.groupOffset,g.groupOffset+g.sizeBytes),b=Q9(y,[g.manifestEntry]);for(const x in b)d[x]=b[x]}),f+=p}),d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uMe="application/octet-stream",cMe="application/json";class QF{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(L(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ae().platform.fetch,L(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&L(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=Z9(e,r);if(n.body.append("model.json",new Blob([JSON.stringify(i)],{type:cMe}),"model.json"),e.weightData!=null){const s=ma.join(e.weightData);n.body.append("model.weights.bin",new Blob([s],{type:uMe}),"model.weights.bin")}const o=await this.fetch(this.path,n);if(o.ok)return{modelArtifactsInfo:Z0(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let s=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?s+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":s+=" Please make sure the server is serving valid JSON for this request.",new Error(s)}const r=n.modelTopology,i=n.weightsManifest;if(r==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return HO(n,o=>this.loadWeights(o))}async loadWeights(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[r,i]=lMe(n),o=this.weightPathPrefix||r,s=tX(e),a=[],u=[];for(const l of e)for(const d of l.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):a.push(o+d+i);this.weightUrlConverter&&a.push(...await Promise.all(u));const c=await PY(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[s,c]}}QF.URL_SCHEME_REGEX=/^https?:\/\//;function lMe(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}function cR(t){return t.match(QF.URL_SCHEME_REGEX)!=null}const $Y=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(r=>cR(r)):n=cR(t),n)return ZF(t,e)}return null};En.registerSaveRouter($Y);En.registerLoadRouter($Y);function ZF(t,e){return new QF(t,e)}function dMe(t,e){return ZF(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tE{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class DY{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class fMe{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function hMe(t,e,n,r){const i=arguments;return new fMe(OY(...i))}function OY(t,e,n,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new tE(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new tE({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new tE({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))}function pMe(t){return new DY(t)}function mMe(t){return new DY(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e3=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:ma,browserFiles:sMe,browserHTTPRequest:dMe,concatenateArrayBuffers:iAe,copyModel:EAe,decodeWeights:Q9,encodeWeights:eAe,fromMemory:hMe,fromMemorySync:OY,getLoadHandlers:fAe,getModelArtifactsForJSON:HO,getModelArtifactsForJSONSync:eX,getModelArtifactsInfoForJSON:Z0,getSaveHandlers:dAe,getWeightSpecs:tX,http:ZF,isHTTPScheme:cR,listModels:kAe,loadWeights:aMe,moveModel:_Ae,registerLoadRouter:lAe,registerSaveRouter:cAe,removeModel:TAe,weightsLoaderFactory:AY,withSaveHandler:pMe,withSaveHandlerSync:mMe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gMe(t,e,n){const r=O(t,"labels","confusionMatrix"),i=O(e,"predictions","confusionMatrix");L(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),L(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),L(i.rank===1,()=>`Expected the rank of predictions to be 1, but got ${i.rank}`),L(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),L(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const o=a0(Dt(r,"int32"),n),s=a0(Dt(i,"int32"),n),a=c0(o),u=Lt(a,s);return Dt(u,"int32")}const vMe=K({confusionMatrix_:gMe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yMe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:vMe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let jd,OV=!1;function FY(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,o=!1,s=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)o=!0;else if(t.getContext!=null)s=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(Yy(yS,X.backendName)!=null){const p={pixels:t},m={numChannels:e};return X.runKernel(yS,p,m)}const[c,l]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let d;if(s)d=t.getContext("2d").getImageData(0,0,c,l).data;else if(r||n)d=t.data;else if(o||i||a){if(jd==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")jd=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else jd=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});jd.canvas.width=c,jd.canvas.height=l,jd.drawImage(t,0,0,c,l),d=jd.getImageData(0,0,c,l).data}let f;if(e===4)f=new Int32Array(d);else{const p=c*l;f=new Int32Array(p*e);for(let m=0;m<p;m++)for(let v=0;v<e;++v)f[m*e+v]=d[m*4+v]}return LF(f,[l,c,e],"int32")}function bMe(t){return t!=null&&t.data instanceof Uint8Array}function xMe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function wMe(t){return t!=null&&t.width!==0&&t.height!==0}function SMe(t){return xMe()&&!(t instanceof ImageBitmap)&&wMe(t)&&!bMe(t)}async function CMe(t,e=3){let n=null;if(ae().getBool("WRAP_TO_IMAGEBITMAP")&&SMe(t)){let r;try{r=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===t.width&&r.height===t.height?n=r:n=t}else n=t;return FY(n,e)}function LY(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}function kMe(t){const e=(t==null?void 0:t.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function cb(t,e){let n=O(t,"img","toPixels");if(!(t instanceof Mt)){const c=n;n=Dt(c,"int32"),c.dispose()}LY(n);const[r,i]=n.shape.slice(0,2),o=n.rank===2?1:n.shape[2],s=await n.data(),a=n.dtype==="float32"?255:1,u=new Uint8ClampedArray(i*r*4);for(let c=0;c<r*i;++c){const l=[0,0,0,255];for(let f=0;f<o;f++){const h=s[c*o+f];if(n.dtype==="float32"){if(h<0||h>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${h}.`)}else if(n.dtype==="int32"&&(h<0||h>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${h}.`);o===1?(l[0]=h*a,l[1]=h*a,l[2]=h*a):l[f]=h*a}const d=c*4;u[d+0]=Math.round(l[0]),u[d+1]=Math.round(l[1]),u[d+2]=Math.round(l[2]),u[d+3]=Math.round(l[3])}if(e!=null){OV||Yy(F$,X.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),OV=!0),e.width=i,e.height=r;const c=e.getContext("2d"),l=new ImageData(u,i,r);c.putImageData(l,0,0)}return n!==t&&n.dispose(),u}function TMe(t,e,n){let r=O(t,"img","draw");if(!(t instanceof Mt)){const s=r;r=Dt(s,"int32"),s.dispose()}LY(r),kMe(n==null?void 0:n.imageOptions);const i={image:r},o={canvas:e,options:n};X.runKernel(F$,i,o)}const _2=K({fromPixels_:FY}),EMe=Object.freeze(Object.defineProperty({__proto__:null,draw:TMe,fromPixels:_2,fromPixelsAsync:CMe,toPixels:cb},Symbol.toStringTag,{value:"Module"}));function t3(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(_e(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,o=i[i.length-1];let s=1;for(let d=0;d<i.length-1;++d)s*=i[d];const a=t.shape,u=i.slice();u.pop();let c=1;for(let d=o;d<n;++d)c*=a[d],u.push(a[d]);const l=[...dr(t.shape).map(d=>d/c),1].slice(0,o);return[u,s,c,l]}const _Me=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:t3},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lR=-2,IMe=-1;function MY(t,e,n){const r=t.shape.length;L(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),L(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)L(e[i]+n[i]<=t.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`)}function RMe(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function BY(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function UY(t,e,n,r){const i=[...t];for(let o=i.length;o<r.length;o++)i.push(1);for(let o=0;o<n;o++)o===0?i[e]=1:(i.splice(e,0,1),i.pop());return i}function VY(t,e,n){return n<=t?n:n-(e-1)}function zY(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function NMe(t,e,n,r,i,o,s,a,u){const c=t.length;let l=new Array(c),d=new Array(c),f=new Array(c);if(e.length&&n>0){const h=e[0],p=n+1;l=WY(s,h,p,r,t),d=jY(a,h,p,i,t),f=UY(o,h,p,t)}else for(let h=0;h<c;h++)l[h]=HY(s,r,o,t,h,u),d[h]=qY(a,i,o,t,h,u),f[h]=GY(o,h,u);return{begin:l,end:d,strides:f}}function WY(t,e,n,r,i){const o=[...i],s=zY(n,e);for(let a=0;a<o.length;a++)if(s.indexOf(a)>-1)o[a]=0;else{const u=VY(e,n,a);let c=r[u];t&1<<u&&(c=0),o[a]=c}return o}function jY(t,e,n,r,i){const o=[...i],s=zY(n,e);for(let a=0;a<o.length;a++)if(s.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const u=VY(e,n,a);let c=r[u];t&1<<u&&(c=Number.MAX_SAFE_INTEGER),o[a]=c}for(let a=0;a<o.length;a++){const u=i[a];o[a]<0&&(o[a]+=u),o[a]=Ky(0,o[a],i[a])}return o}function GY(t,e,n){let r=t[e];return(n&1<<e||r==null)&&(r=1),r}function HY(t,e,n,r,i,o){let s=e[i];const a=n[i]||1;(t&1<<i||o&1<<i||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);const u=r[i];return s<0&&(s+=u),s=Ky(0,s,u-1),s}function qY(t,e,n,r,i,o){let s=e[i];const a=n[i]||1;(t&1<<i||o&1<<i||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);const u=r[i];return s<0&&(s+=u),a>0?s=Ky(0,s,u):s=Ky(-1,s,u-1),s}function n3(t,e,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function r3(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function KY(t,e,n){let r;const i=t.shape.length;typeof e=="number"?r=[e,...new Array(i-1).fill(0)]:e.length<i?r=e.concat(new Array(i-e.length).fill(0)):r=e.slice(),r.forEach(s=>{L(s!==-1,()=>"slice() does not support negative begin indexing.")});let o;return n==null?o=new Array(i).fill(-1):typeof n=="number"?o=[n,...new Array(i-1).fill(-1)]:n.length<i?o=n.concat(new Array(i-n.length).fill(-1)):o=n,o=o.map((s,a)=>s>=0?s:(L(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,o]}function XY(t,e,n,r,i,o,s,a,u){let c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,s!=null&&s&s-1)throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:o,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:u};for(let b=0;b<d.dims;b++)l&&1<<b&a&&d.numAddAxisAfterEllipsis++,1<<b&s&&(l=!0);l||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};PMe(d,f);let h=!0,p=!0,m=!0;const v=[],g=[];for(let b=0;b<t.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const x=!!(f.shrinkAxisMask&1<<b),S=t[b];if(S===-1){v.push(x?1:-1);continue}const C=[f.beginMask&1<<b,f.endMask&1<<b],T=[f.strides[b]>0?0:-1,f.strides[b]>0?S:S-1];if(x&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&f.strides[b]===1;const E=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(x){const F=f.begin[b]<0?S+f.begin[b]:f.begin[b];if(f.begin[b]=F,f.end[b]=f.begin[b]+1,F<0||F>=S)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=FV(f.begin[b],0,f.strides[b],S,C,T),f.end[b]=FV(f.end[b],1,f.strides[b],S,C,T);const $=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===S;h=h&&$,p=p&&(b===0&&f.strides[b]===1||$)}else h=h&&f.strides[b]===1&&E,p=p&&(b===0&&f.strides[b]===1||E);let I,N=!1;if(f.beginValid&&f.endValid?(I=f.end[b]-f.begin[b],N=!0):x?(I=1,N=!0):E&&S>=0&&(f.strides[b]<0?I=-S:I=S,N=!0),N){let $;I===0||I<0!=f.strides[b]<0?$=0:$=Math.trunc(I/f.strides[b])+(I%f.strides[b]!==0?1:0),v.push($)}else v.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){const x=f.finalShapeGatherIndices[b];x>=0?g.push(v[x]):x===lR&&g.push(1)}return{finalShapeSparse:g.filter((b,x)=>f.finalShapeGatherIndices[x]!==lR),finalShape:g,isIdentity:h,sliceDim0:p,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function PMe(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(lR),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[r]),t.end!=null&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(IMe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}function FV(t,e,n,r,i,o){if(i[e])return n>0?o[e]:o[e+1&1];{const s=t<0?r+t:t;return s<o[0]?o[0]:s>o[1]?o[1]:s}}const JY=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:MY,computeFlatOffset:r3,computeOutShape:BY,getNormalizedAxes:NMe,isSliceContinous:n3,maskToAxes:RMe,parseSliceParams:KY,sliceInfo:XY,startForAxis:HY,startIndicesWithElidedDims:WY,stopForAxis:qY,stopIndicesWithElidedDims:jY,stridesForAxis:GY,stridesWithElidedDims:UY},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const AMe="4.9.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YY{static sgd(e){return new E2(e)}static momentum(e,n,r=!1){return new JF(e,n,r)}static rmsprop(e,n=.9,r=0,i=null,o=!1){return new YF(e,n,r,i,o)}static adam(e=.001,n=.9,r=.999,i=null){return new KF(e,n,r,i)}static adadelta(e=.001,n=.95,r=null){return new HF(e,n,r)}static adamax(e=.002,n=.9,r=.999,i=null,o=0){return new XF(e,n,r,i,o)}static adagrad(e,n=.1){return new qF(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Me=YY;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DMe=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t())();function QY(){return new Promise(t=>DMe(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(t,e){const n=t[0].length;t.forEach((i,o)=>{L(i.length===n,()=>`Error in concat${n}D: rank of tensors[${o}] must be the same as the rank of the rest (${n})`)}),L(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=t[0];t.forEach((i,o)=>{for(let s=0;s<n;s++)L(s===e||i[s]===r[s],()=>`Error in concat${n}D: Shape of tensors[${o}] (${i}) does not match the shape of the rest (${r}) along the non-concatenated axis ${o}.`)})}function Zf(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gs;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Gs||(Gs={}));function eQ(t,e,n){let r=new Array;if(n==null&&e==null)return r;if(e==null)for(;r.length<t+n.length;)r.push(-1);else r=e.slice();if(n==null)return r;if(t+n.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const o=n[i],s=r[r.length-n.length+i],a=r[s];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${o} but shape[${i+t}] = ${a}`)}else r[s]=o}return r}function tQ(t){const e={FIRST_DIM_SIZE:Gs.FIRST_DIM_SIZE,VALUE_ROWIDS:Gs.VALUE_ROWIDS,ROW_LENGTHS:Gs.ROW_LENGTHS,ROW_SPLITS:Gs.ROW_SPLITS,ROW_LIMITS:Gs.ROW_LIMITS,ROW_STARTS:Gs.ROW_STARTS},n=[];for(const r of t)if(r in e)n.push(e[r]);else break;return n}function nQ(t){return t.length===0?0:t[0]===Gs.FIRST_DIM_SIZE?t.length-1:t.length}function rQ(t,e){if(t==null||e==null)return;const n=t.length,r=e.length;if(n>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const o=t[i],s=e[i+1];if(o>=0&&s>=0&&o!==1&&o!==s)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${o} but ragged tensor input.flatValues.shape[${i-t.length}] = ${s}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i3=30;function I2(t){return t<=i3?t:gS(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(t,e,n){const r=n*(typeof t=="number"?t:t[0]),i=e*(typeof t=="number"?t:t[1]);return[r,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const o=e.length;for(let s=0;s<o;++s)i=i.concat([t[s+1]/e[s],e[s]]);i=i.concat(t.slice(o+1))}return i}function s3(t,e,n=!0){const r=[];if(n){r.push(e);for(let i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{const i=[],o=[];for(let s=1;s<t;++s)s>=e*2+1||s%2===1?o.push(s):i.push(s);r.push(...i),r.push(0),r.push(...o)}return r}function a3(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function oQ(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function sQ(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ=1.7580993408473768,uQ=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cQ=.3275911,lQ=.254829592,dQ=-.284496736,fQ=1.421413741,hQ=-1.453152027,pQ=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dR(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function OMe(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function FMe(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function LMe(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function MMe(t,e){const n=t[e*2],r=t[e*2+1];return{real:n,imag:r}}function BMe(t,e,n,r){t[r*2]=e,t[r*2+1]=n}function UMe(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const o=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:n,imag:r}}function VMe(t,e,n){const r=(n?2:-2)*Math.PI*(t/e),i=Math.cos(r),o=Math.sin(r);return{real:i,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nE="->",zMe=/->/g,LV=",",MV="...";function mQ(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(zMe,"").length)/nE.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${nE}").`);const[r,i]=t.split(nE);L(r.indexOf(MV)===-1,()=>`The ellipsis notation ("${MV}") is not supported yet.`);const o=r.split(LV),s=o.length;if(e!==s)throw new Error(`Expected ${s} input tensors, received ${e}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<i.length;++f){const h=i[f];if(!o.some(p=>p.indexOf(h)!==-1))throw new Error(`Output subscripts contain the label ${h} not present in the input subscripts.`);a.indexOf(h)===-1&&a.push(h)}for(let f=0;f<r.length;++f){const h=r[f];a.indexOf(h)===-1&&h!==LV&&a.push(h)}const u=new Array(o.length);for(let f=0;f<s;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);u[f]=[];for(let h=0;h<o[f].length;++h)u[f].push(a.indexOf(o[f][h]))}const c=a.length,l=i.length,d=[];for(let f=l;f<c;++f)d.push(f);return{allDims:a,summedDims:d,idDims:u}}function gQ(t,e){let n=new Array(t);n.fill(-1);for(let i=0;i<e.length;++i)n[e[i]]=i;const r=[];for(let i=0;i<t;++i)n[i]===-1&&r.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:r}}function vQ(t,e,n){const r=new Array(t);for(let i=0;i<n.length;++i){const o=n[i].shape;for(let s=0;s<e[i].length;++s)r[e[i][s]]===void 0?r[e[i][s]]=o[s]:L(r[e[i][s]]===o[s],()=>`Expected dimension ${r[e[i][s]]} at axis ${s} of input shaped ${JSON.stringify(o)}, but got dimension ${o[s]}`)}}function yQ(t,e){const n=t,r=[];let i=0;t.length===0&&n.push(-1),i=t.length+1;for(let s=0;s<i;++s)r.push([]);const o=[];for(let s=0;s<n.length;++s){const a=n[s],u=WMe(e,a);for(const c of u)o.indexOf(c)===-1&&(r[s].push(c),o.push(c))}return{path:n,steps:r}}function bQ(t){return t.every((e,n)=>e===n)}function WMe(t,e){const n=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(e)!==-1||e===-1)&&n.push(r);return n}function xQ(t,e,n=0){let r=[];if(typeof e=="number")L(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce((s,a)=>(a===-1&&(s+=1),s),0);L(i<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const s=e.reduce((a,u)=>u>0?a+u:a);e[o]=t.shape[n]-s}L(t.shape[n]===e.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function SQ(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function CQ(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function TQ(t,e){return`size ${t} must be non-negative, not ${e}`}function EQ(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function _Q(t,e){const n=_e(t),r=_e(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${t} outputShape= ${e}`}function IQ(t,e){const n=_e(t),r=_e(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(){return"segment ids must be >= 0"}function RQ(){return"segment ids are not increasing"}function NQ(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function PQ(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(t,e){let n=!1,r;for(t<=i3?(r=t,n=!0):r=gS(t,Math.floor(Math.sqrt(t)));!n;)r>e||r===t?n=!0:r=gS(t,r+1);return r}function $Q(t,e,n){const r=[],i=t.length;for(let o=0;o<i;o++)o!==e?r.push(t[o]):r.push(n);return r}function DQ(t,e,n,r){const i=e.shape.length,o=t.shape.length;if(r!==0&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let d=0;d<r;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const s=t.shape[n],a=[];let u=1,c=1,l=1;for(let d=0;d<r;++d)a.push(t.shape[d]),u*=t.shape[d];for(let d=r;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=r;d<i;d++)a.push(e.shape[d]);for(let d=n+1;d<o;d++)a.push(t.shape[d]),l*=t.shape[d];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:s,outputShape:a}}const jMe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:DQ,computeOutShape:$Q,segOpComputeOptimalWindowSize:AQ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(t){try{return t.map(e=>Hf(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function OQ(t){return t.map(e=>_c(e))}const FQ=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:lQ,ERF_A2:dQ,ERF_A3:fQ,ERF_A4:hQ,ERF_A5:pQ,ERF_P:cQ,PARALLELIZE_THRESHOLD:i3,get RowPartitionType(){return Gs},SELU_SCALE:uQ,SELU_SCALEALPHA:aQ,applyActivation:k2,assertAndGetBroadcastShape:Pt,assertAxesAreInnerMostDims:ga,assertParamsConsistent:ZY,assignToTypedArray:BMe,axesAreInnerMostDims:nF,calculateShapes:ub,checkEinsumDimSizes:vQ,checkPadOnDimRoundingMode:Rs,combineLocations:eJ,combineRaggedTensorToTensorShapes:eQ,complexWithEvenIndex:FMe,complexWithOddIndex:LMe,computeConv2DInfo:Go,computeConv3DInfo:tb,computeDefaultPad:JO,computeDilation2DInfo:CX,computeOptimalWindowSize:I2,computeOutAndReduceShapes:Cu,computeOutShape:Zf,computePool2DInfo:Ch,computePool3DInfo:eb,convertConv2DDataFormat:og,decodeEinsumEquation:mQ,eitherStridesOrDilationsAreOne:bo,expandShapeToKeepDim:Ho,exponent:VMe,exponents:UMe,fromStringArrayToUint8:OQ,fromUint8ToStringArray:Bm,getAxesPermutation:Ns,getBroadcastDims:r0,getComplexWithIndex:MMe,getEinsumComputePath:yQ,getEinsumPermutation:gQ,getFusedBiasGradient:C2,getFusedDyActivation:S2,getImageCenter:iQ,getInnerMostAxes:Ps,getPermuted:s3,getRaggedRank:nQ,getReductionAxes:eF,getReshaped:o3,getReshapedPermuted:a3,getRowPartitionTypesHelper:tQ,getSliceBeginCoords:oQ,getSliceSize:sQ,getSparseFillEmptyRowsIndicesDenseShapeMismatch:wQ,getSparseFillEmptyRowsNegativeIndexErrorMessage:SQ,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:CQ,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:EQ,getSparseReshapeInputOutputMismatchErrorMessage:IQ,getSparseReshapeInputOutputMultipleErrorMessage:_Q,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:kQ,getSparseReshapeNegativeOutputDimErrorMessage:TQ,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:PQ,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:fR,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:RQ,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:NQ,getUndoAxesPermutation:rF,isIdentityPermutation:bQ,log:bPe,mergeRealAndImagArrays:dR,prepareAndValidate:t3,prepareSplitSize:xQ,segment_util:jMe,shouldFuse:T2,slice_util:JY,splitRealAndImagArrays:OMe,stridesOrDilationsArePositive:Jf,tupleValuesAreOne:n0,upcastType:la,validateDefaultValueShape:rQ,validateInput:x2,validateUpdateShape:MF,warn:ls},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GMe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:zF,nonMaxSuppressionV4Impl:WF,nonMaxSuppressionV5Impl:jF,whereImpl:BF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ZLe();const LQ=Object.freeze(Object.defineProperty({__proto__:null,Abs:KA,Acos:XA,Acosh:JA,AdadeltaOptimizer:HF,AdagradOptimizer:qF,AdamOptimizer:KF,AdamaxOptimizer:XF,Add:u2,AddN:YA,All:QA,Any:ZA,ArgMax:e$,ArgMin:t$,Asin:n$,Asinh:r$,Atan:i$,Atan2:s$,Atanh:o$,AvgPool:a$,AvgPool3D:u$,AvgPool3DGrad:E9,AvgPoolGrad:T9,BatchMatMul:c$,BatchToSpaceND:l$,Bincount:d$,BitwiseAnd:f$,BroadcastArgs:h$,BroadcastTo:lPe,Cast:c2,Ceil:p$,ClipByValue:m$,Complex:g$,ComplexAbs:v$,Concat:y$,Conv2D:b$,Conv2DBackpropFilter:x$,Conv2DBackpropInput:w$,Conv3D:S$,Conv3DBackpropFilterV2:_9,Conv3DBackpropInputV2:C$,Cos:k$,Cosh:T$,CropAndResize:I$,Cumprod:E$,Cumsum:_$,DataStorage:d9,DenseBincount:R$,DepthToSpace:N$,DepthwiseConv2dNative:P$,DepthwiseConv2dNativeBackpropFilter:A$,DepthwiseConv2dNativeBackpropInput:$$,Diag:D$,Dilation2D:O$,Dilation2DBackpropFilter:fPe,Dilation2DBackpropInput:dPe,Draw:F$,get ENV(){return HA},Einsum:M$,Elu:B$,EluGrad:I9,Environment:C9,Equal:V$,Erf:U$,Exp:z$,ExpandDims:W$,Expm1:j$,FFT:G$,Fill:H$,FlipLeftRight:q$,Floor:K$,FloorDiv:X$,FromPixels:yS,FusedBatchNorm:J$,FusedConv2D:xS,FusedDepthwiseConv2D:wS,GatherNd:Q$,GatherV2:Y$,Greater:Z$,GreaterEqual:eD,IFFT:tD,Identity:l2,Imag:nD,IsFinite:rD,IsInf:iD,IsNan:oD,KernelBackend:jA,LRN:mD,LRNGrad:R9,LeakyRelu:sD,Less:aD,LessEqual:uD,LinSpace:cD,Log:lD,Log1p:dD,LogSoftmax:pPe,LogicalAnd:fD,LogicalNot:hD,LogicalOr:pD,LogicalXor:hPe,LowerBound:mPe,MatrixBandPart:gPe,Max:gD,MaxPool:yD,MaxPool3D:bD,MaxPool3DGrad:P9,MaxPoolGrad:N9,MaxPoolWithArgmax:xD,Maximum:vD,Mean:wD,Min:SD,Minimum:CD,MirrorPad:kD,Mod:TD,MomentumOptimizer:JF,Multinomial:ED,Multiply:_D,Neg:ID,NonMaxSuppressionV3:ND,NonMaxSuppressionV4:PD,NonMaxSuppressionV5:AD,NotEqual:RD,OP_SCOPE_SUFFIX:jO,OneHot:DD,OnesLike:$D,Optimizer:Rd,OptimizerConstructors:YY,Pack:OD,PadV2:FD,Pool:vPe,Pow:LD,Prelu:MD,Prod:BD,RMSPropOptimizer:YF,RaggedGather:UD,RaggedRange:VD,RaggedTensorToTensor:zD,Range:WD,get Rank(){return JI},Real:jD,RealDiv:L$,Reciprocal:GD,get Reduction(){return di},Relu:HD,Relu6:JD,Reshape:qD,ResizeBilinear:XD,ResizeBilinearGrad:$9,ResizeNearestNeighbor:KD,ResizeNearestNeighborGrad:A9,Reverse:YD,RotateWithOffset:LO,Round:QD,Rsqrt:ZD,SGDOptimizer:E2,ScatterNd:eO,SearchSorted:nO,Select:rO,Selu:iO,Sigmoid:cO,Sign:uO,Sin:sO,Sinh:aO,Slice:oO,Softmax:mO,Softplus:lO,SpaceToBatchND:hO,SparseFillEmptyRows:gO,SparseReshape:vO,SparseSegmentMean:yO,SparseSegmentSum:bO,SparseToDense:xO,SplitV:pO,Sqrt:dO,Square:D9,SquaredDifference:wO,StaticRegexReplace:SO,Step:FO,StridedSlice:CO,StringNGrams:kO,StringSplit:TO,StringToHashBucketFast:EO,Sub:_O,Sum:fO,Tan:IO,Tanh:RO,Tensor:Mt,TensorBuffer:qf,TensorScatterUpdate:tO,Tile:d2,TopK:NO,Transform:PO,Transpose:ty,Unique:AO,Unpack:$O,UnsortedSegmentSum:DO,UpperBound:yPe,Variable:Qy,ZerosLike:OO,_FusedMatMul:bS,abs:qi,acos:fX,acosh:hX,add:it,addN:pX,all:mX,any:gX,argMax:XO,argMin:vX,asin:yX,asinh:bX,atan:xX,atan2:wX,atanh:SX,avgPool:YO,avgPool3d:kX,backend:dX,backend_util:FQ,basicLSTMCell:TX,batchNorm:nb,batchNorm2d:EX,batchNorm3d:_X,batchNorm4d:IX,batchToSpaceND:QO,bincount:ZO,bitwiseAnd:RX,booleanMaskAsync:hY,broadcastArgs:NX,broadcastTo:cm,broadcast_util:rDe,browser:EMe,buffer:Tn,cast:Dt,ceil:PX,clipByValue:AX,clone:Ic,complex:jc,concat:Vr,concat1d:$X,concat2d:DX,concat3d:OX,concat4d:FX,conv1d:LX,conv2d:rb,conv2dTranspose:BX,conv3d:UX,conv3dTranspose:VX,copyRegisteredKernels:CPe,cos:zX,cosh:WX,cosineWindow:w2,cumprod:jX,cumsum:GX,customGrad:pu,denseBincount:HX,deprecationWarn:LAe,depthToSpace:qX,depthwiseConv2d:h2,device_util:YPe,diag:KX,dilation2d:XX,disableDeprecationWarnings:FAe,dispose:mi,disposeVariables:MAe,div:rn,divNoNan:JX,dot:YX,dropout:yY,einsum:of,elu:tF,enableDebugMode:OAe,enableProdMode:DAe,enclosingPowerOfTwo:VF,engine:Bs,ensureShape:QX,env:ae,equal:ib,erf:ZX,euclideanNorm:nJ,exp:hd,expandDims:_i,expm1:rJ,eye:iF,fft:y2,fill:sg,findBackend:GAe,findBackendFactory:HAe,floor:oF,floorDiv:KO,fused:xY,gather:sF,gatherND:vY,gather_util:_Me,getBackend:cX,getGradient:qI,getKernel:Yy,getKernelsForBackend:SS,grad:UDe,grads:VDe,greater:ag,greaterEqual:aF,ifft:u0,imag:sb,image:Yf,inTopKAsync:bY,io:e3,irfft:DF,isFinite:iJ,isInf:oJ,isNaN:sJ,keep:na,kernel_impls:GMe,leakyRelu:uF,less:_S,lessEqual:p2,linalg:TY,linspace:aJ,localResponseNormalization:uJ,log:Fm,log1p:cF,logSigmoid:lJ,logSoftmax:dJ,logSumExp:dF,logicalAnd:i0,logicalNot:fF,logicalOr:hF,logicalXor:fJ,losses:EY,lowerBound:hJ,matMul:Lt,math:yMe,max:Pf,maxPool:pF,maxPool3d:pJ,maxPoolWithArgmax:mJ,maximum:mF,mean:o0,memory:BAe,meshgrid:gJ,min:ES,minimum:s0,mirrorPad:gF,mod:vJ,moments:yJ,movingAverage:pY,mul:Pe,multiRNNCell:bJ,multinomial:xJ,neg:sa,nextFrame:QY,norm:ob,notEqual:vF,oneHot:a0,ones:Bl,onesLike:wJ,op:K,outerProduct:SJ,pad:kh,pad1d:CJ,pad2d:kJ,pad3d:yF,pad4d:TJ,pool:EJ,pow:Om,prelu:xF,print:qO,prod:_J,profile:UAe,raggedGather:IJ,raggedRange:RJ,raggedTensorToTensor:NJ,rand:PJ,randomGamma:OJ,randomNormal:PF,randomStandardNormal:FJ,randomUniform:v2,randomUniformInt:LJ,range:md,ready:WAe,real:Lm,reciprocal:MJ,registerBackend:lX,registerGradient:xPe,registerKernel:MO,relu:ab,relu6:AF,removeBackend:jAe,reshape:ve,reverse:gd,reverse1d:BJ,reverse2d:UJ,reverse3d:VJ,reverse4d:zJ,rfft:b2,round:$F,rsqrt:WJ,scalar:vt,scatterND:mY,scatter_util:WFe,searchSorted:g2,selu:jJ,separableConv2d:GJ,serialization:YLe,setBackend:zAe,setPlatform:qAe,setdiff1dAsync:HJ,sigmoid:uu,sign:qJ,signal:kY,sin:KJ,sinh:XJ,slice:Jt,slice1d:JJ,slice2d:YJ,slice3d:QJ,slice4d:ZJ,slice_util:JY,softmax:eY,softplus:lF,spaceToBatchND:bF,sparse:_Y,sparseToDense:gY,spectral:CY,split:Mm,sqrt:hu,square:Ts,squaredDifference:OF,squeeze:xs,stack:mu,step:FF,stridedSlice:tY,string:IY,sub:gt,sum:cn,sumOutType:f2,tan:nY,tanh:TS,tensor:ks,tensor1d:Ao,tensor2d:Af,tensor3d:LF,tensor4d:rY,tensor5d:iY,tensor6d:oY,tensorScatterUpdate:sY,tensor_util:HPe,test_util:nFe,tidy:ot,tile:lm,time:VAe,topk:aY,train:$Me,transpose:c0,truncatedNormal:uY,unique:cY,unregisterGradient:SPe,unregisterKernel:wPe,unsortedSegmentSum:lY,unstack:Id,upcastType:la,upperBound:dY,util:APe,valueAndGrad:zDe,valueAndGrads:WDe,variable:fY,variableGrads:cJ,version_core:AMe,where:Rc,whereAsync:UF,zeros:pd,zerosLike:co},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HMe=ae();HMe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var ns;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(ns||(ns={}));var BV;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(BV||(BV={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qMe={};function MQ(t){return qMe[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _(t,e,n,r,i){const o=e.inputParams[t];if(o&&o.inputIndexStart!==void 0){const a=o.inputIndexStart,u=o.inputIndexEnd===0?void 0:o.inputIndexEnd===void 0?a+1:o.inputIndexEnd,c=a<0?e.inputNames.length+a:a;if(o.type==="tensor")return xr(e.inputNames[c],n,r,i);if(o.type==="tensors"){const f=e.inputs.slice(a,u);return e.inputNames.slice(a,u).filter((p,m)=>{var v;return((v=f[m])===null||v===void 0?void 0:v.op)!=="NoOp"}).map(p=>xr(p,n,r,i))}const l=xr(e.inputNames[c],n,r,i),d=l.dataSync();return o.type==="number"?d[0]:Nf(l.shape,d)}const s=e.attrParams[t];return s&&s.value}function xr(t,e,n,r){const[i,o]=Gi(t,n);if(r!=null){const a=r.getHashTableHandleByName(i);if(a!=null)return a}const s=n.currentContextIds.find(a=>!!e[IS(i,a)]);return s!==void 0?e[IS(i,s)][o]:void 0}function UV(t,e,n){return e[IS(t,n.currentContextId)]}function Lu(t,e){const[n,r,i]=Gi(t,e);return[IS(n,e&&e.currentContextId),r,i]}function IS(t,e){return e?`${t}-${e}`:t}function Gi(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const o=e.parseNodeNameCache.get(t);if(o!=null)return o}const r=t.split(":");let i;if(r.length===1)i=[t,0,void 0];else{const o=r[0],s=r.length===3?r[1]:void 0,a=Number(r[r.length-1]);i=[o,a,s]}return n&&e.parseNodeNameCache.set(t,i),i}function Hx(t,e,n){let r=_("pad",t,e,n);if(r==="explicit"){r=_("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let o=0;o<4;o++)i[o][0]=r[o*2],i[o][1]=r[o*2+1];return i}return r}function Mu(t){return t.kept?t:Ic(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KMe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],XMe=Object.freeze(Object.defineProperty({__proto__:null,json:KMe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JMe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],YMe=Object.freeze(Object.defineProperty({__proto__:null,json:JMe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QMe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],ZMe=Object.freeze(Object.defineProperty({__proto__:null,json:QMe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e4e=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],t4e=Object.freeze(Object.defineProperty({__proto__:null,json:e4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n4e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],r4e=Object.freeze(Object.defineProperty({__proto__:null,json:n4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i4e=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],o4e=Object.freeze(Object.defineProperty({__proto__:null,json:i4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s4e=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],a4e=Object.freeze(Object.defineProperty({__proto__:null,json:s4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u4e=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],c4e=Object.freeze(Object.defineProperty({__proto__:null,json:u4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l4e=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],d4e=Object.freeze(Object.defineProperty({__proto__:null,json:l4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f4e=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],h4e=Object.freeze(Object.defineProperty({__proto__:null,json:f4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p4e=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],m4e=Object.freeze(Object.defineProperty({__proto__:null,json:p4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g4e=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],v4e=Object.freeze(Object.defineProperty({__proto__:null,json:g4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y4e=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],b4e=Object.freeze(Object.defineProperty({__proto__:null,json:y4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x4e=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],w4e=Object.freeze(Object.defineProperty({__proto__:null,json:x4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S4e=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],C4e=Object.freeze(Object.defineProperty({__proto__:null,json:S4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4e=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],T4e=Object.freeze(Object.defineProperty({__proto__:null,json:k4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E4e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],_4e=Object.freeze(Object.defineProperty({__proto__:null,json:E4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I4e=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],R4e=Object.freeze(Object.defineProperty({__proto__:null,json:I4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N4e=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],P4e=Object.freeze(Object.defineProperty({__proto__:null,json:N4e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VV{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[XMe,YMe,ZMe,t4e,r4e,o4e,a4e,c4e,d4e,h4e,m4e,v4e,b4e,w4e,C4e,T4e,_4e,R4e,P4e],n=[].concat(...e.map(r=>r.json));this.opMappers=n.reduce((r,i)=>(r[i.tfOpName]=i,r),{})}transformGraph(e,n={}){const r=e.node,i=[],o=[],s=[],a=r.reduce((m,v)=>(m[v.name]=this.mapNode(v),v.op.startsWith("Placeholder")?i.push(m[v.name]):v.op==="Const"?o.push(m[v.name]):(v.input==null||v.input.length===0)&&s.push(m[v.name]),m),{});let u=[];const c=[];let l={},d={};n!=null&&(l=this.mapSignatureEntries(n.inputs),d=this.mapSignatureEntries(n.outputs));const f=Object.keys(a);f.forEach(m=>{const v=a[m];v.inputNames.forEach((g,y)=>{const[b,,x]=Lu(g),S=a[b];if(S.outputs!=null){const C=S.outputs.indexOf(x);if(C!==-1){const T=`${b}:${C}`;v.inputNames[y]=T}}v.inputs.push(S),S.children.push(v)})}),Object.keys(d).length===0?f.forEach(m=>{const v=a[m];v.children.length===0&&c.push(v)}):Object.keys(d).forEach(m=>{const[v]=Lu(m),g=a[v];g!=null&&(g.signatureKey=d[m],c.push(g))}),Object.keys(l).length>0?Object.keys(l).forEach(m=>{const[v]=Lu(m),g=a[v];g&&(g.signatureKey=l[m],u.push(g))}):u=i;let h={};e.library!=null&&e.library.function!=null&&(h=e.library.function.reduce((m,v)=>(m[v.signature.name]=this.mapFunction(v),m),{}));const p={nodes:a,inputs:u,outputs:c,weights:o,placeholders:i,signature:n,functions:h};return s.length>0&&(p.initNodes=s),p}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,r)=>(n[e[r].name]=r,n),{})}mapNode(e){const n=MQ(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const r={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(i=>i.startsWith("^")?i.slice(1):i),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(r.inputParams=n.inputs.reduce((i,o)=>(i[o.name]={type:o.type,inputIndexStart:o.start,inputIndexEnd:o.end},i),{})),n.attrs!=null&&(r.attrParams=n.attrs.reduce((i,o)=>{const s=o.type;let a;switch(o.type){case"string":a=hR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=hR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"string[]":a=xR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=xR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"number":a=mR(e.attr,o.tfName,o.defaultValue||0),a===void 0&&o.tfDeprecatedName&&(a=mR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"number[]":a=bR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=bR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool":a=pR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=pR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool[]":a=SR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=SR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape":a=yR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=yR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape[]":a=wR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=wR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype":a=gR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=gR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype[]":a=vR(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=vR(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"func":a=zV(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=zV(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${o.type} for op: ${e.op}`)}return i[o.name]={value:a,type:s},i},{})),r}mapFunction(e){const n=e.nodeDef,r=[],i=[];let o={};n!=null&&(o=n.reduce((d,f)=>(d[f.name]=this.mapNode(f),f.op==="Const"&&i.push(d[f.name]),d),{}));const s=[],a=[];e.signature.inputArg.forEach(d=>{const[f]=Lu(d.name),h={name:f,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:u3(d.type),type:"dtype"}},children:[]};h.signatureKey=d.name,s.push(h),o[f]=h}),Object.keys(o).forEach(d=>{const f=o[d];f.inputNames.forEach((h,p)=>{const[m,,v]=Lu(h),g=o[m];if(g.outputs!=null){const y=g.outputs.indexOf(v);if(y!==-1){const b=`${m}:${y}`;f.inputNames[p]=b}}f.inputs.push(g),g.children.push(f)})});const c=e.ret;e.signature.outputArg.forEach(d=>{const[f,h]=Lu(c[d.name]),p=o[f];p!=null&&(p.defaultOutput=h,a.push(p))});const l=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:a,weights:i,placeholders:r,signature:l}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,r)=>(n[r.name]=this.mapArgToTensorInfo(r),n),{}),outputs:e.signature.outputArg.reduce((n,r)=>(n[r.name]=this.mapArgToTensorInfo(r,e.ret),n),{})}}mapArgToTensorInfo(e,n){let r=e.name;return n!=null&&(r=n[r]),{name:r,dtype:e.type}}}function A4e(t){const e=ae().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function BQ(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):A4e(t);return e?n:n.toLowerCase()}function hR(t,e,n,r=!1){const i=t[e];return i!=null?BQ(i.s,r):n}function pR(t,e,n){const r=t[e];return r?r.b:n}function mR(t,e,n){const r=t[e]||{},i=r.i!=null?r.i:r.f!=null?r.f:n;return typeof i=="number"?i:parseInt(i,10)}function u3(t){switch(typeof t=="string"&&(t=ns[t]),t){case ns.DT_FLOAT:case ns.DT_HALF:return"float32";case ns.DT_INT32:case ns.DT_INT64:case ns.DT_INT8:case ns.DT_UINT8:return"int32";case ns.DT_BOOL:return"bool";case ns.DT_DOUBLE:return"float32";case ns.DT_STRING:return"string";default:return null}}function zV(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function gR(t,e,n){const r=t[e];return r&&r.type?u3(r.type):n}function vR(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map(i=>u3(i)):n}function UQ(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function yR(t,e,n){const r=t[e];return r&&r.shape?UQ(r.shape):n}function bR(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(i=>typeof i=="number"?i:parseInt(i,10)):n}function xR(t,e,n,r=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map(o=>BQ(o,r)):n}function wR(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map(i=>UQ(i)):n}function SR(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $4e{constructor(e,n,r){this.node=e,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(i=>this.getInput(i)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((i,o)=>(i[o]=this.getAttr(o),i),{}))}getInput(e){return xr(e,this.tensorMap,this.context)}getAttr(e,n){const r=this.node.rawAttrs[e];if(r.tensor!=null)return xr(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return mR(this.node.rawAttrs,e,n);if(r.s!=null)return hR(this.node.rawAttrs,e,n);if(r.b!=null)return pR(this.node.rawAttrs,e,n);if(r.shape!=null)return yR(this.node.rawAttrs,e,n);if(r.type!=null)return gR(this.node.rawAttrs,e,n);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return bR(this.node.rawAttrs,e,n);if(r.list.s!=null)return xR(this.node.rawAttrs,e,n);if(r.list.shape!=null)return wR(this.node.rawAttrs,e,n);if(r.list.b!=null)return SR(this.node.rawAttrs,e,n);if(r.list.type!=null)return vR(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Er=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:jO,abs:qi,acos:fX,acosh:hX,add:it,addN:pX,all:mX,any:gX,argMax:XO,argMin:vX,asin:yX,asinh:bX,atan:xX,atan2:wX,atanh:SX,avgPool:YO,avgPool3d:kX,basicLSTMCell:TX,batchNorm:nb,batchNorm2d:EX,batchNorm3d:_X,batchNorm4d:IX,batchToSpaceND:QO,bincount:ZO,bitwiseAnd:RX,booleanMaskAsync:hY,broadcastArgs:NX,broadcastTo:cm,buffer:Tn,cast:Dt,ceil:PX,clipByValue:AX,clone:Ic,complex:jc,concat:Vr,concat1d:$X,concat2d:DX,concat3d:OX,concat4d:FX,conv1d:LX,conv2d:rb,conv2dTranspose:BX,conv3d:UX,conv3dTranspose:VX,cos:zX,cosh:WX,cosineWindow:w2,cumprod:jX,cumsum:GX,denseBincount:HX,depthToSpace:qX,depthwiseConv2d:h2,diag:KX,dilation2d:XX,div:rn,divNoNan:JX,dot:YX,dropout:yY,einsum:of,elu:tF,enclosingPowerOfTwo:VF,ensureShape:QX,equal:ib,erf:ZX,euclideanNorm:nJ,exp:hd,expandDims:_i,expm1:rJ,eye:iF,fft:y2,fill:sg,floor:oF,floorDiv:KO,fused:xY,gather:sF,gatherND:vY,greater:ag,greaterEqual:aF,ifft:u0,imag:sb,image:Yf,inTopKAsync:bY,irfft:DF,isFinite:iJ,isInf:oJ,isNaN:sJ,leakyRelu:uF,less:_S,lessEqual:p2,linalg:TY,linspace:aJ,localResponseNormalization:uJ,log:Fm,log1p:cF,logSigmoid:lJ,logSoftmax:dJ,logSumExp:dF,logicalAnd:i0,logicalNot:fF,logicalOr:hF,logicalXor:fJ,losses:EY,lowerBound:hJ,matMul:Lt,max:Pf,maxPool:pF,maxPool3d:pJ,maxPoolWithArgmax:mJ,maximum:mF,mean:o0,meshgrid:gJ,min:ES,minimum:s0,mirrorPad:gF,mod:vJ,moments:yJ,movingAverage:pY,mul:Pe,multiRNNCell:bJ,multinomial:xJ,neg:sa,norm:ob,notEqual:vF,oneHot:a0,ones:Bl,onesLike:wJ,op:K,outerProduct:SJ,pad:kh,pad1d:CJ,pad2d:kJ,pad3d:yF,pad4d:TJ,pool:EJ,pow:Om,prelu:xF,print:qO,prod:_J,raggedGather:IJ,raggedRange:RJ,raggedTensorToTensor:NJ,rand:PJ,randomGamma:OJ,randomNormal:PF,randomStandardNormal:FJ,randomUniform:v2,randomUniformInt:LJ,range:md,real:Lm,reciprocal:MJ,relu:ab,relu6:AF,reshape:ve,reverse:gd,reverse1d:BJ,reverse2d:UJ,reverse3d:VJ,reverse4d:zJ,rfft:b2,round:$F,rsqrt:WJ,scalar:vt,scatterND:mY,searchSorted:g2,selu:jJ,separableConv2d:GJ,setdiff1dAsync:HJ,sigmoid:uu,sign:qJ,signal:kY,sin:KJ,sinh:XJ,slice:Jt,slice1d:JJ,slice2d:YJ,slice3d:QJ,slice4d:ZJ,softmax:eY,softplus:lF,spaceToBatchND:bF,sparse:_Y,sparseToDense:gY,spectral:CY,split:Mm,sqrt:hu,square:Ts,squaredDifference:OF,squeeze:xs,stack:mu,step:FF,stridedSlice:tY,string:IY,sub:gt,sum:cn,tan:nY,tanh:TS,tensor:ks,tensor1d:Ao,tensor2d:Af,tensor3d:LF,tensor4d:rY,tensor5d:iY,tensor6d:oY,tensorScatterUpdate:sY,tile:lm,topk:aY,transpose:c0,truncatedNormal:uY,unique:cY,unsortedSegmentSum:lY,unstack:Id,upperBound:dY,variable:fY,where:Rc,whereAsync:UF,zeros:pd,zerosLike:co},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D4e=(t,e,n,r=Er)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(_("a",t,e,n),_("b",t,e,n))];case"AddN":return[r.addN(_("tensors",t,e,n))];case"FloorMod":case"Mod":return[r.mod(_("a",t,e,n),_("b",t,e,n))];case"Mul":return[r.mul(_("a",t,e,n),_("b",t,e,n))];case"RealDiv":case"Div":return[r.div(_("a",t,e,n),_("b",t,e,n))];case"DivNoNan":return[r.divNoNan(_("a",t,e,n),_("b",t,e,n))];case"FloorDiv":return[r.floorDiv(_("a",t,e,n),_("b",t,e,n))];case"Sub":return[r.sub(_("a",t,e,n),_("b",t,e,n))];case"Minimum":return[r.minimum(_("a",t,e,n),_("b",t,e,n))];case"Maximum":return[r.maximum(_("a",t,e,n),_("b",t,e,n))];case"Pow":return[r.pow(_("a",t,e,n),_("b",t,e,n))];case"SquaredDifference":return[r.squaredDifference(_("a",t,e,n),_("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O4e=(t,e,n,r=Er)=>{switch(t.op){case"Abs":case"ComplexAbs":return[r.abs(_("x",t,e,n))];case"Acos":return[r.acos(_("x",t,e,n))];case"Acosh":return[r.acosh(_("x",t,e,n))];case"Asin":return[r.asin(_("x",t,e,n))];case"Asinh":return[r.asinh(_("x",t,e,n))];case"Atan":return[r.atan(_("x",t,e,n))];case"Atan2":return[r.atan2(_("x",t,e,n),_("y",t,e,n))];case"Atanh":return[r.atanh(_("x",t,e,n))];case"Ceil":return[r.ceil(_("x",t,e,n))];case"Complex":return[r.complex(_("real",t,e,n),_("imag",t,e,n))];case"Cos":return[r.cos(_("x",t,e,n))];case"Cosh":return[r.cosh(_("x",t,e,n))];case"Elu":return[r.elu(_("x",t,e,n))];case"Erf":return[r.erf(_("x",t,e,n))];case"Exp":return[r.exp(_("x",t,e,n))];case"Expm1":return[r.expm1(_("x",t,e,n))];case"Floor":return[r.floor(_("x",t,e,n))];case"Log":return[r.log(_("x",t,e,n))];case"Log1p":return[r.log1p(_("x",t,e,n))];case"Imag":return[r.imag(_("x",t,e,n))];case"Neg":return[r.neg(_("x",t,e,n))];case"Reciprocal":return[r.reciprocal(_("x",t,e,n))];case"Real":return[r.real(_("x",t,e,n))];case"Relu":return[r.relu(_("x",t,e,n))];case"Round":return[r.round(_("x",t,e,n))];case"Selu":return[r.selu(_("x",t,e,n))];case"Sigmoid":return[r.sigmoid(_("x",t,e,n))];case"Sin":return[r.sin(_("x",t,e,n))];case"Sign":return[r.sign(_("x",t,e,n))];case"Sinh":return[r.sinh(_("x",t,e,n))];case"Softplus":return[r.softplus(_("x",t,e,n))];case"Sqrt":return[r.sqrt(_("x",t,e,n))];case"Square":return[r.square(_("x",t,e,n))];case"Tanh":return[r.tanh(_("x",t,e,n))];case"Tan":return[r.tan(_("x",t,e,n))];case"ClipByValue":return[r.clipByValue(_("x",t,e,n),_("clipValueMin",t,e,n),_("clipValueMax",t,e,n))];case"Relu6":return[r.relu6(_("x",t,e,n))];case"Rsqrt":return[r.rsqrt(xr(t.inputNames[0],e,n))];case"LeakyRelu":return[r.leakyRelu(_("x",t,e,n),_("alpha",t,e,n))];case"Prelu":return[r.prelu(_("x",t,e,n),_("alpha",t,e,n))];case"IsNan":return[r.isNaN(xr(t.inputNames[0],e,n))];case"IsInf":return[r.isInf(xr(t.inputNames[0],e,n))];case"IsFinite":return[r.isFinite(xr(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function is(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){L(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let r=0;r<t.length;r++){const i=t[r],o=e[r];L(i<0||o<0||i===o,()=>n+` Shapes ${t} and ${e} must match`)}}}function WV(t){return!(typeof t=="number"||t.some(e=>e<0))}function iv(t,e,n){let r=CR(t,n);const i=!WV(r);if(i&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(i&&e.forEach(o=>{r=CR(o.shape,r)}),!WV(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function CR(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const i=t[r],o=e[r];if(i>=0&&o>=0&&i!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=i>=0?i:o}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F4e{constructor(e,n,r,i,o,s,a){this.name=e,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=o,this.dynamicSize=s,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=vt(0),na(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const r=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),is(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),r.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(r.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);r.tensor=n,na(n),r.written=!0,this.tensors[e]=r}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((r,i)=>this.write(r,n[i]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let i=0;i<this.size();i++)e.push(i)}if(e.length===0)return ks([],[0].concat(this.elementShape));const r=this.readMany(e);return is(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),mu(r,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return ks([],[0].concat(this.elementShape));const n=[];for(let i=0;i<this.size();i++)n.push(i);const r=this.readMany(n);return is(this.elementShape,r[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${r[0].shape})`),Vr(r,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(!this.dynamicSize&&r>=this.maxSize)throw new Error(`Max index must be < array size (${r}  vs. ${this.maxSize})`);this.writeMany(e,Id(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let r=0;const i=e.map(u=>(r+=u,r));if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const o=r===0?0:n.size/r,s=[];ot(()=>{n=ve(n,[1,r,o]);for(let u=0;u<e.length;++u){const l=[0,u===0?0:i[u-1],0],d=[1,e[u],o];s[u]=ve(Jt(n,l,d),this.elementShape)}return s});const a=[];for(let u=0;u<e.length;u++)a[u]=u;this.writeMany(a,s)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eh{get id(){return this.idTensor.id}constructor(e,n,r,i=-1){this.tensors=e,this.elementShape=n,this.elementDtype=r,e!=null&&e.forEach(o=>{if(r!==o.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${o.dtype}`);is(n,o.shape,"TensorList shape mismatch: "),na(o)}),this.idTensor=vt(0),this.maxNumElements=i,na(this.idTensor)}copy(){return new eh([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,r=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);is(e,this.elementShape,"TensorList shape mismatch: ");const i=iv(this.elementShape,this.tensors,e);return ot(()=>{const o=this.tensors.map(s=>ve(s,i));return mu(o,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const r=iv(this.elementShape,this.tensors,e),i=this.tensors.pop();return i.kept=!1,is(i.shape,e,"TensorList shape mismatch: "),ve(i,r)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(is(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");na(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new eh([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let r=0;r<Math.min(this.tensors.length,e);++r)n.tensors[r]=this.tensors[r];return n}getItem(e,n,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);is(this.tensors[e].shape,n,"TensorList shape mismatch: ");const i=iv(this.elementShape,this.tensors,n);return ve(this.tensors[e],i)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);is(this.elementShape,n.shape,"TensorList shape mismatch: "),na(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,r){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);is(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());const i=iv(this.elementShape,this.tensors,r);return e.length===0?ks([],[0].concat(i)):ot(()=>{const o=e.map(s=>ve(this.tensors[s],i));return mu(o,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);is(this.elementShape,n,"TensorList shape mismatch: ");const r=iv(this.elementShape,this.tensors,n);return this.size()===0?ks([],[0].concat(r)):ot(()=>{const i=this.tensors.map(o=>ve(o,r));return Vr(i,0)})}}function L4e(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const i=t.shape.slice(1);is(i,e,"TensorList shape mismatch: ");const o=Id(t);return new eh(o,e,r)}function M4e(t,e,n,r){return new eh([],t,e,r)}function B4e(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(r!=null&&r!==-1&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const o=new eh([],n,t.dtype,r),s=Id(t,0);return e.forEach((a,u)=>{o.setItem(a,s[u])}),o}function U4e(t,e,n){let r=0;const i=e.map(l=>(r+=l,r));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${t.shape}`);const o=t.shape.slice(1),s=CR(o,n),a=r===0?0:t.size/r,u=ot(()=>{const l=[];t=ve(t,[1,r,a]);for(let d=0;d<e.length;++d){const h=[0,d===0?0:i[d-1],0],p=[1,e[d],a];l[d]=ve(Jt(t,h,p),s)}return t.dispose(),l}),c=new eh([],n,t.dtype,e.length);for(let l=0;l<u.length;l++)c.setItem(l,u[l]);return c}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V4e=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=_("thenBranch",t,e,n),i=_("elseBranch",t,e,n),o=_("cond",t,e,n),s=_("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=_("body",t,e,n),i=_("cond",t,e,n),o=_("args",t,e,n),s=await n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map(l=>l.id);let u=await s[0].data();s.forEach(l=>{!l.kept&&a.indexOf(l.id)===-1&&l.dispose()});let c=o;for(;u[0];){const l=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const d=c.map(h=>h.id);l.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&d.indexOf(h.id)===-1&&h.dispose()});const f=await n.functionMap[i].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await f[0].data(),f.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&d.indexOf(h.id)===-1&&h.dispose()})}return c}case"LoopCond":{const r=_("pred",t,e,n);return[Mu(r)]}case"Switch":{const r=_("pred",t,e,n);let i=_("data",t,e,n);return i.kept||(i=Mu(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=t.inputNames.find(i=>xr(i,e,n)!==void 0);if(r){const i=xr(r,e,n);return[Mu(i)]}return}case"Enter":{const r=_("frameName",t,e,n),i=_("tensor",t,e,n);return n.enterFrame(r),[Mu(i)]}case"Exit":{const r=_("tensor",t,e,n);return n.exitFrame(),[Mu(r)]}case"NextIteration":{const r=_("tensor",t,e,n);return n.nextIteration(),[Mu(r)]}case"TensorArrayV3":{const r=_("size",t,e,n),i=_("dtype",t,e,n),o=_("elementShape",t,e,n),s=_("dynamicSize",t,e,n),a=_("clearAfterRead",t,e,n),u=_("identicalElementShapes",t,e,n),c=_("name",t,e,n),l=new F4e(c,i,r,o,u,s,a);return n.addTensorArray(l),[l.idTensor,vt(1)]}case"TensorArrayWriteV3":{const r=_("tensorArrayId",t,e,n),i=_("index",t,e,n),o=_("tensor",t,e,n),s=n.getTensorArray(r.id);return s.write(i,o),[s.idTensor]}case"TensorArrayReadV3":{const r=_("tensorArrayId",t,e,n),i=_("index",t,e,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=_("tensorArrayId",t,e,n),i=_("indices",t,e,n),o=_("dtype",t,e,n);return[n.getTensorArray(r.id).gather(i,o)]}case"TensorArrayScatterV3":{const r=_("tensorArrayId",t,e,n),i=_("indices",t,e,n),o=_("tensor",t,e,n),s=n.getTensorArray(r.id);return s.scatter(i,o),[s.idTensor]}case"TensorArrayConcatV3":{const r=_("tensorArrayId",t,e,n),i=n.getTensorArray(r.id),o=_("dtype",t,e,n);return[i.concat(o)]}case"TensorArraySplitV3":{const r=_("tensorArrayId",t,e,n),i=_("tensor",t,e,n),o=_("lengths",t,e,n),s=n.getTensorArray(r.id);return s.split(o,i),[s.idTensor]}case"TensorArraySizeV3":{const r=_("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return[vt(i.size(),"int32")]}case"TensorArrayCloseV3":{const r=_("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=_("tensorListId",t,e,n),i=_("index",t,e,n),o=_("tensor",t,e,n),s=n.getTensorList(r.id);return s.setItem(i,o),[s.idTensor]}case"TensorListGetItem":{const r=_("tensorListId",t,e,n),i=_("index",t,e,n),o=_("elementShape",t,e,n),s=_("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(i,o,s)]}case"TensorListScatterV2":case"TensorListScatter":{const r=_("indices",t,e,n),i=_("tensor",t,e,n),o=_("elementShape",t,e,n),s=_("numElements",t,e,n),a=B4e(i,r,o,s);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=_("elementShape",t,e,n),i=_("elementDType",t,e,n);let o;t.op==="TensorListReserve"?o="numElements":o="maxNumElements";const s=_(o,t,e,n),a=t.op==="TensorListReserve"?-1:s,u=M4e(r,i,s,a);return n.addTensorList(u),[u.idTensor]}case"TensorListGather":{const r=_("tensorListId",t,e,n),i=_("indices",t,e,n),o=_("elementShape",t,e,n),s=_("elementDType",t,e,n);return[n.getTensorList(r.id).gather(i,s,o)]}case"TensorListStack":{const r=_("tensorListId",t,e,n),i=_("elementShape",t,e,n),o=_("elementDType",t,e,n),s=_("numElements",t,e,n);return[n.getTensorList(r.id).stack(i,o,s)]}case"TensorListFromTensor":{const r=_("tensor",t,e,n),i=_("elementShape",t,e,n),o=_("elementDType",t,e,n),s=L4e(r,i,o);return n.addTensorList(s),[s.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=_("tensorListId",t,e,n),i=n.getTensorList(r.id),o=_("dtype",t,e,n),s=_("elementShape",t,e,n);return[i.concat(o,s)]}case"TensorListPushBack":{const r=_("tensorListId",t,e,n),i=_("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(i),[o.idTensor]}case"TensorListPopBack":{const r=_("tensorListId",t,e,n),i=_("elementShape",t,e,n),o=_("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(i,o)]}case"TensorListSplit":{const r=_("tensor",t,e,n),i=_("elementShape",t,e,n),o=_("lengths",t,e,n),s=U4e(r,o,i);return n.addTensorList(s),[s.idTensor]}case"TensorListLength":{const r=_("tensorListId",t,e,n),i=n.getTensorList(r.id);return[vt(i.size(),"int32")]}case"TensorListResize":{const r=_("tensorListId",t,e,n),i=_("size",t,e,n),s=n.getTensorList(r.id).resize(i);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(t,e,n){const[r,i]=_("fusedOps",t,e,n),o=r==="biasadd",s=!o,a=i==="prelu",u=r==="fusedbatchnorm",c=_("numArgs",t,e,n);if(o){if(a&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=_("strides",t,e,n),d=Hx(t,e,n),f=_("dataFormat",t,e,n).toUpperCase(),h=_("dilations",t,e,n);let[p,m]=_("args",t,e,n);s&&(m=p,p=void 0);const v=_("leakyreluAlpha",t,e,n);return{stride:l,pad:d,dataFormat:f,dilations:h,biasArg:p,preluArg:m,activationFunc:i,leakyreluAlpha:v}}const z4e=(t,e,n,r=Er)=>{switch(t.op){case"Conv1D":{const i=_("stride",t,e,n),o=_("pad",t,e,n),s=_("dataFormat",t,e,n).toUpperCase(),a=_("dilation",t,e,n);return[r.conv1d(_("x",t,e,n),_("filter",t,e,n),i,o,s,a)]}case"Conv2D":{const i=_("strides",t,e,n),o=Hx(t,e,n),s=_("dataFormat",t,e,n).toUpperCase(),a=_("dilations",t,e,n);return[r.conv2d(_("x",t,e,n),_("filter",t,e,n),[i[1],i[2]],o,s,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:i,pad:o,dataFormat:s,dilations:a,biasArg:u,preluArg:c,activationFunc:l,leakyreluAlpha:d}=jV(t,e,n);return[r.fused.conv2d({x:_("x",t,e,n),filter:_("filter",t,e,n),strides:[i[1],i[2]],pad:o,dataFormat:s,dilations:[a[1],a[2]],bias:u,activation:l,preluActivationWeights:c,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{const{stride:i,pad:o,dataFormat:s,dilations:a,biasArg:u,preluArg:c,activationFunc:l,leakyreluAlpha:d}=jV(t,e,n);return[r.fused.depthwiseConv2d({x:_("x",t,e,n),filter:_("filter",t,e,n),strides:[i[1],i[2]],pad:o,dataFormat:s,dilations:[a[1],a[2]],bias:u,activation:l,preluActivationWeights:c,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const i=_("outputShape",t,e,n),o=_("strides",t,e,n),s=Hx(t,e,n);return[r.conv2dTranspose(_("x",t,e,n),_("filter",t,e,n),i,[o[1],o[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const i=_("strides",t,e,n),o=Hx(t,e,n),s=_("dilations",t,e,n),a=_("dataFormat",t,e,n).toUpperCase();return[r.depthwiseConv2d(_("input",t,e,n),_("filter",t,e,n),[i[1],i[2]],o,a,[s[1],s[2]])]}case"Conv3D":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("dataFormat",t,e,n).toUpperCase(),a=_("dilations",t,e,n);return[r.conv3d(_("x",t,e,n),_("filter",t,e,n),[i[1],i[2],i[3]],o,s,[a[1],a[2],a[3]])]}case"AvgPool":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("kernelSize",t,e,n);return[r.avgPool(_("x",t,e,n),[s[1],s[2]],[i[1],i[2]],o)]}case"MaxPool":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("kernelSize",t,e,n);return[r.maxPool(_("x",t,e,n),[s[1],s[2]],[i[1],i[2]],o)]}case"MaxPoolWithArgmax":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("kernelSize",t,e,n),a=_("includeBatchInIndex",t,e,n),{result:u,indexes:c}=r.maxPoolWithArgmax(_("x",t,e,n),[s[1],s[2]],[i[1],i[2]],o,a);return[u,c]}case"AvgPool3D":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("kernelSize",t,e,n);return[r.avgPool3d(_("x",t,e,n),[s[1],s[2],s[3]],[i[1],i[2],i[3]],o)]}case"MaxPool3D":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("kernelSize",t,e,n);return[r.maxPool3d(_("x",t,e,n),[s[1],s[2],s[3]],[i[1],i[2],i[3]],o)]}case"Dilation2D":{const i=_("strides",t,e,n),o=_("pad",t,e,n),s=_("dilations",t,e,n),a=i[1],u=i[2],c=s[1],l=s[2];return[r.dilation2d(_("x",t,e,n),_("filter",t,e,n),[a,u],o,[c,l],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W4e=(t,e,n,r=Er)=>{switch(t.op){case"Fill":{const i=_("shape",t,e,n),o=_("dtype",t,e,n),s=_("value",t,e,n);return[r.fill(i,s,o)]}case"LinSpace":{const i=_("start",t,e,n),o=_("stop",t,e,n),s=_("num",t,e,n);return[r.linspace(i,o,s)]}case"Multinomial":{const i=_("logits",t,e,n),o=_("numSamples",t,e,n),s=_("seed",t,e,n);return[r.multinomial(i,o,s)]}case"OneHot":{const i=_("indices",t,e,n),o=_("depth",t,e,n),s=_("onValue",t,e,n),a=_("offValue",t,e,n),u=_("dtype",t,e,n);return[r.oneHot(i,o,s,a,u)]}case"Ones":return[r.ones(_("shape",t,e,n),_("dtype",t,e,n))];case"OnesLike":return[r.onesLike(_("x",t,e,n))];case"RandomStandardNormal":return[r.randomStandardNormal(_("shape",t,e,n),_("dtype",t,e,n),_("seed",t,e,n))];case"RandomUniform":return[r.randomUniform(_("shape",t,e,n),_("minval",t,e,n),_("maxval",t,e,n),_("dtype",t,e,n))];case"RandomUniformInt":return[r.randomUniformInt(_("shape",t,e,n),_("minval",t,e,n),_("maxval",t,e,n),_("seed",t,e,n))];case"Range":{const i=_("start",t,e,n),o=_("stop",t,e,n),s=_("step",t,e,n);return[r.range(i,o,s,_("dtype",t,e,n))]}case"TruncatedNormal":{const i=_("shape",t,e,n),o=_("mean",t,e,n),s=_("stdDev",t,e,n),a=_("seed",t,e,n);return[r.truncatedNormal(i,o,s,_("dtype",t,e,n),a)]}case"Zeros":return[r.zeros(_("shape",t,e,n),_("dtype",t,e,n))];case"ZerosLike":return[r.zerosLike(_("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(t,e,n){const r=_("boxes",t,e,n),i=_("scores",t,e,n),o=_("maxOutputSize",t,e,n),s=_("iouThreshold",t,e,n),a=_("scoreThreshold",t,e,n),u=_("softNmsSigma",t,e,n);return{boxes:r,scores:i,maxOutputSize:o,iouThreshold:s,scoreThreshold:a,softNmsSigma:u}}const j4e=async(t,e,n,r,i=Er)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:o,scores:s,maxOutputSize:a,iouThreshold:u,scoreThreshold:c,softNmsSigma:l}=rE(t,e,n),d=await i.image.nonMaxSuppressionWithScoreAsync(o,s,a,u,c,l);return[d.selectedIndices,d.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:o,scores:s,maxOutputSize:a,iouThreshold:u,scoreThreshold:c}=rE(t,e,n),l=_("padToMaxOutputSize",t,e,n),d=await i.image.nonMaxSuppressionPaddedAsync(o,s,a,u,c,l);return[d.selectedIndices,d.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:o,scores:s,maxOutputSize:a,iouThreshold:u,scoreThreshold:c}=rE(t,e,n);return[await i.image.nonMaxSuppressionAsync(o,s,a,u,c)]}case"Where":{const o=i.cast(_("condition",t,e,n),"bool"),s=[await i.whereAsync(o)];return o.dispose(),s}case"ListDiff":return i.setdiff1dAsync(_("x",t,e,n),_("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G4e=(t,e,n,r=Er)=>{switch(t.op){case"LowerBound":{const i=_("sortedSequence",t,e,n),o=_("values",t,e,n);return[r.lowerBound(i,o)]}case"TopKV2":{const i=_("x",t,e,n),o=_("k",t,e,n),s=_("sorted",t,e,n),a=r.topk(i,o,s);return[a.values,a.indices]}case"UpperBound":{const i=_("sortedSequence",t,e,n),o=_("values",t,e,n);return[r.upperBound(i,o)]}case"Unique":{const i=_("x",t,e,n),o=r.unique(i);return[o.values,o.indices]}case"UniqueV2":{const i=_("x",t,e,n),o=_("axis",t,e,n),s=r.unique(i,o);return[s.values,s.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H4e=(t,e,n,r=Er)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const i=_("default",t,e,n);return[xr(t.name,e,n)||i];case"Placeholder":return[xr(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const l=_("x",t,e,n);return[Mu(l)]}case"IdentityN":return _("x",t,e,n).map(l=>Mu(l));case"Snapshot":const o=_("x",t,e,n);return[Mu(o)];case"Shape":return[r.tensor1d(_("x",t,e,n).shape,"int32")];case"ShapeN":return _("x",t,e,n).map(l=>r.tensor1d(l.shape));case"Size":return[r.scalar(_("x",t,e,n).size,"int32")];case"Rank":return[r.scalar(_("x",t,e,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const s=_("x",t,e,n),a=_("data",t,e,n),u=_("message",t,e,n),c=_("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(let l=0;l<a.length;l++)console.log(Array.prototype.slice.call(a[l].dataSync()).slice(0,c));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q4e{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=vt(0),this.tensorMap=new Map,na(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return vt(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const r=await e.data();return this.tensorMap.forEach(i=>i.dispose()),this.tensorMap.clear(),ot(()=>{const i=Id(n),o=r.length,s=i.length;L(o===s,()=>`The number of elements doesn't match, keys has ${o} elements, the values has ${s} elements.`);for(let a=0;a<o;a++){const u=r[a],c=i[a];na(c),this.tensorMap.set(u,c)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const r=await e.data();return ot(()=>{const i=[];for(let o=0;o<r.length;o++){const s=r[o],a=this.findWithDefault(s,n);i.push(a)}return mu(i)})}findWithDefault(e,n){const r=this.tensorMap.get(e);return r??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K4e=async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const i=r.getHashTableHandleByName(t.name);if(i!=null)return[i];{const o=_("keyDType",t,e,n),s=_("valueDType",t,e,n),a=new q4e(o,s);return r.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const i=_("tableHandle",t,e,n,r),o=_("keys",t,e,n),s=_("values",t,e,n);return[await r.getHashTableById(i.id).import(o,s)]}case"LookupTableFind":case"LookupTableFindV2":{const i=_("tableHandle",t,e,n,r),o=_("keys",t,e,n),s=_("defaultValue",t,e,n);return[await r.getHashTableById(i.id).find(o,s)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=_("tableHandle",t,e,n,r);return[r.getHashTableById(i.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X4e=(t,e,n,r=Er)=>{switch(t.op){case"ResizeBilinear":{const i=_("images",t,e,n),o=_("size",t,e,n),s=_("alignCorners",t,e,n),a=_("halfPixelCenters",t,e,n);return[r.image.resizeBilinear(i,[o[0],o[1]],s,a)]}case"ResizeNearestNeighbor":{const i=_("images",t,e,n),o=_("size",t,e,n),s=_("alignCorners",t,e,n),a=_("halfPixelCenters",t,e,n);return[r.image.resizeNearestNeighbor(i,[o[0],o[1]],s,a)]}case"CropAndResize":{const i=_("image",t,e,n),o=_("boxes",t,e,n),s=_("boxInd",t,e,n),a=_("cropSize",t,e,n),u=_("method",t,e,n),c=_("extrapolationValue",t,e,n);return[r.image.cropAndResize(i,o,s,a,u,c)]}case"ImageProjectiveTransformV3":{const i=_("images",t,e,n),o=_("transforms",t,e,n),s=_("outputShape",t,e,n),a=_("fillValue",t,e,n),u=_("interpolation",t,e,n),c=_("fillMode",t,e,n);return[r.image.transform(i,o,u.toLowerCase(),c.toLowerCase(),a,s)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J4e=(t,e,n,r=Er)=>{switch(t.op){case"Equal":return[r.equal(_("a",t,e,n),_("b",t,e,n))];case"NotEqual":return[r.notEqual(_("a",t,e,n),_("b",t,e,n))];case"Greater":return[r.greater(_("a",t,e,n),_("b",t,e,n))];case"GreaterEqual":return[r.greaterEqual(_("a",t,e,n),_("b",t,e,n))];case"Less":return[r.less(_("a",t,e,n),_("b",t,e,n))];case"LessEqual":return[r.lessEqual(_("a",t,e,n),_("b",t,e,n))];case"LogicalAnd":return[r.logicalAnd(_("a",t,e,n),_("b",t,e,n))];case"LogicalNot":return[r.logicalNot(_("a",t,e,n))];case"LogicalOr":return[r.logicalOr(_("a",t,e,n),_("b",t,e,n))];case"Select":case"SelectV2":return[r.where(_("condition",t,e,n),_("a",t,e,n),_("b",t,e,n))];case"BitwiseAnd":return[r.bitwiseAnd(_("a",t,e,n),_("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y4e=(t,e,n,r=Er)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(_("a",t,e,n),_("b",t,e,n),_("transposeA",t,e,n),_("transposeB",t,e,n))];case"Einsum":return[r.einsum(_("equation",t,e,n),..._("tensors",t,e,n))];case"Transpose":return[r.transpose(_("x",t,e,n),_("perm",t,e,n))];case"_FusedMatMul":const[i,o]=_("fusedOps",t,e,n),s=i==="biasadd",a=o==="prelu",u=_("numArgs",t,e,n),c=_("leakyreluAlpha",t,e,n);if(s){if(a&&u!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&u!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[l,d]=_("args",t,e,n);return[r.fused.matMul({a:_("a",t,e,n),b:_("b",t,e,n),transposeA:_("transposeA",t,e,n),transposeB:_("transposeB",t,e,n),bias:l,activation:o,preluActivationWeights:d,leakyreluAlpha:c})];case"MatrixBandPart":return[r.linalg.bandPart(_("a",t,e,n),_("numLower",t,e,n),_("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q4e=(t,e,n,r=Er)=>{switch(t.op){case"EuclideanNorm":return[r.euclideanNorm(_("x",t,e,n),_("axis",t,e,n),_("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(_("x",t,e,n),_("mean",t,e,n),_("variance",t,e,n),_("offset",t,e,n),_("scale",t,e,n),_("epsilon",t,e,n))];case"FusedBatchNormV3":return[r.batchNorm(_("x",t,e,n),_("mean",t,e,n),_("variance",t,e,n),_("offset",t,e,n),_("scale",t,e,n),_("epsilon",t,e,n))];case"LRN":return[r.localResponseNormalization(_("x",t,e,n),_("radius",t,e,n),_("bias",t,e,n),_("alpha",t,e,n),_("beta",t,e,n))];case"Softmax":return[r.softmax(_("x",t,e,n))];case"LogSoftmax":return[r.logSoftmax(_("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z4e=(t,e,n,r=Er)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:i,outputDenseValues:o}=r.raggedGather(_("paramsNestedSplits",t,e,n),_("paramsDenseValues",t,e,n),_("indices",t,e,n),_("outputRaggedRank",t,e,n));return i.concat(o)}case"RaggedRange":{const{rtNestedSplits:i,rtDenseValues:o}=r.raggedRange(_("starts",t,e,n),_("limits",t,e,n),_("splits",t,e,n));return[i,o]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(_("shape",t,e,n),_("values",t,e,n),_("defaultValue",t,e,n),_("rowPartitionTensors",t,e,n),_("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eBe=(t,e,n,r=Er)=>{switch(t.op){case"Max":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.max(_("x",t,e,n),a,u)]}case"Mean":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.mean(_("x",t,e,n),a,u)]}case"Min":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.min(_("x",t,e,n),a,u)]}case"Sum":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.sum(_("x",t,e,n),a,u)]}case"All":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.all(_("x",t,e,n),a,u)]}case"Any":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.any(_("x",t,e,n),a,u)]}case"ArgMax":{const a=_("axis",t,e,n);return[r.argMax(_("x",t,e,n),a)]}case"ArgMin":{const a=_("axis",t,e,n);return[r.argMin(_("x",t,e,n),a)]}case"Prod":{const a=_("axis",t,e,n),u=_("keepDims",t,e,n);return[r.prod(_("x",t,e,n),a,u)]}case"Cumprod":{const a=_("axis",t,e,n),u=_("exclusive",t,e,n),c=_("reverse",t,e,n);return[r.cumprod(_("x",t,e,n),a,u,c)]}case"Cumsum":{const a=_("axis",t,e,n),u=_("exclusive",t,e,n),c=_("reverse",t,e,n);return[r.cumsum(_("x",t,e,n),a,u,c)]}case"Bincount":const i=_("x",t,e,n),o=_("weights",t,e,n),s=_("size",t,e,n);return[r.bincount(i,o,s)];case"DenseBincount":{const a=_("x",t,e,n),u=_("weights",t,e,n),c=_("size",t,e,n),l=_("binaryOutput",t,e,n);return[r.denseBincount(a,u,c,l)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tBe=(t,e,n,r=Er)=>{switch(t.op){case"ConcatV2":case"Concat":{const i=_("n",t,e,n),o=_("axis",t,e,n);let s=_("tensors",t,e,n);return s=s.slice(0,i),[r.concat(s,o)]}case"Gather":{const i=_("x",t,e,n),o=_("indices",t,e,n);return[r.gather(i,r.cast(o,"int32"),0)]}case"GatherV2":{const i=_("axis",t,e,n),o=_("batchDims",t,e,n),s=_("x",t,e,n),a=_("indices",t,e,n);return[r.gather(s,r.cast(a,"int32"),i,o)]}case"Reverse":{const i=_("dims",t,e,n),o=[];for(let a=0;a<i.length;a++)i[a]&&o.push(a);const s=_("x",t,e,n);return[r.reverse(s,o)]}case"ReverseV2":{const i=_("axis",t,e,n),o=_("x",t,e,n);return[r.reverse(o,i)]}case"Slice":{const i=_("begin",t,e,n),o=_("size",t,e,n);return[r.slice(_("x",t,e,n),i,o)]}case"StridedSlice":{const i=_("begin",t,e,n),o=_("end",t,e,n),s=_("strides",t,e,n),a=_("beginMask",t,e,n),u=_("endMask",t,e,n),c=_("ellipsisMask",t,e,n),l=_("newAxisMask",t,e,n),d=_("shrinkAxisMask",t,e,n),f=_("x",t,e,n);return[r.stridedSlice(f,i,o,s,a,u,c,l,d)]}case"Pack":return ot(()=>{const i=_("axis",t,e,n),o=_("tensors",t,e,n),s=o[0].shape,a=r.squeeze(o[0]).shape,u=o.map(c=>{const l=yn(c.shape,s);if(!l&&!yn(r.squeeze(c).shape,a))throw new Error("the input tensors shape does not match");return l?c:r.reshape(c,s)});return[r.stack(u,i)]});case"Unpack":{const i=_("axis",t,e,n),o=_("tensor",t,e,n);return r.unstack(o,i)}case"Tile":{const i=_("reps",t,e,n);return[r.tile(_("x",t,e,n),i)]}case"Split":case"SplitV":{const i=_("axis",t,e,n),o=_("numOrSizeSplits",t,e,n),s=_("x",t,e,n);return r.split(s,o,i)}case"ScatterNd":{const i=_("indices",t,e,n),o=_("values",t,e,n),s=_("shape",t,e,n);return[r.scatterND(i,o,s)]}case"GatherNd":{const i=_("x",t,e,n),o=_("indices",t,e,n);return[r.gatherND(i,o)]}case"SparseToDense":{const i=_("sparseIndices",t,e,n),o=_("outputShape",t,e,n),s=_("sparseValues",t,e,n),a=_("defaultValue",t,e,n);return[r.sparseToDense(i,s,o,s.dtype===a.dtype?a:r.cast(a,s.dtype))]}case"TensorScatterUpdate":{const i=_("indices",t,e,n),o=_("values",t,e,n),s=_("tensor",t,e,n);return[r.tensorScatterUpdate(s,i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nBe=(t,e,n,r=Er)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:i,outputValues:o,emptyRowIndicator:s,reverseIndexMap:a}=r.sparse.sparseFillEmptyRows(_("indices",t,e,n),_("values",t,e,n),_("denseShape",t,e,n),_("defaultValue",t,e,n));return[i,o,s,a]}case"SparseReshape":{const{outputIndices:i,outputShape:o}=r.sparse.sparseReshape(_("inputIndices",t,e,n),_("inputShape",t,e,n),_("newShape",t,e,n));return[i,o]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(_("data",t,e,n),_("indices",t,e,n),_("segmentIds",t,e,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(_("data",t,e,n),_("indices",t,e,n),_("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rBe=(t,e,n,r=Er)=>{switch(t.op){case"FFT":return[r.fft(_("x",t,e,n))];case"IFFT":return[r.ifft(_("x",t,e,n))];case"RFFT":return[r.rfft(_("x",t,e,n))];case"IRFFT":return[r.irfft(_("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iBe=(t,e,n,r=Er)=>{switch(t.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(_("input",t,e,n),_("pattern",t,e,n),_("rewrite",t,e,n),_("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:i,nGramsSplits:o}=r.string.stringNGrams(_("data",t,e,n),_("dataSplits",t,e,n),_("separator",t,e,n),_("nGramWidths",t,e,n),_("leftPad",t,e,n),_("rightPad",t,e,n),_("padWidth",t,e,n),_("preserveShortSequences",t,e,n));return[i,o]}case"StringSplit":{const{indices:i,values:o,shape:s}=r.string.stringSplit(_("input",t,e,n),_("delimiter",t,e,n),_("skipEmpty",t,e,n));return[i,o,s]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(_("input",t,e,n),_("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oBe=(t,e,n,r=Er)=>{switch(t.op){case"Cast":return[r.cast(_("x",t,e,n),_("dtype",t,e,n))];case"ExpandDims":{const i=_("axis",t,e,n);return[r.expandDims(_("x",t,e,n),i)]}case"Squeeze":{const i=_("axis",t,e,n);return[r.squeeze(_("x",t,e,n),i)]}case"Reshape":return[r.reshape(_("x",t,e,n),_("shape",t,e,n))];case"EnsureShape":return[r.ensureShape(_("x",t,e,n),_("shape",t,e,n))];case"MirrorPad":return[r.mirrorPad(_("x",t,e,n),_("padding",t,e,n),_("mode",t,e,n))];case"PadV2":case"Pad":return[r.pad(_("x",t,e,n),_("padding",t,e,n),_("constantValue",t,e,n))];case"SpaceToBatchND":{const i=_("blockShape",t,e,n),o=_("paddings",t,e,n);return[r.spaceToBatchND(_("x",t,e,n),i,o)]}case"BatchToSpaceND":{const i=_("blockShape",t,e,n),o=_("crops",t,e,n);return[r.batchToSpaceND(_("x",t,e,n),i,o)]}case"DepthToSpace":{const i=_("blockSize",t,e,n),o=_("dataFormat",t,e,n).toUpperCase();return[r.depthToSpace(_("x",t,e,n),i,o)]}case"BroadcastTo":return[r.broadcastTo(_("x",t,e,n),_("shape",t,e,n))];case"BroadcastArgs":return[r.broadcastArgs(_("s0",t,e,n),_("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e,n,r,i=ot){const o=((s,a,u)=>{switch(s.category){case"arithmetic":return i(()=>D4e(s,a,u));case"basic_math":return i(()=>O4e(s,a,u));case"control":return V4e(s,a,u);case"convolution":return i(()=>z4e(s,a,u));case"creation":return i(()=>W4e(s,a,u));case"dynamic":return j4e(s,a,u);case"evaluation":return i(()=>G4e(s,a,u));case"image":return i(()=>X4e(s,a,u));case"graph":return i(()=>H4e(s,a,u));case"logical":return i(()=>J4e(s,a,u));case"matrices":return i(()=>Y4e(s,a,u));case"normalization":return i(()=>Q4e(s,a,u));case"ragged":return i(()=>Z4e(s,a,u));case"reduction":return i(()=>eBe(s,a,u));case"slice_join":return i(()=>tBe(s,a,u));case"sparse":return i(()=>nBe(s,a,u));case"spectral":return i(()=>rBe(s,a,u));case"string":return i(()=>iBe(s,a,u));case"transformation":return i(()=>oBe(s,a,u));case"hash_table":return K4e(s,a,u,r);case"custom":const c=MQ(s.op);if(c&&c.customExecutor)return c.customExecutor(new $4e(s,a,u));throw TypeError(`Custom op ${s.op} is not registered.`);default:throw TypeError(`Unknown op '${s.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return fd(o)?o.then(s=>[].concat(s)):[].concat(o)}class HV{constructor(e={},n={},r={},i={},o){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=i,this.parseNodeNameCache=o,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const r=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qV(t,e,n,r){const i=new Set,o=[];let s=null,a=null;const u=new Set,c=new Set(Object.keys(t).map(f=>Gi(f)[0]));r=r||[];const l=new Set(r.map(f=>Gi(f.name)[0])),d=[...e];for(;d.length>0;){const f=d.pop();if((sf(f)||hBe(f)||pBe(f))&&s==null&&(s=f,a=s.children.map(h=>h.name).filter(h=>i.has(h))),i.add(f.name),n[f.name]==null&&!c.has(f.name)&&!l.has(f.name)){if(f.inputs.length===0){o.push(f.name);continue}f.inputs.forEach(h=>{u.has(h.name)||(u.add(h.name),d.push(h))})}}return{inputs:t,outputs:e,usedNodes:i,missingInputs:o,dynamicNode:s,syncInputs:a}}function sBe(t,e){const{usedNodes:n,inputs:r}=e,i=Object.keys(r).map(v=>Gi(v)[0]).map(v=>t.nodes[v]),o=t.initNodes||[],s=v=>n.has(typeof v=="string"?v:v.name);function a(v){return[...new Map(v.map(g=>[g.name,g])).values()]}const u=a([...i,...t.weights,...o]).filter(s),c=a([...u,...Object.values(t.nodes)]).filter(s),l=new Map(c.map(v=>[v.name,v])),d={};for(const v of c){d[v.name]=d[v.name]||0;for(const g of v.children)s(g)||(d[g.name]=Number.POSITIVE_INFINITY),d[g.name]=(d[g.name]||0)+1}const f=Object.entries(d).filter(([,v])=>v===0).map(([v])=>v),h=[...f];for(;f.length>0;){const v=f.pop(),g=l.get(v);for(const y of g.children.filter(s))--d[y.name]===0&&(h.push(y.name),f.push(y.name))}const p=h.map(v=>l.get(v)),m=aBe(p,u);return uBe(m,u),m}function aBe(t,e){const n=new Map(t.map(s=>[s.name,s])),r=e.map(s=>s.name),i=new Set(r);for(;r.length>0;){const s=r.pop(),a=n.get(s);for(const u of a.children)!n.has(u.name)||i.has(u.name)||(i.add(u.name),r.push(u.name))}return t.filter(s=>i.has(s.name))}class L1 extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function uBe(t,e){const n=new Map(t.map((a,u)=>[a.name,u])),r=new Set(e.map(a=>a.name)),i=a=>r.has(typeof a=="string"?a:a.name),o=new Set(t.map(a=>a.name)),s=a=>o.has(typeof a=="string"?a:a.name);for(const a of t){for(const u of a.children.filter(s)){if(!n.has(u.name))throw new L1(`Child ${u.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(u.name))throw new L1(`Node ${a.name} is scheduled to run after its child ${u.name}.`)}if(!i(a))for(const u of a.inputs){if(!n.has(u.name))throw new L1(`Input ${u.name} of node ${a.name} is unreachable.`);if(n.get(u.name)>n.get(a.name))throw new L1(`Node ${a.name} is scheduled to run before its input ${u.name}.`)}}}function cBe(t){const e=new Map(t.map((a,u)=>[a.name,u])),n=Number.MAX_SAFE_INTEGER,r=t.map((a,u)=>sf(a)?n:u),i=a=>{const u=r[e.get(a.name)];return u??-1},o=t.map((a,u)=>a.children.map(i).reduce((c,l)=>Math.max(c,l),r[u])),s=new Map;for(let a=0;a<t.length;++a){const u=o[a];if(u===n)continue;const c=t[a],l=t[u];s.has(l.name)||s.set(l.name,[]),s.get(l.name).push(c)}return s}const lBe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),dBe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),fBe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function sf(t){return lBe.has(t.op)}function hBe(t){return dBe.has(t.op)}function pBe(t){return fBe.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RS{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(r=>e[r].map(i=>i.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(r=>{this._functionExecutorMap[r]=new RS(e.functions[r],this)})}getCompilationKey(e,n){const r=e.map(o=>o.name).sort(),i=n.map(o=>o.name).sort();return r.join(this.SEPARATOR)+"--"+i.join(this.SEPARATOR)}compile(e,n){const r=qV(e,n,this.weightMap,this._initNodes),{missingInputs:i,dynamicNode:o,syncInputs:s}=r;if(o!=null)throw new Error(`This execution contains the node '${o.name}', which has the dynamic op '${o.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(i.length>0){const c=n.map(d=>d.name),l=Object.keys(e);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${l}]. Missing the following inputs: [${i}]`)}const a=sBe(this.graph,r),u=cBe(a);return{orderedNodes:a,nodeLiveUntilMap:u}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return na(n),n}cloneTensorList(e){return e?e.map(r=>this.cloneAndKeepTensor(r)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,this.cloneTensorList(r)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const i=r.map(f=>this.graph.nodes[Gi(f)[0]]),o=n.map(f=>Gi(f)[0]),s=new Set(o);let a=o.map(f=>this.graph.nodes[f]);a.length===0&&(a=this._outputs);const u=this.getCompilationKey(i,a);let c=this.compiledMap.get(u);c==null&&(c=this.compile(e,a),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=ae().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}const l={},d={};return ot(()=>{const f=new HV(this.weightMap,l,d,this.functionExecutorMap,this.parseNodeNameCache),h=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(g=>{const[y,b]=Gi(g,f),x=[];x[b]=e[g],h[y]=x,this.keepIntermediateTensors&&(this.clonedTensorsMap[y]=this.cloneTensorList(x))});const p=this.getFrozenTensorIds(h),{orderedNodes:m,nodeLiveUntilMap:v}=c;for(const g of m){if(h[g.name])continue;const y=GV(g,h,f,this._resourceManager);if(fd(y))throw new Error(`The execution of the op '${g.op}' returned a promise. Please use model.executeAsync() instead.`);h[g.name]=y,this.keepIntermediateTensors&&(this.clonedTensorsMap[g.name]=this.cloneTensorList(y)),this.checkTensorForDisposalWithNodeLiveUntilInfo(g,h,f,p,s,v.get(g.name))}return this.parent==null&&f.dispose(p),n.map(g=>xr(g,h,f))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(r=>e[r]).map(r=>r.map(i=>i.id)));return new Set(n)}checkTensorForDisposal(e,n,r,i,o,s,a){if(!(sf(n)||s.has(e))){for(const u of r[e])u!=null&&(a[u.id]=(a[u.id]||0)+n.children.length);for(const u of n.inputs){if(sf(u))continue;const c=UV(u.name,r,i);if(c!=null)for(const l of c){if(!l||l.kept||o.has(l.id))continue;const d=a[l.id];d===1?(l.dispose(),delete a[l.id]):d!=null&&a[l.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,r,i,o,s){function a(u){return sf(u)||o.has(u.name)}if(!(sf(e)||s==null))for(const u of s){if(a(u))continue;const c=UV(u.name,n,r);for(const l of c)!l||l.kept||i.has(l.id)||l.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,r=!1,i={},o={}){this.disposeIntermediateTensors(),r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=ae().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}const s=new HV(this.weightMap,i,o,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,s,n,r),u=n.map(f=>xr(f,a,s)),c=u.map(f=>f.id),l=Object.keys(e).map(f=>e[f].id),d=new Set([...c,...l,...this.weightIds]);return Object.values(a).forEach(f=>{f.forEach(h=>{h&&!h.isDisposed&&!d.has(h.id)&&h.dispose()})}),this.parent==null&&s.dispose(d),u}async executeFunctionAsync(e,n,r){const i=e.reduce((o,s,a)=>(o[this.inputs[a].name]=s,o),{});return this._executeAsync(i,this.outputNodes,!0,n,r)}async executeWithControlFlow(e,n,r,i){const o=Object.keys(e),s=o.map(x=>this.graph.nodes[Gi(x)[0]]),a=r.map(x=>Gi(x)[0]),u=new Set(a);let c=a.map(x=>this.graph.nodes[x]);c.length===0&&(c=this._outputs);const{usedNodes:l,missingInputs:d,dynamicNode:f,syncInputs:h}=qV(e,c,this.weightMap,this._initNodes),p=[...s,...this.graph.weights,...this._initNodes||[]].map(x=>({node:x,contexts:n.currentContext})),m=Object.assign({},this.weightMap);Object.keys(e).forEach(x=>{const[S,C]=Gi(x),T=[];T[C]=e[x],m[S]=T});const v={},g=this.getFrozenTensorIds(m),y={};for(;p.length>0;){const x=this.processStack(s,p,n,m,y,g,u,v,l);await Promise.all(x)}f==null&&!i&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const b=c.filter(x=>!sf(x)&&!xr(x.name,m,n)).map(x=>x.name);if(b.length>0){let x="";throw f!=null&&(x=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${o}]. Consider providing the following inputs: [${d}]. ${x}`)}return m}processStack(e,n,r,i,o,s,a,u,c){const l=[];for(;n.length>0;){const d=n.pop();r.currentContext=d.contexts;let f="";if(d.node.op==="Enter"&&_("isConstant",d.node,i,r)&&([f]=Lu(d.node.name,r)),i[d.node.name]==null){const h=GV(d.node,i,r,this._resourceManager);f||([f]=Lu(d.node.name,r));const p=r.currentContext;fd(h)?l.push(h.then(m=>(i[f]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[f]=this.cloneTensorList(m)),r.currentContext=p,this.checkTensorForDisposal(f,d.node,i,r,s,a,u),this.processChildNodes(d.node,n,r,i,o,c),m))):(i[f]=h,this.keepIntermediateTensors&&(this.clonedTensorsMap[f]=this.cloneTensorList(h)),this.checkTensorForDisposal(f,d.node,i,r,s,a,u),this.processChildNodes(d.node,n,r,i,o,c))}else this.processChildNodes(d.node,n,r,i,o,c)}return l}processChildNodes(e,n,r,i,o,s){e.children.forEach(a=>{const[u]=Lu(a.name,r);o[u]||!s.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!xr(c,i,r))&&(o[u]=!0,n.push({contexts:r.currentContext,node:a})):a.inputNames.every(c=>!!xr(c,i,r))&&(o[u]=!0,n.push({contexts:r.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const r=e[n],[i]=Gi(n),o=this.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){const s=o.attrParams.shape.value,a=s.length===r.shape.length&&r.shape.every((u,c)=>s[c]===-1||s[c]===u);L(a,()=>`The shape of dict['${o.name}'] provided in model.execute(dict) must be [${s}], but was [${r.shape}]`)}o.attrParams.dtype&&o.attrParams.dtype.value&&L(r.dtype===o.attrParams.dtype.value,()=>`The dtype of dict['${o.name}'] provided in model.execute(dict) must be ${o.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(e){var n,r;const i={};for(const o in e){const s=(r=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||r===void 0?void 0:r[o];s!=null?i[s.name]=e[o]:i[o]=e[o]}return i}checkInputs(e){const n=Object.keys(e).filter(r=>{const[i]=Gi(r);return this.graph.nodes[i]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var r,i;const o=(i=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||i===void 0?void 0:i[n];return o!=null?o.name:n},{})}checkOutputs(e){e.forEach(n=>{const[r]=Gi(n);if(!this.graph.nodes[r])throw new Error(`The output '${n}' is not found in the graph`)})}}class mBe{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gBe="?tfjs-format=file",vBe="model.json";class yBe{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},r=e3){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=r,n==null&&(this.loadOptions={}),this.resourceManager=new mBe}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return fd(e)?e.then(n=>this.loadSync(n)):this.loadSync(e)}loadSync(e){this.artifacts=e;const n=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const o=this.artifacts.userDefinedMetadata;o.signature!=null&&(r=o.signature),o.structuredOutputKeys!=null&&(this.structuredOutputKeys=o.structuredOutputKeys)}this.signature=r,this.version=`${n.versions.producer}.${n.versions.minConsumer}`;const i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new RS(VV.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const o=VV.Instance.transformGraph(e.modelInitializer);this.initializer=new RS(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const r=this.io.getSaveHandlers(e);if(r.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(r.length>1)throw new Error(`Found more than one (${r.length}) save handlers for URL '${e}'`);e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof Mt?[e]:e,r={};return n.forEach((i,o)=>r[this.structuredOutputKeys[o]]=i),r}return e}predict(e,n){const r=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(r)}async predictAsync(e,n){const r=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(r)}normalizeInputs(e){var n;if(!(e instanceof Mt)&&!Array.isArray(e)){const o=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(o!=null)for(const s in o){const a=o[s];a.resourceId!=null&&(e[s]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const r=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+r!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-r} non-resource placeholders, while there are ${e.length} input tensors provided.`);let i=0;return this.inputNodes.reduce((o,s)=>{var a,u,c;const l=(c=(u=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||u===void 0?void 0:u[s])===null||c===void 0?void 0:c.resourceId;return l!=null?o[s]=this.resourceIdToCapturedInput[l]:o[s]=e[i++],o},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,r=Object.keys(n);for(let i=0;i<r.length;i++){const o=r[i],s=n[o];this.resourceIdToCapturedInput[s.resourceId]=e[i]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const r=this.executor.execute(e,n);return r.length>1?r:r[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const r=await this.executor.executeAsync(e,n);return r.length>1?r:r[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,r)=>(n[r]=[e[r]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&mi(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function c3(t,e={},n=e3){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=bBe(t));const r=new yBe(t,e,n);return await r.load(),r}function bBe(t){return t.endsWith("/")||(t=t+"/"),`${t}${vBe}${gBe}`}var xBe={};(function(){var t;function e(w){var k=0;return function(){return k<w.length?{done:!1,value:w[k++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(w,k,R){return w==Array.prototype||w==Object.prototype||(w[k]=R.value),w};function r(w){w=[typeof globalThis=="object"&&globalThis,w,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ii=="object"&&Ii];for(var k=0;k<w.length;++k){var R=w[k];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var i=r(this);function o(w,k){if(k)e:{var R=i;w=w.split(".");for(var D=0;D<w.length-1;D++){var z=w[D];if(!(z in R))break e;R=R[z]}w=w[w.length-1],D=R[w],k=k(D),k!=D&&k!=null&&n(R,w,{configurable:!0,writable:!0,value:k})}}o("Symbol",function(w){function k(j){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new R(D+(j||"")+"_"+z++,j)}function R(j,W){this.h=j,n(this,"description",{configurable:!0,writable:!0,value:W})}if(w)return w;R.prototype.toString=function(){return this.h};var D="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",z=0;return k}),o("Symbol.iterator",function(w){if(w)return w;w=Symbol("Symbol.iterator");for(var k="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),R=0;R<k.length;R++){var D=i[k[R]];typeof D=="function"&&typeof D.prototype[w]!="function"&&n(D.prototype,w,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return w});function s(w){return w={next:w},w[Symbol.iterator]=function(){return this},w}function a(w){var k=typeof Symbol<"u"&&Symbol.iterator&&w[Symbol.iterator];return k?k.call(w):{next:e(w)}}function u(w){if(!(w instanceof Array)){w=a(w);for(var k,R=[];!(k=w.next()).done;)R.push(k.value);w=R}return w}var c=typeof Object.assign=="function"?Object.assign:function(w,k){for(var R=1;R<arguments.length;R++){var D=arguments[R];if(D)for(var z in D)Object.prototype.hasOwnProperty.call(D,z)&&(w[z]=D[z])}return w};o("Object.assign",function(w){return w||c});var l=typeof Object.create=="function"?Object.create:function(w){function k(){}return k.prototype=w,new k},d;if(typeof Object.setPrototypeOf=="function")d=Object.setPrototypeOf;else{var f;e:{var h={a:!0},p={};try{p.__proto__=h,f=p.a;break e}catch{}f=!1}d=f?function(w,k){if(w.__proto__=k,w.__proto__!==k)throw new TypeError(w+" is not extensible");return w}:null}var m=d;function v(w,k){if(w.prototype=l(k.prototype),w.prototype.constructor=w,m)m(w,k);else for(var R in k)if(R!="prototype")if(Object.defineProperties){var D=Object.getOwnPropertyDescriptor(k,R);D&&Object.defineProperty(w,R,D)}else w[R]=k[R];w.za=k.prototype}function g(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function y(w){if(w.m)throw new TypeError("Generator is already running");w.m=!0}g.prototype.u=function(w){this.i=w};function b(w,k){w.l={ma:k,na:!0},w.h=w.s||w.v}g.prototype.return=function(w){this.l={return:w},this.h=this.v};function x(w,k,R){return w.h=R,{value:k}}function S(w){this.h=new g,this.i=w}function C(w,k){y(w.h);var R=w.h.j;return R?T(w,"return"in R?R.return:function(D){return{value:D,done:!0}},k,w.h.return):(w.h.return(k),E(w))}function T(w,k,R,D){try{var z=k.call(w.h.j,R);if(!(z instanceof Object))throw new TypeError("Iterator result "+z+" is not an object");if(!z.done)return w.h.m=!1,z;var j=z.value}catch(W){return w.h.j=null,b(w.h,W),E(w)}return w.h.j=null,D.call(w.h,j),E(w)}function E(w){for(;w.h.h;)try{var k=w.i(w.h);if(k)return w.h.m=!1,{value:k.value,done:!1}}catch(R){w.h.i=void 0,b(w.h,R)}if(w.h.m=!1,w.h.l){if(k=w.h.l,w.h.l=null,k.na)throw k.ma;return{value:k.return,done:!0}}return{value:void 0,done:!0}}function I(w){this.next=function(k){return y(w.h),w.h.j?k=T(w,w.h.j.next,k,w.h.u):(w.h.u(k),k=E(w)),k},this.throw=function(k){return y(w.h),w.h.j?k=T(w,w.h.j.throw,k,w.h.u):(b(w.h,k),k=E(w)),k},this.return=function(k){return C(w,k)},this[Symbol.iterator]=function(){return this}}function N(w){function k(D){return w.next(D)}function R(D){return w.throw(D)}return new Promise(function(D,z){function j(W){W.done?D(W.value):Promise.resolve(W.value).then(k,R).then(j,z)}j(w.next())})}function $(w){return N(new I(new S(w)))}o("Promise",function(w){function k(W){this.i=0,this.j=void 0,this.h=[],this.u=!1;var Q=this.l();try{W(Q.resolve,Q.reject)}catch(de){Q.reject(de)}}function R(){this.h=null}function D(W){return W instanceof k?W:new k(function(Q){Q(W)})}if(w)return w;R.prototype.i=function(W){if(this.h==null){this.h=[];var Q=this;this.j(function(){Q.m()})}this.h.push(W)};var z=i.setTimeout;R.prototype.j=function(W){z(W,0)},R.prototype.m=function(){for(;this.h&&this.h.length;){var W=this.h;this.h=[];for(var Q=0;Q<W.length;++Q){var de=W[Q];W[Q]=null;try{de()}catch(ke){this.l(ke)}}}this.h=null},R.prototype.l=function(W){this.j(function(){throw W})},k.prototype.l=function(){function W(ke){return function(Ne){de||(de=!0,ke.call(Q,Ne))}}var Q=this,de=!1;return{resolve:W(this.I),reject:W(this.m)}},k.prototype.I=function(W){if(W===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(W instanceof k)this.L(W);else{e:switch(typeof W){case"object":var Q=W!=null;break e;case"function":Q=!0;break e;default:Q=!1}Q?this.F(W):this.s(W)}},k.prototype.F=function(W){var Q=void 0;try{Q=W.then}catch(de){this.m(de);return}typeof Q=="function"?this.M(Q,W):this.s(W)},k.prototype.m=function(W){this.v(2,W)},k.prototype.s=function(W){this.v(1,W)},k.prototype.v=function(W,Q){if(this.i!=0)throw Error("Cannot settle("+W+", "+Q+"): Promise already settled in state"+this.i);this.i=W,this.j=Q,this.i===2&&this.K(),this.H()},k.prototype.K=function(){var W=this;z(function(){if(W.D()){var Q=i.console;typeof Q<"u"&&Q.error(W.j)}},1)},k.prototype.D=function(){if(this.u)return!1;var W=i.CustomEvent,Q=i.Event,de=i.dispatchEvent;return typeof de>"u"?!0:(typeof W=="function"?W=new W("unhandledrejection",{cancelable:!0}):typeof Q=="function"?W=new Q("unhandledrejection",{cancelable:!0}):(W=i.document.createEvent("CustomEvent"),W.initCustomEvent("unhandledrejection",!1,!0,W)),W.promise=this,W.reason=this.j,de(W))},k.prototype.H=function(){if(this.h!=null){for(var W=0;W<this.h.length;++W)j.i(this.h[W]);this.h=null}};var j=new R;return k.prototype.L=function(W){var Q=this.l();W.T(Q.resolve,Q.reject)},k.prototype.M=function(W,Q){var de=this.l();try{W.call(Q,de.resolve,de.reject)}catch(ke){de.reject(ke)}},k.prototype.then=function(W,Q){function de(et,Le){return typeof et=="function"?function(ct){try{ke(et(ct))}catch(xt){Ne(xt)}}:Le}var ke,Ne,ut=new k(function(et,Le){ke=et,Ne=Le});return this.T(de(W,ke),de(Q,Ne)),ut},k.prototype.catch=function(W){return this.then(void 0,W)},k.prototype.T=function(W,Q){function de(){switch(ke.i){case 1:W(ke.j);break;case 2:Q(ke.j);break;default:throw Error("Unexpected state: "+ke.i)}}var ke=this;this.h==null?j.i(de):this.h.push(de),this.u=!0},k.resolve=D,k.reject=function(W){return new k(function(Q,de){de(W)})},k.race=function(W){return new k(function(Q,de){for(var ke=a(W),Ne=ke.next();!Ne.done;Ne=ke.next())D(Ne.value).T(Q,de)})},k.all=function(W){var Q=a(W),de=Q.next();return de.done?D([]):new k(function(ke,Ne){function ut(ct){return function(xt){et[ct]=xt,Le--,Le==0&&ke(et)}}var et=[],Le=0;do et.push(void 0),Le++,D(de.value).T(ut(et.length-1),Ne),de=Q.next();while(!de.done)})},k});function F(w,k){w instanceof String&&(w+="");var R=0,D=!1,z={next:function(){if(!D&&R<w.length){var j=R++;return{value:k(j,w[j]),done:!1}}return D=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}o("Array.prototype.keys",function(w){return w||function(){return F(this,function(k){return k})}}),o("Array.prototype.fill",function(w){return w||function(k,R,D){var z=this.length||0;for(0>R&&(R=Math.max(0,z+R)),(D==null||D>z)&&(D=z),D=Number(D),0>D&&(D=Math.max(0,z+D)),R=Number(R||0);R<D;R++)this[R]=k;return this}});function H(w){return w||Array.prototype.fill}o("Int8Array.prototype.fill",H),o("Uint8Array.prototype.fill",H),o("Uint8ClampedArray.prototype.fill",H),o("Int16Array.prototype.fill",H),o("Uint16Array.prototype.fill",H),o("Int32Array.prototype.fill",H),o("Uint32Array.prototype.fill",H),o("Float32Array.prototype.fill",H),o("Float64Array.prototype.fill",H),o("Object.is",function(w){return w||function(k,R){return k===R?k!==0||1/k===1/R:k!==k&&R!==R}}),o("Array.prototype.includes",function(w){return w||function(k,R){var D=this;D instanceof String&&(D=String(D));var z=D.length;for(R=R||0,0>R&&(R=Math.max(R+z,0));R<z;R++){var j=D[R];if(j===k||Object.is(j,k))return!0}return!1}}),o("String.prototype.includes",function(w){return w||function(k,R){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(k,R||0)!==-1}});var G=this||self;function J(w,k){w=w.split(".");var R=G;w[0]in R||typeof R.execScript>"u"||R.execScript("var "+w[0]);for(var D;w.length&&(D=w.shift());)w.length||k===void 0?R[D]&&R[D]!==Object.prototype[D]?R=R[D]:R=R[D]={}:R[D]=k}function ne(w){var k;e:{if((k=G.navigator)&&(k=k.userAgent))break e;k=""}return k.indexOf(w)!=-1}var oe=Array.prototype.map?function(w,k){return Array.prototype.map.call(w,k,void 0)}:function(w,k){for(var R=w.length,D=Array(R),z=typeof w=="string"?w.split(""):w,j=0;j<R;j++)j in z&&(D[j]=k.call(void 0,z[j],j,w));return D},q={},Z=null;function se(w){var k=w.length,R=3*k/4;R%3?R=Math.floor(R):"=.".indexOf(w[k-1])!=-1&&(R="=.".indexOf(w[k-2])!=-1?R-2:R-1);var D=new Uint8Array(R),z=0;return fe(w,function(j){D[z++]=j}),z!==R?D.subarray(0,z):D}function fe(w,k){function R(de){for(;D<w.length;){var ke=w.charAt(D++),Ne=Z[ke];if(Ne!=null)return Ne;if(!/^[\s\xa0]*$/.test(ke))throw Error("Unknown base64 encoding at char: "+ke)}return de}xe();for(var D=0;;){var z=R(-1),j=R(0),W=R(64),Q=R(64);if(Q===64&&z===-1)break;k(z<<2|j>>4),W!=64&&(k(j<<4&240|W>>2),Q!=64&&k(W<<6&192|Q))}}function xe(){if(!Z){Z={};for(var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),k=["+/=","+/","-_=","-_.","-_"],R=0;5>R;R++){var D=w.concat(k[R].split(""));q[R]=D;for(var z=0;z<D.length;z++){var j=D[z];Z[j]===void 0&&(Z[j]=z)}}}}var be=typeof Uint8Array<"u",pe=!(ne("Trident")||ne("MSIE"))&&typeof G.btoa=="function";function ge(w){if(!pe){var k;k===void 0&&(k=0),xe(),k=q[k];for(var R=Array(Math.floor(w.length/3)),D=k[64]||"",z=0,j=0;z<w.length-2;z+=3){var W=w[z],Q=w[z+1],de=w[z+2],ke=k[W>>2];W=k[(W&3)<<4|Q>>4],Q=k[(Q&15)<<2|de>>6],de=k[de&63],R[j++]=ke+W+Q+de}switch(ke=0,de=D,w.length-z){case 2:ke=w[z+1],de=k[(ke&15)<<2]||D;case 1:w=w[z],R[j]=k[w>>2]+k[(w&3)<<4|ke>>4]+de+D}return R.join("")}for(k="";10240<w.length;)k+=String.fromCharCode.apply(null,w.subarray(0,10240)),w=w.subarray(10240);return k+=String.fromCharCode.apply(null,w),btoa(k)}var Ce=RegExp("[-_.]","g");function $e(w){switch(w){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function Ge(w){if(!pe)return se(w);Ce.test(w)&&(w=w.replace(Ce,$e)),w=atob(w);for(var k=new Uint8Array(w.length),R=0;R<w.length;R++)k[R]=w.charCodeAt(R);return k}var tt;function mt(){return tt||(tt=new Uint8Array(0))}var Ie={},lt=typeof Uint8Array.prototype.slice=="function",He=0,yt=0;function en(w){var k=0>w;w=Math.abs(w);var R=w>>>0;w=Math.floor((w-R)/4294967296),k&&(R=a(xi(R,w)),k=R.next().value,w=R.next().value,R=k),He=R>>>0,yt=w>>>0}var sn=typeof BigInt=="function";function xi(w,k){return k=~k,w?w=~w+1:k+=1,[w,k]}function wi(w,k){this.i=w>>>0,this.h=k>>>0}function gr(w){if(!w)return Bi||(Bi=new wi(0,0));if(!/^-?\d+$/.test(w))return null;if(16>w.length)en(Number(w));else if(sn)w=BigInt(w),He=Number(w&BigInt(4294967295))>>>0,yt=Number(w>>BigInt(32)&BigInt(4294967295));else{var k=+(w[0]==="-");yt=He=0;for(var R=w.length,D=k,z=(R-k)%6+k;z<=R;D=z,z+=6)D=Number(w.slice(D,z)),yt*=1e6,He=1e6*He+D,4294967296<=He&&(yt+=He/4294967296|0,He%=4294967296);k&&(k=a(xi(He,yt)),w=k.next().value,k=k.next().value,He=w,yt=k)}return new wi(He,yt)}var Bi;function Gr(w,k){return Error("Invalid wire type: "+w+" (at position "+k+")")}function Ir(){return Error("Failed to read varint, encoding is invalid.")}function Fn(w,k){return Error("Tried to read past the end of the data "+k+" > "+w)}function Rr(){throw Error("Invalid UTF8")}function Si(w,k){return k=String.fromCharCode.apply(null,k),w==null?k:w+k}var va=void 0,qo,Nr=typeof TextDecoder<"u",ku,Nh=typeof TextEncoder<"u",Pd;function Ad(w){if(w!==Ie)throw Error("illegal external caller")}function Ko(w,k){if(Ad(k),this.V=w,w!=null&&w.length===0)throw Error("ByteString should be constructed with non-empty values")}function Tu(){return Pd||(Pd=new Ko(null,Ie))}function nl(w){Ad(Ie);var k=w.V;return k=k==null||be&&k!=null&&k instanceof Uint8Array?k:typeof k=="string"?Ge(k):null,k==null?k:w.V=k}function Eu(w){if(typeof w=="string")return{buffer:Ge(w),C:!1};if(Array.isArray(w))return{buffer:new Uint8Array(w),C:!1};if(w.constructor===Uint8Array)return{buffer:w,C:!1};if(w.constructor===ArrayBuffer)return{buffer:new Uint8Array(w),C:!1};if(w.constructor===Ko)return{buffer:nl(w)||mt(),C:!0};if(w instanceof Uint8Array)return{buffer:new Uint8Array(w.buffer,w.byteOffset,w.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function $d(w,k){this.i=null,this.m=!1,this.h=this.j=this.l=0,vg(this,w,k)}function vg(w,k,R){R=R===void 0?{}:R,w.S=R.S===void 0?!1:R.S,k&&(k=Eu(k),w.i=k.buffer,w.m=k.C,w.l=0,w.j=w.i.length,w.h=w.l)}$d.prototype.reset=function(){this.h=this.l};function ya(w,k){if(w.h=k,k>w.j)throw Fn(w.j,k)}function Dd(w){var k=w.i,R=w.h,D=k[R++],z=D&127;if(D&128&&(D=k[R++],z|=(D&127)<<7,D&128&&(D=k[R++],z|=(D&127)<<14,D&128&&(D=k[R++],z|=(D&127)<<21,D&128&&(D=k[R++],z|=D<<28,D&128&&k[R++]&128&&k[R++]&128&&k[R++]&128&&k[R++]&128&&k[R++]&128)))))throw Ir();return ya(w,R),z}function yg(w,k){if(0>k)throw Error("Tried to read a negative byte length: "+k);var R=w.h,D=R+k;if(D>w.j)throw Fn(k,w.j-R);return w.h=D,R}var rl=[];function bg(){this.h=[]}bg.prototype.length=function(){return this.h.length},bg.prototype.end=function(){var w=this.h;return this.h=[],w};function ba(w,k,R){for(;0<R||127<k;)w.h.push(k&127|128),k=(k>>>7|R<<25)>>>0,R>>>=7;w.h.push(k)}function _u(w,k){for(;127<k;)w.h.push(k&127|128),k>>>=7;w.h.push(k)}function xg(w,k){if(rl.length){var R=rl.pop();vg(R,w,k),w=R}else w=new $d(w,k);this.h=w,this.j=this.h.h,this.i=this.l=-1,this.setOptions(k)}xg.prototype.setOptions=function(w){w=w===void 0?{}:w,this.ca=w.ca===void 0?!1:w.ca},xg.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function gb(w){var k=w.h;if(k.h==k.j)return!1;w.j=w.h.h;var R=Dd(w.h)>>>0;if(k=R>>>3,R&=7,!(0<=R&&5>=R))throw Gr(R,w.j);if(1>k)throw Error("Invalid field number: "+k+" (at position "+w.j+")");return w.l=k,w.i=R,!0}function Ph(w){switch(w.i){case 0:if(w.i!=0)Ph(w);else e:{w=w.h;for(var k=w.h,R=k+10,D=w.i;k<R;)if(!(D[k++]&128)){ya(w,k);break e}throw Ir()}break;case 1:w=w.h,ya(w,w.h+8);break;case 2:w.i!=2?Ph(w):(k=Dd(w.h)>>>0,w=w.h,ya(w,w.h+k));break;case 5:w=w.h,ya(w,w.h+4);break;case 3:k=w.l;do{if(!gb(w))throw Error("Unmatched start-group tag: stream EOF");if(w.i==4){if(w.l!=k)throw Error("Unmatched end-group tag");break}Ph(w)}while(1);break;default:throw Gr(w.i,w.j)}}var Ah=[];function $s(){this.j=[],this.i=0,this.h=new bg}function il(w,k){k.length!==0&&(w.j.push(k),w.i+=k.length)}function L2(w,k){if(k=k.R){il(w,w.h.end());for(var R=0;R<k.length;R++)il(w,nl(k[R])||mt())}}var Ds=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Iu(w,k){return Ds?w[Ds]|=k:w.A!==void 0?w.A|=k:(Object.defineProperties(w,{A:{value:k,configurable:!0,writable:!0,enumerable:!1}}),k)}function vb(w,k){Ds?w[Ds]&&(w[Ds]&=~k):w.A!==void 0&&(w.A&=~k)}function tn(w){var k;return Ds?k=w[Ds]:k=w.A,k??0}function Xo(w,k){Ds?w[Ds]=k:w.A!==void 0?w.A=k:Object.defineProperties(w,{A:{value:k,configurable:!0,writable:!0,enumerable:!1}})}function wg(w){return Iu(w,1),w}function M2(w,k){Xo(k,(w|0)&-51)}function $h(w,k){Xo(k,(w|18)&-41)}var Sg={};function Os(w){return w!==null&&typeof w=="object"&&!Array.isArray(w)&&w.constructor===Object}var Od,yb=[];Xo(yb,23),Od=Object.freeze(yb);function Cg(w){if(tn(w.o)&2)throw Error("Cannot mutate an immutable Message")}function kg(w){var k=w.length;(k=k?w[k-1]:void 0)&&Os(k)?k.g=1:(k={},w.push((k.g=1,k)))}function bb(w){var k=w.i+w.G;return w.B||(w.B=w.o[k]={})}function xo(w,k){return k===-1?null:k>=w.i?w.B?w.B[k]:void 0:w.o[k+w.G]}function Ui(w,k,R,D){Cg(w),Fd(w,k,R,D)}function Fd(w,k,R,D){w.j&&(w.j=void 0),k>=w.i||D?bb(w)[k]=R:(w.o[k+w.G]=R,(w=w.B)&&k in w&&delete w[k])}function ol(w,k,R,D){var z=xo(w,k);Array.isArray(z)||(z=Od);var j=tn(z);if(j&1||wg(z),D)j&2||Iu(z,2),R&1||Object.freeze(z);else{D=!(R&2);var W=j&2;R&1||!W?D&&j&16&&!W&&vb(z,16):(z=wg(Array.prototype.slice.call(z)),Fd(w,k,z))}return z}function Ld(w,k){var R=xo(w,k),D=R==null?R:typeof R=="number"||R==="NaN"||R==="Infinity"||R==="-Infinity"?Number(R):void 0;return D!=null&&D!==R&&Fd(w,k,D),D}function xb(w,k,R,D,z){w.h||(w.h={});var j=w.h[R],W=ol(w,R,3,z);if(!j){var Q=W;j=[];var de=!!(tn(w.o)&16);W=!!(tn(Q)&2);var ke=Q;!z&&W&&(Q=Array.prototype.slice.call(Q));for(var Ne=W,ut=0;ut<Q.length;ut++){var et=Q[ut],Le=k,ct=!1;if(ct=ct===void 0?!1:ct,et=Array.isArray(et)?new Le(et):ct?new Le:void 0,et!==void 0){Le=et.o;var xt=ct=tn(Le);W&&(xt|=2),de&&(xt|=16),xt!=ct&&Xo(Le,xt),Le=xt,Ne=Ne||!!(2&Le),j.push(et)}}return w.h[R]=j,de=tn(Q),k=de|33,k=Ne?k&-9:k|8,de!=k&&(Ne=Q,Object.isFrozen(Ne)&&(Ne=Array.prototype.slice.call(Ne)),Xo(Ne,k),Q=Ne),ke!==Q&&Fd(w,R,Q),(z||D&&W)&&Iu(j,2),D&&Object.freeze(j),j}return z||(z=Object.isFrozen(j),D&&!z?Object.freeze(j):!D&&z&&(j=Array.prototype.slice.call(j),w.h[R]=j)),j}function sl(w,k,R){var D=!!(tn(w.o)&2);if(k=xb(w,k,R,D,D),w=ol(w,R,3,D),!(D||tn(w)&8)){for(D=0;D<k.length;D++){if(R=k[D],tn(R.o)&2){var z=Eb(R,!1);z.j=R}else z=R;R!==z&&(k[D]=z,w[D]=z.o)}Iu(w,8)}return k}function wo(w,k,R){if(R!=null&&typeof R!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof R+": "+R);Ui(w,k,R)}function wb(w,k,R,D,z){Cg(w);var j=xb(w,R,k,!1,!1);return R=D??new R,w=ol(w,k,2,!1),z!=null?(j.splice(z,0,R),w.splice(z,0,R.o)):(j.push(R),w.push(R.o)),R.C()&&vb(w,8),R}function Dh(w,k){return w??k}function Jo(w,k,R){return R=R===void 0?0:R,Dh(Ld(w,k),R)}var Md;function B2(w){switch(typeof w){case"number":return isFinite(w)?w:String(w);case"object":if(w)if(Array.isArray(w)){if(tn(w)&128)return w=Array.prototype.slice.call(w),kg(w),w}else{if(be&&w!=null&&w instanceof Uint8Array)return ge(w);if(w instanceof Ko){var k=w.V;return k==null?"":typeof k=="string"?k:w.V=ge(k)}}}return w}function Sb(w,k,R,D){if(w!=null){if(Array.isArray(w))w=Tg(w,k,R,D!==void 0);else if(Os(w)){var z={},j;for(j in w)z[j]=Sb(w[j],k,R,D);w=z}else w=k(w,D);return w}}function Tg(w,k,R,D){var z=tn(w);D=D?!!(z&16):void 0,w=Array.prototype.slice.call(w);for(var j=0;j<w.length;j++)w[j]=Sb(w[j],k,R,D);return R(z,w),w}function U2(w){return w.ja===Sg?w.toJSON():B2(w)}function V2(w,k){w&128&&kg(k)}function Cb(w,k,R){if(R=R===void 0?$h:R,w!=null){if(be&&w instanceof Uint8Array)return w.length?new Ko(new Uint8Array(w),Ie):Tu();if(Array.isArray(w)){var D=tn(w);return D&2?w:k&&!(D&32)&&(D&16||D===0)?(Xo(w,D|2),w):(w=Tg(w,Cb,D&4?$h:R,!0),k=tn(w),k&4&&k&2&&Object.freeze(w),w)}return w.ja===Sg?Tb(w):w}}function kb(w,k,R,D,z,j,W){if(w=w.h&&w.h[R]){if(D=tn(w),D&2?D=w:(j=oe(w,Tb),$h(D,j),Object.freeze(j),D=j),Cg(k),W=D==null?Od:wg([]),D!=null){for(j=!!D.length,w=0;w<D.length;w++){var Q=D[w];j=j&&!(tn(Q.o)&2),W[w]=Q.o}j=(j?8:0)|1,w=tn(W),(w&j)!==j&&(Object.isFrozen(W)&&(W=Array.prototype.slice.call(W)),Xo(W,w|j)),k.h||(k.h={}),k.h[R]=D}else k.h&&(k.h[R]=void 0);Fd(k,R,W,z)}else Ui(k,R,Cb(D,j,W),z)}function Tb(w){return tn(w.o)&2||(w=Eb(w,!0),Iu(w.o,2)),w}function Eb(w,k){var R=w.o,D=[];Iu(D,16);var z=w.constructor.h;if(z&&D.push(z),z=w.B,z){D.length=R.length,D.fill(void 0,D.length,R.length);var j={};D[D.length-1]=j}tn(R)&128&&kg(D),k=k||w.C()?$h:M2,j=w.constructor,Md=D,D=new j(D),Md=void 0,w.R&&(D.R=w.R.slice()),j=!!(tn(R)&16);for(var W=z?R.length-1:R.length,Q=0;Q<W;Q++)kb(w,D,Q-w.G,R[Q],!1,j,k);if(z)for(var de in z)kb(w,D,+de,z[de],!0,j,k);return D}function Hr(w,k,R){w==null&&(w=Md),Md=void 0;var D=this.constructor.i||0,z=0<D,j=this.constructor.h,W=!1;if(w==null){w=j?[j]:[];var Q=48,de=!0;z&&(D=0,Q|=128),Xo(w,Q)}else{if(!Array.isArray(w)||j&&j!==w[0])throw Error();var ke=Q=Iu(w,0);if((de=(16&ke)!==0)&&((W=(32&ke)!==0)||(ke|=32)),z){if(128&ke)D=0;else if(0<w.length){var Ne=w[w.length-1];if(Os(Ne)&&"g"in Ne){D=0,ke|=128,delete Ne.g;var ut=!0,et;for(et in Ne){ut=!1;break}ut&&w.pop()}}}else if(128&ke)throw Error();Q!==ke&&Xo(w,ke)}this.G=(j?0:-1)-D,this.h=void 0,this.o=w;e:{if(j=this.o.length,D=j-1,j&&(j=this.o[D],Os(j))){this.B=j,this.i=D-this.G;break e}k!==void 0&&-1<k?(this.i=Math.max(k,D+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!z&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(R){k=de&&!W&&!0,z=this.i;var Le;for(de=0;de<R.length;de++)W=R[de],W<z?(W+=this.G,(D=w[W])?Bd(D,k):w[W]=Od):(Le||(Le=bb(this)),(D=Le[W])?Bd(D,k):Le[W]=Od)}}Hr.prototype.toJSON=function(){return Tg(this.o,U2,V2)},Hr.prototype.C=function(){return!!(tn(this.o)&2)};function Bd(w,k){if(Array.isArray(w)){var R=tn(w),D=1;!k||R&2||(D|=16),(R&D)!==D&&Xo(w,R|D)}}Hr.prototype.ja=Sg,Hr.prototype.toString=function(){return this.o.toString()};function Oh(w,k,R){if(R){var D={},z;for(z in R){var j=R[z],W=j.ra;W||(D.J=j.xa||j.oa.W,j.ia?(D.aa=Rb(j.ia),W=function(Q){return function(de,ke,Ne){return Q.J(de,ke,Ne,Q.aa)}}(D)):j.ka?(D.Z=Nb(j.da.P,j.ka),W=function(Q){return function(de,ke,Ne){return Q.J(de,ke,Ne,Q.Z)}}(D)):W=D.J,j.ra=W),W(k,w,j.da),D={J:D.J,aa:D.aa,Z:D.Z}}}L2(k,w)}var Fh=Symbol();function _b(w,k,R){return w[Fh]||(w[Fh]=function(D,z){return k(D,z,R)})}function Eg(w){var k=w[Fh];if(!k){var R=Bh(w);k=function(D,z){return xa(D,z,R)},w[Fh]=k}return k}function z2(w){var k=w.ia;if(k)return Eg(k);if(k=w.wa)return _b(w.da.P,k,w.ka)}function W2(w){var k=z2(w),R=w.da,D=w.oa.U;return k?function(z,j){return D(z,j,R,k)}:function(z,j){return D(z,j,R)}}function Ib(w,k){var R=w[k];return typeof R=="function"&&R.length===0&&(R=R(),w[k]=R),Array.isArray(R)&&(Nu in R||Ru in R||0<R.length&&typeof R[0]=="function")?R:void 0}function _g(w,k,R,D,z,j){k.P=w[0];var W=1;if(w.length>W&&typeof w[W]!="number"){var Q=w[W++];R(k,Q)}for(;W<w.length;){R=w[W++];for(var de=W+1;de<w.length&&typeof w[de]!="number";)de++;switch(Q=w[W++],de-=W,de){case 0:D(k,R,Q);break;case 1:(de=Ib(w,W))?(W++,z(k,R,Q,de)):D(k,R,Q,w[W++]);break;case 2:de=W++,de=Ib(w,de),z(k,R,Q,de,w[W++]);break;case 3:j(k,R,Q,w[W++],w[W++],w[W++]);break;case 4:j(k,R,Q,w[W++],w[W++],w[W++],w[W++]);break;default:throw Error("unexpected number of binary field arguments: "+de)}}return k}var Lh=Symbol();function Rb(w){var k=w[Lh];if(!k){var R=Ud(w);k=function(D,z){return al(D,z,R)},w[Lh]=k}return k}function Nb(w,k){var R=w[Lh];return R||(R=function(D,z){return Oh(D,z,k)},w[Lh]=R),R}var Ru=Symbol();function j2(w,k){w.push(k)}function G2(w,k,R){w.push(k,R.W)}function H2(w,k,R,D){var z=Rb(D),j=Ud(D).P,W=R.W;w.push(k,function(Q,de,ke){return W(Q,de,ke,j,z)})}function Mh(w,k,R,D,z,j){var W=Nb(D,j),Q=R.W;w.push(k,function(de,ke,Ne){return Q(de,ke,Ne,D,W)})}function Ud(w){var k=w[Ru];return k||(k=_g(w,w[Ru]=[],j2,G2,H2,Mh),Nu in w&&Ru in w&&(w.length=0),k)}var Nu=Symbol();function Ig(w,k){w[0]=k}function q2(w,k,R,D){var z=R.U;w[k]=D?function(j,W,Q){return z(j,W,Q,D)}:z}function Pb(w,k,R,D,z){var j=R.U,W=Eg(D),Q=Bh(D).P;w[k]=function(de,ke,Ne){return j(de,ke,Ne,Q,W,z)}}function Rg(w,k,R,D,z,j,W){var Q=R.U,de=_b(D,z,j);w[k]=function(ke,Ne,ut){return Q(ke,Ne,ut,D,de,W)}}function Bh(w){var k=w[Nu];return k||(k=_g(w,w[Nu]={},Ig,q2,Pb,Rg),Nu in w&&Ru in w&&(w.length=0),k)}function xa(w,k,R){for(;gb(k)&&k.i!=4;){var D=k.l,z=R[D];if(!z){var j=R[0];j&&(j=j[D])&&(z=R[D]=W2(j))}if(!z||!z(k,w,D)){z=k,D=w,j=z.j,Ph(z);var W=z;if(!W.ca){if(z=W.h.h-j,W.h.h=j,W=W.h,z==0)z=Tu();else{if(j=yg(W,z),W.S&&W.m)z=W.i.subarray(j,j+z);else{W=W.i;var Q=j;z=j+z,z=Q===z?mt():lt?W.slice(Q,z):new Uint8Array(W.subarray(Q,z))}z=z.length==0?Tu():new Ko(z,Ie)}(j=D.R)?j.push(z):D.R=[z]}}}return w}function al(w,k,R){for(var D=R.length,z=D%2==1,j=z?1:0;j<D;j+=2)(0,R[j+1])(k,w,R[j]);Oh(w,k,z?R[0]:void 0)}function Vd(w,k){return{U:w,W:k}}var Vi=Vd(function(w,k,R){if(w.i!==5)return!1;w=w.h;var D=w.i,z=w.h,j=D[z],W=D[z+1],Q=D[z+2];return D=D[z+3],ya(w,w.h+4),W=(j<<0|W<<8|Q<<16|D<<24)>>>0,w=2*(W>>31)+1,j=W>>>23&255,W&=8388607,Ui(k,R,j==255?W?NaN:1/0*w:j==0?w*Math.pow(2,-149)*W:w*Math.pow(2,j-150)*(W+Math.pow(2,23))),!0},function(w,k,R){if(k=Ld(k,R),k!=null){_u(w.h,8*R+5),w=w.h;var D=+k;D===0?0<1/D?He=yt=0:(yt=0,He=2147483648):isNaN(D)?(yt=0,He=2147483647):(D=(R=0>D?-2147483648:0)?-D:D,34028234663852886e22<D?(yt=0,He=(R|2139095040)>>>0):11754943508222875e-54>D?(D=Math.round(D/Math.pow(2,-149)),yt=0,He=(R|D)>>>0):(k=Math.floor(Math.log(D)/Math.LN2),D*=Math.pow(2,-k),D=Math.round(8388608*D),16777216<=D&&++k,yt=0,He=(R|k+127<<23|D&8388607)>>>0)),R=He,w.h.push(R>>>0&255),w.h.push(R>>>8&255),w.h.push(R>>>16&255),w.h.push(R>>>24&255)}}),K2=Vd(function(w,k,R){if(w.i!==0)return!1;var D=w.h,z=0,j=w=0,W=D.i,Q=D.h;do{var de=W[Q++];z|=(de&127)<<j,j+=7}while(32>j&&de&128);for(32<j&&(w|=(de&127)>>4),j=3;32>j&&de&128;j+=7)de=W[Q++],w|=(de&127)<<j;if(ya(D,Q),128>de)D=z>>>0,de=w>>>0,(w=de&2147483648)&&(D=~D+1>>>0,de=~de>>>0,D==0&&(de=de+1>>>0)),D=4294967296*de+(D>>>0);else throw Ir();return Ui(k,R,w?-D:D),!0},function(w,k,R){k=xo(k,R),k!=null&&(typeof k=="string"&&gr(k),k!=null&&(_u(w.h,8*R),typeof k=="number"?(w=w.h,en(k),ba(w,He,yt)):(R=gr(k),ba(w.h,R.i,R.h))))}),Ab=Vd(function(w,k,R){return w.i!==0?!1:(Ui(k,R,Dd(w.h)),!0)},function(w,k,R){if(k=xo(k,R),k!=null&&k!=null)if(_u(w.h,8*R),w=w.h,R=k,0<=R)_u(w,R);else{for(k=0;9>k;k++)w.h.push(R&127|128),R>>=7;w.h.push(1)}}),$b=Vd(function(w,k,R){if(w.i!==2)return!1;var D=Dd(w.h)>>>0;w=w.h;var z=yg(w,D);if(w=w.i,Nr){var j=w,W;(W=qo)||(W=qo=new TextDecoder("utf-8",{fatal:!0})),w=z+D,j=z===0&&w===j.length?j:j.subarray(z,w);try{var Q=W.decode(j)}catch(ut){if(va===void 0){try{W.decode(new Uint8Array([128]))}catch{}try{W.decode(new Uint8Array([97])),va=!0}catch{va=!1}}throw!va&&(qo=void 0),ut}}else{Q=z,D=Q+D,z=[];for(var de=null,ke,Ne;Q<D;)ke=w[Q++],128>ke?z.push(ke):224>ke?Q>=D?Rr():(Ne=w[Q++],194>ke||(Ne&192)!==128?(Q--,Rr()):z.push((ke&31)<<6|Ne&63)):240>ke?Q>=D-1?Rr():(Ne=w[Q++],(Ne&192)!==128||ke===224&&160>Ne||ke===237&&160<=Ne||((j=w[Q++])&192)!==128?(Q--,Rr()):z.push((ke&15)<<12|(Ne&63)<<6|j&63)):244>=ke?Q>=D-2?Rr():(Ne=w[Q++],(Ne&192)!==128||(ke<<28)+(Ne-144)>>30||((j=w[Q++])&192)!==128||((W=w[Q++])&192)!==128?(Q--,Rr()):(ke=(ke&7)<<18|(Ne&63)<<12|(j&63)<<6|W&63,ke-=65536,z.push((ke>>10&1023)+55296,(ke&1023)+56320))):Rr(),8192<=z.length&&(de=Si(de,z),z.length=0);Q=Si(de,z)}return Ui(k,R,Q),!0},function(w,k,R){if(k=xo(k,R),k!=null){var D=!1;if(D=D===void 0?!1:D,Nh){if(D&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(k))throw Error("Found an unpaired surrogate");k=(ku||(ku=new TextEncoder)).encode(k)}else{for(var z=0,j=new Uint8Array(3*k.length),W=0;W<k.length;W++){var Q=k.charCodeAt(W);if(128>Q)j[z++]=Q;else{if(2048>Q)j[z++]=Q>>6|192;else{if(55296<=Q&&57343>=Q){if(56319>=Q&&W<k.length){var de=k.charCodeAt(++W);if(56320<=de&&57343>=de){Q=1024*(Q-55296)+de-56320+65536,j[z++]=Q>>18|240,j[z++]=Q>>12&63|128,j[z++]=Q>>6&63|128,j[z++]=Q&63|128;continue}else W--}if(D)throw Error("Found an unpaired surrogate");Q=65533}j[z++]=Q>>12|224,j[z++]=Q>>6&63|128}j[z++]=Q&63|128}}k=z===j.length?j:j.subarray(0,z)}_u(w.h,8*R+2),_u(w.h,k.length),il(w,w.h.end()),il(w,k)}}),Db=Vd(function(w,k,R,D,z){if(w.i!==2)return!1;k=wb(k,R,D),R=w.h.j,D=Dd(w.h)>>>0;var j=w.h.h+D,W=j-R;if(0>=W&&(w.h.j=j,z(k,w,void 0,void 0,void 0),W=j-w.h.h),W)throw Error("Message parsing ended unexpectedly. Expected to read "+(D+" bytes, instead read "+(D-W)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return w.h.h=j,w.h.j=R,!0},function(w,k,R,D,z){if(k=sl(k,D,R),k!=null)for(D=0;D<k.length;D++){var j=w;_u(j.h,8*R+2);var W=j.h.end();il(j,W),W.push(j.i),j=W,z(k[D],w),W=w;var Q=j.pop();for(Q=W.i+W.h.length()-Q;127<Q;)j.push(Q&127|128),Q>>>=7,W.i++;j.push(Q),W.i++}});function Uh(w){return function(k,R){e:{if(Ah.length){var D=Ah.pop();D.setOptions(R),vg(D.h,k,R),k=D}else k=new xg(k,R);try{var z=Bh(w),j=xa(new z.P,k,z);break e}finally{z=k.h,z.i=null,z.m=!1,z.l=0,z.j=0,z.h=0,z.S=!1,k.l=-1,k.i=-1,100>Ah.length&&Ah.push(k)}j=void 0}return j}}function Ng(w){return function(){var k=new $s;al(this,k,Ud(w)),il(k,k.h.end());for(var R=new Uint8Array(k.i),D=k.j,z=D.length,j=0,W=0;W<z;W++){var Q=D[W];R.set(Q,j),j+=Q.length}return k.j=[R],R}}function U(w){Hr.call(this,w)}v(U,Hr);var te=[U,1,Ab,2,Vi,3,$b,4,$b];U.prototype.l=Ng(te);function ce(w){Hr.call(this,w,-1,Me)}v(ce,Hr),ce.prototype.addClassification=function(w,k){return wb(this,1,U,w,k),this};var Me=[1],Rt=Uh([ce,1,Db,te]);function Ot(w){Hr.call(this,w)}v(Ot,Hr);var an=[Ot,1,Vi,2,Vi,3,Vi,4,Vi,5,Vi];Ot.prototype.l=Ng(an);function St(w){Hr.call(this,w,-1,ln)}v(St,Hr);var ln=[1],zi=Uh([St,1,Db,an]);function vr(w){Hr.call(this,w)}v(vr,Hr);var ul=[vr,1,Vi,2,Vi,3,Vi,4,Vi,5,Vi,6,K2],Pg=Uh(ul);vr.prototype.l=Ng(ul);function Vh(w,k,R){if(R=w.createShader(R===0?w.VERTEX_SHADER:w.FRAGMENT_SHADER),w.shaderSource(R,k),w.compileShader(R),!w.getShaderParameter(R,w.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+w.getShaderInfoLog(R));return R}function Ob(w){return sl(w,U,1).map(function(k){var R=xo(k,1);return{index:R??0,qa:Jo(k,2),label:xo(k,3)!=null?Dh(xo(k,3),""):void 0,displayName:xo(k,4)!=null?Dh(xo(k,4),""):void 0}})}function eee(w){return{x:Jo(w,1),y:Jo(w,2),z:Jo(w,3),visibility:Ld(w,4)!=null?Jo(w,4):void 0}}function X2(w,k){this.i=w,this.h=k,this.m=0}function w3(w,k,R){return tee(w,k),typeof w.h.canvas.transferToImageBitmap=="function"?Promise.resolve(w.h.canvas.transferToImageBitmap()):R?Promise.resolve(w.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(w.h.canvas):(w.j===void 0&&(w.j=document.createElement("canvas")),new Promise(function(D){w.j.height=w.h.canvas.height,w.j.width=w.h.canvas.width,w.j.getContext("2d",{}).drawImage(w.h.canvas,0,0,w.h.canvas.width,w.h.canvas.height),D(w.j)}))}function tee(w,k){var R=w.h;if(w.s===void 0){var D=Vh(R,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),z=Vh(R,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),j=R.createProgram();if(R.attachShader(j,D),R.attachShader(j,z),R.linkProgram(j),!R.getProgramParameter(j,R.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+R.getProgramInfoLog(j));D=w.s=j,R.useProgram(D),z=R.getUniformLocation(D,"sampler0"),w.l={O:R.getAttribLocation(D,"aVertex"),N:R.getAttribLocation(D,"aTex"),ya:z},w.v=R.createBuffer(),R.bindBuffer(R.ARRAY_BUFFER,w.v),R.enableVertexAttribArray(w.l.O),R.vertexAttribPointer(w.l.O,2,R.FLOAT,!1,0,0),R.bufferData(R.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),R.STATIC_DRAW),R.bindBuffer(R.ARRAY_BUFFER,null),w.u=R.createBuffer(),R.bindBuffer(R.ARRAY_BUFFER,w.u),R.enableVertexAttribArray(w.l.N),R.vertexAttribPointer(w.l.N,2,R.FLOAT,!1,0,0),R.bufferData(R.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),R.STATIC_DRAW),R.bindBuffer(R.ARRAY_BUFFER,null),R.uniform1i(z,0)}D=w.l,R.useProgram(w.s),R.canvas.width=k.width,R.canvas.height=k.height,R.viewport(0,0,k.width,k.height),R.activeTexture(R.TEXTURE0),w.i.bindTexture2d(k.glName),R.enableVertexAttribArray(D.O),R.bindBuffer(R.ARRAY_BUFFER,w.v),R.vertexAttribPointer(D.O,2,R.FLOAT,!1,0,0),R.enableVertexAttribArray(D.N),R.bindBuffer(R.ARRAY_BUFFER,w.u),R.vertexAttribPointer(D.N,2,R.FLOAT,!1,0,0),R.bindFramebuffer(R.DRAW_FRAMEBUFFER?R.DRAW_FRAMEBUFFER:R.FRAMEBUFFER,null),R.clearColor(0,0,0,0),R.clear(R.COLOR_BUFFER_BIT),R.colorMask(!0,!0,!0,!0),R.drawArrays(R.TRIANGLE_FAN,0,4),R.disableVertexAttribArray(D.O),R.disableVertexAttribArray(D.N),R.bindBuffer(R.ARRAY_BUFFER,null),w.i.bindTexture2d(0)}function nee(w){this.h=w}var ree=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function iee(w,k){return k+w}function S3(w,k){window[w]=k}function oee(w){var k=document.createElement("script");return k.setAttribute("src",w),k.setAttribute("crossorigin","anonymous"),new Promise(function(R){k.addEventListener("load",function(){R()},!1),k.addEventListener("error",function(){R()},!1),document.body.appendChild(k)})}function see(){return $(function(w){switch(w.h){case 1:return w.s=2,x(w,WebAssembly.instantiate(ree),4);case 4:w.h=3,w.s=0;break;case 2:return w.s=0,w.l=null,w.return(!1);case 3:return w.return(!0)}})}function J2(w){if(this.h=w,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=w&&w.locateFile||iee,typeof window=="object")var k=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")k=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=k,w.options){k=a(Object.keys(w.options));for(var R=k.next();!R.done;R=k.next()){R=R.value;var D=w.options[R].default;D!==void 0&&(this.l[R]=typeof D=="function"?D():D)}}}t=J2.prototype,t.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function aee(w){var k,R,D,z,j,W,Q,de,ke,Ne,ut;return $(function(et){switch(et.h){case 1:return w.ga?(k=w.h.files===void 0?[]:typeof w.h.files=="function"?w.h.files(w.l):w.h.files,x(et,see(),2)):et.return();case 2:if(R=et.i,typeof window=="object")return S3("createMediapipeSolutionsWasm",{locateFile:w.locateFile}),S3("createMediapipeSolutionsPackedAssets",{locateFile:w.locateFile}),W=k.filter(function(Le){return Le.data!==void 0}),Q=k.filter(function(Le){return Le.data===void 0}),de=Promise.all(W.map(function(Le){var ct=Fb(w,Le.url);if(Le.path!==void 0){var xt=Le.path;ct=ct.then(function(xn){return w.overrideFile(xt,xn),Promise.resolve(xn)})}return ct})),ke=Promise.all(Q.map(function(Le){return Le.simd===void 0||Le.simd&&R||!Le.simd&&!R?oee(w.locateFile(Le.url,w.ha)):Promise.resolve()})).then(function(){var Le,ct,xt;return $(function(xn){if(xn.h==1)return Le=window.createMediapipeSolutionsWasm,ct=window.createMediapipeSolutionsPackedAssets,xt=w,x(xn,Le(ct),2);xt.i=xn.i,xn.h=0})}),Ne=function(){return $(function(Le){return w.h.graph&&w.h.graph.url?Le=x(Le,Fb(w,w.h.graph.url),0):(Le.h=0,Le=void 0),Le})}(),x(et,Promise.all([ke,de,Ne]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return D=k.filter(function(Le){return Le.simd===void 0||Le.simd&&R||!Le.simd&&!R}).map(function(Le){return w.locateFile(Le.url,w.ha)}),importScripts.apply(null,u(D)),z=w,x(et,createMediapipeSolutionsWasm(Module),6);case 6:z.i=et.i,w.m=new OffscreenCanvas(1,1),w.i.canvas=w.m,j=w.i.GL.createContext(w.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),w.i.GL.makeContextCurrent(j),et.h=4;break;case 7:if(w.m=document.createElement("canvas"),ut=w.m.getContext("webgl2",{}),!ut&&(ut=w.m.getContext("webgl",{}),!ut))return alert("Failed to create WebGL canvas context when passing video frame."),et.return();w.K=ut,w.i.canvas=w.m,w.i.createContext(w.m,!0,!0,{});case 4:w.j=new w.i.SolutionWasm,w.ga=!1,et.h=0}})}function uee(w){var k,R,D,z,j,W,Q,de;return $(function(ke){if(ke.h==1){if(w.h.graph&&w.h.graph.url&&w.fa===w.h.graph.url)return ke.return();if(w.u=!0,!w.h.graph||!w.h.graph.url){ke.h=2;return}return w.fa=w.h.graph.url,x(ke,Fb(w,w.h.graph.url),3)}for(ke.h!=2&&(k=ke.i,w.j.loadGraph(k)),R=a(Object.keys(w.D)),D=R.next();!D.done;D=R.next())z=D.value,w.j.overrideFile(z,w.D[z]);if(w.D={},w.h.listeners)for(j=a(w.h.listeners),W=j.next();!W.done;W=j.next())Q=W.value,fee(w,Q);de=w.l,w.l={},w.setOptions(de),ke.h=0})}t.reset=function(){var w=this;return $(function(k){w.j&&(w.j.reset(),w.s={},w.v={}),k.h=0})},t.setOptions=function(w,k){var R=this;if(k=k||this.h.options){for(var D=[],z=[],j={},W=a(Object.keys(w)),Q=W.next();!Q.done;j={X:j.X,Y:j.Y},Q=W.next())if(Q=Q.value,!(Q in this.l&&this.l[Q]===w[Q])){this.l[Q]=w[Q];var de=k[Q];de!==void 0&&(de.onChange&&(j.X=de.onChange,j.Y=w[Q],D.push(function(ke){return function(){var Ne;return $(function(ut){if(ut.h==1)return x(ut,ke.X(ke.Y),2);Ne=ut.i,Ne===!0&&(R.u=!0),ut.h=0})}}(j))),de.graphOptionXref&&(Q=Object.assign({},{calculatorName:"",calculatorIndex:0},de.graphOptionXref,{valueNumber:de.type===1?w[Q]:0,valueBoolean:de.type===0?w[Q]:!1,valueString:de.type===2?w[Q]:""}),z.push(Q)))}(D.length!==0||z.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(z),this.F=(this.F===void 0?[]:this.F).concat(D))}};function cee(w){var k,R,D,z,j,W,Q;return $(function(de){switch(de.h){case 1:if(!w.u)return de.return();if(!w.F){de.h=2;break}k=a(w.F),R=k.next();case 3:if(R.done){de.h=5;break}return D=R.value,x(de,D(),4);case 4:R=k.next(),de.h=3;break;case 5:w.F=void 0;case 2:if(w.H){for(z=new w.i.GraphOptionChangeRequestList,j=a(w.H),W=j.next();!W.done;W=j.next())Q=W.value,z.push_back(Q);w.j.changeOptions(z),z.delete(),w.H=void 0}w.u=!1,de.h=0}})}t.initialize=function(){var w=this;return $(function(k){return k.h==1?x(k,aee(w),2):k.h!=3?x(k,uee(w),3):x(k,cee(w),0)})};function Fb(w,k){var R,D;return $(function(z){return k in w.L?z.return(w.L[k]):(R=w.locateFile(k,""),D=fetch(R).then(function(j){return j.arrayBuffer()}),w.L[k]=D,z.return(D))})}t.overrideFile=function(w,k){this.j?this.j.overrideFile(w,k):this.D[w]=k},t.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},t.send=function(w,k){var R=this,D,z,j,W,Q,de,ke,Ne,ut;return $(function(et){switch(et.h){case 1:return R.h.inputs?(D=1e3*(k??performance.now()),x(et,R.I,2)):et.return();case 2:return x(et,R.initialize(),3);case 3:for(z=new R.i.PacketDataList,j=a(Object.keys(w)),W=j.next();!W.done;W=j.next())if(Q=W.value,de=R.h.inputs[Q]){e:{var Le=w[Q];switch(de.type){case"video":var ct=R.s[de.stream];if(ct||(ct=new X2(R.i,R.K),R.s[de.stream]=ct),ct.m===0&&(ct.m=ct.i.createTexture()),typeof HTMLVideoElement<"u"&&Le instanceof HTMLVideoElement)var xt=Le.videoWidth,xn=Le.videoHeight;else typeof HTMLImageElement<"u"&&Le instanceof HTMLImageElement?(xt=Le.naturalWidth,xn=Le.naturalHeight):(xt=Le.width,xn=Le.height);xn={glName:ct.m,width:xt,height:xn},xt=ct.h,xt.canvas.width=xn.width,xt.canvas.height=xn.height,xt.activeTexture(xt.TEXTURE0),ct.i.bindTexture2d(ct.m),xt.texImage2D(xt.TEXTURE_2D,0,xt.RGBA,xt.RGBA,xt.UNSIGNED_BYTE,Le),ct.i.bindTexture2d(0),ct=xn;break e;case"detections":for(ct=R.s[de.stream],ct||(ct=new nee(R.i),R.s[de.stream]=ct),ct.data||(ct.data=new ct.h.DetectionListData),ct.data.reset(Le.length),xn=0;xn<Le.length;++xn){xt=Le[xn];var dn=ct.data,Pr=dn.setBoundingBox,Yo=xn,Wi=xt.la,Ut=new vr;if(wo(Ut,1,Wi.sa),wo(Ut,2,Wi.ta),wo(Ut,3,Wi.height),wo(Ut,4,Wi.width),wo(Ut,5,Wi.rotation),Ui(Ut,6,Wi.pa),Wi=Ut.l(),Pr.call(dn,Yo,Wi),xt.ea)for(dn=0;dn<xt.ea.length;++dn){Ut=xt.ea[dn],Pr=ct.data,Yo=Pr.addNormalizedLandmark,Wi=xn,Ut=Object.assign({},Ut,{visibility:Ut.visibility?Ut.visibility:0});var Ar=new Ot;wo(Ar,1,Ut.x),wo(Ar,2,Ut.y),wo(Ar,3,Ut.z),Ut.visibility&&wo(Ar,4,Ut.visibility),Ut=Ar.l(),Yo.call(Pr,Wi,Ut)}if(xt.ba)for(dn=0;dn<xt.ba.length;++dn)Pr=ct.data,Yo=Pr.addClassification,Wi=xn,Ut=xt.ba[dn],Ar=new U,wo(Ar,2,Ut.qa),Ut.index&&Ui(Ar,1,Ut.index),Ut.label&&Ui(Ar,3,Ut.label),Ut.displayName&&Ui(Ar,4,Ut.displayName),Ut=Ar.l(),Yo.call(Pr,Wi,Ut)}ct=ct.data;break e;default:ct={}}}switch(ke=ct,Ne=de.stream,de.type){case"video":z.pushTexture2d(Object.assign({},ke,{stream:Ne,timestamp:D}));break;case"detections":ut=ke,ut.stream=Ne,ut.timestamp=D,z.pushDetectionList(ut);break;default:throw Error("Unknown input config type: '"+de.type+"'")}}return R.j.send(z),x(et,R.I,4);case 4:z.delete(),et.h=0}})};function lee(w,k,R){var D,z,j,W,Q,de,ke,Ne,ut,et,Le,ct,xt,xn;return $(function(dn){switch(dn.h){case 1:if(!R)return dn.return(k);for(D={},z=0,j=a(Object.keys(R)),W=j.next();!W.done;W=j.next())Q=W.value,de=R[Q],typeof de!="string"&&de.type==="texture"&&k[de.stream]!==void 0&&++z;1<z&&(w.M=!1),ke=a(Object.keys(R)),W=ke.next();case 2:if(W.done){dn.h=4;break}if(Ne=W.value,ut=R[Ne],typeof ut=="string")return xt=D,xn=Ne,x(dn,dee(w,Ne,k[ut]),14);if(et=k[ut.stream],ut.type==="detection_list"){if(et){for(var Pr=et.getRectList(),Yo=et.getLandmarksList(),Wi=et.getClassificationsList(),Ut=[],Ar=0;Ar<Pr.size();++Ar){var cl=Pg(Pr.get(Ar)),hee=Jo(cl,1),pee=Jo(cl,2),mee=Jo(cl,3),gee=Jo(cl,4),vee=Jo(cl,5,0),Lb=void 0;Lb=Lb===void 0?0:Lb,cl={la:{sa:hee,ta:pee,height:mee,width:gee,rotation:vee,pa:Dh(xo(cl,6),Lb)},ea:sl(zi(Yo.get(Ar)),Ot,1).map(eee),ba:Ob(Rt(Wi.get(Ar)))},Ut.push(cl)}Pr=Ut}else Pr=[];D[Ne]=Pr,dn.h=7;break}if(ut.type==="proto_list"){if(et){for(Pr=Array(et.size()),Yo=0;Yo<et.size();Yo++)Pr[Yo]=et.get(Yo);et.delete()}else Pr=[];D[Ne]=Pr,dn.h=7;break}if(et===void 0){dn.h=3;break}if(ut.type==="float_list"){D[Ne]=et,dn.h=7;break}if(ut.type==="proto"){D[Ne]=et,dn.h=7;break}if(ut.type!=="texture")throw Error("Unknown output config type: '"+ut.type+"'");return Le=w.v[Ne],Le||(Le=new X2(w.i,w.K),w.v[Ne]=Le),x(dn,w3(Le,et,w.M),13);case 13:ct=dn.i,D[Ne]=ct;case 7:ut.transform&&D[Ne]&&(D[Ne]=ut.transform(D[Ne])),dn.h=3;break;case 14:xt[xn]=dn.i;case 3:W=ke.next(),dn.h=2;break;case 4:return dn.return(D)}})}function dee(w,k,R){var D;return $(function(z){return typeof R=="number"||R instanceof Uint8Array||R instanceof w.i.Uint8BlobList?z.return(R):R instanceof w.i.Texture2dDataOut?(D=w.v[k],D||(D=new X2(w.i,w.K),w.v[k]=D),z.return(w3(D,R,w.M))):z.return(void 0)})}function fee(w,k){for(var R=k.name||"$",D=[].concat(u(k.wants)),z=new w.i.StringList,j=a(k.wants),W=j.next();!W.done;W=j.next())z.push_back(W.value);j=w.i.PacketListener.implement({onResults:function(Q){for(var de={},ke=0;ke<k.wants.length;++ke)de[D[ke]]=Q.get(ke);var Ne=w.listeners[R];Ne&&(w.I=lee(w,de,k.outs).then(function(ut){ut=Ne(ut);for(var et=0;et<k.wants.length;++et){var Le=de[D[et]];typeof Le=="object"&&Le.hasOwnProperty&&Le.hasOwnProperty("delete")&&Le.delete()}ut&&(w.I=ut)}))}}),w.j.attachMultiListener(z,j),z.delete()}t.onResults=function(w,k){this.listeners[k||"$"]=w},J("Solution",J2),J("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function C3(w){switch(w===void 0&&(w=0),w){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function k3(w){var k=this;w=w||{},this.h=new J2({locateFile:w.locateFile,files:function(R){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:C3(R.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(R){var D,z,j;return $(function(W){return W.h==1?(D=C3(R),z="third_party/mediapipe/modules/selfie_segmentation/"+D,x(W,Fb(k.h,D),2)):(j=W.i,k.h.overrideFile(z,j),W.return(!0))})}}}})}t=k3.prototype,t.close=function(){return this.h.close(),Promise.resolve()},t.onResults=function(w){this.h.onResults(w)},t.initialize=function(){var w=this;return $(function(k){return x(k,w.h.initialize(),0)})},t.reset=function(){this.h.reset()},t.send=function(w){var k=this;return $(function(R){return x(R,k.h.send(w),0)})},t.setOptions=function(w){this.h.setOptions(w)},J("SelfieSegmentation",k3),J("VERSION","0.1.1675465747")}).call(Ii);/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var kR=function(t,e){return kR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},kR(t,e)};function VQ(t,e){function n(){this.constructor=t}kR(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ti=function(){return ti=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},ti.apply(this,arguments)};function kt(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(c){try{u(r.next(c))}catch(l){o(l)}}function a(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){var l;c.done?i(c.value):(l=c.value,l instanceof n?l:new n(function(d){d(l)})).then(s,a)}u((r=r.apply(t,e||[])).next())})}function Tt(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!((i=i.length>0&&i[i.length-1])||l[0]!==6&&l[0]!==2)){s=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(l[0]===6&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(d){l=[6,d],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}function NS(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function l3(t){return kt(this,void 0,void 0,function(){var e,n;return Tt(this,function(r){switch(r.label){case 0:return e=document.createElement("canvas"),t instanceof Mt?[4,cb(t,e)]:[3,2];case 1:return r.sent(),[3,3];case 2:e.width=NS(t.width),e.height=NS(t.height),n=e.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),r.label=3;case 3:return[2,e]}})})}function zQ(t){return kt(this,void 0,void 0,function(){var e,n,r,i,o,s;return Tt(this,function(a){switch(a.label){case 0:return t instanceof Mt?(e=t.shape.slice(0,2),n=e[0],r=e[1],i=ImageData.bind,[4,cb(t)]):[3,2];case 1:return[2,new(i.apply(ImageData,[void 0,a.sent(),r,n]))];case 2:return o=document.createElement("canvas"),s=o.getContext("2d"),o.width=NS(t.width),o.height=NS(t.height),s.drawImage(t,0,0),[2,s.getImageData(0,0,o.width,o.height)]}})})}function WQ(t){return kt(this,void 0,void 0,function(){var e,n;return Tt(this,function(r){switch(r.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,l3(t)]:[3,2];case 1:return n=r.sent(),[3,3];case 2:n=t,r.label=3;case 3:return e=n,[2,_2(e,4)]}})})}function R2(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got "+t);if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got "+t)}function jQ(t){var e=t.shape[2],n=XO(t,2),r=ve(n,[-1]);return a0(r,e)}function M1(t,e){return ot(function(){return Dt(ag(t,vt(e)),"int32")})}function wBe(t,e){var n=e.shape,r=n[0],i=n[1],o=n[2];return ot(function(){var s=jQ(e),a=_i(md(0,o,1,"int32"),1),u=Dt(Lt(s,a),"int32"),c=ve(u,[r,i]),l=it(c,vt(1,"int32"));return gt(function(d,f){return Pe(d,f)}(l,t),vt(1,"int32"))})}var GQ=function(){function t(e,n){this.model=e,this.outputStride=n;var r=this.model.inputs[0].shape;L(r[1]===-1&&r[2]===-1,function(){return"Input shape ["+r[1]+", "+r[2]+"] must both be equal to or -1"})}return t.prototype.predict=function(e){var n=this;return ot(function(){var r=n.preprocessInput(Dt(e,"float32")),i=_i(r,0),o=n.model.predict(i).map(function(a){return xs(a,[0])}),s=n.nameOutputResults(o);return{heatmapScores:uu(s.heatmap),offsets:s.offsets,displacementFwd:s.displacementFwd,displacementBwd:s.displacementBwd,segmentation:s.segmentation,partHeatmaps:s.partHeatmaps,longOffsets:s.longOffsets,partOffsets:s.partOffsets}})},t.prototype.dispose=function(){this.model.dispose()},t}(),SBe=function(t){function e(){return t!==null&&t.apply(this,arguments)||this}return VQ(e,t),e.prototype.preprocessInput=function(n){return ot(function(){return gt(rn(n,127.5),1)})},e.prototype.nameOutputResults=function(n){return{offsets:n[0],segmentation:n[1],partHeatmaps:n[2],longOffsets:n[3],heatmap:n[4],displacementFwd:n[5],displacementBwd:n[6],partOffsets:n[7]}},e}(GQ),N2=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],Hs=N2.length,PS=N2.reduce(function(t,e,n){return t[e]=n,t},{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(t){var e=t[0],n=t[1];return[PS[e],PS[n]]});function d3(t,e,n){var r=t[0],i=t[1],o=e[0],s=e[1],a=n.top,u=n.bottom;return[s/(n.left+n.right+i),o/(a+u+r)]}function HQ(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+Hs)}}function qQ(t,e,n){var r=HQ(t.heatmapY,t.heatmapX,t.id,n),i=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+i}}function KV(t,e,n){return t<e?e:t>n?n:t}function XV(t,e){return{x:t.x+e.x,y:t.y+e.y}}function CBe(t,e,n){n===void 0&&(n=.3);for(var r=0,i=0,o=0;o<t.length;o++)e.keypoints[o].score>n&&(i+=1,r+=Math.pow(t[o].x-e.keypoints[o].position.x,2)+Math.pow(t[o].y-e.keypoints[o].position.y,2));return i===0?r=1/0:r/=i,r}function kBe(t,e,n,r,i,o,s){for(var a=s[0],u=s[1],c=n(t),l=c.y*r+c.x,d=i[Hs*(2*l)+e],f=i[Hs*(2*l+1)+e],h=t.y+d,p=t.x+f,m=0;m<o;m++){h=Math.min(h,a-1);var v=n({x:p=Math.min(p,u-1),y:h}),g=v.y*r+v.x;h+=d=i[Hs*(2*g)+e],p+=f=i[Hs*(2*g+1)+e]}return{x:p,y:h}}function KQ(t,e,n,r,i,o,s,a,u,c){for(var l=i[0],d=i[1],f=o[0],h=o[1],p=a[0],m=a[1],v=[],g=function(E){return function(I,N,$,F){var H=N[0],G=N[1],J=$[0],ne=$[1],oe=Math.round(((H+I.y+1)*ne-1)/F);return{x:Math.round(((G+I.x+1)*J-1)/F),y:oe}}(E,[l,d],[f,h],u)},y=0;y<r;y++){var b=kBe(t,y,g,s,e,c,[p,m]);v.push(b)}for(var x=-1,S=1/0,C=0;C<n.length;C++){var T=CBe(v,n[C]);T<S&&(x=C,S=T)}return x}function XQ(t,e){var n=t[0],r=t[1];return[Math.round((r-1)/e+1),Math.round((n-1)/e+1)]}function JQ(t,e,n,r,i,o,s,a,u,c,l){for(var d=s[0],f=s[1],h=t.shape,p=h[0],m=h[1],v=e.shape.slice(0,2),g=v[0],y=v[1],b=ve(e,[g,y,2,Hs]),x=new Float32Array(l*Hs*3).fill(0),S=0;S<n.length;S++)for(var C=S*Hs*3,T=n[S],E=0;E<Hs;E++){var I=T.keypoints[E],N=C+3*E;x[N]=I.score,x[N+1]=I.position.y,x[N+2]=I.position.x}var $=d3([r,i],[d,f],a),F=$[0],H=$[1],G=ks(x,[l,Hs,3]),J=a.top,ne=a.left,oe={variableNames:["segmentation","longOffsets","poses"],outputShape:[p,m],userCode:`
    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {
      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));
    }

    float convertToPositionInOutputFloat(
        int pos, int pad, float scale, int stride) {
      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);
    }

    float dist(float x1, float y1, float x2, float y2) {
      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);
    }

    float sampleLongOffsets(float h, float w, int d, int k) {
      float fh = fract(h);
      float fw = fract(w);
      int clH = int(ceil(h));
      int clW = int(ceil(w));
      int flH = int(floor(h));
      int flW = int(floor(w));
      float o11 = getLongOffsets(flH, flW, d, k);
      float o12 = getLongOffsets(flH, clW, d, k);
      float o21 = getLongOffsets(clH, flW, d, k);
      float o22 = getLongOffsets(clH, clW, d, k);
      float o1 = mix(o11, o12, fw);
      float o2 = mix(o21, o22, fw);
      return mix(o1, o2, fh);
    }

    int findNearestPose(int h, int w) {
      float prob = getSegmentation(h, w);
      if (prob < 1.0) {
        return -1;
      }

      // Done(Tyler): convert from output space h/w to strided space.
      float stridedH = convertToPositionInOutputFloat(
        h, `+J+", "+H+", "+o+`);
      float stridedW = convertToPositionInOutputFloat(
        w, `+ne+", "+F+", "+o+`);

      float minDist = 1000000.0;
      int iMin = -1;
      for (int i = 0; i < `+l+`; i++) {
        float curDistSum = 0.0;
        int numKpt = 0;
        for (int k = 0; k < `+Hs+`; k++) {
          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);
          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);

          float y = float(h) + dy;
          float x = float(w) + dx;

          for (int s = 0; s < `+u+`; s++) {
            int yRounded = round(min(y, float(`+(r-1)+`)));
            int xRounded = round(min(x, float(`+(i-1)+`)));

            float yStrided = convertToPositionInOutputFloat(
              yRounded, `+J+", "+H+", "+o+`);
            float xStrided = convertToPositionInOutputFloat(
              xRounded, `+ne+", "+F+", "+o+`);

            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);
            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);

            y = y + dy;
            x = x + dx;
          }

          float poseScore = getPoses(i, k, 0);
          float poseY = getPoses(i, k, 1);
          float poseX = getPoses(i, k, 2);
          if (poseScore > `+c+`) {
            numKpt = numKpt + 1;
            curDistSum = curDistSum + dist(x, y, poseX, poseY);
          }
        }
        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {
          minDist = curDistSum / float(numKpt);
          iMin = i;
        }
      }
      return iMin;
    }

    void main() {
        ivec2 coords = getOutputCoords();
        int nearestPose = findNearestPose(coords[0], coords[1]);
        setOutput(float(nearestPose));
      }
  `};return dX().compileAndRun(oe,[t,b,G])}function YQ(){return cX()==="webgl"}function TBe(t,e,n,r,i,o,s,a,u,c,l,d){var f=s[0],h=s[1];return u===void 0&&(u=.2),c===void 0&&(c=8),l===void 0&&(l=.3),d===void 0&&(d=10),kt(this,void 0,void 0,function(){var p,m,v,g,y;return Tt(this,function(b){switch(b.label){case 0:return p=n.filter(function(x){return x.score>=u}),YQ()?(v=ot(function(){var x=JQ(t,e,p,r,i,o,[f,h],a,c,l,d),S=Bs().makeTensorFromDataId(x.dataId,x.shape,x.dtype);return p.map(function(C,T){return function(E,I){return ot(function(){return Dt(ib(E,vt(I)),"int32")})}(S,T)})}),[4,Promise.all(v.map(function(x){return x.data()}))]):[3,2];case 1:return m=b.sent(),v.forEach(function(x){return x.dispose()}),[3,5];case 2:return[4,t.data()];case 3:return g=b.sent(),[4,e.data()];case 4:y=b.sent(),m=function(x,S,C,T,E,I,N,$,F,H){var G=N[0],J=N[1];H===void 0&&(H=5);for(var ne=C.map(function($e){return new Uint8Array(T*E).fill(0)}),oe=$.top,q=$.left,Z=d3([T,E],[G,J],$),se=Z[0],fe=Z[1],xe=XQ([G,J],I)[0],be=0;be<T;be+=1)for(var pe=0;pe<E;pe+=1){var ge=be*E+pe;if(x[ge]===1){var Ce=KQ({x:pe,y:be},S,C,H,[oe,q],[se,fe],xe,[T,E],I,F);Ce>=0&&(ne[Ce][ge]=1)}}return ne}(g,y,p,r,i,o,[f,h],a,c),b.label=5;case 5:return[2,m.map(function(x,S){return{data:x,pose:p[S],width:i,height:r}})]}})})}function EBe(t,e,n,r,i,o,s,a,u,c,l,d,f){var h=a[0],p=a[1];return c===void 0&&(c=.2),l===void 0&&(l=8),d===void 0&&(d=.3),f===void 0&&(f=10),kt(this,void 0,void 0,function(){var m,v,g,y,b,x;return Tt(this,function(S){switch(S.label){case 0:return m=r.filter(function(C){return C.score>=c}),YQ()?(g=ot(function(){var C=JQ(t,e,m,i,o,s,[h,p],u,l,d,f),T=Bs().makeTensorFromDataId(C.dataId,C.shape,C.dtype);return m.map(function(E,I){return function(N,$,F){return ot(function(){return gt(Pe(Dt(ib(N,vt(F)),"int32"),it($,1)),1)})}(T,n,I)})}),[4,Promise.all(g.map(function(C){return C.data()}))]):[3,2];case 1:return v=S.sent(),g.forEach(function(C){return C.dispose()}),[3,6];case 2:return[4,t.data()];case 3:return y=S.sent(),[4,e.data()];case 4:return b=S.sent(),[4,n.data()];case 5:x=S.sent(),v=function(C,T,E,I,N,$,F,H,G,J,ne){var oe=H[0],q=H[1];ne===void 0&&(ne=5);for(var Z=I.map(function(mt){return new Int32Array(N*$).fill(-1)}),se=G.top,fe=G.left,xe=d3([N,$],[oe,q],G),be=xe[0],pe=xe[1],ge=XQ([oe,q],F)[0],Ce=0;Ce<N;Ce+=1)for(var $e=0;$e<$;$e+=1){var Ge=Ce*$+$e;if(C[Ge]===1){var tt=KQ({x:$e,y:Ce},T,I,ne,[se,fe],[be,pe],ge,[N,$],F,J);tt>=0&&(Z[tt][Ge]=E[Ge])}}return Z}(y,b,x,m,i,o,s,[h,p],u,l),S.label=6;case 6:return[2,v.map(function(C,T){return{pose:m[T],data:C,height:i,width:o}})]}})})}function iE(t){return Math.floor(t/2)}var _Be=function(){function t(e,n){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=n}return t.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},t.prototype.empty=function(){return this.numberOfElements===-1},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(e){for(;e>0&&this.less(iE(e),e);)this.exchange(e,iE(e)),e=iE(e)},t.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var n=2*e;if(n<this.numberOfElements&&this.less(n,n+1)&&n++,!this.less(e,n))break;this.exchange(e,n),e=n}},t.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},t.prototype.less=function(e,n){return this.getValueAt(e)<this.getValueAt(n)},t.prototype.exchange=function(e,n){var r=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[n],this.priorityQueue[n]=r},t}();function IBe(t,e,n,r,i,o){for(var s=o.shape,a=s[0],u=s[1],c=!0,l=Math.max(n-i,0),d=Math.min(n+i+1,a),f=l;f<d;++f){for(var h=Math.max(r-i,0),p=Math.min(r+i+1,u),m=h;m<p;++m)if(o.get(f,m,t)>e){c=!1;break}if(!c)break}return c}var QQ=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(t){var e=t[0],n=t[1];return[PS[e],PS[n]]}),oE=QQ.map(function(t){return t[1]}),JV=QQ.map(function(t){return t[0]});function sE(t,e,n,r){return{y:KV(Math.round(t.y/e),0,n-1),x:KV(Math.round(t.x/e),0,r-1)}}function YV(t,e,n,r,i,o,s,a){a===void 0&&(a=2);for(var u=r.shape,c=u[0],l=u[1],d=function(y,b,x){var S=x.shape[2]/2;return{y:x.get(b.y,b.x,y),x:x.get(b.y,b.x,S+y)}}(t,sE(e.position,o,c,l),s),f=XV(e.position,d),h=0;h<a;h++){var p=sE(f,o,c,l),m=HQ(p.y,p.x,n,i);f=XV({x:p.x*o,y:p.y*o},{x:m.x,y:m.y})}var v=sE(f,o,c,l),g=r.get(v.y,v.x,n);return{position:f,part:N2[n],score:g}}function RBe(t,e,n,r,i,o){var s=e.shape[2],a=oE.length,u=new Array(s),c=t.part,l=t.score,d=qQ(c,r,n);u[c.id]={score:l,part:N2[c.id],position:d};for(var f=a-1;f>=0;--f){var h=oE[f],p=JV[f];u[h]&&!u[p]&&(u[p]=YV(f,u[h],p,e,n,r,o))}for(f=0;f<a;++f)h=JV[f],p=oE[f],u[h]&&!u[p]&&(u[p]=YV(f,u[h],p,e,n,r,i));return u}function ZQ(t,e,n,r){var i=n.x,o=n.y;return t.some(function(s){var a,u,c,l,d,f,h=s.keypoints[r].position;return a=o,u=i,c=h.y,l=h.x,(d=c-a)*d+(f=l-u)*f<=e})}function NBe(t,e,n){var r=n.reduce(function(i,o,s){var a=o.position,u=o.score;return ZQ(t,e,a,s)||(i+=u),i},0);return r/n.length}function B1(t,e,n,r,i,o,s,a){s===void 0&&(s=.5),a===void 0&&(a=20);for(var u=[],c=function(p,m,v){for(var g=v.shape,y=g[0],b=g[1],x=g[2],S=new _Be(y*b*x,function(N){return N.score}),C=0;C<y;++C)for(var T=0;T<b;++T)for(var E=0;E<x;++E){var I=v.get(C,T,E);I<p||IBe(E,I,C,T,m,v)&&S.enqueue({score:I,part:{heatmapY:C,heatmapX:T,id:E}})}return S}(s,1,t),l=a*a;u.length<o&&!c.empty();){var d=c.dequeue();if(!ZQ(u,l,qQ(d.part,i,e),d.part.id)){var f=RBe(d,t,e,i,n,r),h=NBe(u,l,f);u.push({keypoints:f,score:h})}}return u}var ov,PBe=[-123.15,-115.9,-103.06],ABe=function(t){function e(){return t!==null&&t.apply(this,arguments)||this}return VQ(e,t),e.prototype.preprocessInput=function(n){return it(n,PBe)},e.prototype.nameOutputResults=function(n){var r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],u=n[5];return{offsets:a,segmentation:n[6],partHeatmaps:u,longOffsets:s,heatmap:o,displacementFwd:i,displacementBwd:r,partOffsets:n[7]}},e}(GQ),QV="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",ZV="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function Sv(t){if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return function(e){if("offsetHeight"in e&&e.offsetHeight!==0&&"offsetWidth"in e&&e.offsetWidth!==0)return[e.offsetHeight,e.offsetWidth];if(e.height!=null&&e.width!=null)return[e.height,e.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(t);if(typeof ImageData<"u"&&t instanceof ImageData)return[t.height,t.width];if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return function(e){return e.hasAttribute("height")&&e.hasAttribute("width")?[e.height,e.width]:[e.videoHeight,e.videoWidth]}(t);if(t instanceof Mt)return[t.shape[0],t.shape[1]];throw new Error("error: Unknown input type: "+t+".")}function ez(t,e){return function(n,r){return(n-1)%r==0}(t,e)?t:Math.floor(t/e)*e+1}var Cv={low:"low",medium:"medium",high:"high",full:"full"},$Be=((ov={})[Cv.low]=.25,ov[Cv.medium]=.5,ov[Cv.high]=.75,ov[Cv.full]=1,ov);function U1(t,e,n){var r=n[0],i=n[1],o=function(s){if(typeof s=="string"){var a=$Be[s];return L(typeof a=="number",function(){return"string value of inputResolution must be one of "+Object.values(Cv).join(",")+" but was "+s+"."}),a}return L(typeof s=="number"&&s<=2&&s>=.1,function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+s}),s}(t);return[ez(r*o,e),ez(i*o,e)]}function Zh(t,e,n,r,i){var o=e[0],s=e[1],a=n[0],u=n[1],c=r[0],l=c[0],d=c[1],f=r[1],h=f[0],p=f[1];return i===void 0&&(i=!1),ot(function(){var m=Yf.resizeBilinear(t,[a,u],!0);return i&&(m=uu(m)),function(v,g,y){var b=g[0],x=g[1],S=y[0],C=S[0],T=S[1],E=y[1],I=E[0],N=E[1];return ot(function(){var $=_i(v);return xs(Yf.cropAndResize($,[[C/(b+C+T-1),I/(x+I+N-1),(C+b-1)/(b+C+T-1),(I+x-1)/(x+I+N-1)]],[0],[b,x]),[0])})}(m,[o,s],[[l,d],[h,p]])})}function V1(t,e){var n=e[0],r=e[1],i=Sv(t),o=i[0],s=i[1],a=r/n,u=[0,0,0,0],c=u[0],l=u[1],d=u[2],f=u[3];s/o<a?(c=0,l=0,d=Math.round(.5*(a*o-s)),f=Math.round(.5*(a*o-s))):(c=Math.round(.5*(1/a*s-o)),l=Math.round(.5*(1/a*s-o)),d=0,f=0);var h=ot(function(){var p=function(m){return m instanceof Mt?m:_2(m)}(t);return p=yF(p,[[c,l],[d,f],[0,0]]),Yf.resizeBilinear(p,[n,r])});return{resized:h,padding:{top:c,left:d,right:f,bottom:l}}}function z1(t){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,Promise.all(t.map(function(n){return n.buffer()}))]})})}function W1(t,e,n,r,i){var o=e[0],s=e[1],a=n[0],u=n[1],c=function(l,d,f,h,p){return h===void 0&&(h=0),p===void 0&&(p=0),f===1&&d===1&&h===0&&p===0?l:l.map(function(m){return function(v,g,y,b,x){return b===void 0&&(b=0),x===void 0&&(x=0),{score:v.score,keypoints:v.keypoints.map(function(S){var C=S.score,T=S.part,E=S.position;return{score:C,part:T,position:{x:E.x*y+x,y:E.y*g+b}}})}}(m,d,f,h,p)})}(t,(o+r.top+r.bottom)/a,(s+r.left+r.right)/u,-r.top,-r.left);return i?function(l,d){return d<=0?l:l.map(function(f){return function(h,p){return{score:h.score,keypoints:h.keypoints.map(function(m){var v=m.score,g=m.part,y=m.position;return{score:v,part:g,position:{x:p-1-y.x,y:y.y}}})}}(f,d)})}(c,s):c}var tz={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},nz=["MobileNetV1","ResNet50"],rz={MobileNetV1:[8,16,32],ResNet50:[32,16]},iz={MobileNetV1:[.5,.75,1],ResNet50:[1]},oz=[1,2,4],j1={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},G1={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function sz(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,i=t.nmsRadius;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(i<=0)throw new Error("Invalid nmsRadius "+i+".")}function az(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,i=t.nmsRadius,o=t.minKeypointScore,s=t.refineSteps;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(i<=0)throw new Error("Invalid nmsRadius "+i+".");if(o<0||o>1)throw new Error("Invalid minKeypointScore "+o+".Should be in range [0.0, 1.0]");if(s<=0||s>20)throw new Error("Invalid refineSteps "+s+".Should be in range [1, 20]")}var eZ=function(){function t(e){this.baseModel=e}return t.prototype.predictForPersonSegmentation=function(e){var n=this.baseModel.predict(e);return{segmentLogits:n.segmentation,heatmapScores:n.heatmapScores,offsets:n.offsets,displacementFwd:n.displacementFwd,displacementBwd:n.displacementBwd}},t.prototype.predictForPersonSegmentationAndPart=function(e){var n=this.baseModel.predict(e);return{segmentLogits:n.segmentation,partHeatmapLogits:n.partHeatmaps,heatmapScores:n.heatmapScores,offsets:n.offsets,displacementFwd:n.displacementFwd,displacementBwd:n.displacementBwd}},t.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(e){var n=this.baseModel.predict(e);return{segmentLogits:n.segmentation,longOffsets:n.longOffsets,heatmapScores:n.heatmapScores,offsets:n.offsets,displacementFwd:n.displacementFwd,displacementBwd:n.displacementBwd,partHeatmaps:n.partHeatmaps}},t.prototype.segmentPersonActivation=function(e,n,r){var i=this;r===void 0&&(r=.5);var o=Sv(e),s=o[0],a=o[1],u=U1(n,this.baseModel.outputStride,[s,a]),c=V1(e,u),l=c.resized,d=c.padding,f=ot(function(){var y=i.predictForPersonSegmentation(l),b=y.segmentLogits,x=y.heatmapScores,S=y.offsets,C=y.displacementFwd,T=y.displacementBwd,E=l.shape,I=E[0],N=E[1],$=Zh(b,[s,a],[I,N],[[d.top,d.bottom],[d.left,d.right]],!0);return{segmentation:M1(xs($),r),heatmapScores:x,offsets:S,displacementFwd:C,displacementBwd:T}}),h=f.segmentation,p=f.heatmapScores,m=f.offsets,v=f.displacementFwd,g=f.displacementBwd;return l.dispose(),{segmentation:h,heatmapScores:p,offsets:m,displacementFwd:v,displacementBwd:g,padding:d,internalResolutionHeightAndWidth:u}},t.prototype.segmentPerson=function(e,n){return n===void 0&&(n=j1),kt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x;return Tt(this,function(S){switch(S.label){case 0:return sz(n=ti(ti({},j1),n)),r=this.segmentPersonActivation(e,n.internalResolution,n.segmentationThreshold),i=r.segmentation,o=r.heatmapScores,s=r.offsets,a=r.displacementFwd,u=r.displacementBwd,c=r.padding,l=r.internalResolutionHeightAndWidth,d=i.shape,f=d[0],h=d[1],[4,i.data()];case 1:return p=S.sent(),i.dispose(),[4,z1([o,s,a,u])];case 2:return m=S.sent(),v=m[0],g=m[1],y=m[2],b=m[3],x=W1(x=B1(v,g,y,b,this.baseModel.outputStride,n.maxDetections,n.scoreThreshold,n.nmsRadius),[f,h],l,c,!1),o.dispose(),s.dispose(),a.dispose(),u.dispose(),[2,{height:f,width:h,data:p,allPoses:x}]}})})},t.prototype.segmentMultiPerson=function(e,n){return n===void 0&&(n=G1),kt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E=this;return Tt(this,function(I){switch(I.label){case 0:return az(n=ti(ti({},G1),n)),r=Sv(e),i=r[0],o=r[1],s=U1(n.internalResolution,this.baseModel.outputStride,[i,o]),a=V1(e,s),u=a.resized,c=a.padding,l=ot(function(){var N,$=E.predictForMultiPersonInstanceSegmentationAndPart(u),F=$.segmentLogits,H=$.longOffsets,G=$.heatmapScores,J=$.offsets,ne=$.displacementFwd,oe=$.displacementBwd,q=Zh(F,[i,o],s,[[c.top,c.bottom],[c.left,c.right]],!0);return N=H,{segmentation:M1(xs(q),n.segmentationThreshold),longOffsets:N,heatmapScoresRaw:G,offsetsRaw:J,displacementFwdRaw:ne,displacementBwdRaw:oe}}),d=l.segmentation,f=l.longOffsets,h=l.heatmapScoresRaw,p=l.offsetsRaw,m=l.displacementFwdRaw,v=l.displacementBwdRaw,[4,z1([h,p,m,v])];case 1:return g=I.sent(),y=g[0],b=g[1],x=g[2],S=g[3],C=W1(C=B1(y,b,x,S,this.baseModel.outputStride,n.maxDetections,n.scoreThreshold,n.nmsRadius),[i,o],s,c,!1),[4,TBe(d,f,C,i,o,this.baseModel.outputStride,s,c,n.scoreThreshold,n.refineSteps,n.minKeypointScore,n.maxDetections)];case 2:return T=I.sent(),u.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),m.dispose(),v.dispose(),[2,T]}})})},t.prototype.segmentPersonPartsActivation=function(e,n,r){var i=this;r===void 0&&(r=.5);var o=Sv(e),s=o[0],a=o[1],u=U1(n,this.baseModel.outputStride,[s,a]),c=V1(e,u),l=c.resized,d=c.padding,f=ot(function(){var y=i.predictForPersonSegmentationAndPart(l),b=y.segmentLogits,x=y.partHeatmapLogits,S=y.heatmapScores,C=y.offsets,T=y.displacementFwd,E=y.displacementBwd,I=l.shape,N=I[0],$=I[1],F=Zh(b,[s,a],[N,$],[[d.top,d.bottom],[d.left,d.right]],!0),H=Zh(x,[s,a],[N,$],[[d.top,d.bottom],[d.left,d.right]],!0);return{partSegmentation:wBe(M1(xs(F),r),H),heatmapScores:S,offsets:C,displacementFwd:T,displacementBwd:E}}),h=f.partSegmentation,p=f.heatmapScores,m=f.offsets,v=f.displacementFwd,g=f.displacementBwd;return l.dispose(),{partSegmentation:h,heatmapScores:p,offsets:m,displacementFwd:v,displacementBwd:g,padding:d,internalResolutionHeightAndWidth:u}},t.prototype.segmentPersonParts=function(e,n){return n===void 0&&(n=j1),kt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x;return Tt(this,function(S){switch(S.label){case 0:return sz(n=ti(ti({},j1),n)),r=this.segmentPersonPartsActivation(e,n.internalResolution,n.segmentationThreshold),i=r.partSegmentation,o=r.heatmapScores,s=r.offsets,a=r.displacementFwd,u=r.displacementBwd,c=r.padding,l=r.internalResolutionHeightAndWidth,d=i.shape,f=d[0],h=d[1],[4,i.data()];case 1:return p=S.sent(),i.dispose(),[4,z1([o,s,a,u])];case 2:return m=S.sent(),v=m[0],g=m[1],y=m[2],b=m[3],x=W1(x=B1(v,g,y,b,this.baseModel.outputStride,n.maxDetections,n.scoreThreshold,n.nmsRadius),[f,h],l,c,!1),o.dispose(),s.dispose(),a.dispose(),u.dispose(),[2,{height:f,width:h,data:p,allPoses:x}]}})})},t.prototype.segmentMultiPersonParts=function(e,n){return n===void 0&&(n=G1),kt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,m,v,g,y,b,x,S,C,T,E,I=this;return Tt(this,function(N){switch(N.label){case 0:return az(n=ti(ti({},G1),n)),r=Sv(e),i=r[0],o=r[1],s=U1(n.internalResolution,this.baseModel.outputStride,[i,o]),a=V1(e,s),u=a.resized,c=a.padding,l=ot(function(){var $=I.predictForMultiPersonInstanceSegmentationAndPart(u),F=$.segmentLogits,H=$.longOffsets,G=$.heatmapScores,J=$.offsets,ne=$.displacementFwd,oe=$.displacementBwd,q=$.partHeatmaps,Z=Zh(F,[i,o],s,[[c.top,c.bottom],[c.left,c.right]],!0),se=Zh(q,[i,o],s,[[c.top,c.bottom],[c.left,c.right]],!0),fe=H,xe=M1(xs(Z),n.segmentationThreshold),be=function(pe){var ge=pe.shape,Ce=ge[0],$e=ge[1],Ge=ge[2];return ot(function(){var tt=jQ(pe),mt=_i(md(0,Ge,1,"int32"),1),Ie=Dt(Lt(tt,mt),"int32");return ve(Ie,[Ce,$e])})}(se);return{segmentation:xe,longOffsets:fe,heatmapScoresRaw:G,offsetsRaw:J,displacementFwdRaw:ne,displacementBwdRaw:oe,partSegmentation:be}}),d=l.segmentation,f=l.longOffsets,h=l.heatmapScoresRaw,p=l.offsetsRaw,m=l.displacementFwdRaw,v=l.displacementBwdRaw,g=l.partSegmentation,[4,z1([h,p,m,v])];case 1:return y=N.sent(),b=y[0],x=y[1],S=y[2],C=y[3],T=W1(T=B1(b,x,S,C,this.baseModel.outputStride,n.maxDetections,n.scoreThreshold,n.nmsRadius),[i,o],s,c,!1),[4,EBe(d,f,g,T,i,o,this.baseModel.outputStride,s,c,n.scoreThreshold,n.refineSteps,n.minKeypointScore,n.maxDetections)];case 2:return E=N.sent(),u.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),m.dispose(),v.dispose(),g.dispose(),[2,E]}})})},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function DBe(t){return kt(this,void 0,void 0,function(){var e,n,r,i,o,s;return Tt(this,function(a){switch(a.label){case 0:if(e=t.outputStride,n=t.quantBytes,r=t.multiplier,LQ==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return i=function(u,c,l){var d={1:"100",.75:"075",.5:"050"},f="model-stride"+u+".json";return l===4?ZV+"float/"+d[c]+"/"+f:ZV+"quant"+l+"/"+d[c]+"/"+f}(e,r,n),[4,c3(t.modelUrl||i)];case 1:return o=a.sent(),s=new SBe(o,e),[2,new eZ(s)]}})})}function OBe(t){return kt(this,void 0,void 0,function(){var e,n,r,i,o;return Tt(this,function(s){switch(s.label){case 0:if(e=t.outputStride,n=t.quantBytes,LQ==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return r=function(a,u){var c="model-stride"+a+".json";return u===4?QV+"float/"+c:QV+"quant"+u+"/"+c}(e,n),[4,c3(t.modelUrl||r)];case 1:return i=s.sent(),o=new ABe(i,e),[2,new eZ(o)]}})})}function FBe(t){return t===void 0&&(t=tz),kt(this,void 0,void 0,function(){return Tt(this,function(e){return(t=function(n){if((n=n||tz).architecture==null&&(n.architecture="MobileNetV1"),nz.indexOf(n.architecture)<0)throw new Error("Invalid architecture "+n.architecture+". Should be one of "+nz);if(n.outputStride==null&&(n.outputStride=16),rz[n.architecture].indexOf(n.outputStride)<0)throw new Error("Invalid outputStride "+n.outputStride+". Should be one of "+rz[n.architecture]+" for architecture "+n.architecture+".");if(n.multiplier==null&&(n.multiplier=1),iz[n.architecture].indexOf(n.multiplier)<0)throw new Error("Invalid multiplier "+n.multiplier+". Should be one of "+iz[n.architecture]+" for architecture "+n.architecture+".");if(n.quantBytes==null&&(n.quantBytes=4),oz.indexOf(n.quantBytes)<0)throw new Error("Invalid quantBytes "+n.quantBytes+". Should be one of "+oz+" for architecture "+n.architecture+".");return n}(t)).architecture==="ResNet50"?[2,OBe(t)]:t.architecture==="MobileNetV1"?[2,DBe(t)]:[2,null]})})}var TR=["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],uz=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,l3(this.mask)]})})},t.prototype.toImageData=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,this.mask]})})},t.prototype.toTensor=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,WQ(this.mask)]})})},t.prototype.getUnderlyingType=function(){return"imagedata"},t}();function LBe(t){if(R2(t),t!==255)throw new Error("Foreground id must be 255 but got "+t);return"person"}function MBe(t){if(R2(t),t>=TR.length)throw new Error("Invalid body part value "+t);return TR[t]}var BBe=function(){function t(e){this.bodyPixModel=e}return t.prototype.segmentPeople=function(e,n){return kt(this,void 0,void 0,function(){var r,i,o,s;return Tt(this,function(a){switch(a.label){case 0:return e instanceof ImageBitmap&&((r=document.createElement("canvas")).getContext("2d").drawImage(e,0,0),e=r),n.segmentBodyParts?n.multiSegmentation?[4,this.bodyPixModel.segmentMultiPersonParts(e,n)]:[3,2]:[3,5];case 1:return o=a.sent(),[3,4];case 2:return[4,this.bodyPixModel.segmentPersonParts(e,n)];case 3:o=[a.sent()],a.label=4;case 4:return i=o.map(function(u){var c=u.data,l=u.width,d=u.height,f=new Uint8ClampedArray(l*d*4).fill(0);return c.forEach(function(h,p){h===-1?(f[4*p]=TR.length,f[4*p+3]=0):(f[4*p]=h,f[4*p+3]=255)}),{maskValueToLabel:MBe,mask:new uz(new ImageData(f,l,d))}}),[3,10];case 5:return n.multiSegmentation?[4,this.bodyPixModel.segmentMultiPerson(e,n)]:[3,7];case 6:return s=a.sent(),[3,9];case 7:return[4,this.bodyPixModel.segmentPerson(e,n)];case 8:s=[a.sent()],a.label=9;case 9:i=s.map(function(u){var c=u.data,l=u.width,d=u.height,f=new Uint8ClampedArray(l*d*4).fill(0);return c.forEach(function(h,p){h===0?(f[4*p]=0,f[4*p+3]=0):(f[4*p]=255,f[4*p+3]=255)}),{maskValueToLabel:LBe,mask:new uz(new ImageData(f,l,d))}}),a.label=10;case 10:return[2,i]}})})},t.prototype.dispose=function(){this.bodyPixModel.dispose()},t.prototype.reset=function(){},t}();function UBe(t){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,FBe(t).then(function(n){return new BBe(n)})]})})}var cz={runtime:"mediapipe",modelType:"general"},VBe=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,this.mask]})})},t.prototype.toImageData=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,zQ(this.mask)]})})},t.prototype.toTensor=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,WQ(this.mask)]})})},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function zBe(t){return R2(t),"person"}var WBe=function(){function t(e){var n,r=this;this.selfieMode=!1;var i;this.selfieSegmentationSolution=new xBe.SelfieSegmentation({locateFile:(n=e.locateFile)!==null&&n!==void 0?n:function(o,s){return e.solutionPath?e.solutionPath.replace(/\/+$/,"")+"/"+o:s+"/"+o}}),e.modelType==="landscape"?i=1:i=0,this.selfieSegmentationSolution.setOptions({modelSelection:i,selfieMode:this.selfieMode}),this.selfieSegmentationSolution.onResults(function(o){r.segmentation=[{maskValueToLabel:zBe,mask:new VBe(o.segmentationMask)}]})}return t.prototype.segmentPeople=function(e,n){return kt(this,void 0,void 0,function(){var r,i;return Tt(this,function(o){switch(o.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.selfieSegmentationSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Mt?(i=ImageData.bind,[4,cb(e)]):[3,2];case 1:return r=new(i.apply(ImageData,[void 0,o.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:r=e,o.label=3;case 3:return e=r,[4,this.selfieSegmentationSolution.send({image:e})];case 4:return o.sent(),[2,this.segmentation]}})})},t.prototype.dispose=function(){this.selfieSegmentationSolution.close()},t.prototype.reset=function(){this.selfieSegmentationSolution.reset(),this.segmentation=null,this.selfieMode=!1},t.prototype.initialize=function(){return this.selfieSegmentationSolution.initialize()},t}();function jBe(t){return kt(this,void 0,void 0,function(){var e,n;return Tt(this,function(r){switch(r.label){case 0:return e=function(i){if(i==null)return ti({},cz);var o=ti({},i);return o.runtime="mediapipe",o.modelType==null&&(o.modelType=cz.modelType),o}(t),[4,(n=new WBe(e)).initialize()];case 1:return r.sent(),[2,n]}})})}function GBe(t,e,n,r){var i=t.width,o=t.height,s=r?-1:1,a=Math.cos(t.rotation),u=Math.sin(t.rotation),c=t.xCenter,l=t.yCenter,d=1/e,f=1/n,h=new Array(16);return h[0]=i*a*s*d,h[1]=-o*u*d,h[2]=0,h[3]=(-.5*i*a*s+.5*o*u+c)*d,h[4]=i*u*s*f,h[5]=o*a*f,h[6]=0,h[7]=(-.5*o*a-.5*i*u*s+l)*f,h[8]=0,h[9]=0,h[10]=i*d,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,function(p){if(p.length!==16)throw new Error("Array length must be 16 but got "+p.length);return[[p[0],p[1],p[2],p[3]],[p[4],p[5],p[6],p[7]],[p[8],p[9],p[10],p[11]],[p[12],p[13],p[14],p[15]]]}(h)}function tZ(t){return t instanceof Mt?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function aE(t,e){L(t.width!==0,function(){return e+" width cannot be 0."}),L(t.height!==0,function(){return e+" height cannot be 0."})}function HBe(t,e){var n=function(r,i,o,s){var a=i-r,u=s-o;if(a===0)throw new Error("Original min and max are both "+r+", range cannot be 0.");var c=u/a;return{scale:c,offset:o-r*c}}(0,255,e[0],e[1]);return ot(function(){return it(Pe(t,n.scale),n.offset)})}function qBe(t,e,n){var r=e.outputTensorSize,i=e.keepAspectRatio,o=e.borderMode,s=e.outputTensorFloatRange,a=tZ(t),u=function(f,h){return h?{xCenter:h.xCenter*f.width,yCenter:h.yCenter*f.height,width:h.width*f.width,height:h.height*f.height,rotation:h.rotation}:{xCenter:.5*f.width,yCenter:.5*f.height,width:f.width,height:f.height,rotation:0}}(a,n),c=function(f,h,p){if(p===void 0&&(p=!1),!p)return{top:0,left:0,right:0,bottom:0};var m=h.height,v=h.width;aE(h,"targetSize"),aE(f,"roi");var g,y,b=m/v,x=f.height/f.width,S=0,C=0;return b>x?(g=f.width,y=f.width*b,C=(1-x/b)/2):(g=f.height/b,y=f.height,S=(1-b/x)/2),f.width=g,f.height=y,{top:C,left:S,right:S,bottom:C}}(u,r,i),l=GBe(u,a.width,a.height,!1),d=ot(function(){var f,h=(f=t)instanceof Mt?f:_2(f),p=Af(function(g,y,b){return aE(b,"inputResolution"),[1/b.width*g[0][0]*y.width,1/b.height*g[0][1]*y.width,g[0][3]*y.width,1/b.width*g[1][0]*y.height,1/b.height*g[1][1]*y.height,g[1][3]*y.height,0,0]}(l,a,r),[1,8]),m=o==="zero"?"constant":"nearest",v=Yf.transform(_i(Dt(h,"float32")),p,"bilinear",m,0,[r.height,r.width]);return s!=null?HBe(v,s):v});return{imageTensor:d,padding:c,transformationMatrix:l}}function KBe(t,e,n){return ot(function(){var r=xs(t,[0]),i=r.shape[2];if(i===1){var o=r;switch(e.activation){case"none":break;case"sigmoid":o=uu(o);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+e.activation+")")}var s=n?Yf.resizeBilinear(o,[n.height,n.width]):o;return xs(s,[2])}throw new Error("Unsupported number of tensor channels "+i)})}var lz={runtime:"tfjs",modelType:"general",modelUrl:"https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1"},dz={flipHorizontal:!1},XBe={outputTensorSize:{width:256,height:256},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},JBe={outputTensorSize:{width:256,height:144},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},YBe={activation:"none"},QBe=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,l3(this.mask)]})})},t.prototype.toImageData=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,zQ(this.mask)]})})},t.prototype.toTensor=function(){return kt(this,void 0,void 0,function(){return Tt(this,function(e){return[2,this.mask]})})},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function ZBe(t){return R2(t),"person"}var l0,eUe=function(){function t(e,n){this.modelType=e,this.model=n}return t.prototype.segmentPeople=function(e,n){return kt(this,void 0,void 0,function(){var r,i=this;return Tt(this,function(o){return n=function(s){if(s==null)return ti({},dz);var a=ti({},s);return a.flipHorizontal==null&&(a.flipHorizontal=dz.flipHorizontal),a}(n),e==null?(this.reset(),[2,[]]):(r=ot(function(){var s=qBe(e,i.modelType==="general"?XBe:JBe).imageTensor,a=Jt(i.model.predict(s),[0,0,0,1],-1),u=tZ(e),c=KBe(a,YBe,u),l=_i(c,2),d=kh(l,[[0,0],[0,0],[0,1]]);return gF(d,[[0,0],[0,0],[0,2]],"symmetric")}),[2,[{maskValueToLabel:ZBe,mask:new QBe(r)}]])})})},t.prototype.dispose=function(){this.model.dispose()},t.prototype.reset=function(){},t}();function tUe(t){return kt(this,void 0,void 0,function(){var e,n,r;return Tt(this,function(i){switch(i.label){case 0:return e=function(o){if(o==null)return ti({},lz);var s=ti({},o);if(s.runtime="tfjs",s.modelType==null&&(s.modelType=lz.modelType),s.modelType!=="general"&&s.modelType!=="landscape")throw new Error("Model type must be one of general or landscape, but got "+s.modelType);return s.modelUrl==null&&(s.modelType==="general"?s.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1":s.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/landscape/1"),s}(t),n=typeof e.modelUrl=="string"&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,c3(e.modelUrl,{fromTFHub:n})];case 1:return r=i.sent(),[2,new eUe(e.modelType,r)]}})})}function nUe(t,e){return kt(this,void 0,void 0,function(){var n,r;return Tt(this,function(i){switch(t){case l0.MediaPipeSelfieSegmentation:if(n=void 0,(r=e)!=null){if(r.runtime==="tfjs")return[2,tUe(r)];if(r.runtime==="mediapipe")return[2,jBe(r)];n=r.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+n);case l0.BodyPix:return[2,UBe(r=e)];default:throw new Error(t+" is not a supported model name.")}})})}(function(t){t.BodyPix="BodyPix",t.MediaPipeSelfieSegmentation="MediaPipeSelfieSegmentation"})(l0||(l0={}));var rUe="blurred",iUe="blurred-mask",oUe="mask",sUe="draw-image",uE={};function P2(t){if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return function(e){if("offsetHeight"in e&&e.offsetHeight!==0&&"offsetWidth"in e&&e.offsetWidth!==0)return[e.offsetHeight,e.offsetWidth];if(e.height!=null&&e.width!=null)return[e.height,e.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(t);if(typeof ImageData<"u"&&t instanceof ImageData)return[t.height,t.width];if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return function(e){return e.hasAttribute("height")&&e.hasAttribute("width")?[e.height,e.width]:[e.videoHeight,e.videoWidth]}(t);if(t instanceof Mt)return[t.shape[0],t.shape[1]];throw new Error("error: Unknown input type: "+t+".")}function nZ(t){return uE[t]||(uE[t]=function(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")}()),uE[t]}function rZ(t,e){var n=nZ(e);return function(r,i){i.width=r.width,i.height=r.height,i.getContext("2d").putImageData(r,0,0)}(t,n),n}function lb(t,e,n,r,i,o){return kt(this,void 0,void 0,function(){var s,a,u,c;return Tt(this,function(l){switch(l.label){case 0:return e instanceof Mt?[4,cb(e)]:[3,2];case 1:s=l.sent(),a=P2(e),u=a[0],c=a[1],e=new ImageData(s,c,u),l.label=2;case 2:return e instanceof ImageData&&(e=rZ(e,sUe)),i==null||o==null?t.drawImage(e,n,r):t.drawImage(e,n,r,i,o),[2]}})})}function aUe(t,e){return kt(this,void 0,void 0,function(){var n,r,i;return Tt(this,function(o){switch(o.label){case 0:return n=P2(t),r=n[0],i=n[1],e.width=i,e.height=r,[4,lb(e.getContext("2d"),t,0,0,i,r)];case 1:return o.sent(),[2]}})})}function uUe(t){var e=t.getContext("2d");e.scale(-1,1),e.translate(-t.width,0)}function fz(t,e,n){return kt(this,void 0,void 0,function(){return Tt(this,function(r){switch(r.label){case 0:return t.globalCompositeOperation=n,[4,lb(t,e,0,0)];case 1:return r.sent(),[2]}})})}function cUe(t,e,n){return kt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l;return Tt(this,function(d){switch(d.label){case 0:for(r=t.getContext("2d"),i=0,o=5,s=1/(2*Math.PI*o*o),a=n<3?1:2,c=-n;c<=n;c+=a)for(l=-n;l<=n;l+=a)u=s*Math.exp(-(l*l+c*c)/(2*o*o)),i+=u;c=-n,d.label=1;case 1:if(!(c<=n))return[3,6];l=-n,d.label=2;case 2:return l<=n?(r.globalAlpha=s*Math.exp(-(l*l+c*c)/(2*o*o))/i*n,[4,lb(r,e,l,c)]):[3,5];case 3:d.sent(),d.label=4;case 4:return l+=a,[3,2];case 5:return c+=a,[3,1];case 6:return r.globalAlpha=1,[2]}})})}function lUe(t,e,n){return kt(this,void 0,void 0,function(){var r,i,o,s;return Tt(this,function(a){switch(a.label){case 0:return r=P2(t),i=r[0],o=r[1],s=n.getContext("2d"),n.width=o,n.height=i,s.clearRect(0,0,o,i),s.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?[4,cUe(n,t,e)]:[3,2];case 1:return a.sent(),[3,4];case 2:return s.filter="blur("+e+"px)",[4,lb(s,t,0,0,o,i)];case 3:a.sent(),a.label=4;case 4:return s.restore(),[2]}})})}function iZ(t,e,n){return kt(this,void 0,void 0,function(){var r;return Tt(this,function(i){switch(i.label){case 0:return r=nZ(n),e!==0?[3,2]:[4,aUe(t,r)];case 1:return i.sent(),[3,4];case 2:return[4,lUe(t,e,r)];case 3:i.sent(),i.label=4;case 4:return[2,r]}})})}function dUe(t,e,n,r,i,o){o===void 0&&(o={r:0,g:255,b:255,a:255});for(var s=-i;s<=i;s++)for(var a=-i;a<=i;a++)if(s!==0&&a!==0){var u=(e+s)*r+(n+a);t[4*u+0]=o.r,t[4*u+1]=o.g,t[4*u+2]=o.b,t[4*u+3]=o.a}}function fUe(t,e,n,r,i,o,s){s===void 0&&(s=1);for(var a=0,u=-s;u<=s;u++)for(var c=-s;c<=s;c++)if(u!==0&&c!==0){var l=(e+u)*r+(n+c);(!i[t[4*l]]||t[4*l+3]<o)&&(a+=1)}return a>0}function hUe(t,e,n,r,i,o){return e===void 0&&(e={r:0,g:0,b:0,a:0}),n===void 0&&(n={r:0,g:0,b:0,a:255}),r===void 0&&(r=!1),i===void 0&&(i=.5),o===void 0&&(o=Array.from(Array(256).keys())),kt(this,void 0,void 0,function(){var s,a,u,c,l,d,f,h,p,m,v,g,y,b;return Tt(this,function(x){switch(x.label){case 0:return(s=Array.isArray(t)?t:[t]).length===0?[2,null]:[4,Promise.all(s.map(function(S){return S.mask.toImageData()}))];case 1:for(a=x.sent(),u=a[0],c=u.width,l=u.height,d=new Uint8ClampedArray(c*l*4),f=Math.round(255*i),h=new Array(256).fill(!1),o.forEach(function(S){return h[S]=!0}),p=0;p<l;p++)for(m=0;m<c;m++)for(d[4*(v=p*c+m)+0]=n.r,d[4*v+1]=n.g,d[4*v+2]=n.b,d[4*v+3]=n.a,g=0,y=a;g<y.length;g++)b=y[g],h[b.data[4*v]]&&b.data[4*v+3]>=f&&(d[4*v]=e.r,d[4*v+1]=e.g,d[4*v+2]=e.b,d[4*v+3]=e.a,r&&p-1>=0&&p+1<l&&m-1>=0&&m+1<c&&fUe(b.data,p,m,c,h,f)&&dUe(d,p,m,c,1));return[2,new ImageData(d,c,l)]}})})}function pUe(t,e,n){return kt(this,void 0,void 0,function(){var r,i;return Tt(this,function(o){switch(o.label){case 0:return[4,hUe(t,{r:0,g:0,b:0,a:255},{r:0,g:0,b:0,a:0},!1,e)];case 1:return r=o.sent(),i=rZ(r,oUe),n===0?[2,i]:[2,iZ(i,n,iUe)]}})})}function mUe(t,e,n,r,i,o,s){return r===void 0&&(r=.5),i===void 0&&(i=3),o===void 0&&(o=3),s===void 0&&(s=!1),kt(this,void 0,void 0,function(){var a,u,c,l,d,f;return Tt(this,function(h){switch(h.label){case 0:return[4,iZ(e,i,rUe)];case 1:return a=h.sent(),t.width=a.width,t.height=a.height,u=t.getContext("2d"),Array.isArray(n)&&n.length===0?(u.drawImage(a,0,0),[2]):[4,pUe(n,r,o)];case 2:return c=h.sent(),u.save(),s&&uUe(t),l=P2(e),d=l[0],f=l[1],[4,lb(u,e,0,0,f,d)];case 3:return h.sent(),[4,fz(u,c,"destination-in")];case 4:return h.sent(),[4,fz(u,a,"destination-over")];case 5:return h.sent(),u.restore(),[2]}})})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const af={},H1={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function gUe(t,e){af[t]=e}function da(t,e){if(!(t in af)||e!=null){const r=yUe(t,e);if(r!==null)af[t]=r;else return console.log("Could not get context for WebGL version",t),null}const n=af[t];return n==null||n.isContextLost()?(delete af[t],da(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),af[t])}function vUe(t){if(!ae().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function yUe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??vUe(t);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete af[t]},!1),ae().getBool("SOFTWARE_WEBGL_ENABLED")&&(H1.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",H1)||n.getContext("experimental-webgl",H1):n.getContext("webgl2",H1)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var d0;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(d0||(d0={}));var $o;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})($o||($o={}));var wr;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(wr||(wr={}));function db(t,e){return[e,t]}function bUe(t,e){return t*e}function q1(t){const e=_e(t),n=Math.ceil(e/4);return mS(n)}function cg(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function xUe(t,e){const[n,r]=cg(t,e);return n*r*4}function f3(t,e){const n=t;let r,i,o,s,a,u,c,l,d,f;return ae().getNumber("WEBGL_VERSION")===2?(r=n.R32F,i=n.R16F,o=n.RGBA16F,s=n.RGBA32F,a=n.RED,c=4,l=1,d=n.HALF_FLOAT,f=n.FLOAT,u=n.RGBA8):(r=t.RGBA,i=t.RGBA,o=t.RGBA,s=n.RGBA,a=t.RGBA,c=4,l=4,d=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,u=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:d,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(t,e){const n=e();return ae().getBool("DEBUG")&&wUe(t),n}function wUe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+TUe(t,e))}const SUe=596e-10,CUe=65504;function kUe(t){return!!(ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||SUe<Math.abs(t)&&Math.abs(t)<CUe)}function TUe(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function K1(t,e){return el(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function EUe(t,e){const n=el(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Fe(t,()=>t.shaderSource(n,e)),Fe(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function _Ue(t,e){const n=el(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Fe(t,()=>t.shaderSource(n,e)),Fe(t,()=>t.compileShader(n)),ae().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw oZ(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const IUe=/ERROR: [0-9]+:([0-9]+):/g;function oZ(t,e){const n=IUe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const r=+n[1],i=t.split(`
`),o=i.length.toString().length+2,s=i.map((d,f)=>Rf((f+1).toString(),o)+d);let a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);const u=s.slice(0,r-1),c=s.slice(r-1,r),l=s.slice(r);console.log(u.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Rf(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join(`
`))}function RUe(t){return el(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function NUe(t,e){if(Fe(t,()=>t.linkProgram(e)),!ae().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function cE(t,e){if(Fe(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function PUe(t,e){const n=el(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Fe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Fe(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function AUe(t,e){const n=el(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Fe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),Fe(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function $Ue(t){return el(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function DUe(t,e){const n=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const r=`[${t}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n){const r=`[${t}x${e}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}function OUe(t){return el(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function hz(t,e,n,r,i,o,s){const a=t.getAttribLocation(e,n);return a===-1?!1:(Fe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),Fe(t,()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,o,s)),Fe(t,()=>t.enableVertexAttribArray(a)),!0)}function FUe(t,e,n){VUe(t,n),Fe(t,()=>t.activeTexture(t.TEXTURE0+n)),Fe(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function LUe(t,e,n){return el(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function MUe(t,e,n){return t.getUniformLocation(e,n)}function BUe(t,e,n,r){Fe(t,()=>FUe(t,e,r)),Fe(t,()=>t.uniform1i(n,r))}function lE(t,e,n){Fe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Fe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function pz(t,e){Fe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Fe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function X1(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+UUe(t,e))}function UUe(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function el(t,e,n){const r=Fe(t,()=>e());if(r==null)throw new Error(n);return r}function VUe(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function Um(t,e=2){return _e(t.slice(0,t.length-e))}function Vm(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function J1(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Um(t),...Vm(t)]),e}function zUe(t,e=!1){let n=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=ae().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&ae().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),e&&(n=n*2,r=r*2,t=t.map((a,u)=>u>=t.length-2?s2(t[u]):t[u]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Qc(t).newShape);let i=_e(t),o=null;t.length<=1&&i<=n?o=[1,i]:t.length===2&&t[0]<=n&&t[1]<=n?o=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?o=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?o=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?o=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(o=[t[0],t[1]*t[2]*t[3]]);const s=o!=null&&Math.max(...o)>r&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||s)if(e){const a=Um(t);let u=2,c=2;t.length&&([u,c]=Vm(t)),i=a*(u/2)*(c/2),o=mS(i).map(l=>l*2)}else o=mS(i);return o}function Y1(t){return t%2===0}function AS(t,e){if(t=t.slice(-2),e=e.slice(-2),yn(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],r=e[e.length-1];if(n===r||Y1(n)&&Y1(r)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Y1(t[0])&&Y1(e[0])}let dE,fE;function WUe(t){if(dE==null){const e=da(t);dE=e.getParameter(e.MAX_TEXTURE_SIZE)}return dE}function jUe(t){if(fE==null){const e=da(t);fE=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,fE)}function GUe(t){if(t===0)return 0;let e;const n=da(t);return ws(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:ws(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function ws(t,e){return t.getExtension(e)!=null}function mz(t){try{if(da(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function HUe(t){if(t===0)return!1;const e=da(t);if(t===1){if(!ws(e,"OES_texture_float"))return!1}else if(!ws(e,"EXT_color_buffer_float"))return!1;return ER(e)}function qUe(t){if(t===0)return!1;const e=da(t);if(t===1){if(!ws(e,"OES_texture_float")||!ws(e,"WEBGL_color_buffer_float"))return!1}else{if(ws(e,"EXT_color_buffer_float"))return ER(e);const r="EXT_color_buffer_half_float";if(ws(e,r)){const i=e.getExtension(r);return KUe(e,i)}return!1}return ER(e)}function ER(t){const e=f3(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const r=1,i=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,r,i,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),s}function KUe(t,e){const n=f3(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=1,o=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,o,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function XUe(t){return t!==2?!1:da(t).fenceSync!=null}function fb(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&L(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qe=ae();qe.registerFlag("HAS_WEBGL",()=>qe.getNumber("WEBGL_VERSION")>0);qe.registerFlag("WEBGL_VERSION",()=>mz(2)?2:mz(1)?1:0);qe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);qe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>qe.get("WEBGL_VERSION")===2);qe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);qe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);qe.registerFlag("WEBGL_PACK",()=>qe.getBool("HAS_WEBGL"));qe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_CLIP",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_REDUCE",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_LAZILY_UNPACK",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_CONV_IM2COL",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>WUe(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>jUe(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=qe.getNumber("WEBGL_VERSION");return t===0?0:GUe(t)});qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>qe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!zO());qe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>HUe(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>qe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:qe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));qe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>qUe(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>XUe(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>qe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);qe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});qe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>zO()?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});qe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);qe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);qe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);qe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);qe.registerFlag("WEBGL_EXP_CONV",()=>!1);qe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>qe.getBool("IS_TEST"));qe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);qe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);qe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);qe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bi(){let t,e,n,r,i,o,s,a,u,c;return ae().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a=ae().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eh(t,e,n="index"){const r=dr(e);return r.map((i,o)=>{const s=`int ${t[o]} = ${n} / ${i}`,a=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${i}`:`index -= ${t[o]} * ${i}`;return`${s}; ${a};`}).join("")}function A2(t,e,n="index"){const r=dr(e);return r.map((i,o)=>{const s=`int ${t[o]} = ${n} / outShapeStrides[${o}]`,a=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * outShapeStrides[${o}]`:`index -= ${t[o]} * outShapeStrides[${o}]`;return`${s}; ${a};`}).join("")}function JUe(t,e){const n=t.length,r=t.map(o=>`${e}[${o}]`),i=new Array(n-1);i[n-2]=r[n-1];for(let o=n-3;o>=0;--o)i[o]=`(${i[o+1]} * ${r[o+1]})`;return i}function YUe(t,e,n="index"){const r=t.map((o,s)=>s),i=JUe(r,e);return i.map((o,s)=>{const a=`int ${t[s]} = ${n} / ${i[s]}`,u=s===i.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * ${i[s]}`:`index -= ${t[s]} * ${i[s]}`;return`${a}; ${u};`}).join("")}function h3(t){const e=dr(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function p3(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const sZ=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:aZ}=FQ;function QUe(t,e,n){const r=[];if(t.forEach(h=>{const p=_e(h.shapeInfo.logicalShape);if(h.shapeInfo.isUniform?r.push(`uniform float ${h.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${h.name};`),r.push(`uniform int offset${h.name};`)),n.enableShapeUniforms){const{uniformShape:m}=m3(n.packedInputs,h.shapeInfo.logicalShape,h.shapeInfo.texShape);switch(m.length){case 1:r.push(`uniform int ${h.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${h.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${h.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${h.name}Shape;`);break}r.push(`uniform ivec2 ${h.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(h=>{r.push(`uniform ${h.type} ${h.name}${h.arrayIndex?`[${h.arrayIndex}]`:""};`)});const i=r.join(`
`),o=t.map(h=>ZUe(h,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),s=e.texShape,a=bi(),u=nVe(a);let c,l,d=oVe(a);return e.isPacked?(c=eVe(e.logicalShape,s,n.enableShapeUniforms),l=iVe(a)):(c=tVe(e.logicalShape,s,n.enableShapeUniforms),l=rVe(a)),n.packedInputs&&(d+=cVe),[d,u,l,i,c,o,n.userCode].join(`
`)}function lg(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return wVe(t,e);case 1:return CVe(t,e);case 2:return TVe(t,e);case 3:return _Ve(t,e);case 4:return RVe(t,e);case 5:return NVe(t);case 6:return PVe(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function uZ(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return xVe(t);case 1:return SVe(t,e);case 2:return kVe(t,e);case 3:return EVe(t,e);default:return IVe(t,e)}}function ZUe(t,e,n=!1,r){let i="";n?i+=uZ(t,r):i+=lg(t,r);const o=t.shapeInfo.logicalShape,s=e.logicalShape;return o.length<=s.length&&(n?i+=AVe(t,e):i+=$Ve(t,e)),i}function eVe(t,e,n){switch(t.length){case 0:return cZ();case 1:return lVe(t,e,n);case 2:return yVe(t,e,n);case 3:return fVe(t,e,n);default:return pVe(t,e,n)}}function tVe(t,e,n){switch(t.length){case 0:return cZ();case 1:return dVe(t,e,n);case 2:return bVe(t,e,n);case 3:return hVe(t,e,n);case 4:return mVe(t,e,n);case 5:return gVe(t,e);case 6:return vVe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function nVe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function rVe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function iVe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function oVe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${sVe}
    ${aVe}
    ${uVe}
  `}const sVe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,aVe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,uVe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,cVe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function cZ(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function lVe(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function dVe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function fVe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),o=i*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function hVe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${A2(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const r=Eh(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function pVe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),o=i*Math.ceil(t[t.length-2]/2);let s=o,a="",u="b, r, c";for(let c=2;c<t.length-1;c++)s*=t[t.length-c-1],a=`
      int b${c} = index / ${s};
      index -= b${c} * ${s};
    `+a,u=`b${c}, `+u;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${t.length}(${u});
    }
  `}function mVe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${A2(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const r=Eh(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function gVe(t,e){const n=Eh(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function vVe(t,e){const n=Eh(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function yVe(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(yn(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const i=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function bVe(t,e,n){return yn(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function _h(t){return`offset${t}`}function xVe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=bi();return`
    vec4 ${n}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function wVe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,o]=t.shapeInfo.texShape;if(i===1&&o===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const s=_h(n);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${s});
      return sampleTexture(${n}, uv);
    }
  `;const[a,u]=t.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${u}, ${s});
      return sampleTexture(${n}, uv);
    }
  `}function SVe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=bi();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${n}, uv);
    }
  `;const s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${s[0]}, ${s[1]}, index);
      return ${o.texture2D}(${n}, uv);
    }
  `}function CVe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${dg(t)}
      }
    `;const i=t.shapeInfo.texShape,o=i[0],s=i[1];if(s===1&&o===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=_h(n);return s===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${s}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${o}, ${s}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function kVe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,s=o[0],a=o[1],u=bi();if(o!=null&&yn(n,o))return e?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${s}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${l}, ${c[0]}, ${c[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function TVe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape;if(o!=null&&yn(n,o)){if(e)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const f=o[0],h=o[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${h}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:s,keptDims:a}=Qc(n),u=s;if(u.length<n.length){const f=fg(t,u),h=["row","col"];return`
      ${lg(f,e)}
      float ${i}(int row, int col) {
        return ${i}(${hg(h,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${dg(t)}
      }
    `;const c=o[0],l=o[1],d=_h(r);return l===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${r}, uv);
    }
  `:c===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${l}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${l}, index);
    return sampleTexture(${r}, uv);
  }
`}function EVe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){const f=n.slice(1),h=[1,2],p=fg(t,f),m=["b","row","col"];return`
        ${uZ(p,e)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${hg(m,h)});
        }
      `}const a=bi();if(e)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const u=s[0],c=s[1],l=Math.ceil(n[2]/2),d=l*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${c}, ${d}, ${l}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function _Ve(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],s=n[2],{newShape:a,keptDims:u}=Qc(n),c=a;if(c.length<n.length){const m=fg(t,c),v=["row","col","depth"];return`
        ${lg(m,e)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${hg(v,u)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${s}, 1)));
        ${dg(t)}
      }
    `;const l=t.shapeInfo.texShape,d=l[0],f=l[1],h=t.shapeInfo.flatOffset;if(f===o&&h==null)return e?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${s}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(f===s&&h==null)return e?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=_h(r);return e?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${s} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${r}, uv);
      }
  `}function IVe(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=bi();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const o=t.shapeInfo.logicalShape,s=o.length,a=t.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=u[0],l=u[1],d=Math.ceil(o[s-1]/2);let f=d*Math.ceil(o[s-2]/2),h="int b, int row, int col",p=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<s-1;m++)h=`int b${m}, `+h,f*=o[s-m-1],p=`b${m} * ${f} + `+p;return`
    vec4 ${r}(${h}) {
      int index = ${p};
      int texR = index / ${l};
      int texC = index - texR * ${l};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${c});
      return ${i.texture2D}(${n}, uv);
    }
  `}function RVe(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],s=n[2]*o,a=n[1]*s,{newShape:u,keptDims:c}=Qc(n);if(u.length<n.length){const y=fg(t,u),b=["row","col","depth","depth2"];return`
      ${lg(y,e)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${hg(b,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${s}, ${o}, 1)));
        ${dg(t)}
      }
    `;const l=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],h=d[1],p=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,v=`int stride0 = ${r}Shape[1] * stride1;`;if(h===a&&l==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(h===o&&l==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;const g=_h(r);return e?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${g});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${h}, index + ${g});
      return sampleTexture(${r}, uv);
    }
  `}function NVe(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],o=e[3]*i,s=e[2]*o,a=e[1]*s,{newShape:u,keptDims:c}=Qc(e);if(u.length<e.length){const m=fg(t,u),v=["row","col","depth","depth2","depth3"];return`
      ${lg(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${hg(v,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${o}, ${i})) +
          depth3;
        ${dg(t)}
      }
    `;const l=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],h=d[1];if(h===a&&l==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(h===i&&l==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=_h(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${o} +
          depth2 * ${i} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${h}, index);
      return sampleTexture(${n}, uv);
    }
  `}function PVe(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:o}=Qc(e);if(i.length<e.length){const v=fg(t,i),g=["row","col","depth","depth2","depth3","depth4"];return`
      ${lg(v)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${hg(g,o)});
      }
    `}const s=e[5],a=e[4]*s,u=e[3]*a,c=e[2]*u,l=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${c}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${dg(t)}
      }
    `;const d=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,h=f[0],p=f[1];if(p===l&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${u}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=_h(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${c} + depth * ${u} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${m};
      vec2 uv = uvFromFlat(${h}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function dg(t){const e=t.name,n=_e(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function AVe(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",o=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,a=aZ(t.shapeInfo.logicalShape,e.logicalShape),u=Qt(s),c=s-o;let l;const d=["x","y","z","w","u","v"];o===0?l="":s<2&&a.length>=1?l="coords = 0;":l=a.map(y=>`coords.${d[y+c]} = 0;`).join(`
`);let f="";s<2&&o>0?f="coords":f=t.shapeInfo.logicalShape.map((y,b)=>`coords.${d[b+c]}`).join(", ");let h="return outputValue;";const m=_e(t.shapeInfo.logicalShape)===1,g=_e(e.logicalShape)===1;if(o===1&&!m&&!g)h=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)s===1?h=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:h=`
        return vec4(outputValue.x);
      `;else if(a.length){const y=o-2,b=o-1;a.indexOf(y)>-1&&a.indexOf(b)>-1?h="return vec4(outputValue.x);":a.indexOf(y)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${u} coords = getOutputCoords();
      ${l}
      vec4 outputValue = get${r}(${f});
      ${h}
    }
  `}function $Ve(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",o=e.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===u&&t.shapeInfo.flatOffset==null&&yn(s,o))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=Qt(u),l=aZ(t.shapeInfo.logicalShape,e.logicalShape),d=u-a;let f;const h=["x","y","z","w","u","v"];a===0?f="":u<2&&l.length>=1?f="coords = 0;":f=l.map(m=>`coords.${h[m+d]} = 0;`).join(`
`);let p="";return u<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,v)=>`coords.${h[v+d]}`).join(", "),`
    float ${i}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${r}(${p});
    }
  `}function Qt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function m3(t,e,n){const{newShape:r,keptDims:i}=Qc(e),o=e.length,s=t&&o===3&&e[0]===1,a=s?e.slice(1):r,u=!t&&o>1&&!yn(e,n)&&r.length<o||s;return{useSqueezeShape:u,uniformShape:u?a:e,keptDims:i}}function fg(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function hg(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DVe(t,e,n,r){const i=n.map((l,d)=>{const f={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(f.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:f}}),o=i.map(l=>l.shapeInfo),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=QUe(i,s,e),u=_Ue(t.gl,a),c=t.createProgram(u);return ae().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:s},lZ(t,e,c)))}function lZ(t,e,n){const r=[],i=[];let o,s,a,u=null,c=null;c=t.getUniformLocation(n,"NAN",!1),ae().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(n,"INFINITY",!1));const l=!1;for(const d of e.variableNames){const f={name:d,uniform:t.getUniformLocation(n,d,l),offset:t.getUniformLocation(n,`offset${d}`,l)};e.enableShapeUniforms&&(f.shape=t.getUniformLocation(n,`${d}Shape`,l),f.texShape=t.getUniformLocation(n,`${d}TexShape`,l)),r.push(f)}if(e.enableShapeUniforms&&(o=t.getUniformLocation(n,"outShape",l),a=t.getUniformLocation(n,"outShapeStrides",l),s=t.getUniformLocation(n,"outTexShape",l)),e.customUniforms)for(const d of e.customUniforms)i.push(t.getUniformLocation(n,d.name,l));return{variablesLocations:r,customUniformLocations:i,infLoc:u,nanLoc:c,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:s}}function gz(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,r)=>{const i=n.logicalShape,o=e[r],s=o.shape;if(!yn(i,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${s} must match`);if(n.isUniform&&o.isUniform)return;const a=n.texShape,u=o.isUniform?null:o.texData.texShape;if(!yn(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function OVe(t,e,n,r,i){e.program.enableShapeUniforms||(gz(e.inShapeInfos,n),gz([e.outShapeInfo],[r]));const o=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,s[0],s[1]):t.setOutputMatrixTexture(o.texture,s[0],s[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),ae().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let u=0;u<n.length;++u){const c=n[u],{uniform:l,offset:d,shape:f,texShape:h}=e.variablesLocations[u];if(f){const{uniformShape:p}=m3(e.program.packedInputs,c.shape,c.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(f,new Int32Array(p));break;case 2:t.gl.uniform2iv(f,new Int32Array(p));break;case 3:t.gl.uniform3iv(f,new Int32Array(p));break;case 4:t.gl.uniform4iv(f,new Int32Array(p));break}}if(h&&t.gl.uniform2i(h,c.texData.texShape[0],c.texData.texShape[1]),l!=null){if(c.isUniform){if(_e(c.shape)<2)t.gl.uniform1f(l,c.uniformValues[0]);else{let p=c.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(l,p)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,l,u)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const u=dr(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&i)for(let u=0;u<e.program.customUniforms.length;++u){const c=e.program.customUniforms[u],l=e.customUniformLocations[u],d=i[u];if(c.type==="float")t.gl.uniform1fv(l,d);else if(c.type==="vec2")t.gl.uniform2fv(l,d);else if(c.type==="vec3")t.gl.uniform3fv(l,d);else if(c.type==="vec4")t.gl.uniform4fv(l,d);else if(c.type==="int")t.gl.uniform1iv(l,d);else if(c.type==="ivec2")t.gl.uniform2iv(l,d);else if(c.type==="ivec3")t.gl.uniform3iv(l,d);else if(c.type==="ivec4")t.gl.uniform4iv(l,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function FVe(t,e,n){let r="";e.concat(n).forEach(s=>{const a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!s.isUniform){const u=s.texData.texShape,{useSqueezeShape:c,uniformShape:l,keptDims:d}=m3(t.packedInputs,s.shape,u);let f="",h="",p="";if(l.length===1&&t.packedInputs){const S=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];f=`${S[0]>1}_${S[1]>1}`}else if(l.length===2&&!t.packedInputs)h=`${l[0]>1}_${l[1]>1}`;else if(l.length>2&&!t.packedInputs){const S=dr(l);p=`${S[0]===u[1]}_${S[S.length-1]===u[1]}`}const m=s.shape.length,v=l.length===2&&yn(s.shape,u),g=_e(s.shape)===1,y=r0(s.shape,n.shape),b=!t.packedInputs&&m===n.shape.length&&yn(u,n.texData.texShape),x=t.packedInputs||l.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${m}_${b}_${c?d:""}_${l.length}_${g}_${y}_${v}_${f}_${h}_${p}_${x}_${a}`}else{const u=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${u}_${a}`}});const i=t.userCode;let o=t.constructor.name;return o+="_"+r+"_"+i+`${ae().getNumber("WEBGL_VERSION")}`,o}function jr(t){return ae().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LVe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=d0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=bi();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?A2(["r","c","d"],e):Eh(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MVe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=d0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=bi();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?A2(["r","c","d"],e):Eh(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BVe{constructor(e){this.variableNames=["A"],this.outTexUsage=$o.DOWNLOAD;const n=bi();this.outputShape=e,this.userCode=`
      ${sZ}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UVe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=$o.DOWNLOAD;const n=bi();this.outputShape=e,this.userCode=`
      ${sZ}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VVe={R:0,G:1,B:2,A:3};class vz{constructor(e,n=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=bi();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);let o="result";n&&(o="floor(result * 255. + 0.5)");let s="";for(let a=0;a<r.length;a++){const u=r[a];s+=`
          if(offset == ${a}) {
            result = values[${VVe[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?p3():h3(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${s}
        }
        ${i.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zVe{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=bi();this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);let i="",o="result";n&&(o="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){const u=s*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?p3():h3(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${r.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WVe(t){const e=bi(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return EUe(t,n)}function jVe(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return PUe(t,e)}function GVe(t){const e=new Uint16Array([0,1,2,2,1,3]);return AUe(t,e)}function hb(t,e,n,r,i,o){DUe(e,n);const s=$Ue(t),a=t.TEXTURE_2D;return Fe(t,()=>t.bindTexture(a,s)),Fe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Fe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Fe(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Fe(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ae().getNumber("WEBGL_VERSION")===1?Fe(t,()=>t.texImage2D(a,0,r,e,n,0,i,o,null)):Fe(t,()=>t.texStorage2D(a,1,r,e,n)),Fe(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:s,texShape:[n,e]}}function dZ(t){return t.internalFormatFloat}function HVe(t,e,n,r){const[i,o]=db(e,n);return hb(t,i,o,dZ(r),r.textureFormatFloat,t.FLOAT)}function fZ(t){return t.internalFormatHalfFloat}function qVe(t,e,n,r){const[i,o]=db(e,n);return hb(t,i,o,fZ(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function hZ(t){return t.downloadTextureFormat}function KVe(t,e,n,r){const[i,o]=db(e,n);return hb(t,i,o,hZ(r),t.RGBA,t.UNSIGNED_BYTE)}function pZ(t){return t.internalFormatPackedFloat}function XVe(t,e,n,r){const[i,o]=cg(e,n);return hb(t,i,o,pZ(r),t.RGBA,t.FLOAT)}function mZ(t){return t.internalFormatPackedHalfFloat}function JVe(t,e,n,r){const[i,o]=cg(e,n);return hb(t,i,o,mZ(r),t.RGBA,r.textureTypeHalfFloat)}function YVe(t,e,n){return Fe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),hz(t,e,"clipSpacePos",n,3,20,0)&&hz(t,e,"uv",n,2,20,12)}function QVe(t,e,n,r,i,o){Fe(t,()=>t.bindTexture(t.TEXTURE_2D,e));let s,a,u;i instanceof Uint8Array?(s=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,u=t.RGBA):(s=new Float32Array(n*r*4),a=t.FLOAT,u=o.internalFormatPackedFloat),s.set(i),ae().getNumber("WEBGL_VERSION")===2?Fe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,s)):Fe(t,()=>t.texImage2D(t.TEXTURE_2D,0,u,n,r,0,t.RGBA,a,s)),Fe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function ZVe(t,e,n){Fe(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?ae().getNumber("WEBGL_VERSION")===2?Fe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):Fe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):ae().getNumber("WEBGL_VERSION")===2?Fe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):Fe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),Fe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function eze(t,e,n,r){const i=t.createBuffer();Fe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i));const a=4*4*e*n;return Fe(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Fe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),Fe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),i}function tze(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function nze(t,e,n,r){const[i,o]=db(e,n),s=4,a=new Uint8Array(bUe(e*n,s));return Fe(t,()=>t.readPixels(0,0,i,o,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function rze(t,e,n,r,i,o,s,a){const u=t,c=new Float32Array(xUe(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function ize(t,e,n){const r=new Float32Array(e*n*4);return Fe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hE{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ae().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,gUe(n,e)):this.gl=da(n),e=this.gl,ae().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Fe(o,()=>o.createVertexArray()),this.bindVertexArray=s=>Fe(o,()=>o.bindVertexArray(s)),this.deleteVertexArray=s=>Fe(o,()=>o.deleteVertexArray(s)),this.getVertexArray=()=>Fe(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Fe(e,()=>o.createVertexArrayOES()),this.bindVertexArray=s=>Fe(e,()=>o.bindVertexArrayOES(s)),this.deleteVertexArray=s=>Fe(e,()=>o.deleteVertexArrayOES(s)),this.getVertexArray=()=>Fe(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ae().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=K1(this.gl,o),ws(this.gl,s))this.textureHalfFloatExtension=K1(this.gl,s);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),ws(this.gl,i))this.colorBufferHalfFloatExtension=K1(this.gl,i);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",ws(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(ws(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=jVe(this.gl),this.indexBuffer=GVe(this.gl),this.framebuffer=OUe(this.gl),this.textureConfig=f3(this.gl,this.textureHalfFloatExtension)}get debug(){return ae().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Fe(e,()=>e.finish()),Fe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Fe(e,()=>e.deleteFramebuffer(this.framebuffer)),Fe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Fe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Fe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),HVe(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),qVe(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),KVe(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),ZVe(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,r,i){this.throwIfDisposed(),QVe(this.gl,e,n,r,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),JVe(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),XVe(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(pz(this.gl,this.framebuffer),this.outputTexture=null),Fe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,r){return this.downloadMatrixDriver(e,()=>nze(this.gl,n,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,r,i,o,s){return rze(this.gl,e,n,r,i,o,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return tze(this.gl,e,n)}createBufferFromTexture(e,n,r){this.bindTextureToFrameBuffer(e);const i=eze(this.gl,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,r;if(ae().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(n,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:n,isFencePassed:r}}downloadMatrixFromPackedTexture(e,n,r){return this.downloadMatrixDriver(e,()=>ize(this.gl,n,r))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=WVe(n));const r=RUe(n);Fe(n,()=>n.attachShader(r,this.vertexShader)),Fe(n,()=>n.attachShader(r,e)),NUe(n,r);const i=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&cE(n,i),i}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;Fe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),YVe(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Fe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&cE(this.gl,this.program),Fe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,r=!0){return this.throwIfDisposed(),r?LUe(this.gl,e,n):MUe(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),Fe(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),BUe(this.gl,e,n,r)}setOutputMatrixTexture(e,n,r){this.setOutputMatrixTextureDriver(e,r,n)}setOutputPackedMatrixTexture(e,n,r){this.throwIfDisposed();const[i,o]=cg(n,r);this.setOutputMatrixTextureDriver(e,i,o)}setOutputMatrixWriteRegion(e,n,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,n)}setOutputPackedMatrixWriteRegion(e,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&cE(this.gl,this.program),X1(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Fe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Fe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=K1(this.gl,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.createQuery();return r.beginQuery(i.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await HI(()=>this.disposed||this.isQueryAvailable(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),i=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=oze(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:r}=this.itemsToPoll[n];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in ae().platform&&(r=ae().platform.setTimeoutCustom.bind(ae().platform)),HI(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),lE(this.gl,e,this.framebuffer),this.debug&&X1(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(lE(this.gl,this.outputTexture,this.framebuffer),this.debug&&X1(this.gl)):pz(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const r=n();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,n,r){this.throwIfDisposed();const i=this.gl;lE(i,e,this.framebuffer),this.debug&&X1(i),this.outputTexture=e,Fe(i,()=>i.viewport(0,0,n,r)),Fe(i,()=>i.scissor(0,0,n,r))}setOutputMatrixWriteRegionDriver(e,n,r,i){this.throwIfDisposed(),Fe(this.gl,()=>this.gl.scissor(e,n,r,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function oze(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sze(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mi(t){return(e,n,r,i,o)=>{const s=Pt(e,n),a=s.length,u=dr(s),c=_e(s),l=zc(o,c),d=e.length,f=n.length,h=dr(e),p=dr(n),m=r0(e,s),v=r0(n,s);if(m.length+v.length===0)for(let g=0;g<l.length;++g)l[g]=t(r[g%r.length],i[g%i.length]);else for(let g=0;g<l.length;++g){const y=a2(g,a,u),b=y.slice(-d);m.forEach(T=>b[T]=0);const x=vS(b,d,h),S=y.slice(-f);v.forEach(T=>S[T]=0);const C=vS(S,f,p);l[g]=t(r[x],i[C])}return[l,s]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aze(t,e,n,r){if(r==="int32"){const i=Int32Array.from(t);return[e,"int32",i]}if(r==="bool"){const i=Q0([0],n),[o,s]=Mi((a,u)=>a!==u?1:0)(e,[],t,i,"bool");return[s,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uze=Mi((t,e)=>t+e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cze(t,e,n,r,i){const o=_e(r),s=Wc(i,n);for(let a=0;a<t.length;a++){const u=t[a];if(u<0)throw new Error("Input x must be non-negative!");u>=i||(o>0?s[u]+=e[a]:s[u]+=1)}return s}function lze(t,e,n,r=!1){const i=t.shape[0],o=t.shape[1],s=Tn([i,n],e.dtype);for(let a=0;a<i;a++)for(let u=0;u<o;u++){const c=t.get(a,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?s.set(1,a,c):e.size>0?s.set(s.get(a,c)+e.get(a,u),a,c):s.set(s.get(a,c)+1,a,c))}return s}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dze=Mi((t,e)=>t&e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tl(t){return(e,n,r)=>{const i=Qn(n,e.length);for(let o=0;o<e.length;++o)i[o]=t(e[o],r);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fze=tl(t=>Math.ceil(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hze(t,e,n,r){const i=Qn(n,_e(e));if(r&&n!=="string"){let o=0;t.forEach(s=>{const a=_e(s.shape);i.set(s.vals,o),o+=a})}else{let o=0;t.forEach(s=>{const a=n==="string"?Bm(s.vals):s.vals;let u=0;for(let c=0;c<s.shape[0];++c){const l=c*e[1]+o;for(let d=0;d<s.shape[1];++d)i[l+d]=a[u++]}o+=s.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pze=Mi((t,e)=>t===e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mze=tl(t=>Math.exp(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gze=tl(t=>Math.expm1(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vze=tl(t=>Math.floor(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yze=Mi((t,e)=>Math.floor(t/e));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bze(t,e,n,r,i,o,s,a,u){const c=Tn([r,o],n);for(let l=0;l<r;l++){const d=[];let f=0;for(let h=0;h<i;h++){const p=t[l*i+h];f+=p*s[h],d.push(p)}if(f<0||f>=u/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let h=0;h<o;h++)c.values[l*o+h]=e.get(...e.indexToLoc(f*o+h))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xze(t,e,n){const r=Tn(n,t.dtype);for(let i=0;i<r.size;++i){const s=r.indexToLoc(i).slice(),a=s[0],u=s[2],c=e.locToIndex([a,u]);s[2]=e.values[c];const l=t.locToIndex(s);0<=l&&l<t.values.length&&(r.values[i]=t.values[l])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wze=Mi((t,e)=>t>e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sze=Mi((t,e)=>t>=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cze=Mi((t,e)=>t<e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kze=Mi((t,e)=>t<=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tze(t,e,n){const r=(e-t)/(n-1),i=Wc(n,"float32");i[0]=t;for(let o=1;o<i.length;o++)i[o]=i[o-1]+r;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eze=tl(t=>Math.log(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ze(t,e,n,r){const i=zc(r,_e(n));for(let o=0;o<i.length;++o){const s=o*e;let a=t[s];for(let u=0;u<e;++u){const c=t[s+u];(Number.isNaN(c)||c>a)&&(a=c)}i[o]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ize=Mi((t,e)=>Math.max(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rze=Mi((t,e)=>Math.min(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gZ=Mi((t,e)=>t*e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nze(t,e,n){const r=Sh(-1,n);return gZ([],e,r,t,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pze=Mi((t,e)=>t!==e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aze(t,e,n,r,i){const o=e.length,s=_e(e),a=dr(e),u=dr(i),c=zc(n,_e(i));for(let l=0;l<s;++l){const d=a2(l,o,a),f=new Array(d.length);for(let p=0;p<f.length;p++)f[p]=d[r[p]];const h=vS(f,o,u);c[h]=t[l]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ze(t,e,n,r){const[i,o]=Cu(t,r),s=la(e,"int32"),a=Wc(_e(i),s),u=_e(o);for(let c=0;c<a.length;++c){const l=c*u;let d=1;for(let f=0;f<u;++f)d*=n[l+f];a[c]=d}return{outVals:a,outShape:i,outDtype:s}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dze(t,e,n){t.forEach((r,i)=>{if(r<0||r>=n){const o=a2(i,e.length,dr(e)).join(",");throw new Error(`indices[${o}] = ${r} is not in [0, ${n})`)}})}function Oze(t,e){for(let n=0;n<t.length;++n){const r=t[n],i=n===t.length-1?e:t[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let o=1;o<r.length;++o)if(r[o-1]>r[o])throw new Error("Ragged splits must be sorted in ascending order")}}function Fze(t,e,n,r){const i=[];let o=0;const s=e.length-1+n.length,a=new Array(s).fill(null).map(()=>[0]);Oze(n,r);let u=1;for(let c=0;c<e.length-1;++c){u*=e[c];const l=e[c+1];for(let d=1;d<u+1;++d)a[c].push(d*l)}for(let c=0;c<t.length;++c){let l=t[c],d=t[c]+1;for(let f=0;f<n.length;++f){const h=n[f],p=f+e.length-1;if(p>=0){const m=a[p],v=m[m.length-1]-h[l];for(let g=l;g<d;++g)a[p].push(h[g+1]+v)}l=h[l],d=h[d]}d!==l&&(i.push([l,d]),o+=d-l)}return{outSplits:a,valueSlices:i,numValues:o}}function Lze(t){const e=[];for(let n=0;n<t.length;++n){const r=t[n].length,i=Qn("int32",r);e.push(i),t[n].forEach((o,s)=>i[s]=o)}return e}function yz(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function Mze(t,e,n,r,i,o){const s=yz(e,2)[1],a=yz(o,2)[1];let u=0;for(const c of n)for(let l=c[0];l<c[1];++l){for(let d=0;d<r;++d)i[u*a+d]=t[l*s+d];++u}}function Bze(t,e,n,r,i){const o=e.slice();o[0]=i;const s=Qn(n,_e(o)),a=t.length,u=a===0?0:a/e[0];return Mze(t,e,r,u,s,o),[s,o]}function Uze(t,e,n,r,i,o,s,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const u=e[0][0]-1;if(Dze(o,s,u),r.length===0)throw new Error("params.rank must be nonzero");const c=r[0],{outSplits:l,valueSlices:d,numValues:f}=Fze(o,s,t,c),h=Lze(l),p=Bze(n,r,i,d,f);return[h,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bz=2147483647;function Vze(t,e,n,r,i,o,s){if(e.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,u=i.length===0,c=s.length===0,l=[];a||l.push(e[0]),u||l.push(i[0]),c||l.push(s[0]);for(let v=1;v<l.length;++v)if(l[v]!==l[v-1])throw new Error("starts, limits, and deltas must have the same shape");const d=l.length===0?1:l[0],f=Qn("int32",d+1);f[0]=0;for(let v=0;v<d;++v){const g=a?t[0]:t[v],y=u?r[0]:r[v],b=c?o[0]:o[v];if(b===0)throw new Error("Requires delta != 0");let x;if(b>0&&y<g||b<0&&y>g)x=0;else if(x=Math.ceil(Math.abs((y-g)/b)),x>bz)throw new Error(`Requires ((limit - start) / delta) <= ${bz}`);f[v+1]=f[v]+x}const h=f[d],p=Qn(n,h);let m=0;for(let v=0;v<d;++v){const g=f[v+1]-f[v];let y=a?t[0]:t[v];const b=c?o[0]:o[v];for(let x=0;x<g;++x)p[m++]=y,y+=b}return[f,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var es=Gs;class $S{constructor(e,n,r,i,o,s,a,u,c,l){this.shape=e,this.shapeShape=n,this.values=r,this.valuesShape=i,this.valuesDType=o,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=tQ(l),this.raggedRank=nQ(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===es.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===es.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case es.VALUE_ROWIDS:return $S.getMaxWidthValueRowID(n);case es.ROW_SPLITS:return $S.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${es[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let r=0;for(let i=0;i<n-1;++i){const o=e[i+1]-e[i];o>r&&(r=o)}return r}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let r=0,i=e[0],o=0;for(let s=1;s<n;++s){const a=e[s];a!==i&&(i=a,o=Math.max(s-r,o),r=s)}return Math.max(n-r,o)}tensorShapeFromTensor(e,n,r=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return wz(e,r)}calculateOutputSize(e){const n=this.valuesShape,r=this.defaultValueShape;rQ(r,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=eQ(this.raggedRank,i,n);s[0]<0&&(s[0]=e);for(let a=1;a<=this.raggedRank;++a)s[a]<0&&(s[a]=this.getMaxWidth(a));return s}calculateFirstParentOutputIndex(e,n,r){const i=Math.min(e,r),o=[];let s=0;for(let a=0;a<i;++a,s+=n)o.push(s);for(let a=i;a<e;++a)o.push(-1);return L(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,n,r,i){const o=e.length,s=[];for(let a=0;a<o-1;++a){const u=e[a+1]-e[a];let c=Math.min(i,u),l=n[a];l===-1&&(c=0);for(let d=0;d<c;++d)s.push(l),l+=r;for(let d=0;d<u-c;++d)s.push(-1)}if(o>0&&s.length!==e[o-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(e,n,r,i){const o=e.length,s=[];if(o===0)return[];let a=0,u=e[0];if(u>=n.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${n.length}`);let c=n[u];s.push(c);for(let l=1;l<o;++l){const d=e[l];if(d===u)c>=0&&(++a,a<i?c+=r:c=-1);else{if(a=0,u=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}s.push(c)}if(s.length!==e.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(e,n,r,i){const o=this.getRowPartitionTensor(e),s=this.getRowPartitionTypeByDimension(e);switch(s){case es.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,n,r,i);case es.ROW_SPLITS:if(o.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(o,n,r,i);default:throw new Error(`Unsupported partition type: ${es[s]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case es.FIRST_DIM_SIZE:return e[0];case es.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case es.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${es[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),r=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let u=i.length-2;u>=0;--u)i[u]=i[u+1]*r[u+1];const o=wz(r,!1),s=Qn(this.valuesDType,_e(o));if(i[0]*r[0]>0){let u=this.calculateFirstParentOutputIndex(n,i[0],r[0]);for(let c=1;c<=this.raggedRank;++c)u=this.calculateOutputIndex(c-1,u,i[c],r[c]);this.setOutput(this.raggedRank,u,s,o)}return[o,s]}setOutput(e,n,r,i){if(r.length===0)return;const o=this.values,s=r;let a=i.slice();a=a.slice(e+1);const u=_e(a),c=n.length;let l=this.defaultValue;if(l.length!==u&&l.length!==1){const p=this.defaultValueShape;ot(()=>{const m=ve(l,p);l=cm(m,a).dataSync()})}let d=0,f=0,h=0;for(let p=0;p<=c;++p){let m=p<c?n[p]:-1;if(m===h){++h;continue}if(f<h){const v=o.subarray(d*u),g=s.subarray(f*u),y=(h-f)*u;xz(g,v,y)}if(p>=c){const v=r.length;m=Math.floor(v/u)}if(m>h)if(this.defaultValue.length===1)s.subarray(h*u,m*u).fill(this.defaultValue[0]),h=m;else for(;m>h;){const v=s.slice(h*u);xz(v,l,u),++h}m<0?(d=p+1,f=h):(d=p,f=h,h=f+1)}}}function xz(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function wz(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function zze(t,e,n,r,i,o,s,a,u,c){return new $S(t,e,n,r,i,o,s,a,u,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wze(t,e,n,r){const i=t===e,o=t<e&&n<0,s=e<t&&n>1;if(i||o||s)return Wc(0,r);const a=Math.abs(Math.ceil((e-t)/n)),u=Wc(a,r);e<t&&n===1&&(n=-1),u[0]=t;for(let c=1;c<u.length;c++)u[c]=u[c-1]+n;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jze=tl(t=>1/Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gze(t,e,n,r,i,o,s,a,u,c){const l=[r/i,i],d=t.values,f=e.values;if(r===0)return Tn(n,e.dtype);const h=u instanceof qf?u:Tn(l,e.dtype);typeof u=="string"||typeof u=="number"?h.values.fill(u):typeof u=="boolean"&&h.values.fill(+u);for(let p=0;p<o;p++){const m=[];let v=0;for(let g=0;g<s;g++){const y=d[p*s+g];m.push(y),v+=y*a[g]}if(v<0||v>=r/i)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let g=0;g<i;g++)c?h.values[v*i+g]+=f[p*i+g]:h.values[v*i+g]=e.rank===0?f[0]:f[p*i+g]}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hze=tl(t=>1/(1+Math.exp(-t)));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qze(t,e,n,r,i){const o=n3(r,e,n),s=_e(n),a=dr(r);if(o){const d=r3(e,a);return i==="string"?t.slice(d,d+s):t.subarray(d,d+s)}const u=i==="string"?Bm(t):t,c=Tn(r,i,u),l=Tn(n,i);for(let d=0;d<l.size;++d){const f=l.indexToLoc(d),h=f.map((p,m)=>p+e[m]);l.set(c.get(...h),...f)}return i==="string"?OQ(l.values):l.values}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kze(t,e,n,r,i,o,s){const a=e[0],u=o[0],c=new Array(u),l=new Array(a),d=e[1];if(u===0){if(a!==0)throw new Error(wQ(a));const v=Qn(n,0),g=Qn(i,0);return[v,[0,d],g,c,l]}let f=!0,h=0;const p=new Array(u).fill(0);for(let v=0;v<a;++v){const g=t[v*d];if(g<0)throw new Error(SQ(v,g));if(g>=u)throw new Error(CQ(v,g,u));++p[g],f=f&&g>=h,h=g}let m=!0;for(let v=0;v<u;++v){const g=p[v]===0;c[v]=g,m=m&&!g,p[v]=Math.max(p[v],1),v>0&&(p[v]+=p[v-1])}if(m&&f){const v=t,g=r;for(let y=0;y<a;++y)l[y]=y;return[v,[a,d],g,c,l]}else{const v=p[u-1],g=Qn(n,v*d),y=Qn(i,v),b=new Array(u).fill(0);for(let x=0;x<a;++x){const S=t[x*d],C=b[S],T=(S===0?0:p[S-1])+C;b[S]++;for(let E=0;E<d;++E)g[T*d+E]=t[x*d+E];y[T]=r[x],l[x]=T}for(let x=0;x<u;++x)if(b[x]===0){const C=x===0?0:p[x-1];g[C*d+0]=x;for(let T=1;T<d;++T)g[C*d+T]=0;y[C]=s}return[g,[v,d],y,c,l]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xze(t,e,n,r,i){const o=_e(r),s=e[0],a=i.length,u=[];let c=1,l=-1;for(let v=0;v<a;++v){const g=i[v];if(g===-1){if(l!==-1)throw new Error(kQ(l,v));l=v,u.push(1)}else{if(g<0)throw new Error(TQ(v,g));c*=g,u.push(g)}}if(l!==-1){if(c<=0)throw new Error(EQ());const v=Math.trunc(o/c);if(c*v!==o)throw new Error(_Q(r,u));u[l]=v}if(_e(u)!==o)throw new Error(IQ(r,u));const f=r.length,h=[];if(f>0){h[f-1]=1;for(let v=f-2;v>=0;--v)h[v]=h[v+1]*r[v+1]}const p=[];if(a>0){p[a-1]=1;for(let v=a-2;v>=0;--v)p[v]=p[v+1]*u[v+1]}const m=Qn(n,s*a);for(let v=0;v<s;++v){let g=0;for(let y=0;y<f;++y)g+=t[v*f+y]*h[y];for(let y=0;y<a;++y)m[v*a+y]=Math.trunc(g/p[y]),g%=p[y]}return[m,[s,a],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jze(t,e,n,r,i,o=!1,s=0){const a=r.length,u=[e[0],t.length/e[0]],c=u[1],d=a>0?i[a-1]+1:0;if(d<0)throw new Error(fR());const f=e.slice();f[0]=d;const h=f.reduce((b,x)=>b*x,1),p=Qn(n,h);if(a===0)return d>0&&p.fill(s),[p,f];if(d<=0)throw new Error(fR());let m=0,v=1,g=0,y=i[m];for(;;){let b=0;if(v<a){if(b=i[v],y===b){++v;continue}if(y>=b)throw new Error(RQ())}if(y<0||y>=d)throw new Error(NQ(y,d));y>g&&p.fill(s,g*c,y*c);for(let x=m;x<v;++x){const S=r[x];if(S<0||S>=u[0])throw new Error(PQ(x,r[x],u[0]));for(let C=0;C<c;C++)p[y*c+C]+=t[S*c+C]}if(o)for(let x=0;x<c;x++)p[y*c+x]/=v-m;if(m=v,++v,g=y+1,y=b,v>a)break}return g<d&&p.fill(s,g*c,d*c),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yze=tl(t=>Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qze=Mi((t,e)=>{const n=t-e;return n*n});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zze=tl((t,e)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=e;return t.replace(new RegExp(n,r?"g":""),i)});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eWe(t,e,n,r){const i=Tn(t,e.dtype);for(let o=0;o<i.size;o++){const s=i.indexToLoc(o),a=new Array(s.length);for(let u=0;u<a.length;u++)a[u]=s[u]*n[u]+r[u];i.set(e.get(...a),...s)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tWe{constructor(e,n,r,i,o,s){this.separator=_c(e),this.nGramWidths=n,this.leftPad=_c(r),this.rightPad=_c(i),this.padWidth=o,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const r=this.getPadWidth(n);return Math.max(0,e+2*r-n+1)}createNGrams(e,n,r,i,o,s){for(let a=0;a<o;++a){const u=this.getPadWidth(s),c=Math.max(0,u-a),l=Math.max(0,u-(o-(a+1))),d=s-(c+l),f=n+(c>0?0:a-u);let h=0;h+=c*this.leftPad.length;for(let y=0;y<d;++y)h+=e[f+y].length;h+=l*this.rightPad.length;const p=c+l+d-1;h+=p*this.separator.length,r[i+a]=new Uint8Array(h);const m=r[i+a];let v=0;const g=y=>y.forEach(b=>m[v++]=b);for(let y=0;y<c;++y)g(this.leftPad),g(this.separator);for(let y=0;y<d-1;++y)g(e[f+y]),g(this.separator);if(d>0){g(e[f+d-1]);for(let y=0;y<l;++y)g(this.separator),g(this.rightPad)}else{for(let y=0;y<l-1;++y)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,n){const r=e.length,i=n.length;if(i>0){let u=n[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let c=1;c<i;++c){let l=n[c]>=u;if(l=l&&n[c]<=r,!l)throw new Error(`Invalid split value ${n[c]}, must be in [${u}, ${r}]`);u=n[c]}if(u!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${u}`)}const o=i-1,s=Qn("int32",i);if(r===0||i===0){const u=new Array(r);for(let c=0;c<=o;++c)s[c]=0;return[u,s]}s[0]=0;for(let u=1;u<=o;++u){const c=n[u]-n[u-1];let l=0;this.nGramWidths.forEach(d=>{l+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&l===0&&(l=1),s[u]=s[u-1]+l}const a=new Array(s[o]);for(let u=0;u<o;++u){const c=n[u];let l=s[u];if(this.nGramWidths.forEach(d=>{const f=n[u+1]-n[u],h=this.getNumNGrams(f,d);this.createNGrams(e,c,a,l,h,d),l+=h}),this.preserveShort&&l===s[u]){const d=n[u+1]-n[u];if(d===0)continue;const f=d+2*this.padWidth,h=1;this.createNGrams(e,c,a,l,h,f)}}return[a,s]}}function nWe(t,e,n,r,i,o,s,a){return new tWe(n,r,i,o,s,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rWe(t,e,n,r){if(!t.length)return;if(e.length===0){for(let o=0;o<t.length;++o)r.push(t.subarray(o,o+1));return}if(e.length===1){const o=e[0];let s=t.indexOf(o);for(;s!==-1;){const a=t.subarray(0,s);(!n||a.length!==0)&&r.push(a),t=t.subarray(s+1),s=t.indexOf(o)}(!n||t.length!==0)&&r.push(t);return}let i=0;for(let o=0;o<t.length+1;o++)if(o===t.length||e.indexOf(t[o])!==-1){const s=t.subarray(i,o);(!n||s.length!==0)&&r.push(s),i=o+1}}function iWe(t,e,n){const r=t.length,i=[];let o=0,s=0;const a=new Array(r);for(let f=0;f<r;++f){const h=i.length;rWe(t[f],e,n,i);const p=i.length-h;a[f]=p,o+=p,s=Math.max(s,p)}const u=Qn("int32",o*2),c=new Array(o),l=[r,s];let d=0;for(let f=0;f<r;++f)for(let h=0;h<a[f];++h)u[d*2]=f,u[d*2+1]=h,c[d]=i[d],++d;return[u,c,l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oWe(t,e){const n=Qn("int32",t.length);for(let r=0;r<t.length;++r)n[r]=j9(t[r]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sWe=Mi((t,e)=>t-e);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aWe(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const r=Tn(n,t.dtype);for(let i=0;i<r.values.length;++i){const o=r.indexToLoc(i),s=new Array(t.rank);for(let u=0;u<s.length;u++)s[u]=o[u]%t.shape[u];const a=t.locToIndex(s);r.values[i]=t.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kv=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function vZ(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,u=e-n+1,c=Math.log(a),l=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*l*(a-l)/a)*Math.sign(u-a/2),f=Math.max(n,Math.floor(e-u*l/a+d)),h=Math.min(r,Math.floor(e+(a-u)*l/a+d));vZ(t,e,f,h)}const i=t[e];let o=n,s=r;for(Wu(t,n,e),kv(t[r],i)>0&&Wu(t,n,r);o<s;){for(Wu(t,o,s),o++,s--;kv(t[o],i)<0;)o=o+1;for(;kv(t[s],i)>0;)s=s-1}kv(t[n],i)===0?Wu(t,n,s):(s=s+1,Wu(t,s,r)),s<=e&&(n=s+1),e<=s&&(r=s-1)}}function uWe(t,e,n,r,i){const o=e[e.length-1],[s,a]=[t.length/o,o],u=zc(n,s*r),c=zc("int32",s*r);for(let d=0;d<s;d++){const f=d*a,h=t.subarray(f,f+a);let p=new Array(h.length);h.forEach((y,b)=>p[b]={value:y,index:b}),r<p.length&&(vZ(p,r),p=p.slice(0,r)),i&&p.sort(kv);const m=d*r,v=u.subarray(m,m+r),g=c.subarray(m,m+r);for(let y=0;y<r;y++)v[y]=p[y].value,g[y]=p[y].index}const l=e.slice();return l[l.length-1]=r,[Tn(l,n,u),Tn(l,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cWe(t,e,n,r){const i=tr(e,n)[0],o=[1,n[0],1];for(let p=0;p<i;p++)o[0]*=n[p];o[1]=n[i];for(let p=i+1;p<n.length;p++)o[2]*=n[p];const s=new Map,a=new Int32Array(n[i]),u=new qf(o,r,t),c=[],l=o[0]===1&&o[2]===1;for(let p=0;p<n[i];p++){let m;if(l)m=t[p].toString();else{const g=[];for(let y=0;y<o[0];y++)for(let b=0;b<o[2];b++)g.push(u.get(y,p,b));m=g.join(",")}const v=s.get(m);if(v!=null)a[p]=v;else{const g=s.size;s.set(m,g),a[p]=g,c.push(p)}}const d=o.slice();d[1]=s.size;const f=new qf(d,r);c.forEach((p,m)=>{for(let v=0;v<o[0];v++)for(let g=0;g<o[2];g++)f.set(u.get(v,p,g),v,m,g)});const h=n.slice();return h[i]=d[1],{outputValues:f.values,outputShape:h,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lWe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:uze,bincountImpl:cze,bincountReduceImpl:lze,bitwiseAndImpl:dze,castImpl:aze,ceilImpl:fze,concatImpl:hze,equalImpl:pze,expImpl:mze,expm1Impl:gze,floorDivImpl:yze,floorImpl:vze,gatherNdImpl:bze,gatherV2Impl:xze,greaterEqualImpl:Sze,greaterImpl:wze,lessEqualImpl:kze,lessImpl:Cze,linSpaceImpl:Tze,logImpl:Eze,maxImpl:_ze,maximumImpl:Ize,minimumImpl:Rze,multiplyImpl:gZ,negImpl:Nze,notEqualImpl:Pze,prodImpl:$ze,raggedGatherImpl:Uze,raggedRangeImpl:Vze,raggedTensorToTensorImpl:zze,rangeImpl:Wze,rsqrtImpl:jze,scatterImpl:Gze,sigmoidImpl:Hze,simpleAbsImpl:sze,sliceImpl:qze,sparseFillEmptyRowsImpl:Kze,sparseReshapeImpl:Xze,sparseSegmentReductionImpl:Jze,sqrtImpl:Yze,squaredDifferenceImpl:Qze,staticRegexReplaceImpl:Zze,stridedSliceImpl:eWe,stringNGramsImpl:nWe,stringSplitImpl:iWe,stringToHashBucketFastImpl:oWe,subImpl:sWe,tileImpl:aWe,topKImpl:uWe,transposeImpl:Aze,uniqueImpl:cWe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:dWe,bincountImpl:yZ,bincountReduceImpl:fWe,bitwiseAndImpl:hWe,castImpl:pWe,ceilImpl:mWe,concatImpl:gWe,equalImpl:vWe,expImpl:yWe,expm1Impl:bWe,floorImpl:xWe,gatherNdImpl:wWe,gatherV2Impl:SWe,greaterImpl:CWe,greaterEqualImpl:kWe,lessImpl:TWe,lessEqualImpl:EWe,linSpaceImpl:_We,logImpl:IWe,maxImpl:RWe,maximumImpl:NWe,minimumImpl:PWe,multiplyImpl:AWe,negImpl:$We,notEqualImpl:DWe,prodImpl:OWe,raggedGatherImpl:FWe,raggedRangeImpl:LWe,raggedTensorToTensorImpl:MWe,rangeImpl:BWe,rsqrtImpl:UWe,scatterImpl:VWe,sigmoidImpl:zWe,simpleAbsImpl:bZ,sliceImpl:WWe,sparseFillEmptyRowsImpl:jWe,sparseReshapeImpl:GWe,sparseSegmentReductionImpl:xZ,sqrtImpl:HWe,staticRegexReplaceImpl:qWe,stridedSliceImpl:KWe,stringNGramsImpl:XWe,stringSplitImpl:JWe,stringToHashBucketFastImpl:YWe,subImpl:QWe,tileImpl:ZWe,topKImpl:eje,transposeImpl:g3,uniqueImpl:tje}=lWe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function fi(t,e){return e===1?[t]:wZ(t,e)}function nje(t,e){if(t===1)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rje{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=jr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=fi("rc",this.rank),r=Qt(this.rank),i=this.getOutOfBoundsCondition(n),o=this.getSetup(n),s=this.getOutput(n);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let o=`${r===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)o=`${e[e.length-1-s]},`+o;n.push(o)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let r=this.rank-2;r<this.rank;r++)n+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${i};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SZ{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);let r="";for(let i=0;i<4;i++){let o="thisRC = rc;";i%2===1&&(o+="thisRC.z += 1;"),i>1&&(o+="thisRC.y += 1;"),r+=`
        ${o}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${ije(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?p3():h3(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function ije(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?YUe(["r","c","d"],"inputShape"):Eh(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oje{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,r){const i=Cz(n,r),o=kz(e,i,r);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const s=Sz(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const u=this.freeTextures[o].pop();return this.usedTextures[o].push(u),u}let a;return i===wr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===wr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===wr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===wr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===wr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(e,n,r,i){if(this.freeTextures==null)return;const o=Cz(r,i),s=kz(n,o,i);s in this.freeTextures||(this.freeTextures[s]=[]);const a=Sz(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,i),u=ae().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[s],l=c&&c.indexOf(e);if(l==null||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[l]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function sje(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function Sz(t,e,n,r,i){const o=aje(e,r);let s;if(i){const[u,c]=cg(t[0],t[1]);s=u*c}else{const[u,c]=db(t[0],t[1]);s=u*c}const a=sje(n,o);return s*a}function aje(t,e){switch(t){case wr.PACKED_2X2_FLOAT32:return pZ(e);case wr.PACKED_2X2_FLOAT16:return mZ(e);case wr.UNPACKED_FLOAT32:return dZ(e);case wr.UNPACKED_FLOAT16:return fZ(e);case wr.PACKED_4X1_UNSIGNED_BYTE:return hZ(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function uje(t){return ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?wr.PACKED_2X2_FLOAT32:wr.UNPACKED_FLOAT32:t?wr.PACKED_2X2_FLOAT16:wr.UNPACKED_FLOAT16}function Cz(t,e){if(t===$o.UPLOAD)return wr.PACKED_2X2_FLOAT32;if(t===$o.RENDER||t==null)return uje(e);if(t===$o.DOWNLOAD||t===$o.PIXELS)return wr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function kz(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Za{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const As="if (isnan(x)) return x;",cje="return x;",Tz="return abs(x);",lje="return (x >= 0.0) ? x : (exp(x) - 1.0);",dje=As+`
  return (x < 0.0) ? 0.0 : x;
`,fje=As+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Sl="return x;",hje="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pje="return x;",mje=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,gje=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,vje=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,yje="return 1.0 / (1.0 + exp(-1.0 * x));";class Ul{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bje{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);const n=e.length,r=fi("rc",n),i=Qt(n),o=nje(n,r),s=r.slice(-2),a=n<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xje=BF,wje=1e-7,Sje=1e-4,Q1={};function Cje(t){return t in Q1||(Q1[t]={}),Q1[t]}const kje=ae().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Tje=600;function Eje(){return ae().global.screen==null?1024:ae().global.screen.height*ae().global.screen.width*window.devicePixelRatio*Tje/1024/1024}class $2 extends jA{nextDataId(){return $2.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof hE)n=e;else{const r=da(ae().getNumber("WEBGL_VERSION"),e);n=new hE(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=da(ae().getNumber("WEBGL_VERSION"));n=new hE(r),this.binaryCache=Cje(ae().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new oje(this.gpgpu),this.numMBBeforeWarning=Eje(),this.texData=new d9(this,Bs())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,r,i,o,s){const a=this.makeTensorInfo(n,r),u=this.texData.get(a.dataId);u.isPacked=!1,u.texture={texture:e,texShape:[i,o]},u.texShape=[i,o];const c=J1(n),l=new vz(c,!1,s),d=this.runWebGLProgram(l,[a],r,[[i,o]]);return d.shape=n,u.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,r){if((ae().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ae().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:r,values:e,usage:$o.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,r,i,o){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:i,values:n,usage:$o.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:r,dtype:i,complexTensorInfos:o,slice:s,shape:a,isPacked:u}=n;if(s!=null){let f;u?f=new Ul(a,Sl):f=new Za(a,Sl);const h=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:i}],i),p=this.readSync(h.dataId);return this.disposeIntermediateTensorInfo(h),p}if(r!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return r;const c=this.activeTimers!=null;let l;c&&(l=os());let d;if(i==="complex64"){const f=this.readSync(o.real.dataId),h=this.readSync(o.imag.dataId);d=dR(f,h)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=os()-l),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:r,shape:i,slice:o,dtype:s,complexTensorInfos:a,isPacked:u}=n;if(o!=null){let p;u?p=new Ul(i,Sl):p=new Za(i,Sl);const m=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:s}],s),v=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),v}if(r!=null)return this.convertAndCacheOnCPU(e);if(ae().getBool("DEBUG")&&!ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,l;if(s!=="complex64"&&ae().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const p=this.texData.get(l.dataId);c=this.gpgpu.createBufferFromTexture(p.texture.texture,...q1(i))}this.pendingRead.set(e,[]),s!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(s==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],v=p[1];d=dR(m,v)}else if(c==null)d=this.getValuesFromTexture(e);else{const p=_e(i);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(l!=null&&this.disposeIntermediateTensorInfo(l),c!=null){const p=this.gpgpu.gl;Fe(p,()=>p.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,d),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(p=>p(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Bs().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,n={}){const r=this.texData.get(e),{values:i,shape:o,slice:s,dtype:a,isPacked:u,texture:c}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){let h;u?h=new Ul(o,Sl):h=new Za(o,Sl);const p=this.runWebGLProgram(h,[{dataId:e,shape:o,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(c==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const l=this.decode(e,n.customTexShape),d=Bs().makeTensorFromTensorInfo(l),f=this.texData.get(l.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const r=n.map(i=>Hf(i));return Tn(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Tn(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const r=e[n];if(!kUe(r))throw ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:r,isPacked:i}=this.texData.get(e),o=_e(n);if(ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),h=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(h.texture.texture,...q1(n)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),p}const s=ae().getBool("WEBGL_PACK")&&i===!0,a=s?J1(n):n,u=s?new UVe(a):new BVe(a),c=this.runWebGLProgram(u,[{shape:a,dtype:r,dataId:e}],"float32"),l=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture.texture,l.texShape[0],l.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,r=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,e();const o=du(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),s=du(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(o);a.kernelMs=h9(u),a.getExtraProfileInfo=()=>u.map((c,l)=>({name:s[l],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:os(),endMs:null}}endTimer(e){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=os(),e)}async getQueryTime(e){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:r,texShape:i,usage:o,isPacked:s,slice:a}=this.texData.get(e),u=a&&a.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,o,s)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=kje){return ae().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&_e(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){ls("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return xje(e.shape,n)}packedUnaryOp(e,n,r){const i=new Ul(e.shape,n),o=this.compileAndRun(i,[e],r);return Bs().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const i=bZ(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Tz,e.dtype);const n=new Za(e.shape,Tz),r=this.compileAndRun(n,[e]);return Bs().makeTensorFromTensorInfo(r)}makeTensorInfo(e,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&bc(r[0])){const o=r.map(s=>_c(s));i=this.write(o,e,n)}else i=this.write(r,e,n);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:n}}makeOutput(e,n,r){return Bs().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,r),this)}unpackTensor(e){const n=new bje(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new rje(e.shape),r=!0;return this.runWebGLProgram(n,[e],e.dtype,null,r)}packedReshape(e,n){const r=[Um(e.shape),...Vm(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},o=[Um(n),...Vm(n)],s=new SZ(o,r),a=!0,u=[r],c=this.runWebGLProgram(s,[i],e.dtype,u,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const r=this.texData.get(e),{isPacked:i,shape:o,dtype:s}=r;if(n!=null){const f=_e(o),h=n[0]*n[1]*4;L(f<=h,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=J1(o);let u;i?u=new MVe(a):u=new LVe(a);const c=!0,l=[n??q1(a)],d=this.runWebGLProgram(u,[{shape:a,dtype:s,dataId:e}],s,l,c,n);return{dtype:s,shape:o,dataId:d.dataId}}runWebGLProgram(e,n,r,i,o=!1,s){const a=this.makeTensorInfo(e.outputShape,r),u=this.texData.get(a.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===d0.DENSE){const g=s??q1(e.outputShape);u.texShape=g.map(y=>y*2)}if(e.outTexUsage!=null&&(u.usage=e.outTexUsage),_e(a.shape)===0)return u.values=zc(a.dtype,0),a;const c=[],l=n.map(g=>{if(g.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(g.dataId);if(y.texture==null){if(!e.packedInputs&&_e(g.shape)<=ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:g.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=g.shape)}if(this.uploadToGPU(g.dataId),!!y.isPacked!=!!e.packedInputs)g=y.isPacked?this.unpackTensor(g):this.packTensor(g),c.push(g),y=this.texData.get(g.dataId);else if(y.isPacked&&!AS(y.shape,g.shape)){const b=g,x=g.shape;g.shape=y.shape,g=this.packedReshape(g,x),c.push(g),y=this.texData.get(g.dataId),b.shape=x}return{shape:g.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:u,isUniform:!1},f=FVe(e,l,d),h=this.getAndSaveBinary(f,()=>DVe(this.gpgpu,e,l,d)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),ae().get("ENGINE_COMPILE_ONLY")||OVe(this.gpgpu,h,l,d,i),c.forEach(g=>this.disposeIntermediateTensorInfo(g)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const v=ae().get("WEBGL_FLUSH_THRESHOLD");if(v>0){const g=os();g-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=g)}if(!ae().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&o===!1){const g=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),g}return a}compileAndRun(e,n,r,i,o=!1){return r=r||n[0].dtype,this.runWebGLProgram(e,n,r,i,o)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ot(()=>{if(!ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ae().getBool("DEBUG");ae().set("DEBUG",!1);const n=this.abs(vt(1e-8)).dataSync()[0];if(ae().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?wje:Sje}uploadToGPU(e){const n=this.texData.get(e),{shape:r,dtype:i,values:o,texture:s,usage:a,isPacked:u}=n;if(s!=null)return;const c=this.activeTimers!=null;let l;c&&(l=os());let d=n.texShape;if(d==null&&(d=zUe(r,u),n.texShape=d),o!=null){const f=J1(r);let h,p=d[1],m=d[0];const v=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(u||!v)&&([p,m]=cg(d[0],d[1])),u?h=new zVe(f,v):h=new vz(f,v);const g=v?[m,p]:d,y=this.makeTensorInfo(g,i),b=this.texData.get(y.dataId);v?b.usage=$o.PIXELS:b.usage=$o.UPLOAD,b.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),p,m,o);const x=[[m,p]],S=!0,C=this.runWebGLProgram(h,[y],i,x,S),T=this.texData.get(C.dataId);n.texShape=T.texShape,n.isPacked=T.isPacked,n.usage=T.usage,ae().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=T.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(y),c&&(this.uploadWaitMs+=os()-l)}else{const f=this.acquireTexture(d,a,i,u);n.texture=f}}convertAndCacheOnCPU(e,n){const r=this.texData.get(e),{dtype:i}=r;return n!=null&&(r.values=_je(n,i)),r.values}acquireTexture(e,n,r,i){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,i)}computeBytes(e,n){return e[0]*e[1]*Xy(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const r=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(o){throw o}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await QY(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(oZ(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:r,infLoc:i,nanLoc:o,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:u}=lZ(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=r,e.infLoc=i,e.nanLoc=o,e.outShapeLocation=s,e.outShapeStridesLocation=a,e.outTexShapeLocation=u}}createTensorFromGPUData(e,n,r){e.channels=e.channels||"RGBA";const{texture:i,height:o,width:s,channels:a}=e,u=Bs().backend;if(!u.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=u.writeTexture(i,n,r,o,s,a);return Bs().makeTensorFromDataId(c,n,r,u)}}$2.nextDataId=0;function _je(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */WO()&&lX("webgl",()=>new $2,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v3=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class th{constructor(e,n,r){this.variableNames=["A","B"],this.outputShape=Pt(n,r),this.enableShapeUniforms=jr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ih=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class pg{constructor(e,n,r,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Pt(n,r);const o=this.outputShape.length;this.enableShapeUniforms=jr(o);let s="";if(i)if(o===0||_e(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${Qt(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=fi("coords",o);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${u[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${u[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${u[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${u[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mo(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Ije={kernelName:l2,backendName:"webgl",kernelFunc:mo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,o=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(o.dataId),a=mo({inputs:{x:r},backend:n}),u=mo({inputs:{x:i},backend:n});return s.complexTensorInfos={real:a,imag:u},o}const Rje={kernelName:g$,backendName:"webgl",kernelFunc:Nd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CZ="return (a < 0.) ? b * a : a;",kZ=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Nje(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:o}=r,s=n.makeTensorInfo([],"float32",Sh(o,"float32")),a=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pg(kZ,i.shape,s.shape):new th(CZ,i.shape,s.shape),u=n.runWebGLProgram(a,[i,s],"float32");return n.disposeIntermediateTensorInfo(s),u}const Pje={kernelName:sD,backendName:"webgl",kernelFunc:Nje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TZ="return (a < 0.) ? b * a : a;",EZ=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Aje(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pg(EZ,r.shape,i.shape):new th(TZ,r.shape,i.shape);return n.runWebGLProgram(o,[r,i],"float32")}const $je={kernelName:MD,backendName:"webgl",kernelFunc:Aje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mg="if (isnan(x)) return x;";function At({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:o})=>{const{x:s}=i,a=o,u=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&n!=null){const d=a.texData.get(s.dataId),f=n(d.values,u);return a.makeTensorInfo(s.shape,u,f)}const c=ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let l;return c?l=new Ul(s.shape,e):l=new Za(s.shape,t),a.runWebGLProgram(l,[s],u)}}function _r({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:o}){return({inputs:s,backend:a})=>{const{a:u,b:c}=s,l=a;if(r&&u.dtype==="complex64"){const p=l.texData.get(u.dataId),m=l.texData.get(c.dataId),[v,g]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{const[x,S]=b,C={dataId:x.dataId,dtype:x.dtype,shape:u.shape},T={dataId:S.dataId,dtype:S.dtype,shape:c.shape},E=new th(t,u.shape,c.shape);return l.runWebGLProgram(E,[C,T],la(x.dtype,S.dtype))}),y=Nd({inputs:{real:v,imag:g},backend:l});return l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(g),y}const d=o||la(u.dtype,c.dtype);if((u.dtype==="string"||c.dtype==="string"||l.shouldExecuteOnCPU([u,c]))&&i!=null){const p=l.texData.get(u.dataId).values,m=l.texData.get(c.dataId).values,v=u.dtype==="string"?Bm(p):p,g=u.dtype==="string"?Bm(m):m,[y,b]=i(u.shape,c.shape,v,g,d),x=l.makeTensorInfo(b,d),S=l.texData.get(x.dataId);return S.values=y,x}const f=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let h;return f?h=new pg(e,u.shape,c.shape,n):h=new th(t,u.shape,c.shape),l.runWebGLProgram(h,[u,c],d)}}function f0(t,e=!1){if(t==="linear")return e?pje:cje;if(t==="relu")return e?gje:dje;if(t==="elu")return e?mje:lje;if(t==="relu6")return e?vje:fje;if(t==="prelu")return e?EZ:TZ;if(t==="leakyrelu")return e?kZ:CZ;if(t==="sigmoid")return e?yje:hje;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Z{constructor(e,n,r,i=!1,o=!1,s=!1,a=null,u=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=jr(this.outputShape.length);const l=i?e[1]:e[2],d=Math.ceil(l/2),f=i?"i * 2, rc.y":"rc.y, i * 2",h=o?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",g="";a&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:v=`vec4 activation(vec4 x) {
          ${a}
        }`,g="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",x="rc.x";e[0]<n[0]?b=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${x};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${h});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${g}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ez={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class _z{constructor(e,n,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Pt(n,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iz="return a * b;";function y3(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,o=la(r.dtype,i.dtype);if(r.dtype==="complex64"){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),c=new _z(Ez.REAL,r.shape,i.shape),l=new _z(Ez.IMAG,r.shape,i.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],f=n.runWebGLProgram(c,d,"float32"),h=n.runWebGLProgram(l,d,"float32"),p=Nd({inputs:{real:f,imag:h},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),p}if(n.shouldExecuteOnCPU([r,i])){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),[c,l]=AWe(r.shape,i.shape,a.values,u.values,o),d=n.makeTensorInfo(l,o),f=n.texData.get(d.dataId);return f.values=c,d}let s;return ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new pg(Iz,r.shape,i.shape):s=new th(Iz,r.shape,i.shape),n.runWebGLProgram(s,[r,i],o)}const Dje={kernelName:_D,backendName:"webgl",kernelFunc:y3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oje(t,e,n){const r=[Um(t.shape),...Vm(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},o=[Um(e),...Vm(e)],s=new SZ(o,r),a=!0,u=[r],c=n.runWebGLProgram(s,[i],t.dtype,u,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Re(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:o}=r,s=n,a=_e(i.shape),u=m9(o,a),c=_e(u);L(a===c,()=>`The new shape (${u}) has ${c} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const l=s.texData.get(i.dataId);return l.isPacked&&!AS(i.shape,u)&&!(l.texture!==null&&AS(l.shape,u))?Oje(i,u,s):(s.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype})}const Fje={kernelName:qD,backendName:"webgl",kernelFunc:Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rz{constructor(e,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:o,outSize:s}=e;this.outputShape=[i,s];const a=Math.floor(r/4)*4,u=r%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${Gf(d)?d.toPrecision(2):d}, ones);`}let l="";o%r>0&&(l=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${l}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lje{constructor(e,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:o,outSize:s}=e;this.outputShape=[i,s];let a="0.0",u="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",u="min"):n==="max"&&(a="-1.0 / 1e-20",u="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const l=Math.floor(r/4)*4,d=r%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,h="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");let p="";o%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${l}; i += 4) {
          int inIdx = inOffset + i;
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${l};
        if (${d===1}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mje(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],r=I2(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}function Rh(t,e,n,r){const i=Mje(t.shape);let o=t;for(let s=0;s<i.length;s++){const{inSize:a,windowSize:u,outSize:c}=i[s];let l,d;n==="mean"?l=s===0?new Rz({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},a):new Rz({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c}):l=new Lje({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},n),d=o,o=r.runWebGLProgram(l,[o],e),d.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bje{constructor(e,n){this.variableNames=["A"];const r=new Array(e.length);for(let s=0;s<r.length;s++)r[s]=e[n[s]];this.outputShape=r,this.rank=r.length;const i=Qt(this.rank),o=Uje(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function Uje(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vje{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let l=0;l<r.length;l++)r[l]=e[n[l]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=Qt(this.rank),o=wZ("rc",this.rank),s=new Array(this.rank);for(let l=0;l<n.length;l++)s[n[l]]=o[l];const a=`vec2(${s.slice(-2).join()})`,u=`++${o[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${u}) {
        result[1] = ${c};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${u}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D2(t,e,n){const r=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vje(t.shape,e):new Bje(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zje(t,e,n,r){const i=e,o=t.shape.length,s=tr(i,t.shape);let a=s;const u=Ns(a,o),c=u!=null;let l=t;c&&(l=D2(t,u,r),a=Ps(a.length,o)),ga("sum",a,o);const[d,f]=Cu(l.shape,a);let h=d;n&&(h=Ho(d,s));const p=_e(f),v=_e(t.shape)/p,g=Re({inputs:{x:l},attrs:{shape:[v,p]},backend:r}),y=f2(t.dtype),b=Rh(g,y,"sum",r),x=Re({inputs:{x:b},attrs:{shape:h},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(b),c&&r.disposeIntermediateTensorInfo(l),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,keepDims:s}=r;return zje(i,o,s,n)}const Wje={kernelName:fO,backendName:"webgl",kernelFunc:O2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yi(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{perm:o}=r,s=n,a=i.shape.length,u=new Array(a);for(let l=0;l<u.length;l++)u[l]=i.shape[o[l]];let c;if(s.shouldExecuteOnCPU([i])){const d=s.texData.get(i.dataId).values,f=g3(d,i.shape,i.dtype,o,u);c=s.makeTensorInfo(u,i.dtype);const h=s.texData.get(c.dataId);h.values=f}else c=D2(i,o,s);return c}const jje={kernelName:ty,backendName:"webgl",kernelFunc:yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IZ=1e3;function DS({a:t,b:e,transposeA:n,transposeB:r,backend:i,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:u=null}){const c=t.shape.length,l=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],f=r?e.shape[l-1]:e.shape[l-2],h=n?t.shape[c-1]:t.shape[c-2],p=r?e.shape[l-2]:e.shape[l-1],m=t.shape.slice(0,-2),v=e.shape.slice(0,-2),g=_e(m),y=_e(v),x=Pt(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([h,p]);L(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`);const S=n?[g,d,h]:[g,h,d],C=r?[y,p,f]:[y,f,p],T=Re({inputs:{x:t},backend:i,attrs:{shape:S}}),E=Re({inputs:{x:e},backend:i,attrs:{shape:C}}),I=[T,E],N=Math.max(g,y),$=n?T.shape[1]:T.shape[2],F=o!=null,H=s!=null,G=u==="leakyrelu",J=u!=null?f0(u,!0):null,ne=F||H||G||J!=null;let oe;if((h===1||p===1)&&$>IZ&&ne===!1){let Z=T,se=E;n&&(Z=yi({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),I.push(Z)),r&&(se=yi({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),I.push(se));const fe=p!==1,xe=p===1;let be=Z;fe&&(be=Re({inputs:{x:Z},backend:i,attrs:{shape:[N,$,1]}}),I.push(be));const pe=p===1?2:1;let ge=se;xe&&(ge=Re({inputs:{x:se},backend:i,attrs:{shape:[N,1,$]}}),I.push(ge));const Ce=y3({inputs:{a:be,b:ge},backend:i});oe=O2({inputs:{x:Ce},backend:i,attrs:{axis:pe,keepDims:!0}}),I.push(Ce)}else{const Z=la(t.dtype,e.dtype),se=new _Z(S,C,[N,h,p],n,r,F,J,H,G),fe=[T,E];if(o!=null&&fe.push(o),H&&fe.push(s),G){const xe=i.makeTensorInfo([],"float32",Sh(a,"float32"));fe.push(xe),I.push(xe)}oe=i.runWebGLProgram(se,fe,Z)}const q=Re({inputs:{x:oe},backend:i,attrs:{shape:x}});I.push(oe);for(const Z of I)i.disposeIntermediateTensorInfo(Z);return q}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gje(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:o,bias:s,preluActivationWeights:a}=e,{transposeA:u,transposeB:c,activation:l,leakyreluAlpha:d}=r;return DS({a:i,b:o,transposeA:u,transposeB:c,backend:n,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:l})}const Hje={kernelName:bS,backendName:"webgl",kernelFunc:Gje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nz="return abs(x);";function qje(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const o=n.texData.get(r.dataId),s=bZ(o.values);return n.makeTensorInfo(r.shape,r.dtype,s)}let i;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Ul(r.shape,Nz):i=new Za(r.shape,Nz),n.runWebGLProgram(i,[r],r.dtype)}const Kje={kernelName:KA,backendName:"webgl",kernelFunc:qje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xje=As+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Jje=At({opSnippet:Xje}),Yje={kernelName:XA,backendName:"webgl",kernelFunc:Jje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qje=As+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Zje=At({opSnippet:Qje}),e5e={kernelName:JA,backendName:"webgl",kernelFunc:Zje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pz="return a + b;",t5e=_r({opSnippet:Pz,packedOpSnippet:Pz,supportsComplex:!0,cpuKernelImpl:dWe}),n5e={kernelName:u2,backendName:"webgl",kernelFunc:t5e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r5e{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((o,s)=>`T${s}`);const r=[];this.variableNames.forEach(o=>{r.push(`float v${o} = get${o}AtOutCoords();`)});const i=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i5e{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((o,s)=>`T${s}`);const r=[];this.variableNames.forEach(o=>{r.push(`vec4 v${o} = get${o}AtOutCoords();`)});const i=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qx(t){const{inputs:e,backend:n}=t,r=e;if(r.length===1)return mo({inputs:{x:r[0]},backend:n});if(r.length>ae().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),c=qx({inputs:r.slice(0,u),backend:n}),l=qx({inputs:r.slice(u),backend:n});return qx({inputs:[c,l],backend:n})}const i=r.map(u=>u.dtype).reduce((u,c)=>la(u,c)),o=r.map(u=>u.shape),a=ae().getBool("WEBGL_PACK")?new i5e(r[0].shape,o):new r5e(r[0].shape,o);return n.runWebGLProgram(a,r,i)}const o5e={kernelName:YA,backendName:"webgl",kernelFunc:qx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,keepDims:s}=r,a=i.shape.length,u=tr(o,i.shape);let c=u;const l=Ns(c,a);let d=i;l!=null&&(d=yi({inputs:{x:i},backend:n,attrs:{perm:l}}),c=Ps(c.length,a)),ga("all",c,a);const[f,h]=Cu(d.shape,c),p=_e(h),m=Re({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),v=Rh(m,m.dtype,"all",n);let g;if(s){const y=Ho(f,u);g=Re({inputs:{x:v},backend:n,attrs:{shape:y}})}else g=Re({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),l!=null&&n.disposeIntermediateTensorInfo(d),g}const a5e={kernelName:QA,backendName:"webgl",kernelFunc:s5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,keepDims:s}=r,a=i.shape.length,u=tr(o,i.shape);let c=u;const l=Ns(c,a);let d=i;l!=null&&(d=yi({inputs:{x:i},backend:n,attrs:{perm:l}}),c=Ps(c.length,a)),ga("any",c,a);const[f,h]=Cu(d.shape,c),p=_e(h),m=Re({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),v=Rh(m,m.dtype,"any",n);let g;if(s){const y=Ho(f,u);g=Re({inputs:{x:v},backend:n,attrs:{shape:y}})}else g=Re({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),l!=null&&n.disposeIntermediateTensorInfo(d),g}const c5e={kernelName:ZA,backendName:"webgl",kernelFunc:u5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l5e{constructor(e,n,r){this.variableNames=["A"];const{windowSize:i,batchSize:o,outSize:s}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[o,s];const a=n==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d5e{constructor(e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,L(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],s=Math.ceil(o/n);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,u=a.length,c=Qt(u),l=fi("coords",u);let d,f;if(s===1){f=u+1;const E=Qt(f);d=`
        ${E} sourceLocR = ${E}(${l.join()}, 0);
        ++${l[u-1]};
        ${E} sourceLocG = ${E}(${l.join()}, 0);
        ++${l[u-2]};
        ${E} sourceLocA = ${E}(${l.join()}, 0);
        --${l[u-1]};
        ${E} sourceLocB = ${E}(${l.join()}, 0);
        --${l[u-2]};`}else f=u,d=`
        ${c} sourceLocR = coords;
        ++${l[u-1]};
        ${c} sourceLocG = coords;
        ++${l[u-2]};
        ${c} sourceLocA = coords;
        --${l[u-1]};
        ${c} sourceLocB = coords;
        --${l[u-2]};`;const h=["x","y","z","w","u","v"].slice(0,f),p="."+h[f-1],m=h.map(E=>"int "+E),v=fi("sourceLocR",f-1).concat("inIdx.r"),g=fi("sourceLocG",f-1).concat("inIdx.g"),y=fi("sourceLocB",f-1).concat("inIdx.b"),b=fi("sourceLocA",f-1).concat("inIdx.a"),x=r==="max"?"greaterThan":"lessThan",S=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()})));`,C=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${g.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,T=i?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${h.join()}),
                                          vec2(${h.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${h.join()}),
                               vec2(${h.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${l[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${l[u-2]} < ${a[u-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(t,e,n,r=null){let i=e.shape[0],o=e.shape[1];r!=null&&(i=r.shape[0],o=r.shape[1]);const s=I2(o),a={windowSize:s,inSize:o,batchSize:i,outSize:Math.ceil(o/s)},u=new l5e(a,n,r==null),c=[e];r!=null&&c.push(r);const l=t.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;const d=RZ(t,e,n,l);return t.disposeIntermediateTensorInfo(l),d}function NZ(t,e,n,r=null){const i=r!=null?r.shape:e.shape,o=i[i.length-1],s=I2(o),a=new d5e(i,s,n,r==null),u=r==null?[e]:[e,r],c=t.runWebGLProgram(a,u,"int32");if(c.shape.length===e.shape.length){const l=NZ(t,e,n,c);return t.disposeIntermediateTensorInfo(c),l}return c}function PZ(t,e,n,r){const i=[n];if(ga("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.shape.length),!ae().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],s=t.texData.get(e.dataId),a=s!==null&&s.isPacked;let u=e;a&&(u=t.unpackTensor(e),o.push(u));const[c,l]=Cu(u.shape,i),d=_e(l),f=Re({inputs:{x:u},backend:t,attrs:{shape:[-1,d]}});o.push(f);const h=RZ(t,f,r);o.push(h);const p=Re({inputs:{x:h},backend:t,attrs:{shape:c}});return o.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return NZ(t,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o}=r;let s=tr(o,i.shape);const a=Ns(s,i.shape.length);let u=i;const c=[];a!=null&&(u=yi({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(u),s=Ps(s.length,u.shape.length)),ga("argMax",[s[0]],u.shape.length);const l=PZ(n,u,s[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),l}const h5e={kernelName:e$,backendName:"webgl",kernelFunc:f5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o}=r;let s=tr(o,i.shape);const a=Ns(s,i.shape.length);let u=i;const c=[];a!=null&&(u=yi({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(u),s=Ps(s.length,u.shape.length)),ga("argMin",[s[0]],u.shape.length);const l=PZ(n,u,s[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),l}const m5e={kernelName:t$,backendName:"webgl",kernelFunc:p5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g5e=As+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,v5e=At({opSnippet:g5e}),y5e={kernelName:n$,backendName:"webgl",kernelFunc:v5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b5e=As+"return log(x + sqrt(x * x + 1.0));",x5e=At({opSnippet:b5e}),w5e={kernelName:r$,backendName:"webgl",kernelFunc:x5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S5e=As+`
  return atan(x);
`,C5e=At({opSnippet:S5e}),k5e={kernelName:i$,backendName:"webgl",kernelFunc:C5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T5e=v3+`
  return atan(a, b);
`,E5e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ih+`
  return result;
`,_5e=_r({opSnippet:T5e,packedOpSnippet:E5e}),I5e={kernelName:s$,backendName:"webgl",kernelFunc:_5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R5e=As+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,N5e=At({opSnippet:R5e}),P5e={kernelName:o$,backendName:"webgl",kernelFunc:N5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h0{constructor(e,n,r,i=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(m||(y="-1.0 / 1e-20"),r){const E=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${h}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${l}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${E} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?o?v:g:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const S=Math.floor(s/4)*4,C=s%4,T=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${h}, ${p});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${l};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${l}, d),
              getValue(batch, xR, xC + 2 * ${l}, d),
              getValue(batch, xR, xC + 3 * ${l}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${S};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${l}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${l}, d),
              getValue(batch, xR, xC + 2 * ${l}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${x});
      }
    `}}class b3{constructor(e,n,r,i=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,d=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg";let x="0.0";if(b||(x="-1.0 / 1e-20"),r){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${c});
        const ivec3 pads = ivec3(${v}, ${g}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${h};
              wD += ${l}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const T=Math.floor(s/4)*4,E=s%4,I=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${c});
      const ivec3 pads = ivec3(${v}, ${g}, ${y});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${I}
            }

            int xC = xCCorner + ${T};
            if (${E===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${E===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${E===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${I}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;fb(i,"avgPool");const{filterSize:o,strides:s,pad:a,dimRoundingMode:u}=r,c=1;L(bo(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const l=Ch(i.shape,o,s,c,a,u);if(l.filterWidth===1&&l.filterHeight===1&&yn(l.inShape,l.outShape))return mo({inputs:{x:i},backend:n});const d=new h0(l,"avg",!1);return n.runWebGLProgram(d,[i],"float32")}const $5e={kernelName:a$,backendName:"webgl",kernelFunc:A5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:o,strides:s,pad:a,dimRoundingMode:u,dataFormat:c}=r,l=[1,1,1],d=eb(i.shape,o,s,l,a,u,c),f=new b3(d,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const O5e={kernelName:u$,backendName:"webgl",kernelFunc:D5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F5e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,i=e.strideHeight,o=e.strideWidth,s=e.dilationHeight,a=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,d=c-1-e.padInfo.left,f=1/(n*r);this.userCode=`
      const ivec2 pads = ivec2(${l}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class L5e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,r=e.filterHeight,i=e.filterWidth,o=e.strideDepth,s=e.strideHeight,a=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=f-1-e.padInfo.top,v=h-1-e.padInfo.left,g=1/(n*r*i);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${v});
      const float avgMultiplier = float(${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${l}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:o}=e,s=o,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=r,d=[1,1,1],f=eb(s.shape,a,u,d,c,l),h=new L5e(f);return n.runWebGLProgram(h,[i],s.dtype)}const B5e={kernelName:E9,backendName:"webgl",kernelFunc:M5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:o}=e,s=o;fb([i,o],"avgPoolGrad");const{filterSize:a,strides:u,pad:c}=r,l=Ch(s.shape,a,u,1,c),d=new F5e(l);return n.runWebGLProgram(d,[i],s.dtype)}const V5e={kernelName:T9,backendName:"webgl",kernelFunc:U5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5e(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:o}=e,{transposeA:s,transposeB:a}=r;return DS({a:i,b:o,transposeA:s,transposeB:a,backend:n})}const W5e={kernelName:c$,backendName:"webgl",kernelFunc:z5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j5e{constructor(e,n,r,i,o,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Pt(e,n),Pt(e,r);let a="0.0";i!=null&&(Pt(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";o!=null&&(Pt(e,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G5e{constructor(e,n,r,i,o,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Pt(e,n),Pt(e,r);let a="vec4(0.0)";i!=null&&(Pt(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";o!=null&&(Pt(e,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5e=({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:i,variance:o,offset:s,scale:a}=t;L(i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(s==null||i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;u==null&&(u=.001);const c=[r,i,o];let l=null;s!=null&&(l=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));const f=ae().getBool("WEBGL_PACK_NORMALIZATION")?new G5e(r.shape,i.shape,o.shape,l,d,u):new j5e(r.shape,i.shape,o.shape,l,d,u);return e.runWebGLProgram(f,c,c[0].dtype)},q5e={kernelName:J$,backendName:"webgl",kernelFunc:H5e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K5e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=Qt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=X5e(this.rank);let i;const o=e.map((s,a)=>`sourceLoc.${_R[a]} = start[${a}] + coords.${_R[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${r}));
      }
    `}}const _R=["x","y","z","w","u","v"];function X5e(t){if(t===1)return"sourceLoc";if(t<=6)return _R.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J5e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Qt(this.rank),r=fi("coords",this.rank),i=fi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,s=`getChannel(getSource(${i.join()}), ${o})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${s};
        --${i[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((l,d)=>`start[${d}]`).join()});`:e.map((l,d)=>`${i[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5e(t,e,n,r){const i=r.texData.get(t.dataId),o=r.makeTensorInfo(n,t.dtype),s=r.texData.get(o.dataId);Object.assign(s,i),s.refCount=1,s.shape=n,s.dtype=t.dtype;let a=r3(e,dr(t.shape));i.slice&&(a+=i.slice.flatOffset),s.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const u=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,u+1),o}function gg(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:o,size:s}=r,[a,u]=KY(i,o,s);if(MY(i,a,u),_e(u)===0)return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const d=n.texData.get(i.dataId),f=WWe(d.values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,f)}const{isPacked:c}=n.texData.get(i.dataId),l=n3(i.shape,a,u);if(c||!l){const d=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new J5e(u):new K5e(u),f=[a];return n.runWebGLProgram(d,[i],i.dtype,f)}return n.uploadToGPU(i.dataId),Y5e(i,a,u,n)}const Q5e={kernelName:oO,backendName:"webgl",kernelFunc:gg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z5e=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:o,crops:s}=r;L(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,b)=>y*b),u=o3(i.shape,o,a),c=s3(u.length,o.length),l=a3(i.shape,o,a),d=oQ(s,o.length),f=sQ(l,s,o.length),h=[],p=Re({inputs:{x:i},backend:n,attrs:{shape:u}}),m=yi({inputs:{x:p},backend:n,attrs:{perm:c}}),v=Re({inputs:{x:m},backend:n,attrs:{shape:l}}),g=gg({inputs:{x:v},backend:n,attrs:{begin:d,size:f}});return h.push(p),h.push(m),h.push(v),h.forEach(y=>n.disposeIntermediateTensorInfo(y)),g},e6e={kernelName:l$,backendName:"webgl",kernelFunc:Z5e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:o}=e,{size:s}=r,a=n.readSync(i.dataId),u=n.readSync(o.dataId),c=yZ(a,u,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,c)}const n6e={kernelName:d$,backendName:"webgl",kernelFunc:t6e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r6e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,i6e=`
  return float(int(a.r) & int(b.r));
`;function o6e(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=ae().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,i])||s===1){const u=n.texData.get(r.dataId).values,c=n.texData.get(i.dataId).values,[l,d]=hWe(r.shape,i.shape,u,c,r.dtype),f=n.makeTensorInfo(d,r.dtype),h=n.texData.get(f.dataId);return h.values=l,f}let a;return o?a=new pg(r6e,r.shape,i.shape,!1):a=new th(i6e,r.shape,i.shape),n.runWebGLProgram(a,[r,i],r.dtype)}const s6e={kernelName:f$,backendName:"webgl",kernelFunc:o6e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6e(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,o=n.readSync(r.dataId),s=n.readSync(i.dataId),a=Pt(Array.from(o),Array.from(s));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const u6e={kernelName:h$,backendName:"webgl",kernelFunc:a6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c6e="return float(a != b);",AZ=_r({opSnippet:c6e,cpuKernelImpl:DWe,dtype:"bool"}),l6e={kernelName:RD,backendName:"webgl",kernelFunc:AZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pb(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.texData.get(r.dataId);return mo({inputs:{x:i.complexTensorInfos.real},backend:n})}const d6e={kernelName:jD,backendName:"webgl",kernelFunc:pb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f6e="return float(int(x));";function h6e(t,e){const n=new Za(t.shape,f6e),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:o}=r;if(o==="complex64"){if(i.dtype==="complex64")return mo({inputs:{x:i},backend:n});const s=pd(i.shape),a=IR({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),u=Nd({inputs:{real:a,imag:s},backend:n});return s.dispose(),n.disposeIntermediateTensorInfo(a),u}if(i.dtype==="complex64"){const s=pb({inputs:{input:i},backend:n}),a=IR({inputs:{x:s},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(s),a}if(!y9(i.dtype,o)){const s=mo({inputs:{x:i},backend:n});return{dataId:s.dataId,shape:s.shape,dtype:o}}if(n.shouldExecuteOnCPU([i])){const s=n.texData.get(i.dataId).values,[a,u,c]=pWe(s,i.shape,i.dtype,o);return n.makeTensorInfo(a,u,c)}if(o==="int32")return h6e(i,n);if(o==="bool"){const s=n.makeTensorInfo([],"bool",zc("bool",1)),u=AZ({inputs:{a:i,b:s},backend:n});return n.disposeIntermediateTensorInfo(s),u}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${o}`)}const p6e={kernelName:c2,backendName:"webgl",kernelFunc:IR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Az="return ceil(x);",m6e=At({opSnippet:Az,packedOpSnippet:Az,cpuKernelImpl:mWe}),g6e={kernelName:p$,backendName:"webgl",kernelFunc:m6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v6e{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y6e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{clipValueMin:o,clipValueMax:s}=r;let a;ae().getBool("WEBGL_PACK_CLIP")?a=new y6e(i.shape):a=new v6e(i.shape);const u=[[o],[s]];return n.runWebGLProgram(a,[i],i.dtype,u)}const x6e={kernelName:m$,backendName:"webgl",kernelFunc:b6e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w6e{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function S6e(t){const{inputs:e,backend:n}=t,{x:r}=e,i=n.texData.get(r.dataId),o=new w6e(r.shape),s=[$z(r,i.complexTensorInfos.real),$z(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(o,s,s[0].dtype)}const C6e={kernelName:v$,backendName:"webgl",kernelFunc:S6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k6e{constructor(e){this.outputShape=[],this.outputShape=Zf(e,1),this.variableNames=e.map((s,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let s=1;s<n.length;s++)n[s]=n[s-1]+e[s][1];const r=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<n.length;s++){const a=n[s-1];r.push(`else if (yC < ${n[s]}) setOutput(getT${s}(yR, yC-${a}));`)}const i=n.length,o=n[n.length-1];r.push(`else setOutput(getT${i}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T6e{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Zf(e,n);const r=this.outputShape,i=r.length,o=Qt(i),s=fi("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((m,v)=>`T${v}`);const u=new Array(e.length-1);u[0]=e[0][n];for(let m=1;m<u.length;m++)u[m]=u[m-1]+e[m][n];const c=a[n],l=a.slice(-2),d=a.join();let f=`if (${c} < ${u[0]}) {
        return getChannel(
            getT0(${d}), vec2(${l.join()}));
        }`;for(let m=1;m<u.length;m++){const v=u[m-1];f+=`
        if (${c} < ${u[m]}  && ${c} >= ${u[m-1]}) {
          return getChannel(
            getT${m}(${Z1(a,c,v)}),
            vec2(${Z1(l,c,v)}));
        }`}const h=u.length,p=u[u.length-1];f+=`
        return getChannel(
          getT${h}(${Z1(a,c,p)}),
          vec2(${Z1(l,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[i-1]} = ${s[i-1]} + 1;
        if (${s[i-1]} < ${r[i-1]}) {
          result.g = getValue(${s});
        }

        ${s[i-2]} = ${s[i-2]} + 1;
        if (${s[i-2]} < ${r[i-2]}) {
          result.a = getValue(${s});
        }

        ${s[i-1]} = ${s[i-1]} - 1;
        if (${s[i-2]} < ${r[i-2]} &&
            ${s[i-1]} < ${r[i-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}}function Z1(t,e,n){const r=t.indexOf(e);return t.map((o,s)=>s===r?`${o} - ${n}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F2(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.texData.get(r.dataId);return mo({inputs:{x:i.complexTensorInfos.imag},backend:n})}const E6e={kernelName:nD,backendName:"webgl",kernelFunc:F2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tv(t,e,n){const r=t[0].dtype;if(r==="complex64"){const h=t.map(y=>pb({inputs:{input:y},backend:n})),p=t.map(y=>F2({inputs:{input:y},backend:n})),m=Tv(h,e,n),v=Tv(p,e,n),g=Nd({inputs:{real:m,imag:v},backend:n});return h.forEach(y=>n.disposeIntermediateTensorInfo(y)),p.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),g}let i=n.shouldExecuteOnCPU(t);if(r==="string"&&(i=!0),i){const h=t.map(x=>{const C=[-1,_e(x.shape.slice(e))];return Re({inputs:{x},backend:n,attrs:{shape:C}})}),p=h.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),m=Zf(h.map(x=>x.shape),1),v=h[0].shape[0]===1,g=gWe(p,m,r,v),y=Zf(t.map(x=>x.shape),e),b=n.makeTensorInfo(y,r,g);return h.forEach(x=>n.disposeIntermediateTensorInfo(x)),b}const o=t.filter(h=>_e(h.shape)>0),s=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const h=s?new Za(t[0].shape,Sl):new Ul(t[0].shape,Sl);return n.runWebGLProgram(h,t,r)}const a=ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const h=[];for(let m=0;m<o.length;m+=a){const v=o.slice(m,m+a);h.push(Tv(v,e,n))}const p=Tv(h,e,n);for(const m of h)n.disposeIntermediateTensorInfo(m);return p}if(s){const h=new T6e(o.map(p=>p.shape),e);return n.runWebGLProgram(h,o,r)}const{tensors2D:u,outShape:c}=_6e(o,e,n),l=new k6e(u.map(h=>h.shape)),d=n.runWebGLProgram(l,u,r);u.forEach(h=>n.disposeIntermediateTensorInfo(h));const f=Re({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),f}function _6e(t,e,n){const r=Zf(t.map(o=>o.shape),e);return{tensors2D:t.map(o=>Re({inputs:{x:o},attrs:{shape:[-1,_e(o.shape.slice(e))]},backend:n})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,o=tr(i,e[0].shape)[0],s=e.map(c=>c.shape);ZY(s,o);const a=Zf(e.map(c=>c.shape),o);if(_e(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const u=e.filter(c=>_e(c.shape)>0);return u.length===1?mo({inputs:{x:u[0]},backend:n}):Tv(u,o,n)}const I6e={kernelName:y$,backendName:"webgl",kernelFunc:$Z};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DZ{constructor(e,n=!1,r=null,i=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.top,a=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,y=v?2:3,b=v?3:1;let x="",S="";r&&(i?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`
          float activation(float x) {
            ${r}
          }
        `,S="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${u}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${g}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${l};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${S}
        setOutput(result);
      }
    `}}class R6e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,r=e.padInfo.top,i=e.padInfo.left,o=e.strideDepth,s=e.strideHeight,a=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,d=e.filterDepth,f=e.filterHeight,h=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${s}, ${a});
      const ivec3 pads = ivec3(${n}, ${r}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h}; wC++) {
              int xC = xCCorner + wC * ${l};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OZ{constructor(e,n=!1,r=null,i=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=jr(this.outputShape.length);const s=e.padInfo.left,a=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,d=l;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<l;v++)f+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<l;v++)f+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(d+1)/2;v++){const g=v*2;if(f+=`
           xC = xCCorner + ${g*u};
           `,a===1){if(g<l&&(s%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }
               `,u===1&&g>0?f+=`
                 xC${g} = vec4(xTexelC${g-2}.zw, xTexelC${g}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${g} = vec4(previous.zw, xTexelC${g}.xy);
                   } else {
                     xC${g} = vec4(0.0, 0.0, xTexelC${g}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xC${g} = xTexelC${g};
                 `,g+1<l)){const y=s%2===0?s2(u):u;u%2===0&&s%2===1||u%2!==0&&s%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                     xTexelC${g+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${g+1}.zw = vec2(0.0);
                     }
                     xTexelC${g+1}Ready = 1;
                   }
                   `,u>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${g+1} = vec4(previous.zw, xTexelC${g+1}.xy);
                     } else {
                      xC${g+1} = vec4(0.0, 0.0, xTexelC${g+1}.xy);
                     }
                     `:f+=`
                     xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.xy);
                     `):y===1?f+=`
                     xC${g+1} = xTexelC${g};
                     `:f+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                       xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${g+1}.zw = vec2(0.0);
                       }
                       xTexelC${g+1}Ready = 1;
                     }

                     xC${g+1} = xTexelC${g+1};
                     `}}else g<l&&(s%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.0);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
               `,g+1<l&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${g+1} = vec4(xTexelC${g+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(
                   xTexelC${g}.xy, xTexelC${g+1}.xy);
               `,g+1<l&&(f+=`
                   xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
                 `)));g<l&&(f+=`
             wTexel = getW(r, ${g}, d1, d2);
             dotProd += xC${g}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${g}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,g+1<l&&(f+=`
               wTexel = getW(r, ${g+1}, d1, d2);
               dotProd += xC${g+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${g+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let h="",p="";r&&(i?h=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:o?h=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:h=`vec4 activation(vec4 x) {
           ${r}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${h}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N6e{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=jr(this.outputShape.length);const{dataFormat:r}=n,i=bi(),o=r==="channelsLast",s=o?1:2,a=o?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let l=0;l<=1;l++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${l};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${l*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${l*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OS(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function FZ({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:a=null}){const u=t.shape,c=r.texData.get(t.dataId),l=n.inChannels,d=u[0]*u[1]*u[2],f=n.outChannels,h=n.dataFormat==="channelsLast",p=!1,m=!1;let v;const g=[];if(o!=null){const x=OS(o.shape,h);x!=null&&(o=Re({inputs:{x:o},backend:r,attrs:{shape:x}}),g.push(o))}if(i!=null){const x=OS(i.shape,h);x!=null&&(i=Re({inputs:{x:i},backend:r,attrs:{shape:x}}),g.push(i))}if(!((d===1||f===1)&&l>IZ)&&c.isPacked&&h&&c.texture!=null&&u[2]%2!==0&&yn(c.shape.slice(-3),u.slice(-3))){const x=u[0]*u[1]*(u[2]+1),S={dataId:t.dataId,shape:[1,x,n.inChannels],dtype:t.dtype},C=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,L(AS(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);const T=Re({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(T);const E=DS({a:S,b:T,backend:r,transposeA:p,transposeB:m,bias:i,activation:a,preluActivationWeights:o,leakyreluAlpha:s}),I=r.texData.get(E.dataId);L(I.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=C,I.shape=n.outShape,v=mo({inputs:{x:E},backend:r}),v.shape=n.outShape,g.push(E)}else{const x=n.outHeight*n.outWidth,S=Re({inputs:{x:t},backend:r,attrs:{shape:h?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),C=Re({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),T=DS({a:h?S:C,b:h?C:S,transposeA:!h,transposeB:m,backend:r,bias:i,activation:a,preluActivationWeights:o,leakyreluAlpha:s});v=Re({inputs:{x:T},backend:r,attrs:{shape:n.outShape}}),g.push(S),g.push(C),g.push(T)}for(const x of g)r.disposeIntermediateTensorInfo(x);return v}function LZ({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:a=null}){const{filterWidth:u,filterHeight:c,inChannels:l,outWidth:d,outHeight:f,dataFormat:h}=n,p=h==="channelsLast",m=u*c*l,v=f*d,g=[n.batchSize,m,v],y=!0,b=!1,x=[];if(o!=null){const q=OS(o.shape,p);q!=null&&(o=Re({inputs:{x:o},backend:r,attrs:{shape:q}}),x.push(o))}if(i!=null){const q=OS(i.shape,p);q!=null&&(i=Re({inputs:{x:i},backend:r,attrs:{shape:q}}),x.push(i))}const S=Re({inputs:{x:e},backend:r,attrs:{shape:[1,m,_e(e.shape)/m]}});x.push(S);const C=new N6e(g,n),T=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],E=r.runWebGLProgram(C,[t],"float32",T),I=Re({inputs:{x:E},backend:r,attrs:{shape:g}});x.push(E),x.push(I);const N=i!=null,$=o!=null,F=a==="leakyrelu",H=a?f0(a,!0):null,G=new _Z(p?I.shape:S.shape,p?S.shape:I.shape,p?[n.batchSize,v,n.outChannels]:[n.batchSize,n.outChannels,v],y,b,N,H,$,F),J=p?[I,S]:[S,I];if(i&&J.push(i),$&&J.push(o),F){const q=r.makeTensorInfo([],"float32",Sh(s,"float32"));J.push(q),x.push(q)}const ne=r.runWebGLProgram(G,J,"float32"),oe=Re({inputs:{x:ne},backend:r,attrs:{shape:n.outShape}});x.push(ne);for(const q of x)r.disposeIntermediateTensorInfo(q);return oe}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P6e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:o}=e,{strides:s,pad:a,dataFormat:u,dilations:c,dimRoundingMode:l}=r,d=og(u),f=Go(i.shape,o.shape,s,c,a,l,!1,d);let h;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))h=FZ({x:i,filter:o,convInfo:f,backend:n});else if(f.strideWidth<=2&&d==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const m=new OZ(f),v=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];h=n.runWebGLProgram(m,[i,o],"float32",v)}else if(ae().getBool("WEBGL_CONV_IM2COL"))h=LZ({x:i,filter:o,convInfo:f,backend:n});else{const m=new DZ(f);h=n.runWebGLProgram(m,[i,o],"float32")}const p=Re({inputs:{x:h},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(h),p}const A6e={kernelName:b$,backendName:"webgl",kernelFunc:P6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $6e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,r=e.strideWidth,i=e.padInfo.top,o=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class D6e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,i=e.strideHeight,o=e.strideWidth,s=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,u=r-1-e.padInfo.left,c=s?1:2,l=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${l}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class O6e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.padInfo.front,s=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class F6e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,r=e.filterHeight,i=e.filterWidth,o=e.strideDepth,s=e.strideHeight,a=e.strideWidth,u=n-1-e.padInfo.front,c=r-1-e.padInfo.top,l=i-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${c}, ${l});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:o}=e,{strides:s,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:l}=r,d=og(u),f=Go(i.shape,l,s,1,a,c,!1,d),h=new $6e(f);return n.runWebGLProgram(h,[i,o],"float32")}const M6e={kernelName:x$,backendName:"webgl",kernelFunc:L6e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B6e{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=jr(this.outputShape.length);const n=e.filterHeight,r=e.filterWidth,i=n-1-e.padInfo.top,o=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:o}=e,{inputShape:s,strides:a,pad:u,dataFormat:c,dimRoundingMode:l}=r,d=og(c),f=Go(s,o.shape,a,1,u,l,!1,d);if(ae().getBool("WEBGL_PACK")&&d==="channelsLast"){const h=[[f.strideHeight,f.strideWidth]],p=new B6e(f);return n.runWebGLProgram(p,[i,o],"float32",h)}else{const h=new D6e(f);return n.runWebGLProgram(h,[i,o],"float32")}}const V6e={kernelName:w$,backendName:"webgl",kernelFunc:U6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z6e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:o}=e,{strides:s,pad:a,dilations:u}=r,c=tb(i.shape,o.shape,s,u,a),l=new R6e(c);return n.runWebGLProgram(l,[i,o],"float32")}const W6e={kernelName:S$,backendName:"webgl",kernelFunc:z6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:o}=e,{strides:s,pad:a,filterShape:u}=r,c=tb(i.shape,u,s,1,a),l=new O6e(c);return n.runWebGLProgram(l,[i,o],"float32")}const G6e={kernelName:_9,backendName:"webgl",kernelFunc:j6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:o}=e,{pad:s,strides:a,inputShape:u}=r,c=tb(u,o.shape,a,1,s),l=new F6e(c);return n.runWebGLProgram(l,[i,o],"float32")}const q6e={kernelName:C$,backendName:"webgl",kernelFunc:H6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K6e=mg+`
  return cos(x);
`,X6e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Ih}
  return result;
`,J6e=At({opSnippet:K6e,packedOpSnippet:X6e}),Y6e={kernelName:k$,backendName:"webgl",kernelFunc:J6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q6e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Z6e=At({opSnippet:Q6e}),eGe={kernelName:T$,backendName:"webgl",kernelFunc:Z6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tGe{constructor(e,n,r,i,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,a,u,c]=e,[l]=n,[d,f]=r;this.outputShape=[l,d,f,c];const h=i==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${u-1}.0`],[v,g,y]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,x,S]=f>1?[`${(u-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${g};
        float width_scale = ${x};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${h} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nGe=t=>{const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:o,boxInd:s}=e,{cropSize:a,method:u,extrapolationValue:c}=r,l=new tGe(i.shape,o.shape,a,u,c);return n.runWebGLProgram(l,[i,o,s],"float32")},rGe={kernelName:I$,backendName:"webgl",kernelFunc:nGe};var p0;(function(t){t.Prod="*",t.Sum="+"})(p0||(p0={}));class Dz{constructor(e,n,r,i){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,s=this.op===p0.Prod?"1.0":"0.0",a=r?s:`getX(${Oz(o,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let c="",l="";r?(c=i?`end != ${u-1}`:"end != 0",l=i?"end + 1":"end - 1"):(c=i?`end + pow2 < ${u}`:"end >= pow2",l=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Qt(o)} coords = getOutputCoords();
        int end = ${Fz(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${l};
          ${Fz(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${Oz(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function Oz(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function Fz(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(t,e,n,r,i,o){const s=e.shape.length,a=Ns([r],s);let u=e;a!=null&&(u=yi({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Ps(1,s)[0];if(c!==s-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const l=u.shape[c];let d=mo({inputs:{x:u},backend:n});for(let f=0;f<=Math.ceil(Math.log2(l))-1;f++){const h=new Dz(t,u.shape,!1,o),p=[[f]],m=d;d=n.runWebGLProgram(h,[d],d.dtype,p),n.disposeIntermediateTensorInfo(m)}if(i){const f=new Dz(t,u.shape,i,o),h=d;d=n.runWebGLProgram(f,[d],d.dtype),n.disposeIntermediateTensorInfo(h)}if(a!=null){const f=rF(a),h=yi({inputs:{x:d},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),h}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,exclusive:s,reverse:a}=r;return MZ(p0.Prod,i,n,o,s,a)}const oGe={kernelName:E$,backendName:"webgl",kernelFunc:iGe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,exclusive:s,reverse:a}=r;return MZ(p0.Sum,i,n,o,s,a)}const aGe={kernelName:_$,backendName:"webgl",kernelFunc:sGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:o}=e,{size:s,binaryOutput:a}=r;if(i.shape.length===1){const u=n.readSync(i.dataId),c=n.readSync(o.dataId),l=yZ(u,c,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,l)}else if(i.shape.length===2){const u=n.bufferSync(i),c=n.bufferSync(o),l=fWe(u,c,s,a);return n.makeTensorInfo(l.shape,o.dtype,l.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const cGe={kernelName:R$,backendName:"webgl",kernelFunc:uGe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lGe{constructor(e,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:o,dataFormat:s}=r,a=i.shape[0],u=s==="NHWC"?i.shape[1]:i.shape[2],c=s==="NHWC"?i.shape[2]:i.shape[3],l=s==="NHWC"?i.shape[3]:i.shape[1],d=u*o,f=c*o,h=l/(o*o),p=s==="NHWC"?[a,d,f,h]:[a,h,d,f],m=new lGe(p,o,s);return n.runWebGLProgram(m,[i],i.dtype)}const fGe={kernelName:N$,backendName:"webgl",kernelFunc:dGe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BZ{constructor(e,n=!1,r=null,i=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=jr(this.outputShape.length);const s=e.filterHeight,a=e.filterWidth,u=e.outChannels/e.inChannels;let c="",l="";r&&(i?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:c=`
          float activation(float x) {
            ${r}
          }
        `,l="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UZ{constructor(e,n=!1,r=null,i=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=jr(this.outputShape.length);const s=e.outChannels/e.inChannels,a=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,f=d;let h=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<d;g++)h+=`
          vec4 xTexelC${g*2};
          int xTexelC${g*2}Ready;
          vec4 xTexelC${g*2+1};
          int xTexelC${g*2+1}Ready;
          vec4 xC${g};`;h+=`
    for (int r = 0; r < ${l}; r++) {
      `;for(let g=0;g<d;g++)h+=`
          xTexelC${g*2} = vec4(0.0);
          xTexelC${g*2}Ready = 0;
          xTexelC${g*2+1} = vec4(0.0);
          xTexelC${g*2+1}Ready = 0;
          xC${g} = vec4(0.0);`;h+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let g=0;g<(f+1)/2;g++){const y=g*2;if(h+=`
          xC = xCCorner + ${y*c};
          `,u===1){if(y<d&&(a%2===1?(h+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,c===1&&y>0?h+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:h+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):h+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<d)){const b=a%2===0?s2(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(h+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,c>1?h+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:h+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):b===1?h+=`
                    xC${y+1} = xTexelC${y};
                    `:h+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<d&&(a%2===1?(h+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<d&&(h+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(h+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<d&&(h+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<d&&(h+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<d&&(h+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}h+=`
    }
  `,h+=`
      }
    `;let p="",m="";r&&(i?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,m="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${h}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:o}=e,{strides:s,pad:a,dilations:u,dimRoundingMode:c}=r;let l=u;l==null&&(l=[1,1]),L(bo(s,l),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);const d=Go(i.shape,o.shape,s,l,a,c,!0);let f;ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new UZ(d):f=new BZ(d);const h=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(f,[i,o],"float32",h)}const pGe={kernelName:P$,backendName:"webgl",kernelFunc:hGe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mGe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,r=e.strideWidth,i=e.padInfo.top,o=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class gGe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,i=e.strideHeight,o=e.strideWidth,s=n-1-e.padInfo.top,a=r-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:o}=e,{strides:s,dilations:a,pad:u,dimRoundingMode:c,filterShape:l}=r,d=Go(i.shape,l,s,a,u,c,!0),f=new mGe(d);return n.runWebGLProgram(f,[i,o],"float32")}const yGe={kernelName:A$,backendName:"webgl",kernelFunc:vGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bGe(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:o}=e,{strides:s,dilations:a,pad:u,dimRoundingMode:c,inputShape:l}=r,d=Go(l,o.shape,s,a,u,c,!0),f=new gGe(d);return n.runWebGLProgram(f,[i,o],"float32")}const xGe={kernelName:$$,backendName:"webgl",kernelFunc:bGe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wGe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SGe(t){const{inputs:e,backend:n}=t,{x:r}=e,i=[...r.shape,...r.shape],o=_e(r.shape),s=Re({inputs:{x:r},backend:n,attrs:{shape:[o]}}),a=new wGe(o),u=n.runWebGLProgram(a,[s],s.dtype),c=Re({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}const CGe={kernelName:D$,backendName:"webgl",kernelFunc:SGe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kGe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:r,padInfo:i,strideHeight:o,strideWidth:s,filterHeight:a,filterWidth:u,dilationHeight:c,dilationWidth:l}=e,{top:d,left:f}=i;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${s});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${l};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TGe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:o}=e,{strides:s,pad:a,dilations:u}=r,c=CX(i.shape,o.shape,s,a,"NHWC",u);let l;const d=new kGe(c);l=n.runWebGLProgram(d,[i,o],"float32");const f=Re({inputs:{x:l},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(l),f}const EGe={kernelName:O$,backendName:"webgl",kernelFunc:TGe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ge(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,o=e,{allDims:s,summedDims:a,idDims:u}=mQ(i,o.length);vQ(s.length,u,o);const{path:c,steps:l}=yQ(a,u),d=l.length;let f=null,h=s.length;const p=[];for(let m=0;m<d;++m){for(const v of l[m]){const{permutationIndices:g,expandDims:y}=gQ(h,u[v]);let b;bQ(g)?b=o[v]:(b=yi({inputs:{x:o[v]},backend:n,attrs:{perm:g}}),p.push(b));const x=b.shape.slice();for(let S=0;S<y.length;++S)x.splice(y[S],0,1);yn(b.shape,x)||(b=Re({inputs:{x:b},backend:n,attrs:{shape:x}}),p.push(b)),f===null?f=b:(f=y3({inputs:{a:b,b:f},backend:n}),p.push(f))}m<d-1&&(c[m]>=0&&(f=O2({inputs:{x:f},backend:n,attrs:{axis:c[m]-(s.length-h),keepDims:!1}}),p.push(f)),h--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const IGe={kernelName:M$,backendName:"webgl",kernelFunc:_Ge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RGe="return (x >= 0.0) ? x : (exp(x) - 1.0);",NGe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,PGe=At({opSnippet:RGe,packedOpSnippet:NGe}),AGe={kernelName:B$,backendName:"webgl",kernelFunc:PGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ge="return (b >= 0.0) ? a : a * (b + 1.0);",DGe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,OGe=t=>{const{inputs:e,backend:n}=t,{dy:r,y:i}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pg(DGe,r.shape,i.shape):new th($Ge,r.shape,i.shape);return n.runWebGLProgram(o,[r,i],r.dtype)},FGe={kernelName:I9,backendName:"webgl",kernelFunc:OGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LGe=`
  return vec4(equal(a, b));
`,MGe="return float(a == b);",BGe=_r({opSnippet:MGe,packedOpSnippet:LGe,dtype:"bool",cpuKernelImpl:vWe}),UGe={kernelName:V$,backendName:"webgl",kernelFunc:BGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VGe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${cQ};
  float a1 = ${lQ};
  float a2 = ${dQ};
  float a3 = ${fQ};
  float a4 = ${hQ};
  float a5 = ${pQ};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,zGe=At({opSnippet:VGe}),WGe={kernelName:U$,backendName:"webgl",kernelFunc:zGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jGe=mg+`
  return exp(x);
`,GGe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,VZ=At({opSnippet:jGe,packedOpSnippet:GGe,cpuKernelImpl:yWe,dtype:"float32"}),HGe={kernelName:z$,backendName:"webgl",kernelFunc:VZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RR(t){const{inputs:e,attrs:n,backend:r}=t,{dim:i}=n,{input:o}=e,s=o.shape.length,a=o.shape.slice();let u=i;return i<0&&(L(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),u=s+i+1),a.splice(u,0,1),Re({inputs:{x:o},backend:r,attrs:{shape:a}})}const qGe={kernelName:W$,backendName:"webgl",kernelFunc:RR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lz="return exp(x) - 1.0;",KGe=At({opSnippet:Lz,packedOpSnippet:Lz,cpuKernelImpl:bWe}),XGe={kernelName:j$,backendName:"webgl",kernelFunc:KGe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mz{constructor(e,n,r){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const o=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${i}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t,e,n){const r=n.texData.get(t.dataId),i=_e(t.shape),o=t.shape[t.shape.length-1],s=i/o,a=Re({inputs:{x:t},backend:n,attrs:{shape:[s,o]}}),u=a.shape,c=new Mz("real",u,e),l=new Mz("imag",u,e),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],f=n.runWebGLProgram(c,d,"float32"),h=n.runWebGLProgram(l,d,"float32"),p=Nd({inputs:{real:f,imag:h},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h);const m=Re({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JGe(t){const{inputs:e,backend:n}=t,{input:r}=e;return zZ(r,!1,n)}const YGe={kernelName:G$,backendName:"webgl",kernelFunc:JGe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QGe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mb(t){const{backend:e,attrs:n}=t,{shape:r,value:i}=n;let{dtype:o}=n;if(o=o||ig(i),o==="string"){const s=Qn(o,_e(r));return s.fill(i),e.makeTensorInfo(r,o,s)}else{const s=new QGe(r,i),a=[[i]];return e.runWebGLProgram(s,[],o,a)}}const ZGe={kernelName:H$,backendName:"webgl",kernelFunc:mb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eHe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tHe={kernelName:q$,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new eHe(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bz="return floor(x);",nHe=At({opSnippet:Bz,packedOpSnippet:Bz,cpuKernelImpl:xWe}),rHe={kernelName:K$,backendName:"webgl",kernelFunc:nHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iHe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,oHe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,sHe=_r({opSnippet:iHe,packedOpSnippet:oHe,dtype:"int32"}),aHe={kernelName:X$,backendName:"webgl",kernelFunc:sHe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uHe{constructor(e){this.variableNames=["A"];const n=bi(),[r,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${r}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cHe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=bi(),[r,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${r}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lHe={kernelName:yS,backendName:"webgl",kernelFunc:dHe};let ep,pE=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function dHe(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:o}=r,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[u,c]=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=[c,u],d=[c,u,o];if(a||s){const m=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ep==null||m!==pE)&&(pE=m,ep=document.createElement("canvas").getContext("2d",{willReadFrequently:pE})),ep.canvas.width=u,ep.canvas.height=c,ep.drawImage(i,0,0,u,c),i=ep.canvas}const f=n.makeTensorInfo(l,"int32");n.texData.get(f.dataId).usage=$o.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),i);const h=ae().getBool("WEBGL_PACK")?new cHe(d):new uHe(d),p=n.runWebGLProgram(h,[f],"int32");return n.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fHe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:o,bias:s,preluActivationWeights:a}=e,{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=r,m=og(l),v=Go(i.shape,o.shape,u,d,c,f,!1,m);let g;const y=[],b=s!=null,x=a!=null,S=h==="leakyrelu",C=()=>{const E=[i,o],I=(N,$)=>{if($==="NCHW"&&N.shape.length===1&&N.shape[0]!==1){const F=Re({inputs:{x:N},backend:n,attrs:{shape:[N.shape[0],1,1]}});return y.push(F),F}return N};if(b&&E.push(I(s,l)),x&&E.push(I(a,l)),S){const N=n.makeTensorInfo([],"float32",Sh(p,"float32"));E.push(N),y.push(N)}return E};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=FZ({x:i,filter:o,convInfo:v,backend:n,bias:s,activation:h,preluActivationWeights:a,leakyreluAlpha:p});else if(v.strideWidth<=2&&m==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const E=h?f0(h,!0):null,I=new OZ(v,b,E,x,S),N=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],$=C();g=n.runWebGLProgram(I,$,"float32",N)}else if(ae().getBool("WEBGL_CONV_IM2COL"))g=LZ({x:i,filter:o,convInfo:v,backend:n,bias:s,activation:h,preluActivationWeights:a,leakyreluAlpha:p});else{const E=h?f0(h,!1):null,I=new DZ(v,b,E,x,S),N=C();g=n.runWebGLProgram(I,N,"float32")}const T=Re({inputs:{x:g},backend:n,attrs:{shape:v.outShape}});return y.push(g),y.forEach(E=>n.disposeIntermediateTensorInfo(E)),T}const hHe={kernelName:xS,backendName:"webgl",kernelFunc:fHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pHe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:o,bias:s,preluActivationWeights:a}=e,{strides:u,pad:c,dilations:l,dimRoundingMode:d,activation:f,leakyreluAlpha:h}=r,p=[];let m=l;m==null&&(m=[1,1]),L(bo(u,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`);const v=Go(i.shape,o.shape,u,m,c,d,!0),g=ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,y=f?f0(f,g):null,b=[i,o],x=s!=null,S=a!=null,C=f==="leakyrelu";if(x&&b.push(s),S&&b.push(a),C){const N=n.makeTensorInfo([],"float32",Sh(h,"float32"));b.push(N),p.push(N)}let T;g?T=new UZ(v,x,y,S,C):T=new BZ(v,x,y,S,C);const E=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],I=n.runWebGLProgram(T,b,"float32",E);return p.forEach(N=>n.disposeIntermediateTensorInfo(N)),I}const mHe={kernelName:wS,backendName:"webgl",kernelFunc:pHe};class gHe{constructor(e,n,r,i){this.sliceDim=e,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=r;const o=Qt(r.length);let s=`
    int index;`;for(let a=0;a<this.sliceDim;a++)s+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vHe(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,o=i.shape,s=o[o.length-1],a=_e(r.shape),[u,c,l,d]=t3(r,i),f=Re({inputs:{x:i},backend:n,attrs:{shape:[c,s]}}),h=Re({inputs:{x:r},backend:n,attrs:{shape:[_e(r.shape)/l,l]}});if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const g=n.readSync(i.dataId),y=n.bufferSync(r),b=wWe(g,y,r.dtype,c,s,l,d,r.shape,a);return n.makeTensorInfo(u,r.dtype,b.values)}const p=new gHe(s,d,[c,l],r.shape),m=n.runWebGLProgram(p,[h,f],h.dtype),v=Re({inputs:{x:m},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}const yHe={kernelName:Q$,backendName:"webgl",kernelFunc:vHe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bHe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const r=Qt(this.rank),i=xHe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function xHe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<t.length;i++)i===2?r.push("index"):r.push(`${n[i]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:o}=e,{axis:s,batchDims:a}=r,u=tr(s,i.shape)[0];if(ae().get("DEBUG")){const y=n.readSync(o.dataId),b=i.shape[u];for(let x=0;x<y.length;++x){const S=y[x];L(S<=b-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${b-1}]`)}}const c=DQ(i,o,u,a),l=_e(o.shape),d=[],f=Re({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),h=Re({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});d.push(f),d.push(h);const p=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([i,o])||i.dtype==="string"){const y=n.bufferSync(h),b=n.bufferSync(f),x=SWe(b,y,p);return d.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.makeTensorInfo(c.outputShape,x.dtype,x.values)}const m=new bHe(f.shape,p),v=n.runWebGLProgram(m,[f,h],f.dtype);d.push(v);const g=Re({inputs:{x:v},backend:n,attrs:{shape:c.outputShape}});return d.forEach(y=>n.disposeIntermediateTensorInfo(y)),g}const wHe={kernelName:Y$,backendName:"webgl",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SHe="return float(a > b);",CHe=`
  return vec4(greaterThan(a, b));
`,kHe=_r({opSnippet:SHe,packedOpSnippet:CHe,cpuKernelImpl:CWe,dtype:"bool"}),THe={kernelName:Z$,backendName:"webgl",kernelFunc:kHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EHe="return float(a >= b);",_He=`
  return vec4(greaterThanEqual(a, b));
`,IHe=_r({opSnippet:EHe,packedOpSnippet:_He,dtype:"bool",cpuKernelImpl:kWe}),RHe={kernelName:eD,backendName:"webgl",kernelFunc:IHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NHe(t){const{inputs:e,backend:n}=t,{input:r}=e;return zZ(r,!0,n)}const PHe={kernelName:tD,backendName:"webgl",kernelFunc:NHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AHe="return float(!isnan(x) && !isinf(x));",$He=At({opSnippet:AHe,dtype:"bool"}),DHe={kernelName:rD,backendName:"webgl",kernelFunc:$He};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OHe="return float(isinf(x));",FHe=At({opSnippet:OHe,dtype:"bool"}),LHe={kernelName:iD,backendName:"webgl",kernelFunc:FHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MHe="return float(isnan(x));",BHe=At({opSnippet:MHe,dtype:"bool"}),UHe={kernelName:oD,backendName:"webgl",kernelFunc:BHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VHe="return float(a < b);",zHe=`
  return vec4(lessThan(a, b));
`,WHe=_r({opSnippet:VHe,packedOpSnippet:zHe,cpuKernelImpl:TWe,dtype:"bool"}),jHe={kernelName:aD,backendName:"webgl",kernelFunc:WHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GHe="return float(a <= b);",HHe=`
  return vec4(lessThanEqual(a, b));
`,qHe=_r({opSnippet:GHe,packedOpSnippet:HHe,cpuKernelImpl:EWe,dtype:"bool"}),KHe={kernelName:uD,backendName:"webgl",kernelFunc:qHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XHe(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:o}=n,s=_We(r,i,o);return e.makeTensorInfo([s.length],"float32",s)}const JHe={kernelName:cD,backendName:"webgl",kernelFunc:XHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YHe=mg+`
  return x < 0.0 ? 0./0. : log(x);
`,QHe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,ZHe=At({opSnippet:YHe,packedOpSnippet:QHe,cpuKernelImpl:IWe}),e8e={kernelName:lD,backendName:"webgl",kernelFunc:ZHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8e=mg+`
  return log(1.0 + x);
`,n8e=At({opSnippet:t8e}),r8e={kernelName:dD,backendName:"webgl",kernelFunc:n8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8e="return float(a >= 1.0 && b >= 1.0);",o8e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,s8e=_r({opSnippet:i8e,packedOpSnippet:o8e,dtype:"bool"}),a8e={kernelName:fD,backendName:"webgl",kernelFunc:s8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8e="return float(!(x >= 1.0));",c8e=At({opSnippet:u8e}),l8e={kernelName:hD,backendName:"webgl",kernelFunc:c8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8e="return float(a >= 1.0 || b >= 1.0);",f8e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,h8e=_r({opSnippet:d8e,packedOpSnippet:f8e,dtype:"bool"}),p8e={kernelName:pD,backendName:"webgl",kernelFunc:h8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m8e{constructor(e,n,r,i,o){this.variableNames=["x"],this.outputShape=[];const s=n,a=e[3]-1;this.outputShape=e;let u;const c=`float(${r}) + float(${i}) * sum`;o===.5?u=`inversesqrt(${c})`:o===1?u=`1.0/(${c})`:u=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g8e{constructor(e,n,r,i,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=n,a=e[3]-1;this.outputShape=e;let u;const c=`float(${r}) + float(${i}) * sum`;o===.5?u=`inversesqrt(${c})`:o===1?u=`1.0/(${c})`:u=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8e=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:o,bias:s,alpha:a,beta:u}=r,c=ae().getBool("WEBGL_PACK_NORMALIZATION")?new g8e(i.shape,o,s,a,u):new m8e(i.shape,o,s,a,u);return n.runWebGLProgram(c,[i],i.dtype)},y8e={kernelName:mD,backendName:"webgl",kernelFunc:v8e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b8e{constructor(e,n,r,i,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=r,this.alpha=i,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8e=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i,y:o,dy:s}=e,{depthRadius:a,bias:u,alpha:c,beta:l}=r,d=new b8e(i.shape,a,u,c,l);return n.runWebGLProgram(d,[i,o,s],i.dtype)},w8e={kernelName:R9,backendName:"webgl",kernelFunc:x8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8e(t,e,n,r){const i=_e(e),s=_e(t.shape)/i,a=Re({inputs:{x:t},attrs:{shape:[s,i]},backend:r}),u=Rh(a,t.dtype,"max",r),c=Re({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:o,keepDims:s}=r,a=i.shape.length,u=tr(o,i.shape);let c=u;const l=Ns(c,a),d=l!=null,f=n.shouldExecuteOnCPU([i]);let h=i;if(d){if(f){const b=n.texData.get(h.dataId).values,x=new Array(a);for(let T=0;T<x.length;T++)x[T]=i.shape[l[T]];const S=g3(b,i.shape,i.dtype,l,x);h=n.makeTensorInfo(x,i.dtype);const C=n.texData.get(h.dataId);C.values=S}else h=D2(i,l,n);c=Ps(c.length,a)}ga("max",c,a);const[p,m]=Cu(h.shape,c);let v=p;s&&(v=Ho(p,u));let g;if(f){const b=n.texData.get(h.dataId).values,x=RWe(b,_e(m),v,i.dtype);g=n.makeTensorInfo(v,i.dtype);const S=n.texData.get(g.dataId);S.values=x}else g=S8e(h,m,v,n);return d&&n.disposeIntermediateTensorInfo(h),g}const C8e={kernelName:gD,backendName:"webgl",kernelFunc:jZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8e=v3+`
  return max(a, b);
`,T8e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ih+`
  return result;
`,E8e=_r({opSnippet:k8e,packedOpSnippet:T8e,cpuKernelImpl:NWe}),_8e={kernelName:vD,backendName:"webgl",kernelFunc:E8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;fb(i,"maxPool");const{filterSize:o,strides:s,pad:a,dimRoundingMode:u}=r,c=1;L(bo(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const l=Ch(i.shape,o,s,c,a,u);if(l.filterWidth===1&&l.filterHeight===1&&yn(l.inShape,l.outShape))return mo({inputs:{x:i},backend:n});const d=new h0(l,"max",!1);return n.runWebGLProgram(d,[i],i.dtype)}const R8e={kernelName:yD,backendName:"webgl",kernelFunc:I8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:o,strides:s,pad:a,dataFormat:u,dimRoundingMode:c}=r,l=[1,1,1],d=eb(i.shape,o,s,l,a,c,u),f=new b3(d,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const P8e={kernelName:bD,backendName:"webgl",kernelFunc:N8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A8e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,r=e.strideWidth,i=e.dilationHeight,o=e.effectiveFilterHeight,s=e.effectiveFilterWidth,a=o-1-e.padInfo.top,u=s-1-e.padInfo.left,c=o*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class $8e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,a=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=u-1-e.padInfo.front,f=c-1-e.padInfo.top,h=l-1-e.padInfo.left,p=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${l};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${l} +
                  wR * ${l} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:o}=e,s=o,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=r,d=[1,1,1],f=eb(s.shape,a,u,d,c,l),h=new b3(f,"max",!0),p=n.runWebGLProgram(h,[s],s.dtype),m=new $8e(f),v=n.runWebGLProgram(m,[i,p],s.dtype);return n.disposeIntermediateTensorInfo(p),v}const O8e={kernelName:P9,backendName:"webgl",kernelFunc:D8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8e(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:o,output:s}=e,a=o;fb([o,s],"maxPoolGrad");const{filterSize:u,strides:c,pad:l,dimRoundingMode:d}=r,f=Ch(a.shape,u,c,1,l,d),h=!0,p=new h0(f,"max",h),m=n.runWebGLProgram(p,[a],a.dtype),v=new A8e(f),g=n.runWebGLProgram(v,[i,m],a.dtype);return n.disposeIntermediateTensorInfo(m),g}const L8e={kernelName:N9,backendName:"webgl",kernelFunc:F8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8e(t,e,n,r){let i=new h0(n,"max",!1);const o=r.runWebGLProgram(i,[t],"float32");i=new h0(n,"max",!0,!0,e);const s=r.runWebGLProgram(i,[t],"float32");return[o,s]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8e={kernelName:xD,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:o,pad:s,includeBatchInIndex:a}=e,u=n;L(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const c=[1,1];L(bo(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const l=Ch(r.shape,i,o,c,s),[d,f]=M8e(r,a,l,u);return[d,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8e(t,e,n,r){const i=_e(e),s=_e(t.shape)/i,a=Re({inputs:{x:t},attrs:{shape:[s,i]},backend:r}),u=Rh(a,"float32","mean",r),c=Re({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8e={kernelName:wD,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:i,axis:o}=e,s=n,a=r.shape.length,u=tr(o,r.shape);let c=u;const l=Ns(c,a),d=l!=null,f=s.shouldExecuteOnCPU([r]),h=[];let p=r;if(d){if(f){const x=s.texData.get(p.dataId).values,S=new Array(a);for(let E=0;E<S.length;E++)S[E]=r.shape[l[E]];const C=g3(x,r.shape,r.dtype,l,S);p=s.makeTensorInfo(S,r.dtype);const T=s.texData.get(p.dataId);T.values=C}else p=D2(r,l,s);h.push(p),c=Ps(c.length,a)}ga("sum",c,a);const[m,v]=Cu(p.shape,c);let g=m;i&&(g=Ho(m,u));const y=U8e(p,v,g,s);for(const b of h)s.disposeIntermediateTensorInfo(b);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,keepDims:s}=r,a=i.shape.length,u=tr(o,i.shape);let c=u;const l=Ns(c,a);let d=i;l!=null&&(d=yi({inputs:{x:i},backend:n,attrs:{perm:l}}),c=Ps(c.length,i.shape.length)),ga("min",c,a);const[f,h]=Cu(d.shape,c),p=_e(h),m=Re({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),v=Rh(m,m.dtype,"min",n);let g;if(s){const y=Ho(f,u);g=Re({inputs:{x:v},backend:n,attrs:{shape:y}})}else g=Re({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),l!=null&&n.disposeIntermediateTensorInfo(d),g}const W8e={kernelName:SD,backendName:"webgl",kernelFunc:z8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8e=v3+`
  return min(a, b);
`,G8e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ih+`
  return result;
`,H8e=_r({opSnippet:j8e,packedOpSnippet:G8e,cpuKernelImpl:PWe}),q8e={kernelName:CD,backendName:"webgl",kernelFunc:H8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K8e{constructor(e,n,r){this.variableNames=["x"],this.outputShape=n.map((l,d)=>l[0]+e[d]+l[1]);const i=e.length,o=Qt(i),s=n.map(l=>l[0]).join(","),a=n.map((l,d)=>l[0]+e[d]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),c=r==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${s});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X8e{constructor(e,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const i=e.length,o=Qt(i),s=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),u=fi("rc",i),c=fi("source",i),l=`${u[i-1]} < ${this.outputShape[i-1]}`,d=i===1?"source":`vec2(${c.slice(-2).join()})`,f=r==="reflect"?0:1;let h="";if(i===1){const p=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;h=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${u[i-1]} += 1;
        if(${l}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const p=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;h=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${u[i-1]} += 1;
        if(${l}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${u[i-2]} += 1;
        if(${u[i-2]} < ${this.outputShape[i-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${u[i-1]} += 1;
          if(${l}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${s});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8e=({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:i,mode:o}=n,s=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new X8e(r.shape,i,o):new K8e(r.shape,i,o);return e.runWebGLProgram(s,[r],r.dtype)},Y8e={kernelName:kD,backendName:"webgl",kernelFunc:J8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q8e=`if (b == 0.0) return NAN;
  return mod(a, b);`,Z8e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Ih+`
  return result;
`,eqe=_r({opSnippet:Q8e,packedOpSnippet:Z8e}),tqe={kernelName:TD,backendName:"webgl",kernelFunc:eqe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nqe{constructor(e,n,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rqe=`
if (a == b) {
  return 1.0;
};
return a / b;`,iqe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,GZ=_r({opSnippet:rqe,packedOpSnippet:iqe,checkOutOfBounds:!0}),oqe={kernelName:L$,backendName:"webgl",kernelFunc:GZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uz="return a - b;",HZ=_r({opSnippet:Uz,packedOpSnippet:Uz,supportsComplex:!0,cpuKernelImpl:QWe}),sqe={kernelName:_O,backendName:"webgl",kernelFunc:HZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qZ(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:o}=r,s=tr([o],i.shape),a=jZ({inputs:{x:i},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),u=Ho(a.shape,s),c=Re({inputs:{x:a},backend:n,attrs:{shape:u}}),l=HZ({inputs:{a:i,b:c},backend:n}),d=VZ({inputs:{x:l},backend:n}),f=O2({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:!1}}),h=Re({inputs:{x:f},backend:n,attrs:{shape:u}}),p=GZ({inputs:{a:d,b:h},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),p}const aqe={kernelName:mO,backendName:"webgl",kernelFunc:qZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uqe(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:o,seed:s,normalized:a}=r,u=a?i:qZ({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=u.shape[0],l=u.shape[1],d=new nqe(c,l,o),f=[[s]],h=n.runWebGLProgram(d,[u],"int32",f);return a||n.disposeIntermediateTensorInfo(u),h}const cqe={kernelName:ED,backendName:"webgl",kernelFunc:uqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lqe=As+`
  return -x;
`,dqe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function fqe(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId),[s,a]=$We(o.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,s)}let i;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Ul(r.shape,dqe):i=new Za(r.shape,lqe),n.runWebGLProgram(i,[r],r.dtype)}const hqe={kernelName:ID,backendName:"webgl",kernelFunc:fqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pqe=zF;function mqe(t){ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:u}=r,c=n.readSync(i.dataId),l=n.readSync(o.dataId),{selectedIndices:d}=pqe(c,l,s,a,u);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const gqe={kernelName:ND,backendName:"webgl",kernelFunc:mqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vqe=WF;function yqe(t){ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=r,l=n.readSync(i.dataId),d=n.readSync(o.dataId),{selectedIndices:f,validOutputs:h}=vqe(l,d,s,a,u,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}const bqe={kernelName:PD,backendName:"webgl",kernelFunc:yqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xqe=jF;function wqe(t){ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=r,l=n.readSync(i.dataId),d=n.readSync(o.dataId),f=s,h=a,p=u,m=c,{selectedIndices:v,selectedScores:g}=xqe(l,d,f,h,p,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}const Sqe={kernelName:AD,backendName:"webgl",kernelFunc:wqe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cqe{constructor(e,n,r,i){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kqe=t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:o,depth:s,onValue:a,offValue:u}=r,c=_e(i.shape),l=new Cqe(c,s,a,u),d=Re({inputs:{x:i},backend:n,attrs:{shape:[c]}}),f=n.runWebGLProgram(l,[d],o);n.disposeIntermediateTensorInfo(d);const h=[...i.shape,s],p=Re({inputs:{x:f},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(f),p},Tqe={kernelName:DD,backendName:"webgl",kernelFunc:kqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FS(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="complex64"){const i=pb({inputs:{input:r},backend:n}),o=FS({inputs:{x:i},backend:n}),s=F2({inputs:{input:r},backend:n}),a=FS({inputs:{x:s},backend:n}),u=Nd({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),u}else return mb({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}const Eqe={kernelName:OO,backendName:"webgl",kernelFunc:FS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const i=pb({inputs:{input:r},backend:n}),o=KZ({inputs:{x:i},backend:n}),s=F2({inputs:{input:r},backend:n}),a=FS({inputs:{x:s},backend:n}),u=Nd({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),u}else return mb({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const _qe={kernelName:$D,backendName:"webgl",kernelFunc:KZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iqe(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(e.length===1)return RR({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const o=e[0].shape,s=e[0].dtype;e.forEach(l=>{Wr(o,l.shape,"All tensors passed to stack must have matching shapes"),L(s===l.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=e.map(l=>{const d=RR({inputs:{input:l},backend:n,attrs:{dim:i}});return a.push(d),d}),c=$Z({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(l=>n.disposeIntermediateTensorInfo(l)),c}const Rqe={kernelName:OD,backendName:"webgl",kernelFunc:Iqe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nqe{constructor(e,n,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,l)=>c[0]+e[l]+c[1]);const i=e.length,o=Qt(i),s=n.map(c=>c[0]).join(","),a=n.map((c,l)=>c[0]+e[l]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${s});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pqe{constructor(e,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,v)=>m[0]+e[v]+m[1]);const i=e.length,o=Qt(i),s=n.map(m=>m[0]).join(","),a=n.map((m,v)=>m[0]+e[v]).join(","),u=fi("rc",i),c=fi("source",i),l=`${u[i-1]} < ${this.outputShape[i-1]}`,d=i===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${u[i-1]} += 1;
       if(${l}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${u[i-2]} += 1;
       if(${u[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${u[i-1]} += 1;
         if(${l}) {`],h=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,v=i===1?2:4;m<v;m++)p+=`
        ${f[m]}
        if (${h}) {
          result[${m}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${d});
        }
      `;p+=i===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${s});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XZ=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:o,constantValue:s}=r;if(_e(i.shape)===0){const c=o.map((l,d)=>l[0]+i.shape[d]+l[1]);return mb({backend:n,attrs:{shape:c,value:s,dtype:i.dtype}})}const a=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Pqe(i.shape,o,s):new Nqe(i.shape,o,s),u=[[s]];return n.runWebGLProgram(a,[i],i.dtype,u)},Aqe={kernelName:FD,backendName:"webgl",kernelFunc:XZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $qe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Dqe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Ih+`
  return result;
`,Oqe=_r({opSnippet:$qe,packedOpSnippet:Dqe}),Fqe={kernelName:LD,backendName:"webgl",kernelFunc:Oqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lqe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:o,keepDims:s}=r,a=i.shape.length,u=[],c=tr(o,i.shape);let l=c;const d=Ns(l,a);let f=i;d!=null&&(f=yi({inputs:{x:i},backend:n,attrs:{perm:d}}),l=Ps(l.length,a),u.push(f)),ga("prod",l,a);let h;if(n.shouldExecuteOnCPU([f])){const p=n.texData.get(f.dataId).values,{outVals:m,outShape:v,outDtype:g}=OWe(f.shape,f.dtype,p,l);h=n.makeTensorInfo(v,g,m)}else{const[p,m]=Cu(f.shape,l),v=_e(m),g=Re({inputs:{x:f},backend:n,attrs:{shape:[-1,v]}}),y=f2(i.dtype),b=Rh(g,y,"prod",n);h=Re({inputs:{x:b},backend:n,attrs:{shape:p}}),u.push(g),u.push(b)}if(s){u.push(h);const p=Ho(h.shape,c);h=Re({inputs:{x:h},backend:n,attrs:{shape:p}})}return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),h}const Mqe={kernelName:BD,backendName:"webgl",kernelFunc:Lqe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bqe(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:o,indices:s}=e,{outputRaggedRank:a}=r,u=i.map(g=>n.readSync(g.dataId)),c=i.map(g=>g.shape),l=n.readSync(o.dataId),d=n.readSync(s.dataId),[f,h,p]=FWe(u,c,l,o.shape,o.dtype,d,s.shape,a),m=f.map(g=>n.makeTensorInfo([g.length],"int32",g)),v=n.makeTensorInfo(p,o.dtype,h);return m.concat([v])}const Uqe={kernelName:UD,backendName:"webgl",kernelFunc:Bqe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vqe(t){const{inputs:e,backend:n}=t,{starts:r,limits:i,deltas:o}=e,s=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(o.dataId),[c,l]=LWe(s,r.shape,r.dtype,a,i.shape,u,o.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([l.length],r.dtype,l);return[d,f]}const zqe={kernelName:VD,backendName:"webgl",kernelFunc:Vqe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wqe(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:o,defaultValue:s,rowPartitionTensors:a}=e,{rowPartitionTypes:u}=r,c=n.readSync(i.dataId),l=n.readSync(o.dataId),d=n.readSync(s.dataId),f=a.map(v=>n.readSync(v.dataId)),h=a.map(v=>v.shape),[p,m]=MWe(c,i.shape,l,o.shape,o.dtype,d,s.shape,f,h,u);return n.makeTensorInfo(p,o.dtype,m)}const jqe={kernelName:zD,backendName:"webgl",kernelFunc:Wqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JZ=t=>{const{backend:e,attrs:n}=t,{start:r,stop:i,step:o,dtype:s}=n,a=BWe(r,i,o,s);return e.makeTensorInfo([a.length],s,a)},Gqe={kernelName:WD,backendName:"webgl",kernelFunc:JZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hqe="return 1.0 / x;",qqe=At({opSnippet:Hqe}),Kqe={kernelName:GD,backendName:"webgl",kernelFunc:qqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xqe=As+`
  return (x < 0.0) ? 0.0 : x;
`,Jqe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Yqe=At({opSnippet:Xqe,packedOpSnippet:Jqe}),Qqe={kernelName:HD,backendName:"webgl",kernelFunc:Yqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zqe=As+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,e7e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,t7e=At({opSnippet:Zqe,packedOpSnippet:e7e}),n7e={kernelName:JD,backendName:"webgl",kernelFunc:t7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r7e{constructor(e,n,r,i,o){this.variableNames=["A"],this.outputShape=[];const[s,a,u,c]=e;this.outputShape=[s,n,r,c];const l=[i&&n>1?a-1:a,i&&r>1?u-1:u],d=[i&&n>1?n-1:n,i&&r>1?r-1:r];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${l[0]/d[0]},
          ${l[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i7e{constructor(e,n,r,i,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,u,c]=e;this.outputShape=[s,n,r,c];const l=[i&&n>1?a-1:a,i&&r>1?u-1:u],d=[i&&n>1?n-1:n,i&&r>1?r-1:r];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${l[0]/d[0]},
          ${l[1]/d[1]},
          ${l[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7e(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:o,halfPixelCenters:s,size:a}=r,[u,c]=a,l=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new i7e(i.shape,u,c,o,s):new r7e(i.shape,u,c,o,s);return n.runWebGLProgram(l,[i],"float32")}const s7e={kernelName:XD,backendName:"webgl",kernelFunc:o7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a7e{constructor(e,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,o]=n,[,s,a]=e,u=[r&&s>1?i-1:i,r&&a>1?o-1:o],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],l=u[0]/c[0],d=u[1]/c[1],f=1/l,h=1/d,p=Math.ceil(f)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${l});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${h});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7e(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:o}=e,{alignCorners:s}=r,a=new a7e(o.shape,i.shape,s);return n.runWebGLProgram(a,[o],o.dtype)}const c7e={kernelName:$9,backendName:"webgl",kernelFunc:u7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l7e{constructor(e,n,r,i,o){this.variableNames=["A"],this.outputShape=[];const[s,a,u,c]=e;this.outputShape=[s,n,r,c];const l=[i&&n>1?a-1:a,i&&r>1?u-1:u],d=[i&&n>1?n-1:n,i&&r>1?r-1:r],f=i?"0.5":"0.0";let h;o?h="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${l[0]/d[0]},
          ${l[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d7e{constructor(e,n,r,i,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,u,c]=e;this.outputShape=[s,n,r,c];const l=[i&&n>1?a-1:a,i&&r>1?u-1:u],d=[i&&n>1?n-1:n,i&&r>1?r-1:r],f=i?"0.5":"0.0";let h;o?h="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${l[0]/d[0]},
          ${l[1]/d[1]},
          ${l[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7e(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:o,halfPixelCenters:s,size:a}=r,[u,c]=a,l=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new d7e(i.shape,u,c,o,s):new l7e(i.shape,u,c,o,s);return n.runWebGLProgram(l,[i],i.dtype)}const h7e={kernelName:KD,backendName:"webgl",kernelFunc:f7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p7e{constructor(e,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,o]=n,[,s,a]=e,u=[r&&s>1?i-1:i,r&&a>1?o-1:o],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],l=u[0]/c[0],d=u[1]/c[1],f=1/l,h=1/d,p=Math.ceil(f)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${l});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${h});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7e(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:o}=e,{alignCorners:s}=r,a=new p7e(o.shape,i.shape,s);return n.runWebGLProgram(a,[o],o.dtype)}const g7e={kernelName:A9,backendName:"webgl",kernelFunc:m7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v7e{constructor(e,n){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,u)=>i(u)).join(","),s=Qt(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y7e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const i=fi("rc",r),o=`${i[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${i[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Qt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(i.slice())};
          if(${o}){
            result.g = ${c(i.slice())};
          }
          if(${s}) {
            result.b = ${l(i.slice())};
            if(${o}) {
              result.a = ${d(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(p){return f(p)}function c(p){return p[r-1]="("+p[r-1]+" + 1)",f(p)}function l(p){return p[r-2]="("+p[r-2]+" + 1)",f(p)}function d(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",f(p)}function f(p){const m=e.map((y,b)=>h(b,p)),v=m.join(","),g=m.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${g}))`}function h(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:o}=r,s=i.shape.length,a=tr(o,i.shape);if(s===0)return mo({inputs:{x:i},backend:n});const u=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new y7e(i.shape,a):new v7e(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}const x7e={kernelName:YD,backendName:"webgl",kernelFunc:b7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w7e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],i=e[2];this.outputShape=e;let o="";typeof n=="number"?o=`float outputValue = ${n.toFixed(2)};`:o=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7e={kernelName:LO,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:o,center:s}=e,a=n,u=new w7e(r.shape,o),[c,l]=iQ(s,r.shape[1],r.shape[2]),d=[[c,l,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(u,[r],r.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,k7e=At({opSnippet:C7e}),T7e={kernelName:QD,backendName:"webgl",kernelFunc:k7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7e="return inversesqrt(x);",_7e=At({opSnippet:E7e,cpuKernelImpl:UWe}),I7e={kernelName:ZD,backendName:"webgl",kernelFunc:_7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x3{constructor(e,n,r,i,o,s,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const c=Qt(o.length),l=Qt(s.length);let d="";r===1?d="i":r===2&&(d="i, j");const f=`getIndices(${d})`;let h="";i===1?h="i":i===2&&(h="i, coords[1]");const p=`getUpdates(${h})`;let m="";u&&(m="coords[0], coords[1]");const v=`getDefaultValue(${m})`,g=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${l} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${g};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${v}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R7e{constructor(e,n,r,i,o,s,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;const c=Qt(o.length),l=Qt(s.length);let d="";r===1?d="i":r===2&&(d="i, j");const f=`getIndices(${d})`;let h="";i===1?h="i":i===2&&(h="i, coords[1]");const p=`getUpdates(${h})`;let m="";u&&(m="coords[0], coords[1]");const v=`getDefaultValue(${m})`,g=n>1?"strides[j]":"strides",y=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${l} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${g};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${v}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7e(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:o}=e,{shape:s}=r,{sliceRank:a,numUpdates:u,sliceSize:c,strides:l,outputSize:d}=ub(o,i,s),f=[d/c,c];if(d===0)return n.makeTensorInfo(s,i.dtype);const h=Re({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),p=Re({inputs:{x:o},backend:n,attrs:{shape:[u,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let v;ae().getBool("WEBGL_PACK")?v=new R7e(u,a,h.shape.length,p.shape.length,l,f):v=new x3(u,a,h.shape.length,p.shape.length,l,f);const g=n.runWebGLProgram(v,[p,h,m],p.dtype),y=Re({inputs:{x:g},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),y}const P7e={kernelName:eO,backendName:"webgl",kernelFunc:N7e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A7e{constructor(e,n,r,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const o="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ae().getNumber("WEBGL_VERSION")===2?o:s,u=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7e(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:o}=e,{side:s}=r,a=new A7e(i.shape[0],i.shape[1],o.shape[1],s),u=[[i.shape[1]]];return n.runWebGLProgram(a,[i,o],"int32",u)}const D7e={kernelName:nO,backendName:"webgl",kernelFunc:$7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O7e{constructor(e,n,r){this.variableNames=["c","a","b"],this.outputShape=n;let i,o;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)o="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],c=[];for(let l=0;l<n.length;l++)c.push(`${a[l]}`),l<e&&u.push(`${a[l]}`);i=u.join(),o=c.join()}const s=Qt(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7e(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:o}=e,s=new O7e(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(s,[r,i,o],la(i.dtype,o.dtype))}const L7e={kernelName:rO,backendName:"webgl",kernelFunc:F7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${aQ};
  float scale = ${uQ};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,B7e=At({opSnippet:M7e}),U7e={kernelName:iO,backendName:"webgl",kernelFunc:B7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7e=mg+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,z7e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,W7e=At({opSnippet:V7e,packedOpSnippet:z7e,cpuKernelImpl:zWe}),j7e={kernelName:cO,backendName:"webgl",kernelFunc:W7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,H7e=At({opSnippet:G7e}),q7e={kernelName:uO,backendName:"webgl",kernelFunc:H7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7e=mg+`
  return sin(x);
`,X7e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Ih}
  return result;
`,J7e=At({opSnippet:K7e,packedOpSnippet:X7e}),Y7e={kernelName:sO,backendName:"webgl",kernelFunc:J7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Z7e=At({opSnippet:Q7e}),eKe={kernelName:aO,backendName:"webgl",kernelFunc:Z7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tKe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,nKe=At({opSnippet:tKe}),rKe={kernelName:lO,backendName:"webgl",kernelFunc:nKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iKe=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:o,paddings:s}=r;L(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((g,y)=>g*y),u=[[0,0]];u.push(...s);for(let g=1+o.length;g<i.shape.length;++g)u.push([0,0]);const c=[],l=XZ({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),d=o3(l.shape,o,a,!1),f=s3(d.length,o.length,!1),h=a3(l.shape,o,a,!1),p=Re({inputs:{x:l},backend:n,attrs:{shape:d}}),m=yi({inputs:{x:p},backend:n,attrs:{perm:f}}),v=Re({inputs:{x:m},backend:n,attrs:{shape:h}});return c.push(l),c.push(p),c.push(m),c.forEach(g=>n.disposeIntermediateTensorInfo(g)),v},oKe={kernelName:hO,backendName:"webgl",kernelFunc:iKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sKe(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:o,defaultValue:s}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);const a=n.readSync(r.dataId),u=n.readSync(i.dataId),c=n.readSync(o.dataId),l=n.readSync(s.dataId)[0],[d,f,h,p,m]=jWe(a,r.shape,r.dtype,u,i.dtype,c,l);return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([f[0]],i.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(v=>Number(v)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const aKe={kernelName:gO,backendName:"webgl",kernelFunc:sKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uKe(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:o}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const s=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(o.dataId)),[c,l,d]=GWe(a,r.shape,r.dtype,s,u);return[n.makeTensorInfo(l,r.dtype,c),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const cKe={kernelName:vO,backendName:"webgl",kernelFunc:uKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lKe(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const s=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(o.dataId),[c,l]=xZ(s,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(l,r.dtype,c)}const dKe={kernelName:yO,backendName:"webgl",kernelFunc:lKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fKe(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const s=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(o.dataId),[c,l]=xZ(s,r.shape,r.dtype,a,u);return n.makeTensorInfo(l,r.dtype,c)}const hKe={kernelName:bO,backendName:"webgl",kernelFunc:fKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pKe(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:o,defaultValue:s}=e,{outputShape:a}=r,{sliceRank:u,numUpdates:c,sliceSize:l,strides:d,outputSize:f}=ub(o,i,a),h=!1;if(o.dtype==="string"){const g=n.bufferSync(i),y=n.bufferSync(o),b=Hf(n.readSync(s.dataId)[0]),x=VWe(g,y,a,f,l,c,u,d,b,h);return n.makeTensorInfo(a,x.dtype,x.values)}const p=new x3(c,u,i.shape.length,o.shape.length,d,[f,1],h),m=n.runWebGLProgram(p,[o,i,s],o.dtype),v=Re({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),v}const mKe={kernelName:xO,backendName:"webgl",kernelFunc:pKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gKe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:o,axis:s}=r,a=tr(s,i.shape)[0],u=xQ(i,o,a),c=i.shape.length,l=new Array(c).fill(0),d=i.shape.slice();return u.map(f=>{const h=[...d];h[a]=f;const p=gg({inputs:{x:i},backend:n,attrs:{begin:l,size:h}});return l[a]+=f,p})}const vKe={kernelName:pO,backendName:"webgl",kernelFunc:gKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vz="return sqrt(x);",yKe=At({opSnippet:Vz,packedOpSnippet:Vz,cpuKernelImpl:HWe}),bKe={kernelName:dO,backendName:"webgl",kernelFunc:yKe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xKe="return x * x;",wKe=At({opSnippet:xKe}),SKe={kernelName:D9,backendName:"webgl",kernelFunc:wKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zz="return (a - b) * (a - b);",CKe=_r({opSnippet:zz,packedOpSnippet:zz}),kKe={kernelName:wO,backendName:"webgl",kernelFunc:CKe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TKe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const o=n.readSync(i.dataId),s=Bm(o),a=qWe(s,"string",r);return n.makeTensorInfo(i.shape,"string",a)}const EKe={kernelName:SO,backendName:"webgl",kernelFunc:TKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ke({inputs:t,attrs:e,backend:n}){const{x:r}=t,i=As+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Za(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const IKe={kernelName:FO,backendName:"webgl",kernelFunc:_Ke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RKe{constructor(e,n,r){this.variableNames=["x"],this.outputShape=r;const i=r.length,o=Qt(r.length),s=Qt(r.length);let a="";if(i===1)a="coords * strides + begin";else{let u=0;a=r.map((c,l)=>(u++,r.length===1?`coords * strides[${l}] + begin[${l}]`:`coords[${u-1}] * strides[${l}] + begin[${l}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${n});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NKe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:o,end:s,strides:a,beginMask:u,endMask:c,ellipsisMask:l,newAxisMask:d,shrinkAxisMask:f}=r,{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:v,isSimpleSlice:g,begin:y,end:b,strides:x}=XY(i.shape,o,s,a,u,c,l,d,f);let S;if(m)S=Re({inputs:{x:i},backend:n,attrs:{shape:p}});else if(v||g){L(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const T=BY(y,b,x),E=gg({inputs:{x:i},backend:n,attrs:{begin:y,size:T}});S=Re({inputs:{x:E},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(E)}else if(n.shouldExecuteOnCPU([i])){const E=n.readSync(i.dataId),I=Tn(i.shape,i.dtype,E),N=KWe(h,I,x,y);S=n.makeTensorInfo(p,i.dtype,N.values)}else{const E=new RKe(y,x,h);S=n.runWebGLProgram(E,[i],i.dtype)}const C=Re({inputs:{x:S},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(S),C}const PKe={kernelName:CO,backendName:"webgl",kernelFunc:NKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AKe(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:o,leftPad:s,rightPad:a,padWidth:u,preserveShortSequences:c}=r,{data:l,dataSplits:d}=e,f=n.readSync(l.dataId),h=n.readSync(d.dataId),[p,m]=XWe(f,h,i,o,s,a,u,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const $Ke={kernelName:kO,backendName:"webgl",kernelFunc:AKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DKe(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:o,delimiter:s}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const a=n.readSync(o.dataId),u=n.readSync(s.dataId)[0],[c,l,d]=JWe(a,u,i),f=l.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const OKe={kernelName:TO,backendName:"webgl",kernelFunc:DKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FKe(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const s=n.readSync(o.dataId),a=YWe(s,i);return n.makeTensorInfo(o.shape,"int32",a)}const LKe={kernelName:EO,backendName:"webgl",kernelFunc:FKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MKe="return tan(x);",BKe=At({opSnippet:MKe}),UKe={kernelName:IO,backendName:"webgl",kernelFunc:BKe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VKe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,zKe=At({opSnippet:VKe}),WKe={kernelName:RO,backendName:"webgl",kernelFunc:zKe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jKe(t){const{inputs:e,backend:n,attrs:r}=t,{tensor:i,indices:o,updates:s}=e,{sliceRank:a,numUpdates:u,sliceSize:c,strides:l,outputSize:d}=ub(s,o,i.shape),f=[d/c,c];if(d===0)return n.makeTensorInfo(i.shape,o.dtype);const h=Re({inputs:{x:o},backend:n,attrs:{shape:[u,a]}}),p=Re({inputs:{x:s},backend:n,attrs:{shape:[u,c]}}),m=Re({inputs:{x:i},backend:n,attrs:{shape:f}}),v=new x3(u,a,h.shape.length,p.shape.length,l,f,!1,!0),g=n.runWebGLProgram(v,[p,h,m],m.dtype),y=Re({inputs:{x:g},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}const GKe={kernelName:tO,backendName:"webgl",kernelFunc:jKe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HKe{constructor(e,n){this.variableNames=["A"];const r=new Array(e.length);for(let s=0;s<r.length;s++)r[s]=e[s]*n[s];this.outputShape=r,this.rank=r.length;const i=Qt(this.rank),o=qKe(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function qKe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<t.length;i++)r.push(`imod(${n[i]}, ${t[i]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:o}=r;if(i.dtype==="string"||i.shape.length>5){const u=n.readSync(i.dataId),c=i.dtype==="string"?u.map(f=>Hf(f)):u,l=Tn(i.shape,i.dtype,c),d=ZWe(l,o);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const s=new HKe(i.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}const KKe={kernelName:d2,backendName:"webgl",kernelFunc:YZ};class XKe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class JKe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gd(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function Wz(t){let e=1;for(;e<t;)e*=2;return e}function YKe(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:o,sorted:s}=r,a=ae().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=ae().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([i])||l<a||o>u){const N=n.readSync(i.dataId),[$,F]=eje(N,c,i.dtype,o,s);return[n.makeTensorInfo($.shape,$.dtype,$.values),n.makeTensorInfo(F.shape,F.dtype,F.values)]}if(o===0)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(l===1)return[i,mb({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(i.dataId),f=d!==null&&d.isPacked,h=f?n.unpackTensor(i):i,m=_e(c)/l,v=Re({inputs:{x:h},attrs:{shape:[m,l]},backend:n});f&&Gd(n,h);const g=Wz(o),y=Wz(l);let b=null;const x=()=>b===null?[v,v]:[v,b],S=(N,$,F)=>{const H=x(),G=new XKe(F),ne=[[l],[b===null?1:0],[Number.NEGATIVE_INFINITY],[N],[$]],oe=b;b=n.runWebGLProgram(G,H,"int32",ne),Gd(n,oe)};for(let N=1;N<g;N*=2){const $=N*2;for(let F=N;F>=1;F/=2)S($,F,[m,y])}for(let N=y;N>g;N/=2){const $=x(),F=new JKe([m,N/2]),G=[[l],[b===null?1:0],[g]],J=b;b=n.runWebGLProgram(F,$,"int32",G),Gd(n,J);const ne=g/2,oe=ne*2;for(let q=ne;q>=1;q/=2)S(oe,q,b.shape)}let C=b;b=gg({inputs:{x:b},backend:n,attrs:{begin:0,size:[m,o]}}),Gd(n,C);let T=WZ({inputs:{x:v,indices:b},backend:n,attrs:{axis:1,batchDims:1}});Gd(n,v);const E=c.slice(0,-1);E.push(o),C=b,b=Re({inputs:{x:b},attrs:{shape:E},backend:n}),Gd(n,C);const I=T;return T=Re({inputs:{x:T},attrs:{shape:E},backend:n}),Gd(n,I),[T,b]}const QKe={kernelName:NO,backendName:"webgl",kernelFunc:YKe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZKe{constructor(e,n,r,i,o,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const a=r==="nearest"?1:2;let u;switch(i){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9e(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,transforms:o}=e,{interpolation:s,fillMode:a,fillValue:u,outputShape:c}=r,[l,d,f,h]=i.shape,[p,m]=c??[d,f],v=[l,p,m,h],g=new ZKe(d,f,s,a,u,v);return n.runWebGLProgram(g,[i,o],"float32")}const t9e={kernelName:PO,backendName:"webgl",kernelFunc:e9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n9e(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:o}=e;fb(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=r.readSync(o.dataId),{outputValues:a,outputShape:u,indices:c}=tje(s,i,o.shape,o.dtype);return[r.makeTensorInfo(u,o.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const r9e={kernelName:AO,backendName:"webgl",kernelFunc:n9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9e(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:o}=r;o<0&&(o+=i.shape.length);const s=i,a=s.shape.length,u=i.shape[o],c=new Array(a-1);let l=0;for(let m=0;m<a;m++)m!==o&&(c[l++]=s.shape[m]);const d=[],f=new Array(a).fill(0),h=s.shape.slice();h[o]=1;const p=new Array(u);for(let m=0;m<p.length;m++){f[o]=m;const v=gg({inputs:{x:s},backend:n,attrs:{begin:f,size:h}}),g=Re({inputs:{x:v},backend:n,attrs:{shape:c}});p[m]=g,d.push(v)}return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const o9e={kernelName:$O,backendName:"webgl",kernelFunc:i9e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s9e{constructor(e,n){this.variableNames=["x","segmentIds"];const r=e.windowSize,i=e.batchSize,o=e.inSize,s=e.numSegments,a=s*Math.ceil(o/r);this.outputShape=[i,a];const u="0.0",c="sumValue",l=Math.floor(r/4)*4,d=r%4,f=`
        sumValue += dot(values, segFilter);
    `;let h="";o%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let p="";o%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${l}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${l};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a9e(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:o}=e,{numSegments:s}=r,a=i.shape.length,u=[];let c=0;const l=Ns([c],a);let d=i;l!=null&&(d=yi({inputs:{x:i},backend:n,attrs:{perm:l}}),u.push(d),c=Ps(1,a)[0]);const f=$Q(d.shape,c,s),h=_e([d.shape[c]]),p=Re({inputs:{x:d},backend:n,attrs:{shape:[-1,h]}});u.push(p);const m=f2(i.dtype),v=(x,S,C,T,E)=>{const I=x.shape[0],N=x.shape[1],$=AQ(N,E),F={windowSize:$,inSize:N,batchSize:I,numSegments:E},H=new s9e(F,S),G=n.compileAndRun(H,[x,C],T);if(u.push(G),G.shape[1]===E)return G;const J=JZ({backend:n,attrs:{start:0,stop:E,step:1,dtype:"float32"}}),ne=YZ({inputs:{x:J},backend:n,attrs:{reps:[N/$]}});return u.push(J),u.push(ne),v(G,S,ne,T,E)},g=v(p,"unsortedSegmentSum",o,m,s),y=Re({inputs:{x:g},backend:n,attrs:{shape:f}});let b=y;if(l!=null){u.push(y);const x=rF(l);b=yi({inputs:{x:b},backend:n,attrs:{perm:x}})}return u.forEach(x=>n.disposeIntermediateTensorInfo(x)),b}const u9e={kernelName:DO,backendName:"webgl",kernelFunc:a9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c9e=[Hje,Kje,Yje,e5e,n5e,o5e,a5e,c5e,h5e,m5e,y5e,w5e,k5e,I5e,P5e,$5e,O5e,B5e,V5e,W5e,q5e,e6e,n6e,s6e,u6e,p6e,g6e,x6e,Rje,C6e,I6e,A6e,M6e,V6e,W6e,G6e,q6e,Y6e,eGe,rGe,oGe,aGe,cGe,fGe,pGe,yGe,xGe,CGe,EGe,IGe,AGe,FGe,UGe,WGe,HGe,qGe,XGe,YGe,ZGe,tHe,rHe,aHe,lHe,hHe,mHe,yHe,wHe,THe,RHe,Ije,PHe,E6e,DHe,LHe,UHe,Pje,jHe,KHe,JHe,e8e,r8e,a8e,l8e,p8e,y8e,w8e,C8e,_8e,R8e,P8e,O8e,L8e,B8e,V8e,W8e,q8e,Y8e,tqe,cqe,Dje,hqe,gqe,bqe,Sqe,l6e,Tqe,_qe,Rqe,Aqe,Fqe,$je,Mqe,Uqe,zqe,jqe,Gqe,d6e,oqe,Kqe,Qqe,n7e,Fje,s7e,c7e,h7e,g7e,x7e,S7e,T7e,I7e,P7e,D7e,L7e,U7e,j7e,q7e,Y7e,eKe,Q5e,aqe,rKe,oKe,aKe,cKe,dKe,hKe,mKe,vKe,bKe,SKe,kKe,EKe,IKe,PKe,$Ke,OKe,LKe,sqe,Wje,UKe,WKe,GKe,KKe,QKe,t9e,jje,r9e,o9e,u9e,Eqe];for(const t of c9e)MO(t);var QZ={exports:{}};(function(t,e){(function(r,i){t.exports=i(A)})(Ii,function(n){return function(r){var i={};function o(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return r[s].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=r,o.c=i,o.d=function(s,a,u){o.o(s,a)||Object.defineProperty(s,a,{enumerable:!0,get:u})},o.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},o.t=function(s,a){if(a&1&&(s=o(s)),a&8||a&4&&typeof s=="object"&&s&&s.__esModule)return s;var u=Object.create(null);if(o.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:s}),a&2&&typeof s!="string")for(var c in s)o.d(u,c,(function(l){return s[l]}).bind(null,c));return u},o.n=function(s){var a=s&&s.__esModule?function(){return s.default}:function(){return s};return o.d(a,"a",a),a},o.o=function(s,a){return Object.prototype.hasOwnProperty.call(s,a)},o.p="",o(o.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(r,i,o){o.r(i);var s=o("react"),a=function(){var f=function(h,p){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,v){m.__proto__=v}||function(m,v){for(var g in v)v.hasOwnProperty(g)&&(m[g]=v[g])},f(h,p)};return function(h,p){f(h,p);function m(){this.constructor=h}h.prototype=p===null?Object.create(p):(m.prototype=p.prototype,new m)}}(),u=function(){return u=Object.assign||function(f){for(var h,p=1,m=arguments.length;p<m;p++){h=arguments[p];for(var v in h)Object.prototype.hasOwnProperty.call(h,v)&&(f[v]=h[v])}return f},u.apply(this,arguments)},c=function(f,h){var p={};for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&h.indexOf(m)<0&&(p[m]=f[m]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,m=Object.getOwnPropertySymbols(f);v<m.length;v++)h.indexOf(m[v])<0&&Object.prototype.propertyIsEnumerable.call(f,m[v])&&(p[m[v]]=f[m[v]]);return p};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(h){var p=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return p?new Promise(function(m,v){p.call(navigator,h,m,v)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function l(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var d=function(f){a(h,f);function h(p){var m=f.call(this,p)||this;return m.canvas=null,m.ctx=null,m.requestUserMediaId=0,m.unmounted=!1,m.state={hasUserMedia:!1},m}return h.prototype.componentDidMount=function(){var p=this,m=p.state,v=p.props;if(this.unmounted=!1,!l()){v.onUserMediaError("getUserMedia not supported");return}m.hasUserMedia||this.requestUserMedia(),v.children&&typeof v.children!="function"&&console.warn("children must be a function")},h.prototype.componentDidUpdate=function(p){var m=this.props;if(!l()){m.onUserMediaError("getUserMedia not supported");return}var v=JSON.stringify(p.audioConstraints)!==JSON.stringify(m.audioConstraints),g=JSON.stringify(p.videoConstraints)!==JSON.stringify(m.videoConstraints),y=p.minScreenshotWidth!==m.minScreenshotWidth,b=p.minScreenshotHeight!==m.minScreenshotHeight;(g||y||b)&&(this.canvas=null,this.ctx=null),(v||g)&&(this.stopAndCleanup(),this.requestUserMedia())},h.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},h.stopMediaStream=function(p){p&&(p.getVideoTracks&&p.getAudioTracks?(p.getVideoTracks().map(function(m){p.removeTrack(m),m.stop()}),p.getAudioTracks().map(function(m){p.removeTrack(m),m.stop()})):p.stop())},h.prototype.stopAndCleanup=function(){var p=this.state;p.hasUserMedia&&(h.stopMediaStream(this.stream),p.src&&window.URL.revokeObjectURL(p.src))},h.prototype.getScreenshot=function(p){var m=this,v=m.state,g=m.props;if(!v.hasUserMedia)return null;var y=this.getCanvas(p);return y&&y.toDataURL(g.screenshotFormat,g.screenshotQuality)},h.prototype.getCanvas=function(p){var m=this,v=m.state,g=m.props;if(!this.video||!v.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var y=this.video.videoWidth,b=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var x=y/b;y=g.minScreenshotWidth||this.video.clientWidth,b=y/x,g.minScreenshotHeight&&b<g.minScreenshotHeight&&(b=g.minScreenshotHeight,y=b*x)}this.canvas=document.createElement("canvas"),this.canvas.width=(p==null?void 0:p.width)||y,this.canvas.height=(p==null?void 0:p.height)||b,this.ctx=this.canvas.getContext("2d")}var S=this,C=S.ctx,T=S.canvas;return C&&T&&(T.width=(p==null?void 0:p.width)||T.width,T.height=(p==null?void 0:p.height)||T.height,g.mirrored&&(C.translate(T.width,0),C.scale(-1,1)),C.imageSmoothingEnabled=g.imageSmoothing,C.drawImage(this.video,0,0,(p==null?void 0:p.width)||T.width,(p==null?void 0:p.height)||T.height),g.mirrored&&(C.scale(-1,1),C.translate(-T.width,0))),T},h.prototype.requestUserMedia=function(){var p=this,m=this.props,v=function(b,x){var S={video:typeof x<"u"?x:!0};m.audio&&(S.audio=typeof b<"u"?b:!0),p.requestUserMediaId++;var C=p.requestUserMediaId;navigator.mediaDevices.getUserMedia(S).then(function(T){p.unmounted||C!==p.requestUserMediaId?h.stopMediaStream(T):p.handleUserMedia(null,T)}).catch(function(T){p.handleUserMedia(T)})};if("mediaDevices"in navigator)v(m.audioConstraints,m.videoConstraints);else{var g=function(b){return{optional:[{sourceId:b}]}},y=function(b){var x=b.deviceId;return typeof x=="string"?x:Array.isArray(x)&&x.length>0?x[0]:typeof x=="object"&&x.ideal?x.ideal:null};MediaStreamTrack.getSources(function(b){var x=null,S=null;b.forEach(function(E){E.kind==="audio"?x=E.id:E.kind==="video"&&(S=E.id)});var C=y(m.audioConstraints);C&&(x=C);var T=y(m.videoConstraints);T&&(S=T),v(g(x),g(S))})}},h.prototype.handleUserMedia=function(p,m){var v=this.props;if(p||!m){this.setState({hasUserMedia:!1}),v.onUserMediaError(p);return}this.stream=m;try{this.video&&(this.video.srcObject=m),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(m)})}v.onUserMedia(m)},h.prototype.render=function(){var p=this,m=this,v=m.state,g=m.props,y=g.audio;g.forceScreenshotSourceSize,g.onUserMedia,g.onUserMediaError,g.screenshotFormat,g.screenshotQuality,g.minScreenshotWidth,g.minScreenshotHeight,g.audioConstraints,g.videoConstraints,g.imageSmoothing;var b=g.mirrored,x=g.style,S=x===void 0?{}:x,C=g.children,T=c(g,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),E=b?u(u({},S),{transform:(S.transform||"")+" scaleX(-1)"}):S,I={getScreenshot:this.getScreenshot.bind(this)};return s.createElement(s.Fragment,null,s.createElement("video",u({autoPlay:!0,src:v.src,muted:!y,playsInline:!0,ref:function(N){p.video=N},style:E},T)),C&&C(I))},h.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},h}(s.Component);i.default=d},react:function(r,i){r.exports=n}}).default})})(QZ);var l9e=QZ.exports;const d9e=m0(l9e),f9e=()=>{let[t,e]=A.useState(0),[n,r]=A.useState(!1),[i,o]=A.useState(""),[s,a]=A.useState("");const u=A.useRef(null),[c,l]=A.useState(!1),[d,f]=A.useState(!1),[h,p]=A.useState(!1),[m,v]=A.useState(null),{data:g,loading:y,error:b}=iC(),[x,S]=A.useState(null),C=A.useRef(null),[T,E]=A.useState(!0),[I,N]=A.useState(!1),$=oh(),[F,H]=A.useState(null);A.useEffect(()=>{setTimeout(()=>{E(!1)},1500)},[]),A.useEffect(()=>{(async()=>{try{const ge=await fetch(`https://eyedentify-69d961d5a478.herokuapp.com/api/get_student_token/${nt.id}`);if(!ge.ok)throw new Error("Network response was not ok "+ge.statusText);const Ce=await ge.json();H(Ce.token)}catch(ge){console.error("Error fetching the token:",ge)}})()},[nt.id]),A.useEffect(()=>{(async()=>{try{const ge=new UP({adaptiveStream:!0,dynacast:!0,disconnectOnPageLeave:!1,videoCaptureDefaults:{facingMode:"user"}});v(ge),ge.prepareConnection("wss://eyedentify-90kai7lw.livekit.cloud",F),ge.on(De.Connected,()=>{console.log("connected to room",ge.name),ir({terminated:!1},"update_terminate",nt.id),ne(ge.localParticipant)}),ge.on(De.Disconnected,be),await ge.connect("wss://eyedentify-90kai7lw.livekit.cloud",F)}catch(ge){console.error(ge)}})()},[F]),A.useEffect(()=>{async function pe(){await pi.tinyFaceDetector.loadFromUri("/models"),await pi.ssdMobilenetv1.loadFromUri("/models"),await pi.faceLandmark68Net.loadFromUri("/models"),await pi.faceRecognitionNet.loadFromUri("/models"),p(!0)}pe()},[]),A.useEffect(()=>{const pe=async Ce=>{const $e=await qNe(Ce).withFaceLandmarks().withFaceDescriptor();$e&&S($e.descriptor)};(Ce=>{const $e=new Image;$e.crossOrigin="anonymous",$e.src=Ce,$e.onload=()=>{pe($e)}})(nt.imageURL)},[h]);const G=async()=>{var Ce;const pe=(Ce=u.current)==null?void 0:Ce.video;if(!pe)return;const ge=await KNe(pe,new t9).withFaceLandmarks().withFaceDescriptors();ge.length>1||ge.length===0?(nt.ready===!0&&ir({isSuspicious:!0},"update_isSuspicious",nt.id),f(!0)):f(!1),ge.length===0&&l(!1);for(let $e of ge)x&&(l9(x,$e.descriptor)<.6?(console.log(`Match found for ${nt.name}`),l(!0)):(console.log(`No match found for ${nt.name}`),l(!1),nt.ready===!0&&ir({isSuspicious:!0},"update_isSuspicious",nt.id)))};A.useEffect(()=>{if(!h||!x)return;const pe=setInterval(G,1e3);return()=>clearInterval(pe)},[h,x]);const J=A.useCallback(async()=>{var lt;const pe=(lt=u.current)==null?void 0:lt.video,ge=C.current;if(!pe||!ge)return;const Ce=await nUe(l0.MediaPipeSelfieSegmentation,{runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation",modelType:"general"}),$e=.5,Ge=20,tt=5,mt=!1,Ie=async()=>{if(!pe||pe.readyState!==4)return;pe.videoWidth>0&&pe.videoHeight>0?(ge.width=pe.videoWidth,ge.height=pe.videoHeight,pe.width=pe.videoWidth,pe.height=pe.videoHeight):console.error("Video dimensions not available");const He=await Ce.segmentPeople(pe);if(!He){console.error("Segmentation failed!");return}if(ge.width===0||ge.height===0){console.error("Canvas dimensions are zero!");return}if(!ge.getContext("2d")){console.error("Failed to get canvas rendering context!");return}await mUe(ge,pe,He,$e,Ge,tt,mt),requestAnimationFrame(Ie)};Ie()},[u,C]);A.useEffect(()=>{var Ce;const pe=(Ce=u.current)==null?void 0:Ce.video;if(!pe)return;const ge=()=>{if(pe.videoWidth===0||pe.videoHeight===0){console.error("Video dimensions are zero!");return}J()};return pe.addEventListener("play",ge),()=>{pe.removeEventListener("play",ge)}},[u,J]);const ne=async pe=>{await pe.setCameraEnabled(!1),await pe.setMicrophoneEnabled(!1),await pe.setScreenShareEnabled(!1);try{const ge=await jq();await pe.publishTrack(ge);const $e=C.current.captureStream(30).getVideoTracks()[0];await ge.replaceTrack($e)}catch(ge){console.error("Error in publishing or replacing tracks:",ge)}};PP(!0,!0),BC("staff"),A.useEffect(()=>{if(g&&nt){const pe=g.find(ge=>ge.id===nt.id);pe&&(e(pe.warnings),o(pe.warningOne),a(pe.warningTwo),r(pe.terminated),nt.warnings=pe.warnings,nt.warningOne=pe.warningOne,nt.warningTwo=pe.warningTwo,nt.terminated=pe.terminated)}},[g,nt]),nt!==void 0&&nt.name;const[oe,q]=A.useState(null),Z=A.useRef([]),se=async()=>{if(Z.current.length){const pe=new Blob(Z.current,{type:"video/webm"}),ge=await fetch(`https://eyedentify-69d961d5a478.herokuapp.com/api/presigned_url/${nt.id}`),{url:Ce}=await ge.json();console.log("Presigned URL:",Ce),await fetch(Ce,{method:"PUT",headers:{"Content-Type":"video/webm"},body:pe}),console.log("Blob size:",pe.size)}},fe=()=>{if(C.current){const pe=C.current.captureStream(30),ge=new MediaRecorder(pe,{mimeType:"video/webm"});ge.ondataavailable=Ce=>{console.log("Data chunk size:",Ce.data.size),Ce.data.size>0&&Z.current.push(Ce.data)},t===0&&(ge.onstop=se),q(ge),ge.start(),ir({ready:!0},"update_ready",nt.id),nt.ready=!0,N(!0)}},xe=()=>{if(oe&&oe.state!=="inactive"&&oe.stop(),m&&m.localParticipant){const pe=m.localParticipant;pe.tracks.forEach(ge=>{ge.track.kind==="video"&&(ge.track.stop(),pe.unpublishTrack(ge.track))})}ir({terminated:!0},"update_terminate",nt.id),ir({warningOne:""},"update_warning_one",nt.id),ir({warningTwo:""},"update_warning_two",nt.id),ir({ready:!1},"update_ready",nt.id),$("/"),N(!1)};function be(){if(console.log("disconnected from room"),m&&m.localParticipant){const pe=m.localParticipant;pe.tracks.forEach(ge=>{ge.track.kind==="video"&&(ge.track.stop(),pe.unpublishTrack(ge.track))})}}return nt.terminated===!0&&xe(),P.jsxs(P.Fragment,{children:[P.jsx(Et,{hidden:!I,position:"absolute",top:"0",left:"50%",transform:"translateX(-50%)",children:P.jsx(ua,{padding:"10px",children:`Warnings: ${t}`})}),P.jsxs(Uc,{children:[P.jsx(Et,{paddingLeft:"10px",children:P.jsx(LC,{color:"#81E6D9",size:"3em"})}),P.jsx(ua,{padding:"10px",children:nt.name}),P.jsx(DC,{}),P.jsx(Et,{paddingRight:"30px",children:P.jsx("div",{hidden:!I,children:P.jsx(kCe,{handleTerminate:xe})})})]}),P.jsxs(cu,{padding:"20px",minHeight:"91vh",children:[T?P.jsx(Et,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:P.jsx(ch,{thickness:"4px",size:"xl",color:"teal"})}):P.jsx(P.Fragment,{})," ",P.jsx(Et,{borderRadius:"10px",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",children:P.jsxs("div",{style:{position:"relative"},children:[P.jsx("canvas",{ref:C,style:{borderRadius:"10px",overflow:"hidden",width:"50%",height:"auto",position:"relative",zIndex:2,marginLeft:"25%"}}),P.jsx(d9e,{audio:!1,height:720,width:1280,style:{position:"absolute",top:0,left:0,visibility:"hidden",zIndex:0},ref:u,screenshotFormat:"image/jpeg",videoConstraints:{width:1280,height:720,facingMode:"user"}})]})}),P.jsx(Et,{hidden:!!T,children:P.jsxs(Uc,{hidden:!!I,children:[P.jsx(Et,{children:`Face Verified: ${c?"":""}`}),P.jsx(Et,{children:`One Person: ${d?"":""}`})]})}),P.jsx(Et,{hidden:!!T,children:P.jsx(qn,{colorScheme:"teal",variant:"solid",padding:"10px",hidden:!!I,isDisabled:c===!1||d===!0,onClick:fe,children:"Ready"})}),P.jsxs(Et,{width:"75%",children:[P.jsx(y8,{}),t===1&&P.jsx(TCe,{user:nt}),t===2&&P.jsx(ECe,{user:nt})]}),P.jsx(B0,{bottomVal:-2})]})]})};function h9e(t){return M0({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"defs",attr:{},child:[{tag:"clipPath",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M124-288l388-672 388 672H124z",clipRule:"evenodd"}}]}]},{tag:"path",attr:{d:"M508 624a112 112 0 0 0 112-112c0-3.28-.15-6.53-.43-9.74L498.26 623.57c3.21.28 6.45.43 9.74.43zm370.72-458.44L836 122.88a8 8 0 0 0-11.31 0L715.37 232.23Q624.91 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 0 0 0 51.5q56.7 119.43 136.55 191.45L112.56 835a8 8 0 0 0 0 11.31L155.25 889a8 8 0 0 0 11.31 0l712.16-712.12a8 8 0 0 0 0-11.32zM332 512a176 176 0 0 1 258.88-155.28l-48.62 48.62a112.08 112.08 0 0 0-140.92 140.92l-48.62 48.62A175.09 175.09 0 0 1 332 512z"}},{tag:"path",attr:{d:"M942.2 486.2Q889.4 375 816.51 304.85L672.37 449A176.08 176.08 0 0 1 445 676.37L322.74 798.63Q407.82 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 0 0 0-51.5z"}}]})(t)}const p9e=()=>P.jsx("div",{children:P.jsxs(ZH,{direction:"column",align:"center",justify:"center",h:/Android|iPhone/i.test(navigator.userAgent)?"80vh":"90vh",minH:"min-content",children:[P.jsxs(cu,{children:[P.jsx(ua,{fontSize:/Android|iPhone/i.test(navigator.userAgent)?"3xl":"5xl",paddingTop:"20px",children:"404 Not Found"}),P.jsx(ua,{textAlign:"justify",fontSize:/Android|iPhone/i.test(navigator.userAgent)?"1xl":"3xl",paddingTop:"10px",children:"Don't worry, we weren't looking."}),P.jsx(Et,{color:"#81E6D9",paddingTop:/Android|iPhone/i.test(navigator.userAgent)?"20%":"",children:P.jsx(h9e,{size:/Android|iPhone/i.test(navigator.userAgent)?"20em":"30em"})})]}),P.jsx(B0,{bottomVal:/Android|iPhone/i.test(navigator.userAgent)?-2:-16})]})}),m9e=({handleTerminate:t,user:e})=>{const{isOpen:n,onOpen:r,onClose:i}=Xm(),o=A.useRef(null),s=()=>{t(),i()};return P.jsxs(P.Fragment,{children:[P.jsx(qn,{color:"#FFF5F5",bgColor:"red.500",variant:"outline",borderColor:"red.100",onClick:r,children:"Terminate Exam"}),P.jsx(Jm,{motionPreset:"scale",size:/Android|iPhone/i.test(navigator.userAgent)?"xs":"lg",isOpen:n,leastDestructiveRef:o,onClose:i,children:P.jsx(fh,{children:P.jsxs(Ym,{children:[P.jsx(dh,{fontSize:"lg",fontWeight:"bold",children:"Terminate Exam"}),P.jsxs(hh,{children:["Are you sure you want to terminate ",e.name,"'s exam?"]}),P.jsxs(lh,{children:[P.jsx(qn,{ref:o,onClick:i,children:"No"}),P.jsx(qn,{colorScheme:"red",onClick:s,ml:3,children:"Yes"})]})]})})})]})},g9e=({handleWarning:t,user:e})=>{const{isOpen:n,onOpen:r,onClose:i}=Xm(),o=A.useRef(null),[s,a]=A.useState(""),[u,c]=A.useState(""),l=()=>{const d=s==="other"?u:s;e.warnings===0&&ir({warningOne:d},"update_warning_one",e.id),e.warnings===1&&ir({warningTwo:d},"update_warning_two",e.id),t(),a(""),c(""),i()};return P.jsxs(P.Fragment,{children:[P.jsx(qn,{color:"#FFF5F5",bgColor:"red.500",variant:"solid",onClick:r,children:"Issue Warning"}),P.jsx(Jm,{motionPreset:"scale",isOpen:n,leastDestructiveRef:o,onClose:()=>{a(""),c(""),i()},children:P.jsx(fh,{children:P.jsxs(Ym,{children:[P.jsx(dh,{fontSize:"lg",fontWeight:"bold",children:"Issue Warning"}),P.jsxs(hh,{paddingTop:"-2",fontWeight:"bold",children:["Warning reason for ",e.name,":"]}),P.jsx(Et,{paddingLeft:"6",paddingRight:"6",paddingTop:"2",children:P.jsx(f8,{colorScheme:"teal",value:s,onChange:a,children:P.jsxs(OC,{spacing:4,children:[P.jsx(vv,{value:"Unidentified user",children:"Unidentified user"}),P.jsx(vv,{value:"Another person present",children:"Another person present"}),P.jsx(vv,{value:"Phone detection",children:"Phone detection"}),P.jsx(vv,{value:"other",children:"Other:"}),s==="other"&&P.jsx(Oy,{placeholder:"Please specify",value:u,onChange:d=>c(d.target.value)})]})})}),P.jsxs(lh,{children:[P.jsx(qn,{ref:o,onClick:i,children:"Cancel"}),P.jsx(qn,{colorScheme:"red",onClick:l,ml:3,isDisabled:!s||s==="other"&&!u,children:"Submit"})]})]})})})]})};let mE;const v9e=({user:t})=>{const n=A.useContext(MC)[t.id],r=A.useRef(null);A.useEffect(()=>{n&&r.current&&(r.current.srcObject=n)},[n]),A.useEffect(()=>{const a=r.current;if(a){const u=a.querySelector("video");if(u){u.style.width="200%";const c=new MutationObserver(()=>{u.style.width!=="200%"&&(u.style.width="200%")});return c.observe(u,{attributes:!0,attributeFilter:["style"]}),()=>c.disconnect()}}},[r.current,n]),BC("student"),PP(!1,!0);const i=oh();A.useEffect(()=>{t!==void 0&&s(t.warnings)},[t]);const[o,s]=A.useState(mE);return t!==void 0&&(mE=t.warnings),P.jsxs(P.Fragment,{children:[P.jsx(Et,{position:"absolute",top:/Android|iPhone/i.test(navigator.userAgent)?10:0,left:"50%",transform:"translateX(-50%)",children:P.jsx(ua,{padding:"10px",children:`Warnings: ${t.warnings}`})}),P.jsxs(cu,{justifyContent:"center",alignItems:"center",spacing:2.5,children:[P.jsx("video",{ref:r,playsInline:!0,autoPlay:!0,muted:!0,style:{marginTop:/Android|iPhone/i.test(navigator.userAgent)?48:0,display:"flex",justifyContent:"center",alignItems:"center",width:/Android|iPhone/i.test(navigator.userAgent)?"80%":"40%",borderRadius:"10px",overflow:"hidden"}}),P.jsx("div",{hidden:t.warnings===2,children:P.jsx(g9e,{user:t,handleWarning:()=>{ir({warnings:o+1},"update_warnings",t.id),s(mE+1),t!==void 0&&(t.warnings=o)}})}),P.jsx("div",{hidden:t.warnings!==2,children:P.jsx(m9e,{user:t,handleTerminate:()=>{ir({terminated:!0},"update_terminate",t.id),t!==void 0&&(t.terminated=!0),i("/teacher")}})})]})]})},y9e=({handleCancel:t})=>{const{isOpen:e,onOpen:n,onClose:r}=Xm(),i=A.useRef(null),o=()=>{t(),r()};return P.jsxs(P.Fragment,{children:[P.jsx("button",{onClick:n,children:P.jsx(Zr,{as:"u",children:"Cancel"})}),P.jsx(Jm,{motionPreset:"scale",isOpen:e,leastDestructiveRef:i,onClose:r,children:P.jsx(fh,{children:P.jsxs(Ym,{children:[P.jsx(dh,{fontSize:"lg",fontWeight:"bold",children:"Are you sure?"}),P.jsx(hh,{children:"You will be not permitted to start your exam without your consent."}),P.jsxs(lh,{children:[P.jsx(qn,{ref:i,onClick:r,children:"No"}),P.jsx(qn,{colorScheme:"red",onClick:o,ml:3,children:"Yes"})]})]})})})]})},b9e=()=>{const t=oh(),[e,n]=A.useState(!1),[r,i]=A.useState(!1);BC("staff");const o=()=>{n(!0),ir({loggedIn:!0},"update_login",nt.id),t("/student")},s=a=>{i(a.target.scrollHeight-a.target.scrollTop-a.target.clientHeight<1)};return P.jsxs(P.Fragment,{children:[P.jsxs(Uc,{justifyContent:"center",children:[P.jsx(LC,{color:"#81E6D9",size:"3em"}),P.jsx(ua,{padding:"10px",children:"Welcome to Eyedentify!"})]}),P.jsx(Et,{children:P.jsxs(cu,{minHeight:"100vh",justifyContent:"center",alignItems:"center",spacing:5,paddingInline:100,paddingBottom:14,children:[P.jsx(Zr,{as:"b",fontSize:"xl",children:"Privacy Terms and Conditions"}),P.jsx("p",{children:"Before you begin your exam, please take a moment to review our Privacy Terms and Conditions. By starting the exam, you agree to the following:"}),P.jsx(Et,{maxWidth:"50vw",maxHeight:"50vh",overflow:"auto",scrollBehavior:"smooth",onScroll:a=>{s(a)},children:P.jsxs(cu,{justifyContent:"left",alignItems:"left",spacing:"10px",backgroundColor:"#202020",padding:"10px",children:[P.jsx(Zr,{as:"b",children:"VIDEO AND AUDIO RECORDING"}),P.jsx("p",{children:"You permit Eyedentify to use your camera for educational and exam integrity purposes. Video recording may be activated during the exam to monitor and prevent any misconduct."}),P.jsx(Zr,{as:"b",children:"DATA USAGE"}),P.jsx("p",{children:"Eyedentify may collect and process personal data, including but not limited to your name and exam results, for the purpose of maintaining exam records and ensuring the exam's security and integrity."}),P.jsx(Zr,{as:"b",children:"THIRD-PARTY TOOLS"}),P.jsx("p",{children:"We may use third-party tools and services to enhance your exam experience. These services may have their own privacy policies, and you are encouraged to review them as well."}),P.jsx(Zr,{as:"b",children:"CONFIDENTIALITY"}),P.jsx("p",{children:"You agree to keep exam content, questions, and any related information confidential. Sharing or discussing exam content with others may result in disqualification."}),P.jsx(Zr,{as:"b",children:"DATA SECURITY"}),P.jsx("p",{children:"Eyedentify employs industry-standard security measures to protect your personal data. However, we cannot guarantee absolute security, and you should also take necessary precautions."}),P.jsx(Zr,{as:"b",children:"EXAM AND CRITERIA CHECK"}),P.jsx("p",{children:"Eyedentify will conduct a criteria check before the exam to ensure the integrity of the examination process. This check may include verifying your identity, system requirements, and network stability."}),P.jsx("p",{children:P.jsx("b",{children:"Please be aware that the time taken for the criteria check will be included in your overall exam time if the exam has started by the examiner. We recommend that you arrive at least 10 minutes before the scheduled start of the exam to ensure these checks are completed efficiently and to avoid any disruption to your exam experience."})}),P.jsx(Zr,{as:"b",children:"COOKIES AND TRACKING"}),P.jsx("p",{children:"We may use cookies and other tracking technologies to improve your user experience. You can manage your cookie preferences through your browser settings."}),P.jsx(Zr,{as:"b",children:"CONTACT INFORMATION"}),P.jsxs("p",{children:["For questions or concerns about your data or these terms, please contact Eyedentify at"," ",P.jsx(Zr,{as:"b",children:P.jsx(soe,{to:"",children:"eyedentify@exam.com"})}),"."]})]})}),P.jsx("p",{children:'By clicking "Start Exam," you acknowledge that you have read and agree to these Privacy Terms and Conditions. If you do not agree with these terms, please do not proceed with the exam.'}),P.jsx("p",{children:"Thank you for using Eyedentify and best of luck with your exam!"}),P.jsx("p",{children:'By clicking "I Accept," you acknowledge that you have read and agree to these Privacy Terms and Conditions.'}),P.jsx(qn,{colorScheme:"teal",variant:"solid",onClick:o,isDisabled:!r,backgroundColor:r?"teal.500":"teal.100",children:"I Accept"}),P.jsx(y9e,{handleCancel:()=>{t("/"),ir({loggedIn:!1},"update_login",nt.id)}})]})}),P.jsx(B0,{bottomVal:0})]})},x9e=()=>{const{data:t,loading:e,error:n}=iC();return P.jsx(roe,{children:P.jsxs(Yie,{children:[P.jsx(Kd,{path:"/",element:P.jsx(Jxe,{})}),P.jsx(Kd,{path:"/student",element:P.jsx(f9e,{})}),P.jsx(Kd,{path:"/teacher",element:P.jsx(SCe,{}),children:t.map(r=>r.userType==="student"&&r.terminated===!1&&P.jsx(Kd,{path:r.id.toString(),element:P.jsx(v9e,{user:r})},r.id))}),P.jsx(Kd,{path:"/privacy",element:P.jsx(b9e,{})}),P.jsx(Kd,{path:"/*",element:P.jsx(p9e,{})})]})})},w9e={initialColorMode:"dark"},jz=gpe({config:w9e,colors:{gray:{50:"#f9f9f9",100:"#ededed",200:"#d3d3d3",300:"#b3b3b3",400:"#a0a0a0",500:"#898989",600:"#6c6c6c",700:"#202020",800:"#121212",900:"#111"}}});vE.createRoot(document.getElementById("root")).render(P.jsxs($0e,{theme:jz,children:[P.jsx(wse,{initialColorMode:jz.config.initialColorMode}),P.jsx(x9e,{})]}))});export default S9e();
